#!/bin/csh

#-----------------------------------------------------------------------------
# Quick and dirty build for unit testing with Host (serial) and TPI devices.
# To be replace with CMake integration.

set INC_PATH="-I../../../../ThreadPool/src -I. -I../../src"

set GCC_SOURCES="../../src/impl/*.cpp ../../src/DeviceHost/*.cpp main.cpp testHost.cpp testTPI.cpp simple_hex_fixture.cpp"

#-----------------------------------------------------------------------------

set GCC_SOURCES="${GCC_SOURCES} ../../../../ThreadPool/src/*.c ../../src/DeviceTPI/*.cpp"

set LIB="-lpthread"

#-----------------------------------------------------------------------------

# /usr/local/cuda/bin/nvcc -arch=sm_20  ${INC_PATH} -O3 -lib -o libCuda.a \
#      ../../src/DeviceCuda/*.cu testCuda.cu

# set LIB="${LIB} -L/usr/local/cuda/lib64 libCuda.a -lcudart -lcuda"

#-----------------------------------------------------------------------------

echo "#define HAVE_PTHREAD" > ThreadPool_config.h

set GCC_FLAGS="-Wall -O3 -fopenmp ${INC_PATH}"

g++ $GCC_FLAGS -c ${GCC_SOURCES}

g++ $GCC_FLAGS -o internal_force.exe *.o ${LIB} 

rm -f *.o *.a ThreadPool_config.h

#-----------------------------------------------------------------------------


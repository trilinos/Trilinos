
INCLUDE(TribitsAddExecutableAndTest)

IF(Kokkos_ENABLE_Cuda)
  #
  # Add subpackage include path dependencies for CUDA_COMPILE().
  CUDA_INCLUDE_DIRECTORIES( "." )
  CUDA_INCLUDE_DIRECTORIES( ${Tpetra_INCLUDE_DIRS} )
  CUDA_COMPILE(M_PL_OBJECTS_CUDA Map_ProblematicLookup_CU.cu)
  CUDA_COMPILE(M_B5378_OBJECTS_CUDA Map_Bug5378_CU.cu)
  CUDA_COMPILE(M_B5399_OBJECTS_CUDA Map_Bug5399_CU.cu)
  CUDA_COMPILE(M_B6051_OBJECTS_CUDA Map_Bug6051_CU.cu)
  CUDA_COMPILE(M_UT_OBJECTS_CUDA Map_UnitTests_CU.cu)
  CUDA_COMPILE(NBIT_OBJECTS_CUDA NegativeBaseIndexTest_CU.cu)
  CUDA_COMPILE(M_OTO_OBJECTS_CUDA Map_OneToOne_CU.cu)
  CUDA_COMPILE(M_B5822_OBJECTS_CUDA Map_Bug5822_CU.cu)
  CUDA_COMPILE(M_B5822_2_OBJECTS_CUDA Map_Bug5822_2_CU.cu)
  CUDA_COMPILE(M_ET_B5882_OBJECTS_CUDA Map_ExportTest_Bug5882_CU.cu)
  CUDA_COMPILE(M_REP_OBJECTS_CUDA Map_removeEmptyProcesses_CU.cu)
  CUDA_COMPILE(M_RCWS_OBJECTS_CUDA Map_replaceCommWithSubset_CU.cu)
  CUDA_COMPILE(IS_ONE_TO_ONE_OBJECTS_CUDA isOneToOne_CU.cu)
ENDIF()

TRIBITS_ADD_EXECUTABLE_AND_TEST(
  Map_ProblematicLookup
  SOURCES
    Map_ProblematicLookup
    ${M_PL_OBJECTS_CUDA}
    ${TEUCHOS_STD_UNIT_TEST_MAIN}
  COMM mpi
  NUM_MPI_PROCS 2
  STANDARD_PASS_OUTPUT
  )

TRIBITS_ADD_EXECUTABLE_AND_TEST(
  Map_Bug5378
  SOURCES
    Map_Bug5378
    ${M_B5378_OBJECTS_CUDA}
    ${TEUCHOS_STD_UNIT_TEST_MAIN}
  COMM mpi
  NUM_MPI_PROCS 1
  STANDARD_PASS_OUTPUT
  )

TRIBITS_ADD_EXECUTABLE_AND_TEST(
  Map_Bug5399
  SOURCES
    Map_Bug5399
    ${M_B5399_OBJECTS_CUDA}
    ${TEUCHOS_STD_UNIT_TEST_MAIN}
  COMM mpi
  NUM_MPI_PROCS 4
  STANDARD_PASS_OUTPUT
  )

TRIBITS_ADD_EXECUTABLE_AND_TEST(
  Map_Bug6051
  SOURCES
    Map_Bug6051
    ${M_B6051_OBJECTS_CUDA}
    ${TEUCHOS_STD_UNIT_TEST_MAIN}
  COMM mpi
  NUM_MPI_PROCS 2
  STANDARD_PASS_OUTPUT
  )

TRIBITS_ADD_EXECUTABLE_AND_TEST(
  Map_UnitTests
  SOURCES
    Map_UnitTests
    ${M_UT_OBJECTS_CUDA}
    ${TEUCHOS_STD_UNIT_TEST_MAIN}
  COMM serial mpi
  STANDARD_PASS_OUTPUT
  )

# Tpetra bug 5401:
# https://software.sandia.gov/bugzilla/show_bug.cgi?id=5401
TRIBITS_ADD_EXECUTABLE_AND_TEST(
  NegativeBaseIndexTest
  SOURCES
    NegativeBaseIndexTest
    ${NBIT_OBJECTS_CUDA}
  ${TEUCHOS_STD_UNIT_TEST_MAIN}
  COMM mpi
  STANDARD_PASS_OUTPUT
  NUM_MPI_PROCS 2
  )

TRIBITS_ADD_EXECUTABLE_AND_TEST(
  Map_OneToOne
  SOURCES
    Map_OneToOne
    ${M_OTO_OBJECTS_CUDA}
    ${TEUCHOS_STD_UNIT_TEST_MAIN}
  COMM serial mpi
  STANDARD_PASS_OUTPUT
  NUM_MPI_PROCS 2
  )

# Tpetra bug 5822, first test.
TRIBITS_ADD_EXECUTABLE_AND_TEST(
  Map_Bug5822
  SOURCES
    Map_Bug5822
    ${M_B5822_OBJECTS_CUDA}
    ${TEUCHOS_STD_UNIT_TEST_MAIN}
  COMM mpi
  STANDARD_PASS_OUTPUT
  NUM_MPI_PROCS 2
  )

# Tpetra bug 5822, second test.
TRIBITS_ADD_EXECUTABLE_AND_TEST(
  Map_Bug5822_2
  SOURCES
    Map_Bug5822_2
    ${M_B5822_2_OBJECTS_CUDA}
    ${TEUCHOS_STD_UNIT_TEST_MAIN}
  COMM mpi
  STANDARD_PASS_OUTPUT
  NUM_MPI_PROCS 2
  )

# Tpetra bug 5882
TRIBITS_ADD_EXECUTABLE_AND_TEST(
  Map_ExportTest_Bug5882
  SOURCES
    Map_ExportTest_Bug5882
    ${M_ET_B5882_OBJECTS_CUDA}
  COMM serial mpi
  PASS_REGULAR_EXPRESSION "passed!"
  NUM_MPI_PROCS 2
  )

TRIBITS_ADD_EXECUTABLE_AND_TEST(
  Map_removeEmptyProcesses
  SOURCES
    Map_removeEmptyProcesses
    ${M_REP_OBJECTS_CUDA}
    ${TEUCHOS_STD_UNIT_TEST_MAIN}
  COMM mpi
  NUM_MPI_PROCS 1-10
  STANDARD_PASS_OUTPUT
  )

TRIBITS_ADD_EXECUTABLE_AND_TEST(
  Map_replaceCommWithSubset
  SOURCES
    Map_replaceCommWithSubset
    ${M_RCWS_OBJECTS_CUDA}
    ${TEUCHOS_STD_UNIT_TEST_MAIN}
  COMM mpi
  NUM_MPI_PROCS 1-10
  STANDARD_PASS_OUTPUT
  )

TRIBITS_ADD_EXECUTABLE_AND_TEST(
  Map_isOneToOne
  SOURCES
    isOneToOne
    ${IS_ONE_TO_ONE_OBJECTS_CUDA}
    ${TEUCHOS_STD_UNIT_TEST_MAIN}
  COMM serial mpi
  NUM_MPI_PROCS 1-10
  STANDARD_PASS_OUTPUT
  )

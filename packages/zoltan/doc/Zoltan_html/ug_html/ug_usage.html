<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.7 [en] (X11; U; SunOS 5.6 sun4m) [Netscape]">
   <meta name="sandia.approved" content="SAND99-1377">
   <meta name="author" content="karen devine, kddevin@sandia.gov">
   <title>Zoltan User's Guide:  Library Usage</title>
<!-----------------------------------------------------------------------------
 ! Zoltan Library for Parallel Applications            !
 ! Copyright (c) 2000,2001,2002, Sandia National Laboratories.                !
 ! This document is released under the GNU Lesser General Public License.     !
 ! For more info, see the README file in the top-level Zoltan directory.      !
 !----------------------------------------------------------------------------!
-->
<!-- CVS File Information
     $RCSfile$
     $Author$
     $Date$
     $Revision$
-->

</head>
<body bgcolor="#FFFFFF">

<div align=right><b><i><a href="ug.html">Zoltan User's Guide</a>&nbsp;
|&nbsp; <a href="ug_interface.html">Next</a>&nbsp; |&nbsp; <a href="ug_release.html">Previous</a></i></b></div>

<h2>
<a NAME="Using the Library"></a>Using the Zoltan library</h2>
This section contains information needed to use the Zoltan library with
applications:
<blockquote><a href="#System Requirements">System requirements.</a>
<br><a href="#Data Types for Object IDs">Data types</a> for global and
local IDs.
<br>Instructions for <a href="#Building the Library">building the Zoltan
library.</a>
<br>Instructions for <a href="#Building Applications">building applications</a>
that use Zoltan.</blockquote>

<h3>
<a NAME="System Requirements"></a>System Requirements</h3>
Zoltan was designed to run on parallel computers and clusters of workstations.
In order to build and use Zoltan, you will need:
<ul>
<li>
ANSI C compiler.</li>

<li>
<a href="http://www-unix.mcs.anl.gov/mpi/">MPI</a> library for message
passing (version 1.1 or higher), such as MPICH or LAM.</li>

<li>
A Unix-like operating system (e.g., Linux or Solaris) and
<i>gmake</i> (GNU Make) are recommended to build the library.</li>

<li>
A Fortran90 compatible compiler is required if you wish to 
<a href="ug_fortran.html">use Zoltan
with Fortran applications</a>.</li>
</ul>

Zoltan has been tested on a variety of platforms, including Linux, Solaris, Irix,
and the <a href="http://www.sandia.gov/ASCI/Red/">ASCI Red</a> Teraflop machine.
If you wish to use Zoltan on a non-Unix operating system, for example Windows NT or 2000,
you will have to port Zoltan yourself.

<h3>
<a NAME="Data Types for Object IDs"></a>Data Types for Object IDs</h3>
Application query functions and application callable library functions
use global and local identifiers (IDs) for objects. <i>All objects to be
used in load balancing must have unique global IDs.</i> Zoltan stores an
ID as an array of unsigned integers. The number of entries in these arrays
can be set using the <a href="ug_param.html#NUM_GID_ENTRIES">NUM_GID_ENTRIES</a>
and <a href="ug_param.html#NUM_LID_ENTRIES">NUM_LID_ENTRIES</a> parameters;
by default, one unsigned integer represents an ID. Applications may use
whatever format is most convenient to store their IDs; the IDs can then
be converted to and from Zoltan's ID format in the <a href="ug_query.html">application-registered
query functions</a>.
<p>The following type definitions are defined in <i>include/zoltan_types.h</i>; they can
be used by an application for memory allocation, MPI communication, and
as arguments to
<a href="ug_interface.html">load-balancing interface functions</a>
and
<a href="ug_query.html">application-registered query functions</a>.
<blockquote>typedef unsigned int <b>ZOLTAN_ID_TYPE</b>;
<br>typedef <b>ZOLTAN_ID_TYPE</b> *<b>ZOLTAN_ID_PTR</b>;
<br>#define <b>ZOLTAN_ID_MPI_TYPE</b> MPI_UNSIGNED</blockquote>
In the Fortran interface, IDs are passed as arrays of integers since unsigned
integers are not supported in Fortran. See the description of the <a href="ug_fortran_api.html#fortran ug api IDs">Fortran
interface</a> for more details.
<p>The local IDs passed to Zoltan are not used by the library; they are
provided for the convenience of the application and can contain any information
desired by the application. For instance, local array indices for objects
may be passed as local IDs, enabling direct access to object data in the
query function routines. See the <a href="ug_query.html">application-registered
query functions</a> for more details. The source code distribution contains
an example application <i><a href="../dev_html/dev_driver.html">zdrive</a></i>
in which global IDs are integers and local IDs are local array indices.
One may choose not to use local ids at all, in which case <a href="ug_param.html#NUM_LID_ENTRIES">NUM_LID_ENTRIES</a>
may be set to zero.
<p>Some Zoltan routines (e.g., 
<a href="ug_interface_lb.html#Zoltan_LB_Partition"><b>Zoltan_LB_Partition</b></a>
and 
<a href="ug_interface_mig.html#Zoltan_Invert_Lists"><b>Zoltan_Invert_Lists</b></a>)
allocate arrays of type <b>ZOLTAN_ID_PTR</b> and return them to the application.
Others (e.g., <b>Zoltan_Order</b> and 
<a href="ug_util_dd.html#DD_Find"><b>Zoltan_DD_Find</b></a>) require
the application to allocate memory for IDs.  Memory for IDs can be allocated
as follows:
<blockquote><tt>
  ZOLTAN_ID_PTR gids;<br>
  int num_gids, int num_gid_entries;<br>
  gids = (ZOLTAN_ID_PTR) <a href="ug_util_mem.html#Zoltan_Malloc">ZOLTAN_MALLOC</a>(num_gids * num_gid_entries * sizeof(ZOLTAN_ID_TYPE);<br>
</tt></blockquote>
The system call <i>malloc</i> may be used instead of 
<a href="ug_util_mem.html#Zoltan_Malloc"><b>ZOLTAN_MALLOC</b></a>.

<h3>
<a NAME="Building the Library"></a>Building the Zoltan Library</h3>
The Zoltan library is implemented in ANSI C and can be compiled with any
ANSI C compiler.&nbsp; Makefiles are included with the source code; these
makefiles require the GNU Make (gmake) utility.  The
top-level Makefile defines targets for the Zoltan library and <a href="../dev_html/dev_driver.html">test
driver</a> programs in C and Fortran90.&nbsp; This Makefile need not be
edited to build Zoltan.&nbsp; Instead, environment-specific definitions
are specified in the configuration file, <i>Utilities/Config/Config.&lt;platform></i>,
where <i>&lt;platform></i> specifies the particular platform for which
Zoltan is being built.&nbsp; Paths to compilers, include files, and libraries
are defined in this file and are then read by the top-level Makefile.&nbsp;
Examples of configuration files for Solaris, Sandia's ASCI Red (tflop)
computer, SGI workstations, and PCs running Linux are
included in the <i>Utilities/Config</i> subdirectory.&nbsp;&nbsp; A well-commented
version of the configuration file, <i>Utilities/Config/Config.generic</i>,
is also included; this file can be used as a template for new environment-specific
files.&nbsp; The variables in these files should be edited to reflect the
new system's environment.
<p>The command for building Zoltan is shown below:
<blockquote>gmake [options] zoltan</blockquote>
where the options that may be specified are listed below.
<table WIDTH="100%" >
<tr>
<td><b>Options to gmake:</b></td>

<td>&nbsp;</td>
</tr>

<tr>
<td VALIGN=TOP><i>&nbsp;&nbsp;&nbsp; ZOLTAN_ARCH=&lt;platform></i></td>

<td>Specify the target architecture for the Zoltan library.&nbsp; A corresponding
file, <i>Utilities/Config/Config.&lt;platform></i>, containing environment
definitions for <i>&lt;platform</i>>, must be created in the
<i>Utilities/Config</i>
directory.</td>
</tr>

<tr>
<td VALIGN=TOP><i>&nbsp;&nbsp;&nbsp; YES_FORTRAN=1</i></td>

<td>Include Fortran support in the Zoltan library.&nbsp; By default, the
Zoltan library is built without the interface that allows use from Fortran
applications.&nbsp; If this option is specified, the
<a href="ug_fortran.html">Fortran
interface</a> is compiled and included in the library.&nbsp; Use of this
option requires that a Fortran 90 (or 95, or later) compiler is available.</td>
</tr>
</table>
As an alternative to typing the options on the gmake command line, they
may be set as environment variables; e.g., if you are using a C-shell (csh or tcsh),
type
<blockquote>
setenv ZOLTAN_ARCH <i>&lt;platform></i>
</blockquote>
or if you are using a Bourne-type shell (e.g., sh or bash), type
<blockquote>
ZOLTAN_ARCH = <i>&lt;platform>; </i>export ZOLTAN_ARCH
</blockquote>
The resulting library <i>libzoltan.a</i>, object files, and dependency files
are stored in the directory Obj_&lt;<i>platform</i>>.
<h3>
<a NAME="Building Applications"></a>Building Applications that use Zoltan</h3>
The library interface is described in the C include file <i>include/zoltan_types.h</i>;
this file should be included in all application source files that call
Zoltan library routines. Similarly, <a href="ug_fortran_apps.html">Fortran applications</a> must USE
<a href="ug_fortran_api.html#fortran ug api zoltan module">module
zoltan</a> and 
specify <i>Zoltan/Obj_&lt;platform></i>
as a directory to be searched for module information files.
The application should then be linked with the Zoltan library
and its <a href="../ug_html/ug_util.html">utility libraries</a> by including
<blockquote><i>-lzoltan </i></blockquote>
in the linking command for the application. 
Communication within
Zoltan is performed through MPI, so appropriate MPI libraries must be linked
with the application. Third-party libraries, such as <a href="ug_alg_parmetis.html">ParMETIS</a>
and <a href="http://www.gre.ac.uk/~jjg01/">Jostle</a>, must be also be
linked with the application if they were included in compilation of the
Zoltan library.&nbsp; (A courtesy copy of <a href="http://www-users.cs.umn.edu/~karypis/metis/parmetis/">ParMETIS</a>
is included with the Zoltan distribution; <a href="http://www.gre.ac.uk/~jjg01/">Jostle</a>
must be obtained directly from <a href="http://www.gre.ac.uk/~jjg01/">http://www.gre.ac.uk/~jjg01/</a>.)
<br>&nbsp;
<p>
For applications that used versions of Zoltan before Zoltan v.1.3, 
only minor updates to the application build process are
needed; see the section on <a href="ug_backward.html">backward
compatibility</a> of Zoltan.
<p>
<hr WIDTH="100%">[<a href="ug.html">Table of Contents</a>&nbsp; | <a href="ug_interface.html">Next:&nbsp;
Zoltan Interface Functions</a>&nbsp; |&nbsp; <a href="ug_release.html">Previous:
Zoltan Release Notes</a>]
</body>
</html>

<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<title>TriBITS Developers Guide and Reference</title>
<meta name="author" content="Roscoe A. Bartlett (bartlettra&#64;ornl.gov)" />
<meta name="date" content="2014-11-22" />
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5951 2009-05-18 18:03:10Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left{
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="tribits-developers-guide-and-reference">
<h1 class="title">TriBITS Developers Guide and Reference</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Roscoe A. Bartlett (<a class="reference external" href="mailto:bartlettra&#64;ornl.gov">bartlettra&#64;ornl.gov</a>)</td></tr>
<tr><th class="docinfo-name">Date:</th>
<td>2014-11-22</td></tr>
<tr><th class="docinfo-name">Version:</th>
<td>TriBITS Development at 2014-11-22</td></tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Abstract:</th><td class="field-body">This document describes the usage of TriBITS to build, test, and deploy complex software.  The primary audience are those individuals who develop on a software project which uses TriBITS.  The overall structure of a TriBITS project is described including all of the various project- and package-specific files that TriBITS requires or can use and how and what order these files are processed.  It also contains detailed reference information on all of the various TriBITS macros and functions directly used in TriBITS project CMake files.  Many other topics of interest to a TriBITS project developer and architect are discussed as well.</td>
</tr>
</tbody>
</table>
<!-- Above, the depth of the TOC is set to just 2 because I don't want the -->
<!-- TriBITS function/macro names to have section numbers appearing before them. -->
<!-- Also, some of them are long and I don't want them to go off the page of the -->
<!-- PDF document. -->
<!-- Sections in this document use the underlines: -->
<!--  -->
<!-- Level-1 ================== -->
<!-- Level-2 - - - - - - - - - - - - - - - - - - -->
<!-- Level-3 ++++++++++++++++++ -->
<!-- Level-4 .................. -->
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#introduction" id="id4">1&nbsp;&nbsp;&nbsp;Introduction</a></li>
<li><a class="reference internal" href="#background" id="id5">2&nbsp;&nbsp;&nbsp;Background</a><ul class="auto-toc">
<li><a class="reference internal" href="#tribits-developer-and-user-roles" id="id6">2.1&nbsp;&nbsp;&nbsp;TriBITS Developer and User Roles</a></li>
<li><a class="reference internal" href="#cmake-language-overview-and-gotchas" id="id7">2.2&nbsp;&nbsp;&nbsp;CMake Language Overview and Gotchas</a></li>
<li><a class="reference internal" href="#software-engineering-packaging-principles" id="id8">2.3&nbsp;&nbsp;&nbsp;Software Engineering Packaging Principles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-project-structure" id="id9">3&nbsp;&nbsp;&nbsp;TriBITS Project Structure</a><ul class="auto-toc">
<li><a class="reference internal" href="#tribits-structural-units" id="id10">3.1&nbsp;&nbsp;&nbsp;TriBITS Structural Units</a><ul>
<li><a class="reference internal" href="#tribits-project" id="id11">TriBITS Project</a><ul>
<li><a class="reference internal" href="#tribits-project-core-files" id="id12">TriBITS Project Core Files</a></li>
<li><a class="reference internal" href="#tribits-project-core-variables" id="id13">TriBITS Project Core Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-repository" id="id14">TriBITS Repository</a><ul>
<li><a class="reference internal" href="#tribits-repository-core-files" id="id15">TriBITS Repository Core Files</a></li>
<li><a class="reference internal" href="#tribits-repository-core-variables" id="id16">TriBITS Repository Core Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-package" id="id17">TriBITS Package</a><ul>
<li><a class="reference internal" href="#tribits-package-core-files" id="id18">TriBITS Package Core Files</a></li>
<li><a class="reference internal" href="#tribits-package-core-variables" id="id19">TriBITS Package Core Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-subpackage" id="id20">TriBITS Subpackage</a><ul>
<li><a class="reference internal" href="#tribits-subpackage-core-files" id="id21">TriBITS Subpackage Core Files</a></li>
<li><a class="reference internal" href="#tribits-subpackage-core-variables" id="id22">TriBITS Subpackage Core Variables</a></li>
<li><a class="reference internal" href="#how-is-a-tribits-subpackage-is-different-from-a-tribits-package" id="id23">How is a TriBITS Subpackage is different from a TriBITS Package?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-tpl" id="id24">TriBITS TPL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#processing-of-tribits-files-ordering-and-details" id="id25">3.2&nbsp;&nbsp;&nbsp;Processing of TriBITS Files: Ordering and Details</a><ul>
<li><a class="reference internal" href="#full-tribits-project-configuration" id="id26">Full TriBITS Project Configuration</a></li>
<li><a class="reference internal" href="#reduced-package-dependency-processing" id="id27">Reduced Package Dependency Processing</a></li>
<li><a class="reference internal" href="#file-processing-tracing" id="id28">File Processing Tracing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coexisting-projects-repositories-and-packages" id="id29">3.3&nbsp;&nbsp;&nbsp;Coexisting Projects, Repositories, and Packages</a></li>
<li><a class="reference internal" href="#standard-tribits-tpls" id="id30">3.4&nbsp;&nbsp;&nbsp;Standard TriBITS TPLs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-tribits-projects" id="id31">4&nbsp;&nbsp;&nbsp;Example TriBITS Projects</a><ul class="auto-toc">
<li><a class="reference internal" href="#tribitshelloworld" id="id32">4.1&nbsp;&nbsp;&nbsp;TribitsHelloWorld</a></li>
<li><a class="reference internal" href="#tribitsexampleproject" id="id33">4.2&nbsp;&nbsp;&nbsp;TribitsExampleProject</a></li>
<li><a class="reference internal" href="#mocktrilinos" id="id34">4.3&nbsp;&nbsp;&nbsp;MockTrilinos</a></li>
<li><a class="reference internal" href="#reducedmocktrilinos" id="id35">4.4&nbsp;&nbsp;&nbsp;ReducedMockTrilinos</a></li>
<li><a class="reference internal" href="#trilinos" id="id36">4.5&nbsp;&nbsp;&nbsp;Trilinos</a></li>
<li><a class="reference internal" href="#the-tribits-test-package" id="id37">4.6&nbsp;&nbsp;&nbsp;The TriBITS Test Package</a></li>
</ul>
</li>
<li><a class="reference internal" href="#package-dependencies-and-enable-disable-logic" id="id38">5&nbsp;&nbsp;&nbsp;Package Dependencies and Enable/Disable Logic</a><ul class="auto-toc">
<li><a class="reference internal" href="#example-reducedmocktrilinos-project-dependency-structure" id="id39">5.1&nbsp;&nbsp;&nbsp;Example ReducedMockTrilinos Project Dependency Structure</a></li>
<li><a class="reference internal" href="#tribits-dependency-handling-behaviors" id="id40">5.2&nbsp;&nbsp;&nbsp;TriBITS Dependency Handling Behaviors</a></li>
<li><a class="reference internal" href="#example-enable-disable-use-cases" id="id41">5.3&nbsp;&nbsp;&nbsp;Example Enable/Disable Use Cases</a></li>
<li><a class="reference internal" href="#project-packagedependencies-xml" id="id42">5.4&nbsp;&nbsp;&nbsp;&lt;Project&gt;PackageDependencies.xml</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-automated-testing" id="id43">6&nbsp;&nbsp;&nbsp;TriBITS Automated Testing</a><ul class="auto-toc">
<li><a class="reference internal" href="#test-classifications-for-repositories-packages-and-tests" id="id44">6.1&nbsp;&nbsp;&nbsp;Test Classifications for Repositories, Packages, and Tests</a></li>
<li><a class="reference internal" href="#nested-layers-of-tribits-project-testing" id="id45">6.2&nbsp;&nbsp;&nbsp;Nested Layers of TriBITS Project Testing</a></li>
<li><a class="reference internal" href="#pre-push-testing-using-checkin-test-py" id="id46">6.3&nbsp;&nbsp;&nbsp;Pre-push Testing using checkin-test.py</a></li>
<li><a class="reference internal" href="#tribits-package-by-package-ctest-dash-driver" id="id47">6.4&nbsp;&nbsp;&nbsp;TriBITS Package-by-Package CTest/Dash Driver</a><ul>
<li><a class="reference internal" href="#ctest-cdash-nightly-testing" id="id48">CTest/CDash Nightly Testing</a></li>
<li><a class="reference internal" href="#ctest-cdash-ci-server" id="id49">CTest/CDash CI Server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-cdash-customizations" id="id50">6.5&nbsp;&nbsp;&nbsp;TriBITS CDash Customizations</a><ul>
<li><a class="reference internal" href="#cdash-regression-email-addresses" id="id51">CDash regression email addresses</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#multi-repository-support" id="id52">7&nbsp;&nbsp;&nbsp;Multi-Repository Support</a></li>
<li><a class="reference internal" href="#development-workflows" id="id53">8&nbsp;&nbsp;&nbsp;Development Workflows</a><ul class="auto-toc">
<li><a class="reference internal" href="#basic-development-workflow" id="id54">8.1&nbsp;&nbsp;&nbsp;Basic Development Workflow</a></li>
<li><a class="reference internal" href="#multi-repository-development-workflow" id="id55">8.2&nbsp;&nbsp;&nbsp;Multi-Repository Development Workflow</a></li>
</ul>
</li>
<li><a class="reference internal" href="#howtos" id="id56">9&nbsp;&nbsp;&nbsp;Howtos</a><ul class="auto-toc">
<li><a class="reference internal" href="#how-to-add-a-new-tribits-package" id="id57">9.1&nbsp;&nbsp;&nbsp;How to Add a new TriBITS Package</a></li>
<li><a class="reference internal" href="#how-to-add-a-new-tribits-package-with-subpackages" id="id58">9.2&nbsp;&nbsp;&nbsp;How to Add a new TriBITS Package with Subpackages</a></li>
<li><a class="reference internal" href="#how-to-add-a-new-tribits-subpackage" id="id59">9.3&nbsp;&nbsp;&nbsp;How to Add a new TriBITS Subpackage</a></li>
<li><a class="reference internal" href="#how-to-add-a-new-tribits-tpl" id="id60">9.4&nbsp;&nbsp;&nbsp;How to Add a new TriBITS TPL</a></li>
<li><a class="reference internal" href="#how-to-add-a-new-tribits-repository" id="id61">9.5&nbsp;&nbsp;&nbsp;How to Add a new TriBITS Repository</a></li>
<li><a class="reference internal" href="#how-to-add-a-new-tribits-se-package-dependency" id="id62">9.6&nbsp;&nbsp;&nbsp;How to add a new TriBITS SE Package dependency</a></li>
<li><a class="reference internal" href="#how-to-add-a-new-tribits-tpl-dependency" id="id63">9.7&nbsp;&nbsp;&nbsp;How to add a new TriBITS TPL dependency</a></li>
<li><a class="reference internal" href="#how-to-insert-a-package-into-an-upstream-repo" id="id64">9.8&nbsp;&nbsp;&nbsp;How to insert a package into an upstream repo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-topics" id="id65">10&nbsp;&nbsp;&nbsp;Additional Topics</a><ul class="auto-toc">
<li><a class="reference internal" href="#tribits-system-project-dependencies" id="id66">10.1&nbsp;&nbsp;&nbsp;TriBITS System Project Dependencies</a></li>
<li><a class="reference internal" href="#project-specific-build-quick-reference" id="id67">10.2&nbsp;&nbsp;&nbsp;Project-Specific Build Quick Reference</a></li>
<li><a class="reference internal" href="#project-and-repository-versioning-and-release-mode" id="id68">10.3&nbsp;&nbsp;&nbsp;Project and Repository Versioning and Release Mode</a></li>
<li><a class="reference internal" href="#tribits-environment-probing-and-setup" id="id69">10.4&nbsp;&nbsp;&nbsp;TriBITS Environment Probing and Setup</a></li>
<li><a class="reference internal" href="#configure-time-system-tests" id="id70">10.5&nbsp;&nbsp;&nbsp;Configure-time System Tests</a></li>
<li><a class="reference internal" href="#creating-source-distributions" id="id71">10.6&nbsp;&nbsp;&nbsp;Creating Source Distributions</a></li>
<li><a class="reference internal" href="#multi-repository-almost-continuous-integration" id="id72">10.7&nbsp;&nbsp;&nbsp;Multi-Repository Almost Continuous Integration</a><ul>
<li><a class="reference internal" href="#aci-introduction" id="id73">ACI Introduction</a></li>
<li><a class="reference internal" href="#aci-multi-git-tribits-repo-integration-example" id="id74">ACI Multi-Git/TriBITS Repo Integration Example</a></li>
<li><a class="reference internal" href="#aci-local-sync-git-repo-setup" id="id75">ACI Local Sync Git Repo Setup</a></li>
<li><a class="reference internal" href="#aci-integration-build-directory-setup" id="id76">ACI Integration Build Directory Setup</a></li>
<li><a class="reference internal" href="#aci-sync-driver-script" id="id77">ACI Sync Driver Script</a></li>
<li><a class="reference internal" href="#aci-cron-job-setup" id="id78">ACI Cron Job Setup</a></li>
<li><a class="reference internal" href="#addressing-aci-failures-and-summary" id="id79">Addressing ACI Failures and Summary</a></li>
</ul>
</li>
<li><a class="reference internal" href="#post-push-ci-and-nightly-testing-using-checkin-test-py" id="id80">10.8&nbsp;&nbsp;&nbsp;Post-Push CI and Nightly Testing using checkin-test.py</a></li>
<li><a class="reference internal" href="#tribits-dashboard-driver" id="id81">10.9&nbsp;&nbsp;&nbsp;TriBITS Dashboard Driver</a></li>
<li><a class="reference internal" href="#regulated-backward-compatibility-and-deprecated-code" id="id82">10.10&nbsp;&nbsp;&nbsp;Regulated Backward Compatibility and Deprecated Code</a><ul>
<li><a class="reference internal" href="#setting-up-support-for-deprecated-code-handling" id="id83">Setting up support for deprecated code handling</a></li>
<li><a class="reference internal" href="#deprecating-code-but-maintaining-backward-compatibility" id="id84">Deprecating code but maintaining backward compatibility</a><ul>
<li><a class="reference internal" href="#deprecating-c-c-classes-structs-functions-typdefs-etc" id="id85">Deprecating C/C++ classes, structs, functions, typdefs, etc.</a></li>
<li><a class="reference internal" href="#deprecating-preprocessor-macros" id="id86">Deprecating preprocessor macros</a></li>
<li><a class="reference internal" href="#deprecating-an-entire-header-and-or-source-file" id="id87">Deprecating an entire header and/or source file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hiding-deprecated-code-to-certify-and-facilitate-later-removal" id="id88">Hiding deprecated code to certify and facilitate later removal</a><ul>
<li><a class="reference internal" href="#hiding-c-c-entities" id="id89">Hiding C/C++ entities</a></li>
<li><a class="reference internal" href="#hiding-entire-deprecated-header-and-source-files" id="id90">Hiding entire deprecated header and source files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#physically-removing-deprecated-code" id="id91">Physically removing deprecated code</a><ul>
<li><a class="reference internal" href="#removing-entire-deprecated-header-and-source-files" id="id92">Removing entire deprecated header and source files</a></li>
<li><a class="reference internal" href="#removing-deprecated-code-from-remaining-files" id="id93">Removing deprecated code from remaining files</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#installation-and-backward-compatibility-testing" id="id94">10.11&nbsp;&nbsp;&nbsp;Installation and Backward Compatibility Testing</a></li>
<li><a class="reference internal" href="#wrapping-externally-configured-built-software" id="id95">10.12&nbsp;&nbsp;&nbsp;Wrapping Externally Configured/Built Software</a></li>
<li><a class="reference internal" href="#tribits-directory-snapshotting" id="id96">10.13&nbsp;&nbsp;&nbsp;TriBITS directory snapshotting</a></li>
<li><a class="reference internal" href="#tribits-development-toolset" id="id97">10.14&nbsp;&nbsp;&nbsp;TriBITS Development Toolset</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references" id="id98">11&nbsp;&nbsp;&nbsp;References</a></li>
<li><a class="reference internal" href="#tribits-detailed-reference-documentation" id="id99">12&nbsp;&nbsp;&nbsp;TriBITS Detailed Reference Documentation</a><ul class="auto-toc">
<li><a class="reference internal" href="#tribits-global-project-settings" id="id100">12.1&nbsp;&nbsp;&nbsp;TriBITS Global Project Settings</a></li>
<li><a class="reference internal" href="#tribits-macros-and-functions" id="id101">12.2&nbsp;&nbsp;&nbsp;TriBITS Macros and Functions</a><ul>
<li><a class="reference internal" href="#tribits-add-advanced-test" id="id102">TRIBITS_ADD_ADVANCED_TEST()</a></li>
<li><a class="reference internal" href="#tribits-add-debug-option" id="id103">TRIBITS_ADD_DEBUG_OPTION()</a></li>
<li><a class="reference internal" href="#tribits-add-example-directories" id="id104">TRIBITS_ADD_EXAMPLE_DIRECTORIES()</a></li>
<li><a class="reference internal" href="#tribits-add-executable" id="id105">TRIBITS_ADD_EXECUTABLE()</a></li>
<li><a class="reference internal" href="#tribits-add-executable-and-test" id="id106">TRIBITS_ADD_EXECUTABLE_AND_TEST()</a></li>
<li><a class="reference internal" href="#tribits-add-library" id="id107">TRIBITS_ADD_LIBRARY()</a></li>
<li><a class="reference internal" href="#tribits-add-option-and-define" id="id108">TRIBITS_ADD_OPTION_AND_DEFINE()</a></li>
<li><a class="reference internal" href="#tribits-add-show-deprecated-warnings-option" id="id109">TRIBITS_ADD_SHOW_DEPRECATED_WARNINGS_OPTION()</a></li>
<li><a class="reference internal" href="#tribits-add-test" id="id110">TRIBITS_ADD_TEST()</a></li>
<li><a class="reference internal" href="#tribits-add-test-directories" id="id111">TRIBITS_ADD_TEST_DIRECTORIES()</a></li>
<li><a class="reference internal" href="#tribits-allow-missing-external-packages" id="id112">TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES()</a></li>
<li><a class="reference internal" href="#tribits-configure-file" id="id113">TRIBITS_CONFIGURE_FILE()</a></li>
<li><a class="reference internal" href="#tribits-copy-files-to-binary-dir" id="id114">TRIBITS_COPY_FILES_TO_BINARY_DIR()</a></li>
<li><a class="reference internal" href="#tribits-ctest-driver" id="id115">TRIBITS_CTEST_DRIVER()</a></li>
<li><a class="reference internal" href="#tribits-determine-if-current-package-needs-rebuilt" id="id116">TRIBITS_DETERMINE_IF_CURRENT_PACKAGE_NEEDS_REBUILT()</a></li>
<li><a class="reference internal" href="#tribits-disable-package-on-platforms" id="id117">TRIBITS_DISABLE_PACKAGE_ON_PLATFORMS()</a></li>
<li><a class="reference internal" href="#tribits-exclude-files" id="id118">TRIBITS_EXCLUDE_FILES()</a></li>
<li><a class="reference internal" href="#tribits-find-most-recent-binary-file-timestamp" id="id119">TRIBITS_FIND_MOST_RECENT_BINARY_FILE_TIMESTAMP()</a></li>
<li><a class="reference internal" href="#tribits-find-most-recent-file-timestamp" id="id120">TRIBITS_FIND_MOST_RECENT_FILE_TIMESTAMP()</a></li>
<li><a class="reference internal" href="#tribits-find-most-recent-source-file-timestamp" id="id121">TRIBITS_FIND_MOST_RECENT_SOURCE_FILE_TIMESTAMP()</a></li>
<li><a class="reference internal" href="#tribits-include-directories" id="id122">TRIBITS_INCLUDE_DIRECTORIES()</a></li>
<li><a class="reference internal" href="#id1" id="id123">TRIBITS_PACKAGE()</a></li>
<li><a class="reference internal" href="#tribits-package-decl" id="id124">TRIBITS_PACKAGE_DECL()</a></li>
<li><a class="reference internal" href="#tribits-package-def" id="id125">TRIBITS_PACKAGE_DEF()</a></li>
<li><a class="reference internal" href="#tribits-package-define-dependencies" id="id126">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a></li>
<li><a class="reference internal" href="#tribits-package-postprocess" id="id127">TRIBITS_PACKAGE_POSTPROCESS()</a></li>
<li><a class="reference internal" href="#tribits-process-subpackages" id="id128">TRIBITS_PROCESS_SUBPACKAGES()</a></li>
<li><a class="reference internal" href="#tribits-process-enabled-tpl" id="id129">TRIBITS_PROCESS_ENABLED_TPL()</a></li>
<li><a class="reference internal" href="#id2" id="id130">TRIBITS_PROJECT()</a></li>
<li><a class="reference internal" href="#tribits-project-define-extra-repositories" id="id131">TRIBITS_PROJECT_DEFINE_EXTRA_REPOSITORIES()</a></li>
<li><a class="reference internal" href="#tribits-repository-define-packages" id="id132">TRIBITS_REPOSITORY_DEFINE_PACKAGES()</a></li>
<li><a class="reference internal" href="#tribits-repository-define-tpls" id="id133">TRIBITS_REPOSITORY_DEFINE_TPLS()</a></li>
<li><a class="reference internal" href="#tribits-set-st-for-dev-mode" id="id134">TRIBITS_SET_ST_FOR_DEV_MODE()</a></li>
<li><a class="reference internal" href="#id3" id="id135">TRIBITS_SUBPACKAGE()</a></li>
<li><a class="reference internal" href="#tribits-subpackage-postprocess" id="id136">TRIBITS_SUBPACKAGE_POSTPROCESS()</a></li>
<li><a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries" id="id137">TRIBITS_TPL_FIND_INCLUDE_DIRS_AND_LIBRARIES()</a></li>
<li><a class="reference internal" href="#tribits-tpl-tentatively-enable" id="id138">TRIBITS_TPL_TENTATIVELY_ENABLE()</a></li>
<li><a class="reference internal" href="#tribits-verbose-print-var" id="id139">TRIBITS_VERBOSE_PRINT_VAR()</a></li>
<li><a class="reference internal" href="#tribits-write-flexible-package-client-export-files" id="id140">TRIBITS_WRITE_FLEXIBLE_PACKAGE_CLIENT_EXPORT_FILES()</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-utility-macros-and-functions" id="id141">12.3&nbsp;&nbsp;&nbsp;General Utility Macros and Functions</a><ul>
<li><a class="reference internal" href="#add-subdirectories" id="id142">ADD_SUBDIRECTORIES()</a></li>
<li><a class="reference internal" href="#advanced-option" id="id143">ADVANCED_OPTION()</a></li>
<li><a class="reference internal" href="#advanced-set" id="id144">ADVANCED_SET()</a></li>
<li><a class="reference internal" href="#append-cmndline-args" id="id145">APPEND_CMNDLINE_ARGS()</a></li>
<li><a class="reference internal" href="#append-glob" id="id146">APPEND_GLOB()</a></li>
<li><a class="reference internal" href="#append-global-set" id="id147">APPEND_GLOBAL_SET()</a></li>
<li><a class="reference internal" href="#append-set" id="id148">APPEND_SET()</a></li>
<li><a class="reference internal" href="#append-string-var" id="id149">APPEND_STRING_VAR()</a></li>
<li><a class="reference internal" href="#append-string-var-ext" id="id150">APPEND_STRING_VAR_EXT()</a></li>
<li><a class="reference internal" href="#append-string-var-with-sep" id="id151">APPEND_STRING_VAR_WITH_SEP()</a></li>
<li><a class="reference internal" href="#assert-defined" id="id152">ASSERT_DEFINED()</a></li>
<li><a class="reference internal" href="#combined-option" id="id153">COMBINED_OPTION()</a></li>
<li><a class="reference internal" href="#concat-strings" id="id154">CONCAT_STRINGS()</a></li>
<li><a class="reference internal" href="#dual-scope-append-cmndline-args" id="id155">DUAL_SCOPE_APPEND_CMNDLINE_ARGS()</a></li>
<li><a class="reference internal" href="#dual-scope-prepend-cmndline-args" id="id156">DUAL_SCOPE_PREPEND_CMNDLINE_ARGS()</a></li>
<li><a class="reference internal" href="#dual-scope-set" id="id157">DUAL_SCOPE_SET()</a></li>
<li><a class="reference internal" href="#global-null-set" id="id158">GLOBAL_NULL_SET()</a></li>
<li><a class="reference internal" href="#global-set" id="id159">GLOBAL_SET()</a></li>
<li><a class="reference internal" href="#join" id="id160">JOIN()</a></li>
<li><a class="reference internal" href="#message-wrapper" id="id161">MESSAGE_WRAPPER()</a></li>
<li><a class="reference internal" href="#multiline-set" id="id162">MULTILINE_SET()</a></li>
<li><a class="reference internal" href="#parse-arguments" id="id163">PARSE_ARGUMENTS()</a></li>
<li><a class="reference internal" href="#prepend-cmndline-args" id="id164">PREPEND_CMNDLINE_ARGS()</a></li>
<li><a class="reference internal" href="#prepend-global-set" id="id165">PREPEND_GLOBAL_SET()</a></li>
<li><a class="reference internal" href="#print-nonempty-var" id="id166">PRINT_NONEMPTY_VAR()</a></li>
<li><a class="reference internal" href="#print-nonempty-var-with-spaces" id="id167">PRINT_NONEMPTY_VAR_WITH_SPACES()</a></li>
<li><a class="reference internal" href="#print-var" id="id168">PRINT_VAR()</a></li>
<li><a class="reference internal" href="#remove-global-duplicates" id="id169">REMOVE_GLOBAL_DUPLICATES()</a></li>
<li><a class="reference internal" href="#set-and-inc-dirs" id="id170">SET_AND_INC_DIRS()</a></li>
<li><a class="reference internal" href="#set-cache-on-off-empty" id="id171">SET_CACHE_ON_OFF_EMPTY()</a></li>
<li><a class="reference internal" href="#set-default" id="id172">SET_DEFAULT()</a></li>
<li><a class="reference internal" href="#set-default-and-from-env" id="id173">SET_DEFAULT_AND_FROM_ENV()</a></li>
<li><a class="reference internal" href="#split" id="id174">SPLIT()</a></li>
<li><a class="reference internal" href="#timer-get-raw-seconds" id="id175">TIMER_GET_RAW_SECONDS()</a></li>
<li><a class="reference internal" href="#timer-get-rel-seconds" id="id176">TIMER_GET_REL_SECONDS()</a></li>
<li><a class="reference internal" href="#timer-print-rel-time" id="id177">TIMER_PRINT_REL_TIME()</a></li>
<li><a class="reference internal" href="#unittest-compare-const" id="id178">UNITTEST_COMPARE_CONST()</a></li>
<li><a class="reference internal" href="#unittest-has-substr-const" id="id179">UNITTEST_HAS_SUBSTR_CONST()</a></li>
<li><a class="reference internal" href="#unittest-string-regex" id="id180">UNITTEST_STRING_REGEX()</a></li>
<li><a class="reference internal" href="#unittest-file-regex" id="id181">UNITTEST_FILE_REGEX()</a></li>
<li><a class="reference internal" href="#unittest-final-result" id="id182">UNITTEST_FINAL_RESULT()</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix" id="id183">13&nbsp;&nbsp;&nbsp;Appendix</a><ul class="auto-toc">
<li><a class="reference internal" href="#history-of-tribits" id="id184">13.1&nbsp;&nbsp;&nbsp;History of TriBITS</a></li>
<li><a class="reference internal" href="#why-a-tribits-package-is-not-a-cmake-package" id="id185">13.2&nbsp;&nbsp;&nbsp;Why a TriBITS Package is not a CMake Package</a></li>
<li><a class="reference internal" href="#design-considerations-for-tribits" id="id186">13.3&nbsp;&nbsp;&nbsp;Design Considerations for TriBITS</a></li>
<li><a class="reference internal" href="#checkin-test-py-help" id="id187">13.4&nbsp;&nbsp;&nbsp;checkin-test.py --help</a></li>
<li><a class="reference internal" href="#gitdist-help" id="id188">13.5&nbsp;&nbsp;&nbsp;gitdist --help</a></li>
<li><a class="reference internal" href="#snapshot-dir-py-help" id="id189">13.6&nbsp;&nbsp;&nbsp;snapshot-dir.py --help</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id4">1&nbsp;&nbsp;&nbsp;Introduction</a></h1>
<p>This document describes the usage of the TriBITS (Tribal Build, Integration,
Test System) to develop software projects.  An initial overview of TriBITS is
provided in the <a class="reference external" href="../overview/TribitsOverview.pdf">TriBITS Overview</a> document which contains the big picture
and provides a high-level road map to what TriBITS provides.  This particular
document, however, describes the details on how to use the TriBITS system to
create a CMake build system for a set of compiled software packages.  Also
described are an extended set of tools and processes to create a complete
software development, testing, and deployment environment consistent with
modern agile software development best practices.</p>
<p>TriBITS is a fairly extensive framework that is built on top of the
open-source CMake/CTest/CPack/CDash system (which in itself is a very
extensive system of software and tools).  The most important thing to remember
is that a software project that use TriBITS are really just a CMake project.
TriBITS makes no attempt to hide that fact either from the TriBITS project
developers or from the users that need to configure and build the software.
Therefore, to make effective usage of TriBITS, one must learn the basics of
CMake (both as a developer and as a user).  In particular, CMake is a
Turning-complete programming language with local and global variables (with
strange scoping rules), macros, functions, targets, commands, and other
features.  One needs to understand how to define and use variables, macros,
and functions in CMake.  One needs to know how to debug CMakeLists.txt files
and CMake code in general (i.e. using <tt class="docutils literal">MESSAGE()</tt> print statements).  One
needs to understand how CMake defines and uses targets for various qualities
like libraries, executables, etc.  Without this basic understanding of CMake,
one will have trouble resolving problems when they might occur.</p>
<p>The remainder of this documented is structured as follows.  First, there is
some additional <a class="reference internal" href="#background">Background</a> material provided.  Then, a detailed
specification of <a class="reference internal" href="#tribits-project-structure">TriBITS Project Structure</a> is given which lists and defines
all of the files that a TriBITS project contains and how they are processed.
This is followed up by short descriptions of <a class="reference internal" href="#example-tribits-projects">Example TriBITS Projects</a> that
are provided with the TriBITS source tree that are used throughout this
document.  The topic of <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable Logic</a> is
then discussed which is the backbone of the TriBITS system.  An overview of
the foundations for <a class="reference internal" href="#tribits-automated-testing">TriBITS Automated Testing</a> is then given.  The topic of
TriBITS <a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a> is examined next.  <a class="reference internal" href="#development-workflows">Development
Workflows</a> using TriBITS is then explored.  This is followed by a set of
detailed <a class="reference internal" href="#howtos">Howtos</a>.  Later some <a class="reference internal" href="#additional-topics">Additional Topics</a> are presented that don't
fit well into other sections.  Then the main bulk of the detailed reference
material for TriBITS is given in the section <a class="reference internal" href="#tribits-detailed-reference-documentation">TriBITS Detailed Reference
Documentation</a>.  Finally, several bits of information are provided in the
<a class="reference internal" href="#appendix">Appendix</a>.</p>
</div>
<div class="section" id="background">
<h1><a class="toc-backref" href="#id5">2&nbsp;&nbsp;&nbsp;Background</a></h1>
<p>Before diving into the details about TriBITS in the following sections, first
some more background is in order.  First, a discussion of <a class="reference internal" href="#tribits-developer-and-user-roles">TriBITS Developer
and User Roles</a> is provided to help the reader identify their own role(s) and
to help guide the reader to the appropriate documentation (which may or may
not primarily be in this document).  Then, section <a class="reference internal" href="#cmake-language-overview-and-gotchas">CMake Language Overview
and Gotchas</a> tries to orient readers with little to no CMake knowledge or
experience on where to start and provides some warnings about non-obvious
CMake behavior that often trips up new users of TriBITS.</p>
<div class="section" id="tribits-developer-and-user-roles">
<h2><a class="toc-backref" href="#id6">2.1&nbsp;&nbsp;&nbsp;TriBITS Developer and User Roles</a></h2>
<p>There are approximately five different types roles related to TriBITS.  These
different roles require different levels of expertise and knowledge of CMake
and knowledge of the TriBITS system.  The primary roles are 1) <a class="reference internal" href="#tribits-project-user">TriBITS
Project User</a>, 2) <a class="reference internal" href="#tribits-project-developer">TriBITS Project Developer</a>, 3) <a class="reference internal" href="#tribits-project-architect">TriBITS Project
Architect</a>, 4) <a class="reference internal" href="#tribits-system-developer">TriBITS System Developer</a>, and 5) <a class="reference internal" href="#tribits-system-architect">TriBITS System
Architect</a>.  Each of these roles builds on the necessary knowledge of the
lower-level roles.</p>
<p id="tribits-project-users"><span id="tribits-project-user"></span>The first role is that of a <strong>TriBITS Project User</strong> who only needs to be able
to configure, build, and test a project that uses TriBITS as its build system.
A person acting in this role needs to know little about CMake other than
basics about how to run the <tt class="docutils literal">cmake</tt> and <tt class="docutils literal">ctest</tt> executables, how to set
CMake cache variables, and the basics of building software by typing <tt class="docutils literal">make</tt>
and running tests with <tt class="docutils literal">ctest</tt>.  The proper reference for a TriBITS Project
User is the <a class="reference internal" href="#project-specific-build-quick-reference">Project-Specific Build Quick Reference</a>.  The <a class="reference external" href="../overview/TribitsOverview.pdf">TriBITS
Overview</a> document may also be of some help.  A TriBITS project user does not
need to know anything about the CMake language itself or any of the TriBITS
macros or functions described in <a class="reference internal" href="#tribits-macros-and-functions">TriBITS Macros and Functions</a> or really
anything else described in this current document except for <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package
Dependencies and Enable/Disable Logic</a>.</p>
<p id="tribits-project-developers"><span id="tribits-project-developer"></span>A <strong>TriBITS Project Developer</strong> is someone who contributes to a software
project that uses TriBITS.  They will add source files, libraries and
executables , test executables and define tests run with <tt class="docutils literal">ctest</tt>.  They have
to configure and build the project code in order to be able to develop and run
tests and therefore this role includes all of the necessary knowledge and
functions of a TriBITS Project User.  A casual TriBITS Project Developer
typically does not need to know a lot about CMake and really only needs to
know a subset of the <a class="reference internal" href="#tribits-macros-and-functions">TriBITS Macros and Functions</a> defined in this document
in addition to the genetic <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html">TriBITS Build Quick Reference</a> document.  A slightly more
sophisticated TriBITS Project Developer will also add new packages, add new
package dependencies, and define new TPLs.  This current TriBITS Developers
Guide and Reference document should supply everything such a developer needs
to know and more.  Only a smaller part of this document needs to be understood
and accessed by people assuming this role.</p>
<p id="tribits-project-architects"><span id="tribits-project-architect"></span>The next level of roles is a <strong>TriBITS Project Architect</strong>.  This is someone
(perhaps only one person on a project development team) that knows the usage
and functioning of TriBITS in great detail.  They understand how to set up a
TriBITS project from scratch, how to set up automated testing using the TriBITS
system, and know how to use TriBITS to implement the overall software
development process.  A person in this role is also likely to be the one who
makes the initial technical decision for their project to adopt TriBITS for
its native build and test system.  This document (along with detailed
CMake/CTest/CDash documentation provided by Kitware and the larger community)
should provide most of what a person in this role needs to know.  A person
assuming this role is the primary audience for a lot of the more advanced
material in this document.</p>
<p id="tribits-system-architects"><span id="tribits-system-architect"></span><span id="tribits-system-developers"></span><span id="tribits-system-developer"></span>The last two roles <strong>TriBITS System Developer</strong> and <strong>TriBITS System
Architect</strong> are for those individuals that actually extend and modify the
TriBITS system itself.  A TriBITS System Developer needs to know how to add
new TriBITS functionality while maintaining backward compatibility, know how to
add new unit tests for the TriBITS system (see <a class="reference internal" href="#the-tribits-test-package">The TriBITS Test Package</a>),
and perform other related tasks.  Such a developer needs to be very
knowledgeable of the basic functioning of CMake and know how TriBITS is
implemented in the CMake language.  A TriBITS System Architect is someone who
must be consulted on almost all non-trivial changes or additions to the
TriBITS system.  A <em>TriBITS System Architect</em> in addition needs to know the
entire TriBITS system, the design philosophy that provides the foundation for
TriBITS and be an expert in CMake, CTest, and CDash.  Everything that needs to
be known by a TriBITS System Developer and a TriBITS System Architect is not
contained in this document.  Instead, the primary documentation will be in the
TriBITS CMake source code and various unit tests itself defined in <a class="reference internal" href="#the-tribits-test-package">The
TriBITS Test Package</a>.  At the time of this writing, there is currently there
is only one TriBITS System Architect (who also happens to be the primary
author of this document).</p>
<p>An explicit goal of this document is to make new <a class="reference internal" href="#tribits-project-architects">TriBITS Project Architects</a>
(i.e. those who would make the decision to adopt TriBITS for their projects),
and new <a class="reference internal" href="#tribits-system-developers">TriBITS System Developers</a> to help extend and maintain TriBITS.  As
TriBITS matures and its requirements further stabilize, the need for a
<a class="reference internal" href="#tribits-system-architect">TriBITS System Architect</a> will hopefully be diminished.</p>
<p>So depending on the particular role that a reader falls into, this document
may or may not be necessary but instead the <a class="reference external" href="../overview/TribitsOverview.pdf">TriBITS Overview</a> or the
<a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html">&lt;Project&gt;BuildQuickRef</a> documents may be more appropriate.  Hopefully the
above roles and discussion will help the reader select the right document to
start with.</p>
</div>
<div class="section" id="cmake-language-overview-and-gotchas">
<h2><a class="toc-backref" href="#id7">2.2&nbsp;&nbsp;&nbsp;CMake Language Overview and Gotchas</a></h2>
<p>TriBITS removes a lot of the boiler plate code needed to write a CMake
project.  As a result, many people can come into a project that uses TriBITS
and quickly start to contribute by adding new source files, adding new
libraries, adding new tests, and even adding new TriBITS packages and TPLs;
all without really having learned anything about CMake.  One just needs to
copy-and-paste existing example CMake code and files as basically &quot;monkey see,
monkey do&quot;.  As long as nothing out of the ordinary happens, many people can
get along just fine in this mode for a time.</p>
<p>However, we have observed that most mistakes that people make when using
TriBITS, and most of the problems they have when using the system, are due to a
basic lack of knowledge of the CMake language.  One can find basic tutorials
and references on the CMake language in various locations online for free.
One can also purchase the <a class="reference external" href="http://www.cmake.org/cmake/help/book.html">official CMake reference book</a>.  Also, documentation
for any built-in CMake command is available locally by running:</p>
<pre class="literal-block">
$ cmake --help-command &lt;CMAKE_COMMAND&gt;
</pre>
<p>Because tutorials and detailed documentation for the CMake language already
exists, this document will not even attempt to provide a first reference to
CMake (which is a large topic in itself).  However, what we try to provide
below is a short overview of the more quirky or surprising aspects of the
CMake language that an programmer experienced in another language might get
tripped up or surprised by.  Some of the more unique features of the language
are described in order to help avoid some of these common mistakes and provide
greater understanding of how TriBITS works.</p>
<p>The CMake language that is used to write CMake projects with TriBITS (and that
core TriBITS functionality itself is implemented in, see <a class="reference internal" href="#tribits-system-project-dependencies">TriBITS System
Project Dependencies</a>) is a fairly simple programming language with fairly
simple rules (for the most part).  However, compared to other programming
languages, there are a few peculiar aspects to the CMake language like strange
variable scoping rules, and how arguments are passed to macros and functions,
that can make working with it difficult if you don't understand these.  Also,
CMake has some interesting gotchas.  In order to effectively use TriBITS (or
just raw CMake) to construct and maintain a project's CMake files, one must
know the basic rules of CMake and be aware of these gotchas.</p>
<p>The first thing to understand about the CMake language is that nearly every
line of CMake code is just a command taking a string (or an array of strings)
and functions that operate on strings.  An array argument is just a single
string literal with elements separated by semi-colons <tt class="docutils literal"><span class="pre">&quot;&lt;str0&gt;;&lt;str1&gt;;...&quot;</span></tt>.
CMake is a bit odd in how it deals with these arrays (which are just
represented as a string with elements separated with semi-colons <tt class="docutils literal">';'</tt>).
For example, all of the following are equivalent and pass in a CMake array
with 3 elements [<tt class="docutils literal">A</tt>], [<tt class="docutils literal">B</tt>], and [<tt class="docutils literal">C</tt>]:</p>
<pre class="literal-block">
SOME_FUNC(A B C)
SOME_FUNC(&quot;A&quot; &quot;B&quot; &quot;C&quot;)
SOME_FUNC(&quot;A;B;C&quot;)
</pre>
<p>However, the above is <em>not</em> the same as:</p>
<pre class="literal-block">
SOME_FUNC(&quot;A B C&quot;)
</pre>
<p>which just passes in a single element with value [<tt class="docutils literal">A B C</tt>].  Raw quotes in
CMake basically escape the interpretation of space characters as array element
boundaries.  Quotes around arguments with no spaces does nothing (as seen
above, except for the interpretation as variable names in an <tt class="docutils literal">IF()</tt>
statement).  In order to get a quote char [<tt class="docutils literal">&quot;</tt>] into string, you must escape
it as:</p>
<pre class="literal-block">
SOME_FUNC(\&quot;A\&quot;)
</pre>
<p>which passes an array with the single argument [<tt class="docutils literal">\&quot;A\&quot;</tt>].</p>
<p>Variables are set using the built-in CMake <tt class="docutils literal">SET()</tt> command that just takes
string arguments like:</p>
<pre class="literal-block">
SET(SOME_VARIABLE &quot;some_value&quot;)
</pre>
<p>In CMake, the above is identical, in every way, to:</p>
<pre class="literal-block">
SET(SOME_VARIABLE some_value)
SET(&quot;SOME_VARIABLE;&quot;some_value&quot;)
SET(&quot;SOME_VARIABLE;some_value&quot;)
</pre>
<p>The function <tt class="docutils literal">SET()</tt> simply interprets the first argument to as the name of
a variable to set in the local scope.  Many other built-in and user-defined
CMake functions work the same way.  That is some of the string arguments are
interpreted as the names of variables.  There is no special language feature
that interprets them as variables (except in an <tt class="docutils literal">IF()</tt> statement).</p>
<p>However, CMake appears to parse arguments differently for built-in CMake
control structure functions like <tt class="docutils literal">FOREACH()</tt> and <tt class="docutils literal">IF()</tt> and does not just
interpret them as a string array.  For example:</p>
<pre class="literal-block">
FOREACH (SOME_VAR &quot;a;b;c&quot;)
  MESSAGE(&quot;SOME_VAR='${SOME_VAR}'&quot;)
ENDFOREACH()
</pre>
<p>prints <tt class="docutils literal"><span class="pre">`SOME_VAR='a;b;c'</span></tt> instead of printing <tt class="docutils literal"><span class="pre">SOME_VAR='a'</span></tt> followed by
<tt class="docutils literal"><span class="pre">SOME_VAR='b'</span></tt>, etc., as you would otherwise expect.  Therefore, this simple
rule for the handling of function arguments as string arrays does not hold for
CMake logic control commands.  Just follow the CMake documentation for these
control structures (i.e. see <tt class="docutils literal">cmake <span class="pre">--help-command</span> if</tt> and <tt class="docutils literal">cmake
<span class="pre">--help-command</span> foreach</tt>).</p>
<p>CMake offers a rich assortment of built-in commands for doing all sorts of
things.  Two of these are the built-in <tt class="docutils literal">MACRO()</tt> and the <tt class="docutils literal">FUNCTION()</tt>
commands which allow you to create user-defined macros and functions (which is
what TriBITS is built on).  All of these built-in and user-defined macros and
functions work exactly the same way; they take in an array of string
arguments.  Some functions take in positional arguments but most actually take
a combination of positional and keyword arguments (see <a class="reference internal" href="#parse-arguments">PARSE_ARGUMENTS()</a>).</p>
<p>Variable names are translated into their stored values using
<tt class="docutils literal">${SOME_VARIABLE}</tt>.  The value that is extracted depends on if the variable
is set in the local or global (cache) scope.  The local scopes for CMake start
in the base project directory in its base <tt class="docutils literal">CMakeLists.txt</tt> file.  Any
variables that are created by macros in that base local scope are seen across
an entire project but are <em>not</em> persistent across multiple successive
<tt class="docutils literal">cmake</tt> configure invocations where the cache file <tt class="docutils literal">CMakeCache.txt</tt> is not
deleted in between.</p>
<p>The handling of variables is one area where CMake is radically different from
most other languages.  First, a variable that is not defined simply returns
nothing.  What is surprising to most people about this is that it does not
even return an empty string that would register as an array element!  For
example, the following set statement:</p>
<pre class="literal-block">
SET(SOME_VAR a ${SOME_UNDEFINED_VAR} c)
</pre>
<p>(where <tt class="docutils literal">SOME_UNDEFINED_VAR</tt> is an undefined variable) produces
<tt class="docutils literal"><span class="pre">SOME_VAR='a;c'</span></tt> and <em>not</em> <tt class="docutils literal"><span class="pre">'a;;c'</span></tt>!  The same thing occurs when an empty
variable is de-references such as with:</p>
<pre class="literal-block">
SET(EMPTY_VAR &quot;&quot;)
SET(SOME_VAR a ${EMPTY_VAR} c)
</pre>
<p>which produces <tt class="docutils literal"><span class="pre">SOME_VAR='a;c'</span></tt> and <em>not</em> <tt class="docutils literal"><span class="pre">'a;;c'</span></tt>.  In order to always
produce an element in the array even if the variable is empty, one must quote
the argument as with:</p>
<pre class="literal-block">
SET(EMPTY_VAR &quot;&quot;)
SET(SOME_VAR a &quot;${EMPTY_VAR}&quot; c)
</pre>
<p>which produces <tt class="docutils literal"><span class="pre">SOME_VAR='a;;c'</span></tt>, or three elements as one might assume.</p>
<p>This is a common error that people make when they call CMake functions
(built-in or TriBITS-defined) involving variables that might be undefined or
empty.  For example, for the macro:</p>
<pre class="literal-block">
MACRO(SOME_MACRO  A_ARG  B_ARG  C_ARG)
   ...
ENDMACRO()
</pre>
<p>if someone tries to call it with (misspelled variable?):</p>
<pre class="literal-block">
SOME_MACRO(a ${SOME_OHTER_VAR} c)
</pre>
<p>and if <tt class="docutils literal"><span class="pre">SOME_OHTER_VAR=&quot;&quot;</span></tt> or if it is undefined, then CMake will error out
with the error message saying that the macro <tt class="docutils literal">SOME_MACRO()</tt> takes 3
arguments but only 2 were provided.  If a variable might be empty but that is
still a valid argument to the command, then it must be quoted as:</p>
<pre class="literal-block">
SOME_MACRO(a &quot;${SOME_OHTER_VAR}&quot; c)
</pre>
<p>Related to this problem is that if you misspell the name of a variable in a
CMake <tt class="docutils literal">IF()</tt> statement like:</p>
<pre class="literal-block">
IF (SOME_VARBLE)
  ...
ENDIF()
</pre>
<p>then it will always be false and the code inside the if statement will never
be executed!  To avoid this problem, use the utility function
<a class="reference internal" href="#assert-defined">ASSERT_DEFINED()</a> as:</p>
<pre class="literal-block">
ASSERT_DEFINED(SOME_VARBLE)
IF (SOME_VARBLE)
  ...
ENDIF()
</pre>
<p>In this case, the misspelled variable would be caught.</p>
<p>While on the subject of <tt class="docutils literal">IF()</tt> statements, CMake has a strange convention.
When you say:</p>
<pre class="literal-block">
IF (SOME_VAR)
  DO_SOMETHING()
ENDIF()
</pre>
<p>then <tt class="docutils literal">SOME_VAR</tt> is interpreted as a variable and will be considered true and
<tt class="docutils literal">DO_SOMETHING()</tt> will be called if <tt class="docutils literal">${SOME_VAR}</tt> does <em>not</em> evaluate to
<tt class="docutils literal">0</tt>, <tt class="docutils literal">OFF</tt>, <tt class="docutils literal">NO</tt>, <tt class="docutils literal">FALSE</tt>, <tt class="docutils literal">N</tt>, <tt class="docutils literal">IGNORE</tt>, <tt class="docutils literal">&quot;&quot;</tt>, or ends in the
suffix <tt class="docutils literal"><span class="pre">-NOTFOUND</span></tt>.  How about that for a true/false rule!  To be safe, use
<tt class="docutils literal">ON/OFF</tt> and <tt class="docutils literal">TRUE/FALSE</tt> pairs for setting variables.  Look up native
CMake documentation on <tt class="docutils literal">IF()</tt> for all the interesting details and all the
magical things it can do.</p>
<p><strong>WARNING:</strong> If you mistype <tt class="docutils literal">&quot;ON&quot;</tt> as <tt class="docutils literal">&quot;NO&quot;</tt>, it evaluates to
<tt class="docutils literal">FALSE</tt>/<tt class="docutils literal">OFF</tt>!  (That is a fun defect to track down!)</p>
<p>CMake language behavior with respect to case sensitivity is also strange:</p>
<ul class="simple">
<li>Calls of built-in and user-defined macros and functions is <em>case
insensitive</em>!  That is <tt class="docutils literal"><span class="pre">set(...)</span></tt>, <tt class="docutils literal"><span class="pre">SET(...)</span></tt>, <tt class="docutils literal">Set()</tt>, and all other
combinations of upper and lower case characters for 'S', 'E', 'T' all call
the built-in <tt class="docutils literal">SET()</tt> function.  The convention in TriBITS is to use all
caps for functions and macros (which was adopted by following the
conventions used in the early versions of TriBITS, see the <a class="reference internal" href="#history-of-tribits">History of
TriBITS</a>).  The convention in CMake literature from Kitware seems to use
lower-case letters for functions and macros.</li>
<li>However, the names of CMake (local or cache/global) variables are <em>case
sensitive</em>!  That is, <tt class="docutils literal">SOME_VAR</tt> and <tt class="docutils literal">some_var</tt> are <em>different</em>
variables.  Built-in CMake variables tend use all caps with underscores
(e.g. <tt class="docutils literal">CMAKE_CURRENT_SOURCE_DIR</tt>) but other built-in CMake variables tend
to use mixed case with underscores (e.g. <tt class="docutils literal">CMAKE_Fortran_FLAGS</tt>).  TriBITS
tends to use a similar naming convention where variables have mostly
upper-case letters except for parts that are proper nouns like the project,
package or TPL name (e.g. <tt class="docutils literal">TribitsProj_TRIBITS_DIR</tt>,
<tt class="docutils literal">TriBITS_SOURCE_DIR</tt>, <tt class="docutils literal">Boost_INCLUDE_DIRS</tt>).</li>
</ul>
<p>I don't know of any other programming language that uses different case
sensitivity rules for variables and functions.  However, because we must parse
macro and function arguments when writing user-defined macros and functions,
it is a good thing that CMake variables are case sensitive.  Case insensitivity
would make it much harder and more expensive to parse argument lists that take
keyword-based arguments (see <a class="reference internal" href="#parse-arguments">PARSE_ARGUMENTS()</a>).</p>
<p>Other mistakes that people make result from not understanding how CMake scopes
variables and other entities.  CMake defines a global scope (i.e. &quot;cache&quot;
variables) and several nested local scopes that are created by
<tt class="docutils literal">ADD_SUBDIRECTORY()</tt> and entering FUNCTIONS.  See <a class="reference internal" href="#dual-scope-set">DUAL_SCOPE_SET()</a> for a
short discussion of these scoping rules.  And it is not just variables that
can have local and global scoping rules.  Other entities, like defines set
with the built-in command <tt class="docutils literal">ADD_DEFINITIONS()</tt> only apply to the local scope
and child scopes.  That means that if you call <tt class="docutils literal">ADD_DEFINITIONS()</tt> to set a
define that affects the meaning of a header-file in C or C++, for example,
that definition will <em>not</em> carry over to a peer subdirectory and those
definitions will not be set (see warning in <a class="reference internal" href="#miscellaneous-notes-tribits-add-library">Miscellaneous Notes
(TRIBITS_ADD_LIBRARY())</a>).</p>
<p>Now that some CMake basics and common gotchas have been reviewed, we now get
into the meat of TriBITS starting with the overall structure of a TriBITS
project in the next section.</p>
</div>
<div class="section" id="software-engineering-packaging-principles">
<h2><a class="toc-backref" href="#id8">2.3&nbsp;&nbsp;&nbsp;Software Engineering Packaging Principles</a></h2>
<p>The term &quot;software engineering&quot; package is adopted in TriBITS nomenclature in
order to highlight and the role of defining and managing &quot;Packages&quot; according
to standard software engineering packaging principles.  In his book [<a class="reference internal" href="#agile-software-development-2003">Agile
Software Development, 2003</a>], Robert Martin defines several object-oriented
(OO) software engineering principles related to packaging software which are
listed below:</p>
<ul class="simple">
<li><em>Package Cohesion OO Principles</em>:<ol class="arabic">
<li><em>REP (Release-Reuse Equivalency Principle)</em>: The granule of reuse is the
granule of release.</li>
<li><em>CCP (Common Closure Principle)</em>: The classes in a package should be
closed together against the same kinds of changes.  A change that affects
a closed package affects all the classes in that package and no other
packages.</li>
<li><em>CRP (Common Reuse Principle)</em>: The classes in a package are used
together.  If you reuse one of the classes in a package, you reuse them
all.</li>
</ol>
</li>
<li><em>Package Coupling OO Principles</em>:<ol class="arabic" start="4">
<li><em>ADP (Acyclic Dependencies Principle)</em>: Allow no cycles in the package
dependency graph.</li>
<li><em>SDP (Stable Dependencies Principle)</em>: Depend in the direction of
stability.</li>
<li>SAP (Stable Abstractions Principle): A package should be as abstract as
it is stable.</li>
</ol>
</li>
</ul>
<p>Any of these six OO packaging principles (and other issues) may be considered
when deciding how to partition software into different <a class="reference internal" href="#tribits-se-packages">TriBITS SE Packages</a>.</p>
<p>NOTE: This purpose of this TriBITS Developers Guide document is not teach
basic software engineering so these various principles will not be expanded on
further here.  However, interested readers are strongly encouraged to read
[<a class="reference internal" href="#agile-software-development-2003">Agile Software Development, 2003</a>] as one of the better software
engineering books out there (see
<a class="reference external" href="http://web.ornl.gov/~8vt/readingList.html#Most_Recommended_SE_Books">http://web.ornl.gov/~8vt/readingList.html#Most_Recommended_SE_Books</a>).</p>
</div>
</div>
<div class="section" id="tribits-project-structure">
<h1><a class="toc-backref" href="#id9">3&nbsp;&nbsp;&nbsp;TriBITS Project Structure</a></h1>
<p>TriBITS is a Framework, implemented in CMake, to create CMake projects.  As a
Framework (with a capital &quot;F&quot;), TriBITS defines the overall structure of a
CMake build system for a project and it processes the various project-,
repository-, and package-specific files in a specified order.  Almost all of
this processing takes place in the <a class="reference internal" href="#id2">TRIBITS_PROJECT()</a> macro (or macros and
functions it calls).  The following subsections define the essence of the
TriBITS framework in some detail.  Later sections cover specific topics and
the various sections link to each other.  Within this section, the subsection
<a class="reference internal" href="#tribits-structural-units">TriBITS Structural Units</a> defines the basic units <a class="reference internal" href="#tribits-project">TriBITS Project</a>,
<a class="reference internal" href="#tribits-repository">TriBITS Repository</a>, <a class="reference internal" href="#tribits-package">TriBITS Package</a>, <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a> and other related
structural units.  The subsection <a class="reference internal" href="#processing-of-tribits-files-ordering-and-details">Processing of TriBITS Files: Ordering and
Details</a> defines exactly what files TriBITS processes and in what order.  It
also shows how to get TriBITS to show exactly what files it is processing to
help in debugging issues.  The subsection <a class="reference internal" href="#coexisting-projects-repositories-and-packages">Coexisting Projects, Repositories,
and Packages</a> gives some of the rules and constrains for how the different
structure units can co-exist in the same directories.  The last subsection in
this section covers the <a class="reference internal" href="#standard-tribits-tpls">Standard TriBITS TPLs</a>.</p>
<div class="section" id="tribits-structural-units">
<h2><a class="toc-backref" href="#id10">3.1&nbsp;&nbsp;&nbsp;TriBITS Structural Units</a></h2>
<p>A CMake project that uses TriBITS as its build and test system is composed of
a single <a class="reference internal" href="#tribits-project">TriBITS Project</a>, one or more <a class="reference internal" href="#tribits-repositories">TriBITS Repositories</a> and one or
more <a class="reference internal" href="#tribits-packages">TriBITS Packages</a>.  In addition, a TriBITS Package can be broken up
into <a class="reference internal" href="#tribits-subpackages">TriBITS Subpackages</a>.  Together, the collection of TriBITS Packages and
TriBITS Subpackages are called <em>TriBITS Software Engineering Packages</em>, or
<a class="reference internal" href="#tribits-se-packages">TriBITS SE Packages</a> for short.</p>
<p>First, to better establish the basic nomenclature, the key structural TriBITS
units are:</p>
<ul class="simple" id="tribits-packages">
<li><a class="reference internal" href="#tribits-package">TriBITS Package</a>: A collection of related software that typically includes
one or more source files built into one or more libraries and has associated
tests to help define and protect the functionality provided by the software.
A package also typically defines a single integrated unit of documentation
and testing (see <a class="reference internal" href="#tribits-automated-testing">TriBITS Automated Testing</a>).  A TriBITS package may or
may not be broken down into multiple subpackages. Examples of TriBITS
packages in <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> include <tt class="docutils literal">SimpleCXX</tt>,
<tt class="docutils literal">MixedLang</tt> and <tt class="docutils literal">WithSubpackages</tt>.  (Don't confuse a TriBITS
&quot;Package&quot; with a raw CMake &quot;Package&quot;. A raw CMake &quot;Package&quot; actually maps to
a <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>; see <a class="reference internal" href="#why-a-tribits-package-is-not-a-cmake-package">Why a TriBITS Package is not a CMake Package</a>.)</li>
</ul>
<ul class="simple" id="tribits-subpackages">
<li><a class="reference internal" href="#tribits-subpackage">TriBITS Subpackage</a>: A part of a parent <a class="reference internal" href="#tribits-package">TriBITS Package</a> that also
typically has source files built into libraries and tests but is documented
and tested along with the other subpackages the parent package.  The primary
purpose for supporting subpackages is to provide finer-grained control of
software dependencies.  In <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>, <tt class="docutils literal">WithSubpackages</tt> is
an example of a package with subpackages <tt class="docutils literal">'A'</tt>, <tt class="docutils literal">'B'</tt>, and <tt class="docutils literal">'C'</tt>.  The
full subpackage name is prefixed by the parent package name (e.g. the full
name for subpackage <tt class="docutils literal">'A'</tt> is <tt class="docutils literal">WithSubpackagesA</tt>).  The parent package is
always implicitly dependent on its subpackages (e.g. parent package
<tt class="docutils literal">WithSubpackages</tt> depends on its subpackages <tt class="docutils literal">WithSubpackagesA</tt>,
<tt class="docutils literal">WithSubpackagesB</tt>, and <tt class="docutils literal">WithSubpackagesC</tt>).</li>
</ul>
<ul class="simple" id="tribits-se-packages">
<span id="tribits-se-package"></span><li><strong>TriBITS SE Package</strong>: The combined set of <a class="reference internal" href="#tribits-packages">TriBITS Packages</a> and <a class="reference internal" href="#tribits-subpackages">TriBITS
Subpackages</a> that constitute the basic <em>Software Engineering</em> packages of a
TriBITS project (see <a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering Packaging Principles</a>): SE
packages are the basis for setting dependencies in the TriBITS system.  For
example, the SE Packages provided by the top-level example package
<tt class="docutils literal">WithSubpackages</tt> (in order of increasing dependencies) are
<tt class="docutils literal">WithSubpackagesA</tt>, <tt class="docutils literal">WithSubpackagesB</tt>, <tt class="docutils literal">WithSubpackagesC</tt>, and
<tt class="docutils literal">WithSubpackages</tt> (see <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>).</li>
</ul>
<ul class="simple" id="tribits-tpls">
<li><a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>: The specification for a particular external dependency that
is required or can be used in one or more <a class="reference internal" href="#tribits-se-packages">TriBITS SE Packages</a>.  A TPL (a
Third Party Library) typically provides a list of libraries or a list
include directories for header files but can also be manifested in order
ways as well.  Examples of basic TPLs include <tt class="docutils literal">BLAS</tt>, <tt class="docutils literal">LAPACK</tt>, and
<tt class="docutils literal">Boost</tt>.</li>
</ul>
<ul class="simple" id="tribits-repositories">
<li><a class="reference internal" href="#tribits-repository">TriBITS Repository</a>: A collection of one or more <a class="reference internal" href="#tribits-packages">TriBITS Packages</a>
specified in a <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file and zero or more TPL
declarations specified in a <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file.</li>
</ul>
<ul class="simple" id="tribits-projects">
<li><a class="reference internal" href="#tribits-project">TriBITS Project</a>: A collection of <a class="reference internal" href="#tribits-repositories">TriBITS Repositories</a> and <a class="reference internal" href="#tribits-packages">TriBITS
Packages</a> that defines a complete CMake <tt class="docutils literal">PROJECT</tt> defining software which can be
directly configured with <tt class="docutils literal">cmake</tt> and then be built, tested, installed,
etc.</li>
</ul>
<ul class="simple" id="tribits-meta-projects">
<span id="tribits-meta-project"></span><li><strong>TriBITS Meta-Project</strong>: A <a class="reference internal" href="#tribits-project">TriBITS Project</a> that contains no native
<a class="reference internal" href="#tribits-packages">TriBITS packages</a> or <a class="reference internal" href="#tribits-tpls">TriBITS TPLs</a> but is composed out packages from
other <a class="reference internal" href="#tribits-repositories">TriBITS Repositories</a>.</li>
</ul>
<p>In this document, dependencies are described as either being <em>upstream</em> or
<em>downstream/forward</em> defined as:</p>
<ul class="simple" id="upstream-dependencies">
<span id="upstream-dependency"></span><span id="upstream"></span><li>If unit &quot;B&quot; requires (or can use, or comes before) unit &quot;A&quot;, then &quot;A&quot; is an
<strong>upstream dependency</strong> of &quot;B&quot;.</li>
</ul>
<ul class="simple" id="downstream-dependencies">
<span id="downstream-dependency"></span><span id="downstream"></span><li>If unit &quot;B&quot; requires (or can use, or comes before) unit &quot;A&quot;, then &quot;B&quot; is a
<strong>downstream dependency</strong> or a <strong>forward dependency</strong> of &quot;A&quot;.</li>
</ul>
<p>The following subsections define the major structural units of a TriBITS
project in more detail.  Each structural unit is described along with the
files and directories associated with each.  In addition, a key set of TriBITS
CMake variables for each are defined as well.</p>
<p>In the next major section following this one, some <a class="reference internal" href="#example-tribits-projects">Example TriBITS Projects</a>
are described.  For those who just want to jump in and learn best by example,
these example projects are a good way to start.  These example projects will
be referenced in the more detailed descriptions given in this document.</p>
<p>The last issue to touch on before getting into the detailed descriptions of
the different TriBITS structural units is the issue of how CMake variables are
defined and used by TriBITS. The CMake variables described in the TriBITS
structural units below fall into one of two major types:</p>
<ul class="simple">
<li><em>Local Fixed-Name Variables</em> are used temporarily in the processing of a
TriBITS unit.  These include variables such as <tt class="docutils literal">PROJECT_NAME</tt>,
<tt class="docutils literal">REPOSITORY_NAME</tt>, <tt class="docutils literal">PACKAGE_NAME</tt>, and <tt class="docutils literal">PARENT_PACKAGE_NAME</tt>.  These
are distinguished by having a non-namespaced fixed/constant name.  They are
typically part of TriBITS reflection system, allowing subordinate units to
determine the encapsulating unit in which they are participating.  For,
example, a TriBITS subpackage can determine its name, its parent package's
name and directories, its parent repository name and directories, and the
enclosing project's name and directories without having to refer to any
specific names.</li>
<li><em>Globally Scoped Namespaced Variables</em> are used to refer to properties of a
named TriBITS unit that are seen globally by the entire TriBITS project.
These include variables such as <tt class="docutils literal">${REPOSITORY_NAME}_SOURCE_DIR</tt>
(e.g. <tt class="docutils literal">TribitsExProj_SOURCE_DIR</tt>) and <tt class="docutils literal">${PACKAGE_NAME}_BINARY_DIR</tt>
(e.g. <tt class="docutils literal">SimpleCXX_BINARY_DIR</tt>).  They are available after processing the
unit, for use by <a class="reference internal" href="#downstream">downstream</a> or subordinate units.  They are part of the
TriBITS dependency system, allowing downstream units to access properties of
their known <a class="reference internal" href="#upstream-dependencies">upstream dependencies</a>.</li>
</ul>
<p>More information about these various files is described in section <a class="reference internal" href="#processing-of-tribits-files-ordering-and-details">Processing
of TriBITS Files: Ordering and Details</a>.</p>
<div class="section" id="tribits-project">
<h3><a class="toc-backref" href="#id11">TriBITS Project</a></h3>
<p>A TriBITS Project:</p>
<ul class="simple">
<li>Defines the <tt class="docutils literal">PROJECT_NAME</tt> CMake variable (defined in
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a>)</li>
<li>Defines a complete CMake project which calls <tt class="docutils literal"><span class="pre">PROJECT(${PROJECT_NAME}</span>
<span class="pre">...)</span></tt> and can be directly configured, built, tested, installed, etc.</li>
<li>Consists of one or more <a class="reference internal" href="#tribits-repositories">TriBITS Repositories</a> (and may itself be a
<a class="reference internal" href="#tribits-repository">TriBITS Repository</a>) which can include native and extra repositories.</li>
<li>Allows for extra Repositories to be added on before or after the set of
native Repositories (specified in
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> or by CMake cache
variables)</li>
<li>Defines a default CDash server and default project name on the server (the
project name on the CDash server must be the same as <tt class="docutils literal">${PROJECT_NAME}</tt>).</li>
<li>Defines pre-push testing standard builds (using <a class="reference internal" href="#checkin-test-py">checkin-test.py</a>)</li>
</ul>
<p>For more details on the definition of a TriBITS Project, see:</p>
<ul class="simple">
<li><a class="reference internal" href="#tribits-project-core-files">TriBITS Project Core Files</a></li>
<li><a class="reference internal" href="#tribits-project-core-variables">TriBITS Project Core Variables</a></li>
</ul>
<div class="section" id="tribits-project-core-files">
<h4><a class="toc-backref" href="#id12">TriBITS Project Core Files</a></h4>
<p>The core files making up a TriBITS Project (where <tt class="docutils literal">&lt;projectDir&gt; =
${PROJECT_SOURCE_DIR}</tt>) are:</p>
<pre class="literal-block">
&lt;projectDir&gt;/
   ProjectName.cmake    # Defines PACKAGE_NAME
   CMakeLists.txt       # Base project CMakeLists.txt file
   CTestConfig.cmake    # [Optional] Needed for CDash submits
   Version.cmake        # [Optional] Dev mode, Project version, VC branch
   project-checkin-test-config.py # [Optional] checkin-test.py config
   cmake/
     NativeRepositoriesList.cmake    # [Optional] Rarely used
     ExtraRepositoriesList.cmake     # [Optional] Lists repos and VC URLs
     ProjectDependenciesSetup.cmake  # [Optional] Project deps overrides
     CallbackDefineProjectPackaging.cmake  # [Optional] CPack settings
     tribits/    # [Optional] Or provide ${PROJECT_NAME}_TRIBITS_DIR
     ctest/
       CTestCustom.cmake.in  # [Optional] Custom ctest settings
</pre>
<p>These TriBITS Project files are documented in more detail below:</p>
<ul class="simple">
<li><a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a></li>
<li><a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a></li>
<li><a class="reference internal" href="#projectdir-ctestconfig-cmake">&lt;projectDir&gt;/CTestConfig.cmake</a></li>
<li><a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a></li>
<li><a class="reference internal" href="#projectdir-project-checkin-test-config-py">&lt;projectDir&gt;/project-checkin-test-config.py</a></li>
<li><a class="reference internal" href="#projectdir-cmake-nativerepositorieslist-cmake">&lt;projectDir&gt;/cmake/NativeRepositoriesList.cmake</a></li>
<li><a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a></li>
<li><a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a></li>
<li><a class="reference internal" href="#projectdir-cmake-callbackdefineprojectpackaging-cmake">&lt;projectDir&gt;/cmake/CallbackDefineProjectPackaging.cmake</a></li>
<li><a class="reference internal" href="#projectdir-cmake-tribits">&lt;projectDir&gt;/cmake/tribits/</a></li>
<li><a class="reference internal" href="#projectdir-cmake-ctest-ctestcustom-cmake-in">&lt;projectDir&gt;/cmake/ctest/CTestCustom.cmake.in</a></li>
</ul>
<p id="projectdir-projectname-cmake"><strong>&lt;projectDir&gt;/ProjectName.cmake</strong>: [Required] At a minimum provides a
<tt class="docutils literal">SET()</tt> statement to set the local variable <tt class="docutils literal">PROJECT_NAME</tt>.  This file is
the first file that is read by a number of tools in order to get the TriBITS
project's name.  This file is read first in every context that involves
processing the TriBITS project's files, including processes and tools that
just need to build the package and TPL dependency tree (see <a class="reference internal" href="#reduced-package-dependency-processing">Reduced Package
Dependency Processing</a>).  Being this is the first file read in for a TriBITS
project and that it is read in first at the top level scope in every context,
this is a good file to put in other universal static project options.  Note
that this is a project, not a repository file so no general
repository-specific settings should go in this file.  A simple example of this
file is <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">ProjectName.cmake</tt>:</p>
<pre class="literal-block">
# Must set the project name at very beginning before including anything else
SET(PROJECT_NAME TribitsExProj)

# Turn on export depenency generation for WrapExteranl package
SET(${PROJECT_NAME}_GENERATE_EXPORT_FILE_DEPENDENCIES_DEFAULT ON)

</pre>
<p>A meta-project's <tt class="docutils literal">ProjectName.cmake</tt> file might have a number of other
variables set that define how the various different TriBITS repos are cobbled
together into a single TriBITS meta-project (usually because the different
TriBITS repos and packages are a bit messy and have other issues).  For
example, the CASL VERA TriBITS meta-project at one point had a very extensive
collection of set statements in this file.</p>
<p id="projectdir-cmakelists-txt"><strong>&lt;projectDir&gt;/CMakeLists.txt</strong>: [Required] The top-level CMake project file.
This is the first file that the <tt class="docutils literal">cmake</tt> executable processes that starts
everything off and is the base-level scope for local (non-cache) CMake
variables.  Due to a few CMake limitations and quarks, a project's top-level
<tt class="docutils literal">CMakeLists.txt</tt> file is not quit as clean as one might otherwise hope would
be but it is not too bad.  A simple, but representative, example is
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">CMakeLists.txt</tt>:</p>
<pre class="literal-block">
################################################################################
#                                                                              #
#                        TribitsExampleProject                                 #
#                                                                              #
################################################################################

# Make CMake set WIN32 with CYGWIN for older CMake versions.  CMake requires
# this to be in the top-level CMakeLists.txt file and not an include file :-(
SET(CMAKE_LEGACY_CYGWIN_WIN32 1 CACHE BOOL &quot;&quot; FORCE)

#
# A) Define your project name and set up major project options
#
# NOTE: Don't set options that would impact what packages get defined or
# enabled/disabled in this file as that would not impact other tools that
# don't process this file.
#

# Get PROJECT_NAME (must be in file for other parts of system to read)
INCLUDE(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ProjectName.cmake&quot;)

# CMake requires that you declare the CMake project in the top-level file and
# not in an include file :-(
PROJECT(${PROJECT_NAME} NONE)

#
# B) Pull in the TriBITS system and execute
#

SET(${PROJECT_NAME}_TRIBITS_DIR
   &quot;${CMAKE_CURRENT_LIST_DIR}/../../..&quot;  CACHE  STRING
  &quot;TriBITS base directory (default assumes in TriBITS source tree)&quot;)
INCLUDE(&quot;${${PROJECT_NAME}_TRIBITS_DIR}/TriBITS.cmake&quot;)

# CMake requires this be in the top file and not in an include file :-(
CMAKE_MINIMUM_REQUIRED(VERSION ${TRIBITS_CMAKE_MINIMUM_REQUIRED})

# Set default location for header-only TPL to make easy to configure out of
# the TriBITS source tree.
SET(HeaderOnlyTpl_INCLUDE_DIRS
  &quot;${${PROJECT_NAME}_TRIBITS_DIR}/doc/examples/tpls/HeaderOnlyTpl&quot; 
  CACHE PATH &quot;Default set by TriBITS/CMakeLists.txt&quot; )

# Do all of the processing for this Tribits project
TRIBITS_PROJECT()

</pre>
<p>A couple of CMake and TriBITS quarks that that above example
<tt class="docutils literal">CMakeLists.txt</tt> addresses are worth some discussion.  First, to avoid
duplication, the project's <tt class="docutils literal">ProjectName.cmake</tt> file is read in with an
<tt class="docutils literal">INCLUDE()</tt> that defines the local variable <tt class="docutils literal">PROJECT_NAME</tt>.  Right after
this initial include, the built-in CMake command <tt class="docutils literal"><span class="pre">PROJECT(${PROJECT_NAME}</span>
NONE)</tt> is run.  This command must be explicitly called with <tt class="docutils literal">NONE</tt> so as to
avoid default CMake behavior for defining compilers.  The definition of
compilers comes later as part of the TriBITS system inside of the
<a class="reference internal" href="#id2">TRIBITS_PROJECT()</a> command (see <a class="reference internal" href="#full-processing-of-tribits-project-files">Full Processing of TriBITS Project
Files</a>).</p>
<p>As noted in the above example file, the only project defaults that should be
set in this top-level <tt class="docutils literal">CMakeLists.txt</tt> file are those that do not impact the
list of package enables/disables.  The latter type of defaults should set in
other files (see below).</p>
<p id="project-name-tribits-dir">In this example project, a CMake cache variable
<tt class="docutils literal">${PROJECT_NAME}_TRIBITS_DIR</tt> must be set by the user to define where the
base <tt class="docutils literal">tribits</tt> source directory is located.  With this variable set
(i.e. passed into <tt class="docutils literal">cmake</tt> command-line use
<tt class="docutils literal"><span class="pre">-DTribitsExProj_TRIBITS_DIR=&lt;someDir&gt;</span></tt>), one just includes a single file to
pull in the TriBITS system:</p>
<pre class="literal-block">
INCLUDE(&quot;${${PROJECT_NAME}_TRIBITS_DIR}/TriBITS.cmake&quot;)
</pre>
<p>With the <tt class="docutils literal">TriBITS.cmake</tt> file included, the configuration of the project
using TriBITS occurs with a single call to <a class="reference internal" href="#id2">TRIBITS_PROJECT()</a>.</p>
<p>Some projects, like Trilinos, actually snapshot the <tt class="docutils literal">tribits</tt> directory into
their source tree <a class="reference internal" href="#projectdir-cmake-tribits">&lt;projectDir&gt;/cmake/tribits/</a> and therefore don't need to
have this variable set.  In Trilinos, the include line is just:</p>
<pre class="literal-block">
INCLUDE(${CMAKE_CURRENT_SOURCE_DIR}/cmake/tribits/TriBITS.cmake)
</pre>
<p>The minimum CMake version must also be declared in the top-level
<tt class="docutils literal">CMakeLists.txt</tt> file as shown.  Explicitly setting the minimum CMake
version avoids strange errors that can occur when someone tries to build the
project using a version of CMake that is too old.  If the given project
requires a version of CMake newer than what is required by TriBITS itself (as
defined in the variable <tt class="docutils literal">TRIBITS_CMAKE_MINIMUM_REQUIRED</tt> which was set when
the <tt class="docutils literal">TriBITS.cmake</tt> file was included), then that version can be passed
instead of using <tt class="docutils literal">${TRIBITS_CMAKE_MINIMUM_REQUIRED}</tt> (the current minimum
version of CMake required by TriBITS is given at in <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#getting-set-up-to-use-cmake">Getting set up to use
CMake</a>) .  For example, the <tt class="docutils literal">VERA/CMakeLists.txt</tt> file lists as its first
line:</p>
<pre class="literal-block">
SET(VERA_TRIBITS_CMAKE_MINIMUM_REQUIRED 2.8.11)
CMAKE_MINIMUM_REQUIRED(VERSION ${VERA_TRIBITS_CMAKE_MINIMUM_REQUIRED})
</pre>
<p id="projectdir-ctestconfig-cmake"><strong>&lt;projectDir&gt;/CTestConfig.cmake</strong>: [Optional] Specifies the CDash site and
project to submit results to when doing an automated build driven by the CTest
driver function <a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a> (see <a class="reference internal" href="#tribits-package-by-package-ctest-dash-driver">TriBITS Package-by-Package
CTest/Dash Driver</a>).  This file is also required to use the TriBITS-generated
<tt class="docutils literal">dashboard</tt> target (see <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#dashboard-submissions">Dashboard Submissions</a>).  An example of this file
is <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">CTestConfig.cmake</tt>:</p>
<pre class="literal-block">
INCLUDE(SetDefaultAndFromEnv)

SET(CTEST_NIGHTLY_START_TIME &quot;04:00:00 UTC&quot;) # 10 PM MDT or 9 PM MST

IF (NOT DEFINED CTEST_DROP_METHOD)
  SET_DEFAULT_AND_FROM_ENV(CTEST_DROP_METHOD &quot;http&quot;)
ENDIF()

IF (CTEST_DROP_METHOD STREQUAL &quot;http&quot;)
  SET_DEFAULT_AND_FROM_ENV(CTEST_DROP_SITE &quot;casl-dev.ornl.gov&quot;)
  SET_DEFAULT_AND_FROM_ENV(CTEST_PROJECT_NAME &quot;TribitsExProj&quot;)
  SET_DEFAULT_AND_FROM_ENV(CTEST_DROP_LOCATION &quot;/cdash/submit.php?project=TribitsExProj&quot;)
  SET_DEFAULT_AND_FROM_ENV(CTEST_TRIGGER_SITE &quot;&quot;)
  SET_DEFAULT_AND_FROM_ENV(CTEST_DROP_SITE_CDASH TRUE)
ENDIF()

</pre>
<p>All of the variables set in this file are directly understood by raw <tt class="docutils literal">ctest</tt>
and will not be explained here further (see documentation for the standard
CMake module <tt class="docutils literal">CTest</tt>).  The usage of the function
<a class="reference internal" href="#set-default-and-from-env">SET_DEFAULT_AND_FROM_ENV()</a> allows the variables to be overridden both as
CMake cache variables and in the environment.  The latter is needed when
running using <tt class="docutils literal">ctest</tt> as the driver (since older versions of <tt class="docutils literal">ctest</tt> did
not support <tt class="docutils literal"><span class="pre">-D&lt;var-name&gt;:&lt;type&gt;=&lt;value&gt;</span></tt> command-line arguments like
<tt class="docutils literal">cmake</tt> does).  Given that all of these variables are nicely namespaced,
overriding them in the shell environment is not as dangerous as might
otherwise be the case but this is what had to be done to get around
limitations for older versions of CMake/CTest.</p>
<p id="projectdir-version-cmake"><strong>&lt;projectDir&gt;/Version.cmake</strong>: If defined, gives the project's version and
determines development/release mode (see <a class="reference internal" href="#project-and-repository-versioning-and-release-mode">Project and Repository Versioning
and Release Mode</a>).  This file is read in (using <tt class="docutils literal">INCLUDE()</tt>) in the
project's base-level <tt class="docutils literal"><span class="pre">&lt;projectDir&gt;/CMakeLists.txt</span></tt> file scope so local
variables set in this file are seen by the entire CMake project.  For example,
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">Version.cmake</tt>, looks like:</p>
<pre class="literal-block">
SET(${REPOSITORY_NAME}_VERSION 1.1)
SET(${REPOSITORY_NAME}_MAJOR_VERSION 01)
SET(${REPOSITORY_NAME}_MAJOR_MINOR_VERSION 010100)
SET(${REPOSITORY_NAME}_VERSION_STRING &quot;1.1 (Dev)&quot;)
SET(${REPOSITORY_NAME}_ENABLE_DEVELOPMENT_MODE_DEFAULT ON) # Change to 'OFF' for a release

</pre>
<p>Note that the prefix <tt class="docutils literal">${REPOSITORY_NAME}_</tt> is used instead of hard-coding
the project name.  This is so that the same <tt class="docutils literal">Version.txt</tt> file can be used
as the <a class="reference internal" href="#repodir-version-cmake">&lt;repoDir&gt;/Version.cmake</a> file and have the repository name be
flexible.  TriBITS sets <tt class="docutils literal">REPOSITORY_NAME = ${PROJECT_NAME}</tt> when it reads in
this file at the project-level scope.</p>
<p>It is strongly recommended that every TriBITS project contain a
<tt class="docutils literal">Version.cmake</tt> file, even if a release has never occurred.  Otherwise, the
project needs to define the variable
<a class="reference internal" href="#project-name-enable-development-mode-default">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE_DEFAULT</a> at the global project scope
(perhaps in <tt class="docutils literal"><span class="pre">&lt;projectDir&gt;/ProjectName.cmake</span></tt>) to get right development mode
behavior.</p>
<p id="projectdir-project-checkin-test-config-py"><strong>&lt;projectDir&gt;/project-checkin-test-config.py</strong>: [Optional] Used to define the
<tt class="docutils literal"><span class="pre">--default-builds</span></tt> and other project-level configuration options for the
project's usage of the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script.  Machine or package-specific
options should <strong>not</strong> be placed in this file.  An example of this file for
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal"><span class="pre">project-checkin-test-config.py</span></tt> is shown below:</p>
<pre class="literal-block">
#
# Define project-specific options for the checkin-test script for
# TribitsExampleProject.
#

configuration = {

    # Default command line arguments
    'defaults': {
        '--send-email-to-on-push': 'trilinos-checkin-tests&#64;software.sandia.gov',
        },

    # CMake options (-DVAR:TYPE=VAL) cache variables.
    'cmake': {
        
        # Options that are common to all builds.
        'common': [],

        # Defines --default-builds, in order.
        'default-builds': [
            # Options for the MPI_DEBUG build.
            ('MPI_DEBUG', [
                '-DTPL_ENABLE_MPI:BOOL=ON',
                '-DCMAKE_BUILD_TYPE:STRING=RELEASE',
                '-DTribitsExProj_ENABLE_DEBUG:BOOL=ON',
                '-DTribitsExProj_ENABLE_CHECKED_STL:BOOL=ON',
                '-DTribitsExProj_ENABLE_DEBUG_SYMBOLS:BOOL=ON',
                ]),
            # Options for the SERIAL_RELEASE build.
            ('SERIAL_RELEASE', [
                '-DTPL_ENABLE_MPI:BOOL=OFF',
                '-DCMAKE_BUILD_TYPE:STRING=RELEASE',
                '-DTribitsExProj_ENABLE_DEBUG:BOOL=OFF',
                '-DTribitsExProj_ENABLE_CHECKED_STL:BOOL=OFF',
                ]),
            ], # default-builds

        }, # cmake

    } # configuration

</pre>
<p>The contents of the file <tt class="docutils literal"><span class="pre">project-checkin-test-config.py</span></tt> show above are
pretty self explanatory.  This file defines a single python dictionary
data-structure called <tt class="docutils literal">configuration</tt> which gives some default arguments in
<tt class="docutils literal">defaults</tt>, and then cmake options that define the projects
<tt class="docutils literal"><span class="pre">--default-builds</span></tt>.  For more details, see the section <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing
using checkin-test.py</a>.</p>
<p id="projectdir-cmake-nativerepositorieslist-cmake"><strong>&lt;projectDir&gt;/cmake/NativeRepositoriesList.cmake</strong>: [Optional] If present,
this file gives the list of native repositories for the TriBITS project.  The
file must contain a <tt class="docutils literal">SET()</tt> statement defining the variable
<tt class="docutils literal">${PROJECT_NAME}_NATIVE_REPOSITORIES</tt> which is just a flat list of repository
names that must also be directory names under <tt class="docutils literal">&lt;projectDir&gt;/</tt>.  For example,
if this file contains:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_NATIVE_REPOSITORIES Repo0 Repo1)
</pre>
<p>then the directories <tt class="docutils literal"><span class="pre">&lt;projectDir&gt;/Repo0/</span></tt> and <tt class="docutils literal"><span class="pre">&lt;projectDir&gt;/Repo1/</span></tt> must
exist and must be valid TriBITS repositories (see <a class="reference internal" href="#tribits-repository">TriBITS Repository</a>).</p>
<p>There are no examples for the usage of this file in any of the TriBITS
examples or test projects.  However, support for this file is maintained for
backward compatibility since there may be some TriBITS projects that still use
it.  It is recommended instead to define multiple repositories using the
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file as it allows for more
flexibility in how extra repositories are specified and how they are accessed.
The latter file allows the various tools to perform VC activities with these
repos while &quot;native repositories&quot; do not.</p>
<p>If this file <tt class="docutils literal">NativeRepositoriesList.cmake</tt> does not exist, then TriBITS
sets <tt class="docutils literal">${PROJECT_NAME}_NATIVE_REPOSITORIES</tt> equal to &quot;.&quot;, or the base project
directory (i.e. <tt class="docutils literal"><span class="pre">&lt;projectDir&gt;/.</span></tt>).  In this case, the file
<tt class="docutils literal"><span class="pre">&lt;projectDir&gt;/PackagesList.cmake</span></tt> and <tt class="docutils literal"><span class="pre">&lt;projectDir&gt;/TPLsList.cmake</span></tt> must
exist.  However, if the project has no native packages or TPLs, then these
files can be set up to list no packages or TPLs.  This is the case for
meta-projects like VERA that have only extra repositories specified in the
file <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a>.</p>
<p id="projectdir-cmake-extrarepositorieslist-cmake"><strong>&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</strong>: [Optional] If present,
this file defines a list of extra repositories that are added on to the
project's native repositories.  The list of repositories is defined using the
macro <a class="reference internal" href="#tribits-project-define-extra-repositories">TRIBITS_PROJECT_DEFINE_EXTRA_REPOSITORIES()</a>.  For example, the extra
repos file:</p>
<pre class="literal-block">
TRIBITS_PROJECT_DEFINE_EXTRA_REPOSITORIES(
  ExtraRepo1  &quot;&quot;  GIT  someurl.com:/ExtraRepo1   &quot;&quot;          Continuous
  ExtraRepo2  packages/SomePackage/Blah  GIT  someurl2.com:/ExtraRepo2
                                                 NOPACKAGES  Nightly
  ExtraRepo3  &quot;&quot;  HG  someurl3.com:/ExtraRepo3   &quot;&quot;          Continuous
  ExtraRepo4  &quot;&quot;  SVN  someurl4.com:/ExtraRepo4  &quot;&quot;          Nightly
  )

</pre>
<p>shows the specification of both TriBITS Repositories and non-TriBITS VC
Repositories.  In the above file, the repositories <tt class="docutils literal">ExtraRepo1</tt>,
<tt class="docutils literal">ExtraRepo3</tt>, and <tt class="docutils literal">ExtraRepo4</tt> are both TriBITS and VC repositories that
are cloned into directories under <tt class="docutils literal">&lt;projectDir&gt;</tt> of the same names from the
URLs <tt class="docutils literal"><span class="pre">someurl.com:/ExtraRepo1</span></tt>, <tt class="docutils literal"><span class="pre">someurl3.com:/ExtraRepo3</span></tt>, and
<tt class="docutils literal"><span class="pre">someurl4.com:/ExtraRepo4</span></tt>, respectively.  However, the repository
<tt class="docutils literal">ExtraRepo2</tt> is <strong>not</strong> a <a class="reference internal" href="#tribits-repository">TriBITS Repository</a> because it is marked as
<tt class="docutils literal">NOPACKAGES</tt>.  In this case, it gets cloned as the directory:</p>
<pre class="literal-block">
&lt;projectDir&gt;/packages/SomePackage/Blah
</pre>
<p>However, the code in the tools <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> and
<a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a> will consider non-TriBITS VC repos like
<tt class="docutils literal">ExtraRepo2</tt> and any changes to this repository will be listed as changes to
<tt class="docutils literal">somePackage</tt> (see <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing using checkin-test.py</a>).</p>
<p>NOTE: This file can be overridden by setting the cache variable
<a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#project-extrarepos-file">&lt;Project&gt;_EXTRAREPOS_FILE</a>.</p>
<!-- ToDO: I am not really sure what repos get cloned the first time based on -->
<!-- the list of extra repos.  From looking at TribitsCTestDriverCore.cmake, it -->
<!-- looks like only the selected repos will be cloned.  I need to add some unit -->
<!-- tests that really show what the real behavior is and then document that -->
<!-- behavior here. -->
<p id="projectdir-cmake-projectdependenciessetup-cmake"><strong>&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</strong>: [Optional] If present,
this file is included a single time as part of the generation of the project's
dependency data-structure (see <a class="reference internal" href="#reduced-package-dependency-processing">Reduced Package Dependency Processing</a>).  It
gets included at the top project level scope after all of the
<a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a> files have been included
but before all of the package <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files
are included.  Any local variables set in this file have project-wide scope.
The primary purpose for this file is to set variables that will impact the
processing of project's package <tt class="docutils literal">Dependencies.cmake</tt> files.</p>
<p>The typical usage of this file is to set the default CDash email address for
all packages or override the email addresses for all of a repository's package
CDash regression email addresses (see <a class="reference internal" href="#cdash-regression-email-addresses">CDash regression email addresses</a>).
For example, to set the default email address for all of the packages, one
would set in this file:</p>
<pre class="literal-block">
SET_DEFAULT(${PROJECT_NAME}_PROJECT_MASTER_EMAIL_ADDRESS
    projectx-regressions&#64;somemailserver.org)
</pre>
<p>The repository email address variables
<a class="reference internal" href="#repository-name-repository-email-url-address-base">${REPOSITORY_NAME}_REPOSITORY_EMAIL_URL_ADDRESS_BASE</a> and
<a class="reference internal" href="#repository-name-repository-master-email-address">${REPOSITORY_NAME}_REPOSITORY_MASTER_EMAIL_ADDRESS</a> possibly set in the just
processed <a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a> files can also
be overridden in this file.  The CASL VERA meta-project uses this file to
override several of the repository-specific email addresses for its
constituent repositories.</p>
<p>In general, variables that affect how package dependencies are defined or
affect package and TPL enable/disable logic for <em>only this particular project</em>
should be defined in this file.</p>
<p id="projectdir-cmake-callbackdefineprojectpackaging-cmake"><strong>&lt;projectDir&gt;/cmake/CallbackDefineProjectPackaging.cmake</strong>: [Optional] If
exists, defines the CPack settings for the project (see <a class="reference external" href="http://www.cmake.org/cmake/help/documentation.html">Official CPack
Documentation</a> and
<a class="reference external" href="http://www.cmake.org/Wiki/CMake:Packaging_With_CPack">Online CPack Wiki</a>).
This file must define a macro called <tt class="docutils literal">TRIBITS_PROJECT_DEFINE_PACKAGING()</tt>
which is then invoked by TriBITS.  The file:</p>
<blockquote>
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">cmake/CallbackDefineProjectPackaging.cmake</tt></blockquote>
<p>provides a good example which is:</p>
<pre class="literal-block">
MACRO(TRIBITS_PROJECT_DEFINE_PACKAGING)

    TRIBITS_COPY_INSTALLER_RESOURCE(TribitsExProj_README
      &quot;${TribitsExProj_SOURCE_DIR}/README&quot;
      &quot;${TribitsExProj_BINARY_DIR}/README.txt&quot;)
    TRIBITS_COPY_INSTALLER_RESOURCE(TribitsExProj_LICENSE
      &quot;${TribitsExProj_SOURCE_DIR}/LICENSE&quot;
      &quot;${TribitsExProj_BINARY_DIR}/LICENSE.txt&quot;)

    SET(CPACK_PACKAGE_DESCRIPTION &quot;TribitsExampleProject just shows you how to use TriBITS.&quot;)
    SET(CPACK_PACKAGE_FILE_NAME &quot;tribitsexproj-setup-${TribitsExProj_VERSION}&quot;)
    SET(CPACK_PACKAGE_INSTALL_DIRECTORY &quot;TribitsExProj ${TribitsExProj_VERSION}&quot;)
    SET(CPACK_PACKAGE_REGISTRY_KEY &quot;TribitsExProj ${TribitsExProj_VERSION}&quot;)
    SET(CPACK_PACKAGE_NAME &quot;tribitsexproj&quot;)
    SET(CPACK_PACKAGE_VENDOR &quot;Sandia National Laboratories&quot;)
    SET(CPACK_PACKAGE_VERSION &quot;${TribitsExProj_VERSION}&quot;)
    SET(CPACK_RESOURCE_FILE_README &quot;${TribitsExProj_README}&quot;)
    SET(CPACK_RESOURCE_FILE_LICENSE &quot;${TribitsExProj_LICENSE}&quot;)
    SET(${PROJECT_NAME}_CPACK_SOURCE_GENERATOR_DEFAULT &quot;TGZ;TBZ2&quot;)
    SET(CPACK_SOURCE_FILE_NAME &quot;tribitsexproj-source-${TribitsExProj_VERSION}&quot;)
    SET(CPACK_COMPONENTS_ALL ${TribitsExProj_PACKAGES} Unspecified)

ENDMACRO()

</pre>
<p>The CPack variables show above that should be defined at the project-level are
described in the <a class="reference external" href="http://www.cmake.org/cmake/help/documentation.html">Official CPack Documentation</a>.</p>
<p>Settings that are general for all distributions (like non-package repository
files to exclude from the tarball) should be set at the in the file
<a class="reference internal" href="#repodir-cmake-callbackdefinerepositorypackaging-cmake">&lt;repoDir&gt;/cmake/CallbackDefineRepositoryPackaging.cmake</a>.  See <cite>Creating
Source Distributions</cite> for more details.</p>
<p id="projectdir-cmake-tribits"><strong>&lt;projectDir&gt;/cmake/tribits/</strong>: [Optional] This is the typical location of
the <tt class="docutils literal">tribits</tt> source tree for projects that choose to snapshot or checkout
TriBITS into their source tree.  In fact, TriBITS assumes this is the default
location for the TriBITS source tree if <tt class="docutils literal">${PROJECT_NAME}_TRIBITS_DIR</tt> is not
otherwise specified.  Trilinos, for example, currently snapshots the TriBITS
source tree into this directory.  See <a class="reference internal" href="#tribits-directory-snapshotting">TriBITS directory snapshotting</a> for
more details.</p>
<p id="projectdir-cmake-ctest-ctestcustom-cmake-in"><strong>&lt;projectDir&gt;/cmake/ctest/CTestCustom.cmake.in</strong>: [Optional] If this file
exists, it is processed using a <tt class="docutils literal">CONFIGURE_FILE()</tt> command to write the file
<tt class="docutils literal">CTestCustom.cmake</tt> in the project base build directory
<tt class="docutils literal"><span class="pre">`${PROJECT_BINARY_DIR}/</span></tt>.  This file is picked up automatically by
<tt class="docutils literal">ctest</tt> (see <a class="reference external" href="http://www.cmake.org/Wiki/CMake/Testing_With_CTest">CTest documentation</a>).  This file is typically used to change
the maximum size of test output.  For example, the
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">cmake/ctest/CTestCustom.cmake.in</tt> looks like:</p>
<pre class="literal-block">
# Allow full output to go to CDash
SET(CTEST_CUSTOM_MAXIMUM_PASSED_TEST_OUTPUT_SIZE 0)
SET(CTEST_CUSTOM_MAXIMUM_FAILED_TEST_OUTPUT_SIZE 0)
# WARNING!  This could be a lot of output and could overwhelm CDash and the
# MySQL DB so this might not be a good idea!

</pre>
<p>which sets the output size for each test submitted to CDash be unlimited
(which is not really recommended).  These variables used by Trilinos at one
time were:</p>
<pre class="literal-block">
SET(CTEST_CUSTOM_MAXIMUM_PASSED_TEST_OUTPUT_SIZE 50000)
SET(CTEST_CUSTOM_MAXIMUM_FAILED_TEST_OUTPUT_SIZE 5000000)
</pre>
<p>which sets the max output for passed and failed tests to 50000k and 5000000k,
respectively.</p>
<p>For documentation of the options one can change for CTest, see online <a class="reference external" href="http://www.cmake.org/Wiki/CMake/Testing_With_CTest">CTest
documentation</a>.</p>
</div>
<div class="section" id="tribits-project-core-variables">
<h4><a class="toc-backref" href="#id13">TriBITS Project Core Variables</a></h4>
<p>The following local variables are defined in the top-level Project
<tt class="docutils literal">CMakeLists.txt</tt> file scope and are therefore accessible by all files
processed by TriBITS:</p>
<blockquote>
<p id="project-name"><tt class="docutils literal">PROJECT_NAME</tt></p>
<blockquote>
The name of the TriBITS Project.  This exists to support, among other
things, the ability for subordinate units (Repositories and Packages) to
determine the Project in which is participating.  This is typically read
from a <tt class="docutils literal">SET()</tt> statement in the project's
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.</blockquote>
<p id="project-source-dir"><tt class="docutils literal">PROJECT_SOURCE_DIR</tt></p>
<blockquote>
The absolute path to the base Project source directory.  This is set
automatically by TriBITS given the directory passed into <tt class="docutils literal">cmake</tt> at
configure time at the beginning of the <a class="reference internal" href="#id2">TRIBITS_PROJECT()</a> macro.</blockquote>
<p id="project-binary-dir"><tt class="docutils literal">PROJECT_BINARY_DIR</tt></p>
<blockquote>
The absolute path to the base Project binary/build directory.  This is set
automatically by TriBITS and is the directory where <tt class="docutils literal">cmake</tt> is run from
and is set at the beginning of the <a class="reference internal" href="#id2">TRIBITS_PROJECT()</a> macro.</blockquote>
<p id="project-name-source-dir"><tt class="docutils literal">${PROJECT_NAME}_SOURCE_DIR</tt></p>
<blockquote>
Set to the same directory as <tt class="docutils literal">${PROJECT_SOURCE_DIR}</tt> automatically by
the built-in <tt class="docutils literal">PROJECT()</tt> command called in the top-level
<a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file..</blockquote>
<p id="project-name-binary-dir"><tt class="docutils literal">${PROJECT_NAME}_BINARY_DIR</tt></p>
<blockquote>
Set to the same directory as <tt class="docutils literal">${PROJECT_BINARY_DIR}</tt> automatically by
the built-in <tt class="docutils literal">PROJECT()</tt> command called in the top-level
<a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file..</blockquote>
<p id="project-name-enable-tests"><tt class="docutils literal">${PROJECT_NAME}_ENABLE_TESTS</tt></p>
<blockquote>
CMake cache variables that if set to <tt class="docutils literal">ON</tt>, then tests for all explicitly
enabled packages will be turned on.  This has a default value of <tt class="docutils literal">OFF</tt>.
This is used in logic to enable individual SE package tests (see
<a class="reference internal" href="#project-enable-tests-only-enables-explicitly-enabled-se-package-tests">&lt;Project&gt;_ENABLE_TESTS only enables explicitly enabled SE package
tests</a>).</blockquote>
<p><tt class="docutils literal">${PACKAGE_NAME}_ENABLE_EXAMPLES</tt></p>
<blockquote>
CMake cache variables that if set to <tt class="docutils literal">ON</tt>, then examples for all
explicitly enabled packages will be turned on.  This has a default value
of <tt class="docutils literal">OFF</tt>.</blockquote>
</blockquote>
<p>The following internal project-scope local (non-cache) CMake variables are
defined by TriBITS giving the project's TriBITS repositories.:</p>
<blockquote>
<p id="project-name-native-repositories"><tt class="docutils literal">${PROJECT_NAME}_NATIVE_REPOSITORIES</tt></p>
<blockquote>
The list of Native Repositories for a given TriBITS project
(i.e. Repositories that are always present when configuring the Project
and are managed in the same VC repo typically).  This variable is set in
the file <a class="reference internal" href="#projectdir-cmake-nativerepositorieslist-cmake">&lt;projectDir&gt;/cmake/NativeRepositoriesList.cmake</a> if it exists.
If the file <tt class="docutils literal">NativeRepositoriesList.cmake</tt> does not exist, then the
project is assumed to also be a repository and the list of native
repositories is just the local project directory
<tt class="docutils literal"><span class="pre">${PROJECT_SOURCE_DIR}/.</span></tt>.  In this case, the
<tt class="docutils literal">${PROJECT_SOURCE_DIR}/</tt> must contain at a minimum a
<tt class="docutils literal">PackagesList.cmake</tt> file, and a <tt class="docutils literal">TPLsList.cmake</tt> file (see <a class="reference internal" href="#tribits-repository">TriBITS
Repository</a>).</blockquote>
<p id="project-name-extra-repositories"><tt class="docutils literal">${PROJECT_NAME}_EXTRA_REPOSITORIES</tt></p>
<blockquote>
The list of Extra Repositories that the project is being configured with.
This list of repositories either comes from processing the project's
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file or comes from the
CMake cache variable <tt class="docutils literal">${PROJECT_NAME}_EXTRA_REPOSITORIES</tt>.  See
<a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#enabling-extra-repositories-with-add-on-packages">Enabling extra repositories with add-on packages</a> for details.</blockquote>
<p id="project-name-all-repositories"><tt class="docutils literal">${PROJECT_NAME}_ALL_REPOSITORIES</tt></p>
<blockquote>
Concatenation of all the repos listed in
<a class="reference internal" href="#project-name-native-repositories">${PROJECT_NAME}_NATIVE_REPOSITORIES</a> and
<a class="reference internal" href="#project-name-extra-repositories">${PROJECT_NAME}_EXTRA_REPOSITORIES</a> in the order they are processed.</blockquote>
</blockquote>
</div>
</div>
<div class="section" id="tribits-repository">
<h3><a class="toc-backref" href="#id14">TriBITS Repository</a></h3>
<p>A TriBITS Repository is the basic unit of ready-made composition between
different collections of software that use the TriBITS CMake build and system.</p>
<p>In short, a TriBITS Repository:</p>
<ul class="simple">
<li>Is a named collection of related TriBITS Packages and TPLs (defined in
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> and <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a>
respectively)</li>
<li>Defines the base source and binary directories for the Repository
<tt class="docutils literal">${REPOSITORY_NAME}_SOURCE_DIR</tt> and <tt class="docutils literal">${REPOSITORY_NAME}_BINARY_DIR</tt>.</li>
<li>Defines a common set of initializations and other hooks for a all the
packages in the repository.</li>
<li>Typically maps to a VC (i.e. git) repository and therefore represents a unit
of integration, versioning and reuse.  (But core TriBITS has no dependency
on any VC tool.)</li>
</ul>
<p>For more details on the definition of a TriBITS Repository, see:</p>
<ul class="simple">
<li><a class="reference internal" href="#tribits-repository-core-files">TriBITS Repository Core Files</a></li>
<li><a class="reference internal" href="#tribits-repository-core-variables">TriBITS Repository Core Variables</a></li>
</ul>
<div class="section" id="tribits-repository-core-files">
<h4><a class="toc-backref" href="#id15">TriBITS Repository Core Files</a></h4>
<p>The core files making up a TriBITS Repository (where <tt class="docutils literal">&lt;repoDir&gt; =
<span class="pre">${${REPOSITORY_NAME}_SOURCE_DIR}</span></tt>) are:</p>
<pre class="literal-block">
&lt;repoDir&gt;/
  PackagesList.cmake
  TPLsList.cmake
  Copyright.txt  # [Optional] Only needed if creating version header file
  Version.cmake  # [Optional] Info inserted into ${REPO_NAME}_version.h
  cmake/
     RepositoryDependenciesSetup.cmake # [Optional] CDash email addresses?
     CallbackSetupExtraOptions.cmake # [Optional] Called after main options
     CallbackDefineRepositoryPackaging.cmake # [Optional] CPack packaging
</pre>
<p>These TriBITS Repository files are documented in more detail below:</p>
<ul class="simple">
<li><a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a></li>
<li><a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a></li>
<li><a class="reference internal" href="#repodir-copyright-txt">&lt;repoDir&gt;/Copyright.txt</a></li>
<li><a class="reference internal" href="#repodir-version-cmake">&lt;repoDir&gt;/Version.cmake</a></li>
<li><a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a></li>
<li><a class="reference internal" href="#repodir-cmake-callbacksetupextraoptions-cmake">&lt;repoDir&gt;/cmake/CallbackSetupExtraOptions.cmake</a></li>
<li><a class="reference internal" href="#repodir-cmake-callbackdefinerepositorypackaging-cmake">&lt;repoDir&gt;/cmake/CallbackDefineRepositoryPackaging.cmake</a></li>
</ul>
<p id="repodir-packageslist-cmake"><strong>&lt;repoDir&gt;/PackagesList.cmake</strong>: [Required] Provides the list of top-level
packages defined by the repository.  This file typically just calls the macro
<a class="reference internal" href="#tribits-repository-define-packages">TRIBITS_REPOSITORY_DEFINE_PACKAGES()</a> to define the list of packages along
with their directories and other properties.  For example, the file
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">PackagesList.cmake</tt> looks like:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_PACKAGES(
  SimpleCxx          packages/simple_cxx         PT
  MixedLang          packages/mixed_lang         PT
  ExternalPkg        ExternalPkg                 ST
  WithSubpackages    packages/with_subpackages   PT
  WrapExternal       packages/wrap_external      ST
  )

TRIBITS_DISABLE_PACKAGE_ON_PLATFORMS(WrapExternal Windows)
TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES(ExternalPkg)

</pre>
<p>Other commands that are appropriate to use in this file include
<a class="reference internal" href="#tribits-disable-package-on-platforms">TRIBITS_DISABLE_PACKAGE_ON_PLATFORMS()</a> and
<a class="reference internal" href="#tribits-allow-missing-external-packages">TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES()</a>.  Also, if the binary directory
for any package <tt class="docutils literal">&lt;packageName&gt;</tt> needs to be changed from the default, then
the variable <tt class="docutils literal">&lt;packageName&gt;_SPECIFIED_BINARY_DIR</tt> can be set.  One can see
an example of this in the file <tt class="docutils literal">TriBITS/PackageList.cmake</tt> which shows</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_PACKAGES(
  TriBITS  .    PT
  )

</pre>
<p>(see <a class="reference internal" href="#tribits-package-tribits-repository-tribits-project">TriBITS Package == TriBITS Repository == TriBITS Project</a>).</p>
<p>It is perfectly legal for a TriBITS repository to define no packages at all
with:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_PACKAGES()
</pre>
<p>and this would be the case for a TriBITS meta-project that has no native
packages, only extra repositories.</p>
<!-- ToDo: Point to example meta-project. -->
<p id="repodir-tplslist-cmake"><strong>&lt;repoDir&gt;/TPLsList.cmake</strong>: [Required] Provides the list of TPLs that are
referenced as TPL dependencies in the repository's SE package's
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files (see <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>).  This
file typically just calls the macro <a class="reference internal" href="#tribits-repository-define-tpls">TRIBITS_REPOSITORY_DEFINE_TPLS()</a> to
define the TPLs along with their find modules and other properties.  An
example is <a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a>/<tt class="docutils literal">TPLsList.cmake</tt> which shows:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_TPLS(
  MPI            &quot;${${PROJECT_NAME}_TRIBITS_DIR}/tpls/&quot;    PT
  BLAS           cmake/TPLs/    PT
  LAPACK         cmake/TPLs/    PT
  Boost          cmake/TPLs/    ST
  UMFPACK        cmake/TPLs/    ST
  AMD            cmake/TPLs/    EX
  PETSC          cmake/TPLs/    ST
  )

</pre>
<p>See <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a> for details on what gets defined for each TriBITS TPL once
this file is processed.</p>
<p>It is perfectly fine to specify no TPLs at all for a repository with:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_TPLS()
</pre>
<p>but the macro <tt class="docutils literal">TRIBITS_REPOSITORY_DEFINE_TPLS()</tt> has to be called, even if
there are no TPLs.  See <a class="reference internal" href="#tribits-repository-define-tpls">TRIBITS_REPOSITORY_DEFINE_TPLS()</a> for further
details and constraints.</p>
<p id="repodir-copyright-txt"><strong>&lt;repoDir&gt;/Copyright.txt</strong>: [Optional] Gives the default copyright and
license declaration for all of the software in the TriBITS repository
directory <tt class="docutils literal">&lt;repoDir&gt;/</tt>.  This file is read into a string and then used to
configure the repository's version header file (see <a class="reference internal" href="#project-and-repository-versioning-and-release-mode">Project and Repository
Versioning and Release Mode</a>).  Even if a repository version header file is
not produced, it is a good idea for every TriBITS repository to define this
file, just for legal purposes.  For a good open-source license, one should
consider copying the <tt class="docutils literal">TriBITS/Copyright.txt</tt> file which is a simple 3-clause
BSD-like license like:</p>
<pre class="literal-block">
# &#64;HEADER
# ************************************************************************
#
#            TriBITS: Tribal Build, Integrate, and Test System
#                    Copyright 2013 Sandia Corporation
#
# Under the terms of Contract DE-AC04-94AL85000 with Sandia Corporation,
# the U.S. Government retains certain rights in this software.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are
# met:
#
# 1. Redistributions of source code must retain the above copyright
# notice, this list of conditions and the following disclaimer.
#
# 2. Redistributions in binary form must reproduce the above copyright
# notice, this list of conditions and the following disclaimer in the
# documentation and/or other materials provided with the distribution.
#
# 3. Neither the name of the Corporation nor the names of the
# contributors may be used to endorse or promote products derived from
# this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY SANDIA CORPORATION &quot;AS IS&quot; AND ANY
# EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL SANDIA CORPORATION OR THE
# CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
# EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
# PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
# PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
# LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
# NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
# SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
# ************************************************************************
# &#64;HEADER

</pre>
<p id="repodir-version-cmake"><strong>&lt;repoDir&gt;/Version.cmake</strong>: [Optional] Contains version information for the
repository (and the project also if this is also the base project).  For
example, <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">Version.cmake</tt>, this looks like:</p>
<pre class="literal-block">
SET(${REPOSITORY_NAME}_VERSION 1.1)
SET(${REPOSITORY_NAME}_MAJOR_VERSION 01)
SET(${REPOSITORY_NAME}_MAJOR_MINOR_VERSION 010100)
SET(${REPOSITORY_NAME}_VERSION_STRING &quot;1.1 (Dev)&quot;)
SET(${REPOSITORY_NAME}_ENABLE_DEVELOPMENT_MODE_DEFAULT ON) # Change to 'OFF' for a release

</pre>
<p>Note that the prefix <tt class="docutils literal">${REPOSITORY_NAME}_</tt> is used instead of hard-coding
the repository's name to allow flexibility in what a meta-project names a
given TriBITS repository.</p>
<p>The local variables in these set statements are processed in the base project
directory's local scope and are therefore seen by the entire CMake project.
When this file is read in repository mode, the variable
<tt class="docutils literal">${REPOSITORY_NAME}_ENABLE_DEVELOPMENT_MODE_DEFAULT</tt> is ignored.</p>
<p id="repodir-cmake-repositorydependenciessetup-cmake"><strong>&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</strong>: [Optional] If present,
this file is included a single time as part of the generation of the project
dependency data-structure (see <a class="reference internal" href="#reduced-package-dependency-processing">Reduced Package Dependency Processing</a>).  It
gets included in the order listed in <a class="reference internal" href="#project-name-all-repositories">${PROJECT_NAME}_ALL_REPOSITORIES</a>.  Any
local variables set in this file have project-wide scope.  The primary purpose
for this file is to set variables that will impact the processing of project's
package's <tt class="docutils literal">Dependencies.cmake</tt> files and take care of other enable/disable
issues that are not otherwise cleanly handled by the TriBITS system
automatically.</p>
<p>The typical usage of this file is to set the default CDash email address for
all of the defined packages (see <a class="reference internal" href="#cdash-regression-email-addresses">CDash regression email addresses</a>).  For
example, to set the default email address for all of the packages in this
repository, one would set in this file:</p>
<pre class="literal-block">
SET_DEFAULT(${REPOSITORY_NAME}_REPOSITORY_MASTER_EMAIL_ADDRESS
    repox-regressions&#64;somemailserver.org)
</pre>
<p>Note that the prefix <tt class="docutils literal">${REPOSITORY_NAME}_</tt> is used instead of hard-coding
the repo name to allow greater flexibility in how meta-projects refer to this
TriBITS repo.</p>
<p id="repodir-cmake-callbacksetupextraoptions-cmake"><strong>&lt;repoDir&gt;/cmake/CallbackSetupExtraOptions.cmake</strong>: [Optional] If defined,
this file is processed (included) for each repo in order right after the basic
TriBITS options are defined in the macro
<tt class="docutils literal">TRIBITS_DEFINE_GLOBAL_OPTIONS_AND_DEFINE_EXTRA_REPOS()</tt>.  This file must
define the macro <tt class="docutils literal">TRIBITS_REPOSITORY_SETUP_EXTRA_OPTIONS()</tt> which is then
called by the TriBITS system.  This file is only processed when doing a basic
configuration of the project and <strong>not</strong> when it is just building up the
dependency data-structures (i.e. it is <strong>not</strong> processed in the <a class="reference internal" href="#reduced-package-dependency-processing">Reduced
Package Dependency Processing</a>).  Any local variables set have project-wide
scope.</p>
<p>A few additional variables are defined by the time this file is processed and
can be used in the logic in these files.  Some of the variables that should
already be defined (in addition to all of the basic user TriBITS cache
variables set in <tt class="docutils literal">TRIBITS_DEFINE_GLOBAL_OPTIONS_AND_DEFINE_EXTRA_REPOS()</tt>)
include <tt class="docutils literal">CMAKE_HOST_SYSTEM_NAME</tt>, <tt class="docutils literal">${PROJECT_NAME}_HOSTNAME</tt>, and
<tt class="docutils literal">PYTHON_EXECUTABLE</tt>.  The types of commands and logic to put in this file
include:</p>
<ul class="simple">
<li>Setting additional user cache variable options that are used by multiple
packages in the TriBITS Repository.  For example, Trilinos defines a
<tt class="docutils literal">Trilinos_DATA_DIR</tt> user cache variable that several Trilinos packages use
to get extra test data to define extra tests.</li>
<li>Disabling packages in the TriBITS Repository when conditions will not allow
them to be enabled.  For example, Trilinos disables the package
<tt class="docutils literal">ForTrilinos</tt> when <tt class="docutils literal">Fortran</tt> is disabled and disables the package
<tt class="docutils literal">PyTrilinos</tt> when Python support is disabled.</li>
</ul>
<p>An example of this file is:</p>
<blockquote>
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">/cmake/CallbackSetupExtraOptions.cmake</tt></blockquote>
<p>which currently looks like:</p>
<pre class="literal-block">
MACRO(TRIBITS_REPOSITORY_SETUP_EXTRA_OPTIONS)

  ASSERT_DEFINED(${PROJECT_NAME}_ENABLE_EXPORT_MAKEFILES)
  ASSERT_DEFINED(${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES)

  IF (${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES)
    MESSAGE(
      &quot;\n***&quot;
      &quot;\n*** Warning: Setting ${PROJECT_NAME}_ENABLE_WrapExternal=OFF&quot;
      &quot; because ${PROJECT_NAME}_ENABLE_EXPORT_MAKEFILES or&quot;
      &quot; ${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES is on!&quot;
      &quot;\n***\n&quot;
      )
    SET(${PROJECT_NAME}_ENABLE_WrapExternal OFF)
  ENDIF()

  ASSERT_DEFINED(${PROJECT_NAME}_ENABLE_Fortran)

  IF (NOT ${PROJECT_NAME}_ENABLE_Fortran)
    MESSAGE(
      &quot;\n***&quot;
      &quot;\n*** Warning: Setting ${PROJECT_NAME}_ENABLE_MixedLang=OFF&quot;
      &quot; because ${PROJECT_NAME}_ENABLE_Fortran=OFF!&quot;
      &quot;\n***\n&quot;
      )
    SET(${PROJECT_NAME}_ENABLE_MixedLang OFF)
  ENDIF()

ENDMACRO()

</pre>
<p id="repodir-cmake-callbackdefinerepositorypackaging-cmake"><strong>&lt;repoDir&gt;/cmake/CallbackDefineRepositoryPackaging.cmake</strong>: [Optional] If
this file exists, then it defines extra CPack-related options that are
specific to this TriBITS Repository.  This file must define the macro
<tt class="docutils literal">TRIBITS_REPOSITORY_DEFINE_PACKAGING()</tt> which is called by TriBITS.  This
file is processed as the top project-level scope so any local variables set
have project-wide effect.  This file is processed after the project's
<a class="reference internal" href="#projectdir-cmake-callbackdefineprojectpackaging-cmake">&lt;projectDir&gt;/cmake/CallbackDefineProjectPackaging.cmake</a> file so any project
CPACK varaibles are defined for the repository-level options and commands are
created.  This file typically just sets extra excludes to remove files from
the tarball.  The file:</p>
<blockquote>
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">cmake/CallbackDefineRepositoryPackaging.cmake</tt></blockquote>
<p>provides a good example which is:</p>
<pre class="literal-block">
MACRO(TRIBITS_REPOSITORY_DEFINE_PACKAGING)

  ASSERT_DEFINED(${REPOSITORY_NAME}_SOURCE_DIR)
  APPEND_SET(CPACK_SOURCE_IGNORE_FILES
    &quot;${${REPOSITORY_NAME}_SOURCE_DIR}/cmake/ctest/&quot;
    )

ENDMACRO()

</pre>
<p>As shown in the above example, it is important to prefix the excluded files
and directories with the repository base directory
<tt class="docutils literal"><span class="pre">${${REPOSITORY_NAME}_SOURCE_DIR}/</span></tt> since these are interpreted by CPack as
regular-expressions.</p>
</div>
<div class="section" id="tribits-repository-core-variables">
<h4><a class="toc-backref" href="#id16">TriBITS Repository Core Variables</a></h4>
<p>The following temporary local variables are defined automatically by TriBITS
before processing a given TriBITS repository's files
(e.g. <tt class="docutils literal">PackagesList.cmake</tt>, <tt class="docutils literal">TPLsList.cmake</tt>, etc.):</p>
<blockquote>
<p id="repository-name"><tt class="docutils literal">REPOSITORY_NAME</tt></p>
<blockquote>
The name of the current TriBITS repository.  This name will be the
repository name listed in
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file or if this
repository directory is the project base directory, <tt class="docutils literal">REPOSITORY_NAME</tt>
will be set to <tt class="docutils literal">${PROJECT_NAME}</tt>.</blockquote>
<p><tt class="docutils literal">REPOSITORY_DIR</tt></p>
<blockquote>
Path of the current Repository <em>relative</em> to the Project's base source
directory <a class="reference internal" href="#project-name-source-dir">${PROJECT_NAME}_SOURCE_DIR</a>..  This is typically just the
repository name but can be an arbitrary directory if specified through the
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file.</blockquote>
</blockquote>
<p>The following project-scope (non-cache) local variables are set once the list
of TriBITS repositories is processed and before any of the repository's files
are processed:</p>
<blockquote>
<p><tt class="docutils literal">${REPOSITORY_NAME}_SOURCE_DIR</tt></p>
<blockquote>
The absolute path to the base of a given TriBITS Repository's source
directory.  CMake code, for example in a packages's <tt class="docutils literal">CMakeLists.txt</tt>
file, typically refers to this by the raw name like <tt class="docutils literal">RepoX_SOURCE_DIR</tt>.
This makes such CMake code independent of where the various TriBITS repos
are in relation to each other or the TriBITS Project (but does hard-code
the repository name which is not ideal).</blockquote>
<p><tt class="docutils literal">${REPOSITORY_NAME}_BINARY_DIR</tt></p>
<blockquote>
The absolute path to the base of a given TriBITS Repository's binary
directory.  CMake code, for example in packages, refer to this by the raw
name like <tt class="docutils literal">RepoX_SOURCE_DIR</tt>.  This makes such CMake code independent of
where the various TriBITS repos are in relation to each other or the
Project.</blockquote>
</blockquote>
<p>The following project-level local varaibles can be defined by the project or
the user to help define the what packages from the repository
<tt class="docutils literal">${REPOSITORY_NAME}</tt> contribute to the primary meta-project packages (PMPP):</p>
<blockquote>
<p id="repository-name-no-primary-meta-project-packages"><tt class="docutils literal">${REPOSITORY_NAME}_NO_PRIMARY_META_PROJECT_PACKAGES</tt></p>
<blockquote>
If set to <tt class="docutils literal">TRUE</tt>, then the package's in the TriBITS repository are not
considered to be part of the primary meta-project packages.  This affects
what packages get enabled by default when enabling all packages with
setting <tt class="docutils literal">${PROJECT_NAME}_ENABLE_ALL_PACKAGES=ON</tt> and what tests and
examples get enabled by default when setting
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_TESTS=ON</tt>.  See <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling
Behaviors</a> for more details.</blockquote>
<p id="repository-name-no-primary-meta-project-packages-except"><tt class="docutils literal">${REPOSITORY_NAME}_NO_PRIMARY_META_PROJECT_PACKAGES_EXCEPT</tt></p>
<blockquote>
When the above variable is set to <tt class="docutils literal">TRUE</tt>, this variable is read by
TriBITS to find the list of TriBITS packages selected packages in the
repository <tt class="docutils literal">${REPOSITORY_NAME}</tt> which are considered to be part of the
set of the project's primary meta-project package when the above variable
is set to <tt class="docutils literal">ON</tt>.  NOTE: It is not necessary to list all of the
subpackages in a given parent package.  Only the parent package need be
listed and it will be equivalent to listing all of the subpackages.  See
<a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a> for more details.</blockquote>
</blockquote>
<p>The above primary meta-project variables should be set in the meta-project's
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file so that they will be set in all
situations.</p>
</div>
</div>
<div class="section" id="tribits-package">
<h3><a class="toc-backref" href="#id17">TriBITS Package</a></h3>
<p>A TriBITS Package:</p>
<ul class="simple">
<li>Is the fundamental TriBITS structural unit of software partitioning and
aggregation.</li>
<li>Must have a unique package name (<tt class="docutils literal">PACKAGE_NAME</tt>) that is globally unique
(see <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS package names</a>).</li>
<li>Typically defines a set of libraries and/or header files and/or executables
and/or tests with CMake build targets for building these for which TriBITS
exports the list of include directories, libraries, and targets that are
created (along with CMake dependencies).</li>
<li>Is declared in its parent repository's <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file.</li>
<li>Declares dependencies on <a class="reference internal" href="#upstream">upstream</a> TPLs and/or other SE packages by just
naming the dependencies in the file
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a>.</li>
<li>Can optionally have subpackages listed in the argument
<a class="reference internal" href="#subpackages-dirs-classifications-optreqs">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</a> to the macro call
<a class="reference internal" href="#tribits-package-define-dependencies">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a>.</li>
<li>Is the unit of testing as driven by <a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a> and displayed
on CDash.</li>
</ul>
<p id="globally-unique-tribits-package-names"><strong>WARNING:</strong> As noted above, one must be very careful to pick <strong>globally
unique TriBITS package names</strong>.  This name must be unique not only within its
defined TriBITS repository but also across all SE packages in all TriBITS
repositories that ever might be cobbled together into a single TriBITS (meta)
project!  Choosing a good package name is the single most important decision
when it comes to defining a TriBITS package.  One must be careful <strong>not</strong> to
pick names like &quot;Debug&quot; or &quot;StandardUtils&quot; that have a high chance of clashing
with poorly named TriBITS packages from other TriBITS repositories.</p>
<p>For more details on the definition of a TriBITS Package (or subpackage), see:</p>
<ul class="simple">
<li><a class="reference internal" href="#tribits-package-core-files">TriBITS Package Core Files</a></li>
<li><a class="reference internal" href="#tribits-package-core-variables">TriBITS Package Core Variables</a></li>
</ul>
<div class="section" id="tribits-package-core-files">
<h4><a class="toc-backref" href="#id18">TriBITS Package Core Files</a></h4>
<p>The core files that make up a <em>TriBITS Package</em> (where <tt class="docutils literal">&lt;packageDir&gt; =
<span class="pre">${${PACKAGE_NAME}_SOURCE_DIR}</span></tt>) are:</p>
<pre class="literal-block">
&lt;packageDir&gt;/
  CMakeLists.txt  # Only processed if the package is enabled
  cmake/
    Dependencies.cmake  # Always processed if its repo is processed
    &lt;packageName&gt;_config.h.in  # [Optional], name is not fixed
</pre>
<p><strong>NOTE:</strong> Before a TriBITS Package's files are described in more detail, it is
important to note that all of the package's files that define its behavior and
tests should strictly be contained under the package's base source directory
<tt class="docutils literal">&lt;packageDir&gt;/</tt> if at all possible.  While this is not a requirement for the
basic TriBITS build system, the approach for automatically detecting when a
package has changed by looking at what files have changed (which is used in
the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script and <a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a>) requires that the
package's files be listed under <tt class="docutils literal">&lt;packageDir&gt;/</tt> (see <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing using
checkin-test.py</a>).  Without this, the TriBITS development tools will not be
able to automatically determine what needs to be rebuilt and retested which
can lead to pushing broken software.</p>
<p>The following TriBITS Package files are documented in more detail below:</p>
<ul class="simple">
<li><a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a></li>
<li><a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a></li>
<li><a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a></li>
</ul>
<p id="packagedir-cmake-dependencies-cmake"><strong>&lt;packageDir&gt;/cmake/Dependencies.cmake</strong>: [Required] Defines the dependencies
for a given TriBITS (SE) package using the macro
<a class="reference internal" href="#tribits-package-define-dependencies">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a>.  This file is processed at the
top-level project scope (using an <tt class="docutils literal">INCLUDE()</tt>) so any local variables set
will be seen by the entire project.  This file is always processed, including
when just building the project's dependency data-structure (see <a class="reference internal" href="#reduced-package-dependency-processing">Reduced
Package Dependency Processing</a>).</p>
<p>An example of a <tt class="docutils literal">Dependencies.cmake</tt> file for a package with optional and
required dependencies is for the mock <tt class="docutils literal">Panzer</tt> package in <a class="reference internal" href="#mocktrilinos">MockTrilinos</a>:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_DEFINE_DEPENDENCIES(
  LIB_REQUIRED_PACKAGES Teuchos Sacado Phalanx Intrepid Thyra
    Tpetra Epetra EpetraExt
  LIB_OPTIONAL_PACKAGES Stokhos
  TEST_OPTIONAL_PACKAGES Stratimikos
  LIB_REQUIRED_TPLS MPI Boost
  )

</pre>
<p id="with-subpackages-cmake-dependencies-cmake">An example of a package with subpackages is <tt class="docutils literal">WithSubpackages</tt> which has the
dependencies file:</p>
<blockquote>
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">packages/with_subpackages/cmake/Dependencies.cmake</tt></blockquote>
<p>which is:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_DEFINE_DEPENDENCIES(
  SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS
    A   a   PT  REQUIRED
    B   b   ST  OPTIONAL
    C   c   ST  OPTIONAL
  )

</pre>
<p><tt class="docutils literal">WithSubpackages</tt> defines three subpackages which creates three new SE
packages with names <tt class="docutils literal">WithSubpackagesA</tt>, <tt class="docutils literal">WithSubpackagesB</tt>, and
<tt class="docutils literal">WithSubpackagesC</tt>.</p>
<p id="packagedir-cmake-packagename-config-h-in"><strong>&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</strong>: [Optional] The package's
configured header file.  This file will contain placeholders for variables
that will be substitute at configure time with <a class="reference internal" href="#tribits-configure-file">TRIBITS_CONFIGURE_FILE()</a>.
This includes usage of <tt class="docutils literal">#cmakedefine &lt;varName&gt;</tt> and other standard CMake
file configuration features.</p>
<p><strong>NOTE:</strong> The file name <tt class="docutils literal">&lt;packageName&gt;_config.h.in</tt> is not at all fixed and
the package can call this file anything it wants.  Also, a package can
configure multiple header files in different directories for different
purposes using <a class="reference internal" href="#tribits-configure-file">TRIBITS_CONFIGURE_FILE()</a> or even calls to the raw CMake
function <a class="reference external" href="http://www.cmake.org/cmake/help/v2.8.11/cmake.html#command:configure_file">CONFIGURE_FILE()</a>.</p>
<p id="packagedir-cmakelists-txt"><strong>&lt;packageDir&gt;/CMakeLists.txt</strong>: [Required] The package's top-level
<tt class="docutils literal">CMakeLists.txt</tt> file that defines the libraries, include directories, and
contains the tests for the package.</p>
<p>The basic structure of this file for a <strong>package without subpackages</strong> is
shown in:</p>
<blockquote>
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">packages/simple_cxx/CMakeLists.txt</tt></blockquote>
<p>which is:</p>
<pre class="literal-block">
#
# A) Define the package
#
TRIBITS_PACKAGE( SimpleCxx  ENABLE_SHADOWING_WARNINGS  CLEANED )

#
# B) Platform-specific checks
#
INCLUDE(CheckFor__int64)
CHECK_FOR___INT64(HAVE_SIMPLECXX___INT64)

#
# C) Set up package-specific options
#
TRIBITS_ADD_DEBUG_OPTION()
TRIBITS_ADD_SHOW_DEPRECATED_WARNINGS_OPTION()

#
# D) Add the libraries, tests, and examples
#
ADD_SUBDIRECTORY(src)
TRIBITS_ADD_TEST_DIRECTORIES(test)
#TRIBITS_ADD_EXAMPLE_DIRECTORIES(example)

#
# E) Do standard postprocessing
#
TRIBITS_PACKAGE_POSTPROCESS()

</pre>
<p>The first command at the top of the file is a call to <a class="reference internal" href="#id1">TRIBITS_PACKAGE()</a>
which takes the package name (<tt class="docutils literal">SimpleCxx</tt> in this case) in addition to a few
other options.  While TriBITS obviously already knows the package name (since
it read it from the <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file), the purpose for
repeating it in this call is as documentation for the developer's sake (and
this name is checked against the expected package name).  Then a set of
configure-time tests are typically performed (if the package needs any of
these).  In this example, the existence of the C++ <tt class="docutils literal">__int64</tt> data-type is
checked using the module <tt class="docutils literal">CheckFor__int64.cmake</tt> (which is in the <tt class="docutils literal">cmake/</tt>
directory of this package.  (CMake has great support <a class="reference internal" href="#configure-time-system-tests">Configure-time System
Tests</a>.)  This is followed by package-specific options.  In this case, the
standard TriBITS options for debug checking and deprecated warnings are added
using the standard macros <a class="reference internal" href="#tribits-add-debug-option">TRIBITS_ADD_DEBUG_OPTION()</a> and
<a class="reference internal" href="#tribits-add-show-deprecated-warnings-option">TRIBITS_ADD_SHOW_DEPRECATED_WARNINGS_OPTION()</a>.  After all of this up-front
stuff is complete (which will be present in any moderately complex
CMake-configured project) the source and the test sub-directories are added
that actually define the library and the tests.  In this case, the standard
<a class="reference internal" href="#tribits-add-test-directories">TRIBITS_ADD_TEST_DIRECTORIES()</a> macro is used which only conditionally adds
the tests for the package.</p>
<p>The final command in the package's base <tt class="docutils literal">CMakeLists.txt</tt> file must always be
<a class="reference internal" href="#tribits-package-postprocess">TRIBITS_PACKAGE_POSTPROCESS()</a>.  This is needed in order to perform some
necessary post-processing by TriBITS.</p>
<p>It is also possible for the package's top-level <tt class="docutils literal">CMakeLists.txt</tt> to be the
only <tt class="docutils literal">CMakeLists.txt</tt> file for a package.  Such an example can be see in the
example project <a class="reference internal" href="#tribitshelloworld">TribitsHelloWorld</a> in the <tt class="docutils literal">HelloWorld</tt> package.</p>
<p>When a TriBITS package is broken up into subpackages (see <a class="reference internal" href="#tribits-subpackage">TriBITS
Subpackage</a>), its <tt class="docutils literal">CMakeLists.txt</tt> file looks a little different from a
package with no subpackages as shown above.  The basic structure of this file
for a <strong>package with subpackages</strong> is shown in:</p>
<blockquote>
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">packages/with_subpackages/CMakeLists.txt</tt></blockquote>
<p>which contains:</p>
<pre class="literal-block">
#
# A) Forward declare the package so that certain options are also defined for
# subpackages
#
TRIBITS_PACKAGE_DECL(WithSubpackages)

#
# B) Define the common options for the package first so they can be used by
# subpackages as well.
#
TRIBITS_ADD_DEBUG_OPTION()

#
# C) Process the subpackages
#
TRIBITS_PROCESS_SUBPACKAGES()

#
# D) Define the package now and perform standard postprocessing
#
TRIBITS_PACKAGE_DEF()
TRIBITS_PACKAGE_POSTPROCESS()

</pre>
<p>What is different about <tt class="docutils literal">CMakeLists.txt</tt> files for packages without
subpackages is that the <a class="reference internal" href="#id1">TRIBITS_PACKAGE()</a> command is broken up into two
parts <a class="reference internal" href="#tribits-package-decl">TRIBITS_PACKAGE_DECL()</a> and <a class="reference internal" href="#tribits-package-def">TRIBITS_PACKAGE_DEF()</a>.  In between
these two commands, the parent package can define the common package options
and then calls the command <a class="reference internal" href="#tribits-process-subpackages">TRIBITS_PROCESS_SUBPACKAGES()</a> which fully
processes the packages.  If the parent package has libraries and/or
tests/example of its own, it can define those after calling
<a class="reference internal" href="#tribits-package-def">TRIBITS_PACKAGE_DEF()</a>, just like with a regular package.  However, it is
rare for a package broken up into subpackages to have its own libraries and/or
tests and examples.  As always, the final command called inside of a package's
base <tt class="docutils literal">CMakeLists.txt</tt> file is <a class="reference internal" href="#tribits-package-postprocess">TRIBITS_PACKAGE_POSTPROCESS()</a>.</p>
<p>NOTE: The package's base <tt class="docutils literal">CMakeLists.txt</tt> file only gets processed if the
package is actually enabled
(i.e. <tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_${PACKAGE_NAME}=ON</span></tt>).  This is an important
design feature of TriBITS in that the contents of non-enabled package's can't
damage the configure, build, and test of the enabled packages based on errors
in non-enabled packages.  This is critical to allow experimental <a class="reference internal" href="#ex">EX</a>
test-group packages and lower-maturity packages to exist in the same source
repositories safely with higher-maturity and more important packages.</p>
</div>
<div class="section" id="tribits-package-core-variables">
<h4><a class="toc-backref" href="#id19">TriBITS Package Core Variables</a></h4>
<p>A packages' core variables are broken down into the following categories:</p>
<ul class="simple">
<li><a class="reference internal" href="#tribits-package-local-variables">TriBITS Package Local Variables</a></li>
<li><a class="reference internal" href="#tribits-package-top-level-local-variables">TriBITS Package Top-Level Local Variables</a></li>
<li><a class="reference internal" href="#tribits-package-cache-variables">TriBITS Package Cache Variables</a></li>
<li><a class="reference internal" href="#tribits-package-optional-dependency-macro-variables">TriBITS Package Optional Dependency Macro Variables</a></li>
</ul>
<p id="tribits-package-local-variables">The following locally scoped <em>TriBITS Package Local Variables</em> are defined
when the files for a given TriBITS Package (or any SE package for that matter)
are being processed:</p>
<blockquote>
<p><tt class="docutils literal">PACKAGE_NAME</tt></p>
<blockquote>
The name of the current TriBITS SE package.  This is set automatically by
TriBITS before the packages's <tt class="docutils literal">CMakeLists.txt</tt> file is processed.
<strong>WARNING:</strong> This name must be globally unique across the entire project
(see <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS package names</a>).</blockquote>
<p><tt class="docutils literal">PACKAGE_SOURCE_DIR</tt></p>
<blockquote>
The absolute path to the package's base source directory.    This is
set automatically by TriBITS in the macro <a class="reference internal" href="#id1">TRIBITS_PACKAGE()</a>.</blockquote>
<p><tt class="docutils literal">PACKAGE_BINARY_DIR</tt></p>
<blockquote>
The absolute path to the package's base binary/build directory.  This is
set automatically by TriBITS in the macro <a class="reference internal" href="#id1">TRIBITS_PACKAGE()</a>.</blockquote>
<p><tt class="docutils literal">PACKAGE_NAME_UC</tt></p>
<blockquote>
This is set to the upper-case version of <tt class="docutils literal">${PACKAGE_NAME}</tt>.  This is set
automatically by TriBITS in the macro <a class="reference internal" href="#id1">TRIBITS_PACKAGE()</a>.</blockquote>
</blockquote>
<p id="tribits-package-top-level-local-variables">Once all of the TriBITS SE package's <tt class="docutils literal">Dependencies.cmake</tt> files have been
processed, the following <em>TriBITS Package Top-Level Local Variables</em> are
defined:</p>
<blockquote>
<p><tt class="docutils literal">${PACKAGE_NAME}_SOURCE_DIR</tt></p>
<blockquote>
The absolute path to the package's base source directory.  CMake code, for
example in other packages, refer to this by the raw name like
<tt class="docutils literal">PackageX_SOURCE_DIR</tt>.  This makes such CMake code independent of where
the package is in relation to other packages.  NOTE: This variable is
defined for all declared packages that exist, independent of whether they
are enabled or not.  This varible is set as soon as it is known if the
given package exists or not.</blockquote>
<p><tt class="docutils literal">${PACKAGE_NAME}_BINARY_DIR</tt></p>
<blockquote>
The absolute path to the package's base binary directory.  CMake code, for
example in other packages, refer to this by the raw name like
<tt class="docutils literal">PackageX_BINARY_DIR</tt>.  This makes such CMake code independent of where
the package is in relation to other packages.  NOTE: This variable is
<strong>only</strong> defined if the package is actually enabled!</blockquote>
<p><tt class="docutils literal">${PACKAGE_NAME}_PARENT_REPOSITORY</tt></p>
<blockquote>
The name of the package's parent repository.  This can be used by a
package to access information about its parent repository.  For example,
the variable <tt class="docutils literal"><span class="pre">${${PACKAGE_NAME}_PARENT_REPOSITORY}_SOURCE_DIR</span></tt> can be
dereferenced and read of needed (but it is not recommended that packages
be aware of their parent repository in general)..</blockquote>
<p id="package-name-testgroup"><tt class="docutils literal">${PACKAGE_NAME}_TESTGROUP</tt></p>
<blockquote>
Defines the <a class="reference internal" href="#se-package-test-group">SE Package Test Group</a> for the package.  This determines in
what contexts the package is enabled or not for testing-related purposes
(see <a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested Layers of TriBITS Project Testing</a>)</blockquote>
</blockquote>
<p id="tribits-package-cache-variables">In addition, the following user-settable <em>TriBITS Package Cache Variables</em> are
defined before a (SE) Package's <tt class="docutils literal">CMakeLists.txt</tt> file is processed:</p>
<blockquote>
<p id="project-name-enable-package-name"><tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_${PACKAGE_NAME}</span></tt></p>
<blockquote>
Set to <tt class="docutils literal">ON</tt> if the package is enabled and is to be processed.</blockquote>
<p id="package-name-enable-optional-dep-package-name"><tt class="docutils literal"><span class="pre">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_PACKAGE_NAME}</span></tt></p>
<blockquote>
<p>Set to <tt class="docutils literal">ON</tt> if support for the optional <a class="reference internal" href="#upstream">upstream</a> dependent package
<tt class="docutils literal">${OPTIONAL_DEP_PACKAGE_NAME}</tt> is enabled in package
<tt class="docutils literal">${PACKAGE_NAME}</tt>.  Here <tt class="docutils literal">${OPTIONAL_DEP_PACKAGE_NAME}</tt> corresponds to
each optional upstream SE package listed in the <tt class="docutils literal">LIB_OPTIONAL_PACKAGES</tt>
and <tt class="docutils literal">TEST_OPTIONAL_PACKAGES</tt> arguments to the
<a class="reference internal" href="#tribits-package-define-dependencies">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a> macro.</p>
<p><strong>NOTE:</strong> It is important that the CMake code in the package's
<tt class="docutils literal">CMakeLists.txt</tt> files key off of this variable and <strong>not</strong> the
project-level variable
<tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_${OPTIONAL_DEP_PACKAGE_NAME}</span></tt> because the
package-level variable
<tt class="docutils literal"><span class="pre">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_PACKAGE_NAME}</span></tt> can be explicitly
turned off by the user even through the packages <tt class="docutils literal">${PACKAGE_NAME}</tt> and
<tt class="docutils literal">${OPTIONAL_DEP_PACKAGE_NAME}</tt> are both enabled at the project level!
See <a class="reference internal" href="#support-for-optional-se-package-tpl-can-be-explicitly-disabled">Support for optional SE package/TPL can be explicitly disabled</a>.</p>
</blockquote>
<p id="package-name-enable-optional-dep-tpl-name"><tt class="docutils literal"><span class="pre">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_TPL_NAME}</span></tt></p>
<blockquote>
Set to <tt class="docutils literal">ON</tt> if support for the optional <a class="reference internal" href="#upstream">upstream</a> dependent TPL
<tt class="docutils literal">${OPTIONAL_DEP_TPL_NAME}</tt> is enabled in package
<tt class="docutils literal">${PACKAGE_NAME}</tt>.  Here <tt class="docutils literal">${OPTIONAL_DEP_TPL_NAME}</tt> corresponds
each to the optional upstream TPL listed in the <tt class="docutils literal">LIB_OPTIONAL_TPLS</tt> and
<tt class="docutils literal">TEST_OPTIONAL_TPLS</tt> arguments to the
<a class="reference internal" href="#tribits-package-define-dependencies">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a> macro.  <strong>NOTE:</strong> It is important
that the CMake code in the package <tt class="docutils literal">${PACKAGE_NAME}</tt> key off of this
variable and <strong>not</strong> the global
<tt class="docutils literal"><span class="pre">TPL_ENABLE_${OPTIONAL_DEP_TPL_NAME}</span></tt> variable because
<tt class="docutils literal"><span class="pre">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_TPL_NAME}</span></tt> can be
explicitly turned off by the user even through the package
<tt class="docutils literal">${PACKAGE_NAME}</tt> and the TPL <tt class="docutils literal">${OPTIONAL_DEP_TPL_NAME}</tt> are
both enabled (see <a class="reference internal" href="#support-for-optional-se-package-tpl-can-be-explicitly-disabled">Support for optional SE package/TPL can be explicitly
disabled</a>).</blockquote>
<p id="package-name-enable-tests"><tt class="docutils literal">${PACKAGE_NAME}_ENABLE_TESTS</tt></p>
<blockquote>
Set to <tt class="docutils literal">ON</tt> if the package's tests are to be enabled.  This will enable
a package's tests and all of its subpackage's tests.</blockquote>
<p id="package-name-enable-examples"><tt class="docutils literal">${PACKAGE_NAME}_ENABLE_EXAMPLES</tt></p>
<blockquote>
Set to <tt class="docutils literal">ON</tt> if the package's examples are to be enabled.  This will
enable a package's examples and all of its subpackage's examples.</blockquote>
</blockquote>
<p>The above global cache variables can be explicitly set by the user or may be
set automatically as part of the <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable
Logic</a>.</p>
<p id="tribits-package-optional-dependency-macro-variables">The following local <em>TriBITS Package Optional Dependency Macro Variables</em> are
defined in the top-level project scope before a (SE) Package's
<tt class="docutils literal">CMakeLists.txt</tt> file is processed:</p>
<blockquote>
<p id="have-package-name-uc-optional-dep-package-name-uc"><tt class="docutils literal">HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_PACKAGE_NAME_UC&gt;</tt></p>
<blockquote>
<p>Set to <tt class="docutils literal">ON</tt> if support for optional upstream package
<tt class="docutils literal">${OPTIONAL_DEP_PACKAGE}</tt> is enabled in downstream package
<tt class="docutils literal">${PACKAGE_NAME}</tt>
(i.e. <a class="reference internal" href="#package-name-enable-optional-dep-package-name">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_PACKAGE_NAME}</a> = <tt class="docutils literal">ON</tt>) and
is set to <tt class="docutils literal">FALSE</tt> otherwise.  Here, <tt class="docutils literal">&lt;PACKAGE_NAME_UC&gt;</tt> and
<tt class="docutils literal">&lt;OPTIONAL_DEP_PACKAGE_NAME_UC&gt;</tt> are the upper-case names for the packages
<tt class="docutils literal">${PACKAGE_NAME}</tt> and <tt class="docutils literal">${OPTIONAL_DEP_PACKAGE_NAME}</tt>, respectively.
For example, if optional support for upstream package <tt class="docutils literal">Triutils</tt> is
enabled in downstream package <tt class="docutils literal">EpetraExt</tt> in <a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a>,
then <tt class="docutils literal">EpetraExt_ENABLE_TriUtils=ON</tt> and <tt class="docutils literal">HAVE_EPETRAEXT_TRIUTILS=ON</tt>.
This variable is meant to be used in:</p>
<pre class="literal-block">
#cmakedefine HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_PACKAGE_NAME_UC&gt;
</pre>
<p>in configured header files
(e.g. <a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a>).  For example, for
the <tt class="docutils literal">EpetraExt</tt> and <tt class="docutils literal">Triutils</tt> example, this would be:</p>
<pre class="literal-block">
#cmakedefine HAVE_EPETRAEXT_TRIUTILS
</pre>
</blockquote>
<p id="have-package-name-uc-optional-dep-tpl-name-uc"><tt class="docutils literal">HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_TPL_NAME_UC&gt;</tt></p>
<blockquote>
<p>Set to <tt class="docutils literal">ON</tt> if support for the optional TPL <tt class="docutils literal">${OPTIONAL_DEP_TPL_NAME}</tt>
is enabled in downstream package <tt class="docutils literal">${PACKAGE_NAME}</tt>
(i.e. <a class="reference internal" href="#package-name-enable-optional-dep-tpl-name">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_TPL_NAME}</a> = <tt class="docutils literal">ON</tt>) and is
set to <tt class="docutils literal">FALSE</tt> otherwise.  Here, <tt class="docutils literal">&lt;PACKAGE_NAME_UC&gt;</tt> and
<tt class="docutils literal">&lt;OPTIONAL_DEP_TPL_NAME_UC&gt;</tt> are the upper-case names for the packages
<tt class="docutils literal">${PACKAGE_NAME}</tt> and <tt class="docutils literal">${OPTIONAL_DEP_TPL_NAME}</tt>, respectively.  For
example, if optional support for the TPL <tt class="docutils literal">Boost</tt> is enabled in the
package <tt class="docutils literal">Teuchos</tt> in <a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a>, then
<tt class="docutils literal">Teuchos_ENABLE_Boost=ON</tt> and <tt class="docutils literal">HAVE_TUECHOS_BOOST=ON</tt>.  This variable
is meant to be used in:</p>
<pre class="literal-block">
#cmakedefine HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_TPL_NAME_UC&gt;
</pre>
<p>in configured header files
(e.g. <a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a>).  For example, for
the <tt class="docutils literal">Teuchos</tt> and <tt class="docutils literal">Boost</tt> example, this would be:</p>
<pre class="literal-block">
#cmakedefine HAVE_TEUCHOS_BOOST
</pre>
</blockquote>
</blockquote>
<p>Currently, a Package can refer to its containing Repository and refer to its
source and binary directories.  This is so that it can refer to
repository-level resources (e.g. like the <tt class="docutils literal">Trilinos_version.h</tt> file for
Trilinos packages).  However, this may be undesirable because it will make it
hard to pull a package out of one TriBITS repository and place it in another
repository for a different use.  However, a package can indirectly refer to
its own repository without loss of generality by reading the variable
<tt class="docutils literal">${PACKAGE_NAME}_PARENT_REPOSITORY</tt>.  The problem is referring to other
TriBITS repositories explicitly.</p>
</div>
</div>
<div class="section" id="tribits-subpackage">
<h3><a class="toc-backref" href="#id20">TriBITS Subpackage</a></h3>
<p>A TriBITS Subpackage:</p>
<ul class="simple">
<li>Is a compartmentalization of a parent <a class="reference internal" href="#tribits-package">TriBITS Package</a> according to
<a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering Packaging Principles</a>.</li>
<li>Typically defines a set of libraries and/or header files and/or executables
and/or tests with CMake build targets for building these for which TriBITS
exports the list of include directories, libraries, and targets that are
created (along with CMake dependencies).</li>
<li>Is declared in its parent packages's
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file in a call to
<a class="reference internal" href="#tribits-package-define-dependencies">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a> using the argument
<a class="reference internal" href="#subpackages-dirs-classifications-optreqs">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</a>.</li>
<li>Defines dependencies on <a class="reference internal" href="#upstream">upstream</a> TPLs and/or other SE packages by just
naming the dependencies in the file
<a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> using the macro
<a class="reference internal" href="#tribits-package-define-dependencies">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a>.</li>
<li>Can <strong>NOT</strong> have its own subpackages defined (only top-level packages can
have subpackages).</li>
<li>Is enabled or disabled along with all other subpackages in the parent
package automatically if it's parent package is enabled or disabled with
<tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_${PARENT_PACKAGE_NAME}</span></tt> set to <tt class="docutils literal">ON</tt> or <tt class="docutils literal">OFF</tt>
respectively (see <a class="reference internal" href="#enable-disable-of-parent-package-is-enable-disable-for-subpackages">Enable/disable of parent package is enable/disable for
subpackages</a> and <a class="reference internal" href="#parent-package-name">PARENT_PACKAGE_NAME</a>).</li>
<li>Has tests turned on automatically if
<tt class="docutils literal">${PARENT_PACKAGE_NAME}_ENABLE_TESTS=ON</tt>.</li>
</ul>
<p>The contents of a TriBITS Subpackage are almost identical to those of a
TriBITS Package.  The differences are described below and in <a class="reference internal" href="#how-is-a-tribits-subpackage-is-different-from-a-tribits-package">How is a TriBITS
Subpackage is different from a TriBITS Package?</a>.</p>
<p>For more details on the definition of a TriBITS Package (or subpackage), see:</p>
<ul class="simple">
<li><a class="reference internal" href="#tribits-subpackage-core-files">TriBITS Subpackage Core Files</a></li>
<li><a class="reference internal" href="#tribits-subpackage-core-variables">TriBITS Subpackage Core Variables</a></li>
</ul>
<div class="section" id="tribits-subpackage-core-files">
<h4><a class="toc-backref" href="#id21">TriBITS Subpackage Core Files</a></h4>
<p>The set of core files for a subpackage are identical to the <a class="reference internal" href="#tribits-package-core-files">TriBITS Package
Core Files</a> and are:</p>
<pre class="literal-block">
&lt;packageDir&gt;/&lt;spkgDir&gt;/
  CMakeLists.txt  # Only processed if this subpackage is enabled
  cmake/
    Dependencies.cmake  # Always processed if the parent package
                          # is listed in the enclosing Repository
</pre>
<p>(where <tt class="docutils literal">&lt;packageDir&gt; = <span class="pre">${${PARENT_PACKAGE_NAME}_SOURCE_DIR}</span></tt> and
<tt class="docutils literal">&lt;spkgDir&gt;</tt> is the subpackage directory listed in the
<a class="reference internal" href="#subpackages-dirs-classifications-optreqs">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</a> to
<a class="reference internal" href="#tribits-package-define-dependencies">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a>).</p>
<p>These TriBITS Subpackage files are documented in more detail below:</p>
<ul class="simple">
<li><a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a></li>
<li><a class="reference internal" href="#packagedir-spkgdir-cmakelists-txt">&lt;packageDir&gt;/&lt;spkgDir&gt;/CMakeLists.txt</a></li>
</ul>
<p id="packagedir-spkgdir-cmake-dependencies-cmake"><strong>&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</strong>: [Required] The contents
of this file for subpackages are identical as for top-level packages.  It just
contains a call to the macro <a class="reference internal" href="#tribits-package-define-dependencies">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a> to
define this SE package's <a class="reference internal" href="#upstream">upstream</a> TPL and SE package dependencies.  A
simple example is for the example subpackage <tt class="docutils literal">WithSubpackagesB</tt> (declared in
<a class="reference internal" href="#with-subpackages-cmake-dependencies-cmake">with_subpackages/cmake/Dependencies.cmake</a>) with the file:</p>
<blockquote>
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">packages/with_subpackages/b/cmake/Dependencies.cmake</tt></blockquote>
<p>which is:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_DEFINE_DEPENDENCIES(
  LIB_REQUIRED_PACKAGES  SimpleCxx
  LIB_OPTIONAL_PACKAGES  WithSubpackagesA  ExternalPkg 
  TEST_OPTIONAL_PACKAGES  MixedLang
  )

</pre>
<p>What this shows is that subpackages must list their dependencies on each other
(if such dependencies exist) using the full SE package name
<tt class="docutils literal"><span class="pre">${PARENT_PACKAGE_NAME}${SUBPACKAGE_NAME}</span></tt> or in this case:</p>
<pre class="literal-block">
'WithSubpackagesA' = 'WithSubpackages' + 'A'
</pre>
<p>Note that the parent SE package depends on its subpackages, not the other way
around.  For example, the <tt class="docutils literal">WithSubpackages</tt> parent SE package
automatically depends its SE subpackages
<tt class="docutils literal">WithSubpackagesA</tt>, <tt class="docutils literal">WithSubpackagesC</tt>,
and <tt class="docutils literal">WithSubpackagesC</tt>.  As such all (direct) dependencies
for a subpackage must be listed in its own <tt class="docutils literal">Dependencies.cmake</tt> file.  For
example, the <tt class="docutils literal">WithSubpackages</tt> subpackage <tt class="docutils literal">A</tt> depends on
the <tt class="docutils literal">SimpleCxx</tt> package and is declared as such as shown in:</p>
<blockquote>
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">packages/with_subpackages/a/cmake/Dependencies.cmake</tt></blockquote>
<p>which is:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_DEFINE_DEPENDENCIES(
  LIB_REQUIRED_PACKAGES SimpleCxx
  )

</pre>
<p>What this means is that any TPL or library dependencies listed in the parent
package's <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file are <strong>NOT</strong>
dependencies of its subpackages.  For example, if
<a class="reference internal" href="#with-subpackages-cmake-dependencies-cmake">with_subpackages/cmake/Dependencies.cmake</a> where changed to be:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_DEFINE_DEPENDENCIES(
  LIB_REQUIRED_TPLS Boost
  SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS
    A   A   PT  REQUIRED
    ...
  )
</pre>
<p>then the <tt class="docutils literal">Boost</tt> TPL would <strong>NOT</strong> be a dependency of the SE package
<tt class="docutils literal">WithSubpackagesA</tt> but instead would be listed as a
dependency of the parent SE package <tt class="docutils literal">WithSubpackages</tt>.  (And in this
case, this TPL dependency is pretty worthless since the SE package
<tt class="docutils literal">WithSubpackages</tt> does not even define any libraries or tests of its
own.)</p>
<p id="packagedir-spkgdir-cmakelists-txt"><strong>&lt;packageDir&gt;/&lt;spkgDir&gt;/CMakeLists.txt</strong>: [Required] The subpackage's
top-level <tt class="docutils literal">CMakeLists.txt</tt> file that defines the libraries, include
directories, and contains the tests for the subpackage.  The contents of a
subpackage's top-level <tt class="docutils literal">CMakeLists.txt</tt> file are almost identical to a
top-level package's <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file.  The primary
difference is that the commands <a class="reference internal" href="#id1">TRIBITS_PACKAGE()</a> and
<a class="reference internal" href="#tribits-package-postprocess">TRIBITS_PACKAGE_POSTPROCESS()</a> and replaced with <a class="reference internal" href="#id3">TRIBITS_SUBPACKAGE()</a> and
<a class="reference internal" href="#tribits-subpackage-postprocess">TRIBITS_SUBPACKAGE_POSTPROCESS()</a> as shown in the file:</p>
<blockquote>
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">packages/with_subpackages/a/CMakeLists.txt</tt></blockquote>
<p>which contains:</p>
<pre class="literal-block">
#
# A) Define the subpackage
#
TRIBITS_SUBPACKAGE(A)

#
# B) Set up subpackage-specific options
#
# Typically there are none or are few as most options are picked up from the
# parent package's CMakeLists.txt file!

#
# C) Add the libraries, tests, and examples
#

INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})
TRIBITS_ADD_LIBRARY(pws_a
  SOURCES A.cpp
  HEADERS A.hpp
  NOINSTALLHEADERS 
)

TRIBITS_ADD_TEST_DIRECTORIES(tests)

#
# D) Do standard postprocessing
#
TRIBITS_SUBPACKAGE_POSTPROCESS()

</pre>
<p>Unlike <a class="reference internal" href="#id1">TRIBITS_PACKAGE()</a>, <a class="reference internal" href="#id3">TRIBITS_SUBPACKAGE()</a> does not take any extra
arguments.  Those extra settings are assumed to be defined by the top-level
parent package.  Like top-level packages, subpackages are free to define
user-settable options and configure-time tests but typically don't.  The idea
is that subpackages should be lighter weight than top-level packages.  Other
than using <a class="reference internal" href="#id3">TRIBITS_SUBPACKAGE()</a> and <a class="reference internal" href="#tribits-subpackage-postprocess">TRIBITS_SUBPACKAGE_POSTPROCESS()</a>, a
subpackage can be laid out just like any other package and can call on any
other commands to add libraries, add executables, add test, etc.</p>
</div>
<div class="section" id="tribits-subpackage-core-variables">
<h4><a class="toc-backref" href="#id22">TriBITS Subpackage Core Variables</a></h4>
<p>The core variables associated with a subpackage are identical to the <a class="reference internal" href="#tribits-package-core-variables">TriBITS
Package Core Variables</a>.  The only difference is that a subpackage may need
to refer to its parent package where a top-level package does not have a
parent package.  The extra variables that are defined when processing a
subpackage's files are:</p>
<blockquote>
<p id="parent-package-name"><tt class="docutils literal">PARENT_PACKAGE_NAME</tt></p>
<blockquote>
The name of the parent package.</blockquote>
<p><tt class="docutils literal">PARENT_PACKAGE_SOURCE_DIR</tt></p>
<blockquote>
The absolute path to the parent package's base source directory.</blockquote>
<p><tt class="docutils literal">PARENT_PACKAGE_BINARY_DIR</tt></p>
<blockquote>
The absolute path to the parent package's base binary directory.</blockquote>
</blockquote>
</div>
<div class="section" id="how-is-a-tribits-subpackage-is-different-from-a-tribits-package">
<h4><a class="toc-backref" href="#id23">How is a TriBITS Subpackage is different from a TriBITS Package?</a></h4>
<p>A common question this is natural to ask is how a TriBITS Subpackage is
different from a TriBITS Package?  They contain the same basic files (i.e. a
<tt class="docutils literal">cmake/Dependencies.cmake</tt> file, a top-level <tt class="docutils literal">CMakeLists.txt</tt> file, source
files, test files, etc.).  They both are included in the list of <a class="reference internal" href="#tribits-se-packages">TriBITS SE
Packages</a> and therefore can both be enabled/disabled by the user or in
automatic dependency logic (see <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable
Logic</a>).  The primary difference is that a subpackage is meant to involve
less overhead and is to be used to partition the parent package's software
into chunks according to <a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering Packaging Principles</a>.  Also,
the dependency logic treats a parent package's subpackages as part of itself
so when the parent package is explicitly enabled or disabled, it is identical
to explicitly enabling or disabling all of its subpackages (see
<a class="reference internal" href="#enable-disable-of-parent-package-is-enable-disable-for-subpackages">Enable/disable of parent package is enable/disable for subpackages</a>).  Also,
subpackages are tested along with their peer subpackages with the parent
package as part of <a class="reference internal" href="#tribits-package-by-package-ctest-dash-driver">TriBITS Package-by-Package CTest/Dash Driver</a>.  This
effectively means that if a build failure is detected in any subpackage, then
that will effectively disable the parent package and all of its other
subpackages in downstream testing.  This is a type of &quot;all for one and all for
one&quot; when it comes to the relationship between the subpackages within a single
parent package.  These are some of the issues to consider when breaking up
software into packages and subpackages that will be mentioned in other
sections as well.</p>
</div>
</div>
<div class="section" id="tribits-tpl">
<h3><a class="toc-backref" href="#id24">TriBITS TPL</a></h3>
<p>A <em>TriBITS TPL</em>:</p>
<ul class="simple">
<li>Defines a set of pre-built libraries and/or header files and/or executables
and/or some other resources used by one or more TriBITS Packages for which
TriBITS publishes the list of include directories and/or libraries and/or
executables provided by the TPL to the TriBITS project.</li>
<li>Has a globally unique name (see <a class="reference internal" href="#globally-unique-tribits-tpl-names">Globally unique TriBITS TPL names</a>) that
is declared in a <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file.</li>
<li>Is listed as an explicit optional or required dependency in one or more
TriBITS SE package's <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files.</li>
</ul>
<p id="globally-unique-tribits-tpl-names"><strong>WARNING:</strong> One must be very careful to pick <strong>Globally unique TriBITS TPL
names</strong> across all TPLs in all TriBITS repositories that ever might be cobbled
together into a single TriBITS (meta) project!  However, choosing TPL names is
usually much easier and less risky than choosing <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS
package names</a> because the native TPLs themselves tend to be uniquely named.
For example, the TPL names <tt class="docutils literal">BLAS</tt> and <tt class="docutils literal">LAPACK</tt> are well defined in the
applied math and computational science community and are not likely to clash.</p>
<p>Using a TriBITS TPL is to be preferred over using raw CMake
<tt class="docutils literal"><span class="pre">FIND_PACKAGE(&lt;someCMakePackage&gt;)</span></tt> because the TriBITS system guarantees
that only a single unique version of TPL of the same version will be used by
multiple packages.  Also, by defining a TriBITS TPL, automatic enable/disable
logic will be applied as described in <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable
Logic</a>.  For example, if a TPL is explicitly disabled, all of the downstream
packages that depend on that TPL will be automatically disabled as well (see
<a class="reference internal" href="#tpl-disable-triggers-auto-disables-of-downstream-dependencies">TPL disable triggers auto-disables of downstream dependencies</a>).</p>
<p>For each TPL referenced in a <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file using the macro
<a class="reference internal" href="#tribits-repository-define-tpls">TRIBITS_REPOSITORY_DEFINE_TPLS()</a>, there must exist a file, typically called
<tt class="docutils literal"><span class="pre">FindTPL${TPL_NAME}.cmake</span></tt>, that once processed, produces the variables
<tt class="docutils literal">${TPL_NAME}_LIBRARIES</tt> and <tt class="docutils literal">${TPL_NAME}_INCLUDE_DIRS</tt>.  Most
<tt class="docutils literal"><span class="pre">FindTPL${TPL_NAME}.cmake</span></tt> files just use the function
<a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">TRIBITS_TPL_FIND_INCLUDE_DIRS_AND_LIBRARIES()</a> the define the TriBITS TPL.  A simple
example of such a file is the standard TriBITS <tt class="docutils literal">FindTPLPETSC.cmake</tt> module
which is currently:</p>
<pre class="literal-block">
TRIBITS_TPL_FIND_INCLUDE_DIRS_AND_LIBRARIES( PETSC
  REQUIRED_HEADERS petsc.h
  REQUIRED_LIBS_NAMES petsc
  )

</pre>
<p>Some concrete <tt class="docutils literal"><span class="pre">FindTPL${TPL_NAME}.cmake</span></tt> files actually do use
<tt class="docutils literal">FIND_PACKAGE()</tt> and a standard CMake package find module to fill in the
guts of finding at TPL which is perfectly fine.</p>
<p>Once processed, each defined TPL <tt class="docutils literal">TPL_NAME</tt> is assigned the following global
non-cache variables:</p>
<blockquote>
<p id="tpl-name-findmod"><tt class="docutils literal">${TPL_NAME}_FINDMOD</tt></p>
<blockquote>
Gives the location for the TPL's find module.  This is set using the
<tt class="docutils literal">FINDMOD</tt> field in the call to <a class="reference internal" href="#tribits-repository-define-tpls">TRIBITS_REPOSITORY_DEFINE_TPLS()</a>.  The
final value of the variable is defined by the <em>last</em>
<a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file that is processed that declares the TPL
<tt class="docutils literal">TPL_NAME</tt>.  For example, if <tt class="docutils literal">Repo1/TPLsList.cmake</tt> and
<tt class="docutils literal">Repo2/TPLsList.cmake</tt> both list the TPL <tt class="docutils literal">SomeTpl</tt>, then if <tt class="docutils literal">Repo2</tt>
is processed after <tt class="docutils literal">Repo1</tt>, then <tt class="docutils literal">SomeTpl_FINDMOD</tt> is determined by
<tt class="docutils literal">Repo2/TPLsList.cmake</tt> and the find module listed in
<tt class="docutils literal">Repo1/TPLsList.cmake</tt> is ignored.</blockquote>
<p id="tpl-name-testgroup"><tt class="docutils literal">${TPL_NAME}_TESTGROUP</tt></p>
<blockquote>
Gives the TPLs <a class="reference internal" href="#se-package-test-group">SE Package Test Group</a>. This is set using the
<tt class="docutils literal">CLASSIFICATION</tt> field in the call to
<a class="reference internal" href="#tribits-repository-define-tpls">TRIBITS_REPOSITORY_DEFINE_TPLS()</a>.  If multiple repos define a given
TPL, then the <em>first</em> <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file that is processed
that declares the TPL <tt class="docutils literal">TPL_NAME</tt> specifies the test group.  For example,
if <tt class="docutils literal">Repo1/TPLsList.cmake</tt> and <tt class="docutils literal">Repo2/TPLsList.cmake</tt> both list the TPL
<tt class="docutils literal">SomeTpl</tt>, then if <tt class="docutils literal">Repo2</tt> is processed after <tt class="docutils literal">Repo1</tt>, then
<tt class="docutils literal">SomeTpl_TESTGROUP</tt> is determined by <tt class="docutils literal">Repo1/TPLsList.cmake</tt> and the
test group in <tt class="docutils literal">Repo2/TPLsList.cmake</tt> is ignored.  However, if
<tt class="docutils literal">${TPL_NAME}_TESTGROUP</tt> is already set before the
<a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> files are processed, then that test group will
be used.  Therefore, the project can override the test group for a given
TPL if desired.</blockquote>
</blockquote>
<p>The specification given in <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#enabling-support-for-an-optional-third-party-library-tpl">Enabling support for an optional Third-Party
Library (TPL)</a> and <a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">TRIBITS_TPL_FIND_INCLUDE_DIRS_AND_LIBRARIES()</a> describes how the a
<tt class="docutils literal"><span class="pre">FindTPL${TPL_NAME}.cmake</span></tt> module should behave and allow users to override
and specialize how a TPL is determined.  However, note that the TriBITS system
does not require the usage of of the function
<tt class="docutils literal">TRIBITS_TPL_FIND_INCLUDE_DIRS_AND_LIBRARIES()</tt> and does not even care about the TPL
module name <tt class="docutils literal"><span class="pre">FindTPL${TPL_NAME}.cmake</span></tt>.  All that is required is that some
CMake file fragment exist that once included, will define the variables
<tt class="docutils literal">${TPL_NAME}_LIBRARIES</tt> and <tt class="docutils literal">${TPL_NAME}_INCLUDE_DIRS</tt>.  However, to be
user friendly, such a CMake file should respond to the same variables as
accepted by the standard <tt class="docutils literal">TRIBITS_TPL_FIND_INCLUDE_DIRS_AND_LIBRARIES()</tt> function.</p>
<p>The core variables related to an enabled TPL are <tt class="docutils literal">${TPL_NAME}_LIBRARIES</tt>,
<tt class="docutils literal">${TPL_NAME}_INCLUDE_DIRS</tt>, and <tt class="docutils literal">${TPL_NAME}_TESTGROUP</tt> as defined in
<a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">TRIBITS_TPL_FIND_INCLUDE_DIRS_AND_LIBRARIES()</a> need to be defined.  For more details, see
<a class="reference internal" href="#tribits-repository-define-tpls">TRIBITS_REPOSITORY_DEFINE_TPLS()</a>.</p>
</div>
</div>
<div class="section" id="processing-of-tribits-files-ordering-and-details">
<h2><a class="toc-backref" href="#id25">3.2&nbsp;&nbsp;&nbsp;Processing of TriBITS Files: Ordering and Details</a></h2>
<p>One of the most important things to know about TriBITS is what files it
processes, in what order, and in what context.  This is critical to being able
to understand what impact (if any) setting a variable or otherwise changing
the CMake run-time state will have on configuring a CMake project which uses
TriBITS.  While the different files that make up a <a class="reference internal" href="#tribits-project">TriBITS Project</a>,
<a class="reference internal" href="#tribits-repository">TriBITS Repository</a>, <a class="reference internal" href="#tribits-package">TriBITS Package</a>, <a class="reference internal" href="#tribits-subpackage">TriBITS Subpackage</a>, and <a class="reference internal" href="#tribits-tpl">TriBITS
TPL</a> were defined in the section <a class="reference internal" href="#tribits-structural-units">TriBITS Structural Units</a>, that material
did not fully describe the context and in what order these files are processed
by the TriBITS framework.</p>
<p>The TriBITS system processes the project's files in one of two general use
cases.  The first use case is in the basic configuration of the project with a
standard <tt class="docutils literal">cmake</tt> command invocation in order to set up the build files in
the binary directory (see <a class="reference internal" href="#full-tribits-project-configuration">Full TriBITS Project Configuration</a>).  The second
use case is in reading the project's dependency-related files in order to
build the package dependency data-structure (e.g. the
<a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a> file, see <a class="reference internal" href="#reduced-package-dependency-processing">Reduced Package Dependency
Processing</a>).  The second use case of reading the project's dependency files
is largely a subset of the first.</p>
<p>Another factor that is important to understand is the scoping in which the
various files are processed (with <tt class="docutils literal">INCLUDE()</tt> or <tt class="docutils literal">ADD_SUBDIRECTORY()</tt>).
This scoping has a large impact on the configuration of the project and what
effect the processing of files and setting variables have on the project as a
whole.  Some of the strange scoping rules for CMake are discussed in <a class="reference internal" href="#cmake-language-overview-and-gotchas">CMake
Language Overview and Gotchas</a> and should be understood before trying to
debug issues with processing.  Many of the basic files are processed
(included) in the base project <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> scope and
therefore any local variables set in these files are accessible to the entire
CMake project (after the file is processed, of course).  Other files get
processed inside of functions which have their own local scope and therefore
only impact the rest of the project in more purposeful ways.  And of course
all of the package <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> files that are processed
using <tt class="docutils literal">ADD_SUBDIRECTORY()</tt> create a new local scope for that given package.</p>
<div class="section" id="full-tribits-project-configuration">
<h3><a class="toc-backref" href="#id26">Full TriBITS Project Configuration</a></h3>
<p>The first use case to describe is the full processing of all of the TriBITS
project's files starting with the base <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file.
This begins with the invocation of the following CMake command to generate the
project's build files:</p>
<pre class="literal-block">
$ cmake [options] &lt;projectDir&gt;
</pre>
<p>Below, is a short pseudo-code algorithm for the TriBITS framework processing
and callbacks that begin in the <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> and proceed
through the call to <a class="reference internal" href="#id2">TRIBITS_PROJECT()</a>.</p>
<p id="full-processing-of-tribits-project-files"><strong>Full Processing of TriBITS Project Files:</strong></p>
<div class="line-block">
<div class="line">1.  Read <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> (sets <a class="reference internal" href="#project-name">PROJECT_NAME</a>)</div>
<div class="line">2.  Call <tt class="docutils literal"><span class="pre">PROJECT(${PROJECT_NAME}</span> NONE)</tt> (sets <a class="reference internal" href="#project-name-source-dir">${PROJECT_NAME}_SOURCE_DIR</a></div>
<div class="line-block">
<div class="line">and <a class="reference internal" href="#project-name-binary-dir">${PROJECT_NAME}_BINARY_DIR</a>)</div>
</div>
<div class="line">3.  Execute <a class="reference internal" href="#id2">TRIBITS_PROJECT()</a>:</div>
<div class="line-block">
<div class="line">1)  Set <a class="reference internal" href="#project-source-dir">PROJECT_SOURCE_DIR</a> and <a class="reference internal" href="#project-binary-dir">PROJECT_BINARY_DIR</a></div>
<div class="line">2)  For each <tt class="docutils literal">&lt;optFile&gt;</tt> in ${<a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#project-configure-options-file">${PROJECT_NAME}_CONFIGURE_OPTIONS_FILE</a>}:</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal"><span class="pre">INCLUDE(&lt;optFile&gt;)</span></tt></div>
</div>
<div class="line">3)  Set variables <tt class="docutils literal">CMAKE_HOST_SYSTEM_NAME</tt> and <tt class="docutils literal">${PROJECT_NAME}_HOSTNAME</tt></div>
<div class="line-block">
<div class="line">(both of these can be overridden in the cache by the user)</div>
</div>
<div class="line">4)  Find Python (sets <tt class="docutils literal">PYTHON_EXECUTABLE</tt>)</div>
<div class="line">5)  <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a> <tt class="docutils literal">)</tt></div>
<div class="line">6)  Define primary TriBITS options and read in the list of extra repositories</div>
<div class="line-block">
<div class="line">(calls <tt class="docutils literal">TRIBITS_DEFINE_GLOBAL_OPTIONS_AND_DEFINE_EXTRA_REPOS()</tt>)</div>
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> <tt class="docutils literal">)</tt></div>
</div>
<div class="line">7)  For each <tt class="docutils literal">&lt;repoDir&gt;</tt> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#repodir-cmake-callbacksetupextraoptions-cmake">&lt;repoDir&gt;/cmake/CallbackSetupExtraOptions.cmake</a> <tt class="docutils literal">)</tt></div>
<div class="line">* Call macro <tt class="docutils literal">TRIBITS_REPOSITORY_SETUP_EXTRA_OPTIONS()</tt></div>
</div>
<div class="line">9)  Call <tt class="docutils literal">TRIBITS_READ_PACKAGES_PROCESS_DEPENDENCIES_WRITE_XML()</tt>:</div>
<div class="line-block">
<div class="line">a)  For each <tt class="docutils literal">&lt;repoDir&gt;</tt> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> <tt class="docutils literal">)</tt> and process list</div>
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> <tt class="docutils literal">)</tt> and process list</div>
</div>
<div class="line">b)  For each <tt class="docutils literal">&lt;repoDir&gt;</tt> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a> <tt class="docutils literal">)</tt></div>
</div>
<div class="line">c)  <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a> <tt class="docutils literal">)</tt></div>
<div class="line">d)  For each <tt class="docutils literal">&lt;packageDir&gt;</tt> in all defined top-level packages:</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> <tt class="docutils literal">)</tt></div>
<div class="line-block">
<div class="line">- Sets all package-specific options (see <a class="reference internal" href="#tribits-package-cache-variables">TriBITS Package Cache Variables</a>)</div>
</div>
<div class="line">* For each <tt class="docutils literal">&lt;spkgDir&gt;</tt> in all subpackages for this package:</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> <tt class="docutils literal">)</tt></div>
<div class="line-block">
<div class="line">- Sets all subpackage-specific options</div>
</div>
</div>
</div>
</div>
<div class="line">10) Adjust SE package and TPLs enables and disables</div>
<div class="line-block">
<div class="line">(see <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable Logic</a>)</div>
</div>
<div class="line">11) <a class="reference internal" href="#probe-and-set-up-the-environment">Probe and set up the environment</a> (finds MPI, compilers, etc.)</div>
<div class="line-block">
<div class="line">(see <a class="reference internal" href="#tribits-environment-probing-and-setup">TriBITS Environment Probing and Setup</a>)</div>
</div>
<div class="line">12) For <tt class="docutils literal">&lt;tplName&gt;</tt> in the set of enabled TPLs:</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal"><span class="pre">INCLUDE(${&lt;tplName&gt;_FINDMOD})</span></tt> (see <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>)</div>
</div>
<div class="line">13) For each <tt class="docutils literal">&lt;repoDir&gt;</tt> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* Read <a class="reference internal" href="#repodir-copyright-txt">&lt;repoDir&gt;/Copyright.txt</a></div>
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#repodir-version-cmake">&lt;repoDir&gt;/Version.cmake</a> <tt class="docutils literal">)</tt></div>
<div class="line">(see <a class="reference internal" href="#project-and-repository-versioning-and-release-mode">Project and Repository Versioning and Release Mode</a>)</div>
</div>
<div class="line">14) For each <tt class="docutils literal">&lt;packageDir&gt;</tt> in all enabled top-level packages</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal">ADD_SUBDIRECTORY(</tt> <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> <tt class="docutils literal">)</tt></div>
<div class="line">* For each <tt class="docutils literal">&lt;spkgDir&gt;</tt> in all enabled subpackages for this package:</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal">ADD_SUBDIRECTORY(</tt> <a class="reference internal" href="#packagedir-spkgdir-cmakelists-txt">&lt;packageDir&gt;/&lt;spkgDir&gt;/CMakeLists.txt</a> <tt class="docutils literal">)</tt></div>
</div>
</div>
<div class="line">16) <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#projectdir-cmake-callbackdefineprojectpackaging-cmake">&lt;projectDir&gt;/cmake/CallbackDefineProjectPackaging.cmake</a> <tt class="docutils literal">)</tt></div>
<div class="line-block">
<div class="line">* Call <tt class="docutils literal">TRIBITS_PROJECT_DEFINE_PACKAGING()</tt></div>
</div>
<div class="line">16) For each <tt class="docutils literal">&lt;repoDir&gt;</tt> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#repodir-cmake-callbackdefinerepositorypackaging-cmake">&lt;repoDir&gt;/cmake/CallbackDefineRepositoryPackaging.cmake</a> <tt class="docutils literal">)</tt></div>
<div class="line">* Call <tt class="docutils literal">TRIBITS_REPOSITORY_DEFINE_PACKAGING()</tt></div>
</div>
</div>
</div>
<p>The TriBITS Framework obviously does a lot more that what is described above
but the basic trace of major operations and ordering and the processing of
project, repository, package, and subpackage files should be clear.  All of
this information should also be clear when enabling <a class="reference internal" href="#file-processing-tracing">File Processing
Tracing</a>.</p>
</div>
<div class="section" id="reduced-package-dependency-processing">
<h3><a class="toc-backref" href="#id27">Reduced Package Dependency Processing</a></h3>
<p>In addition to the full processing that occurs as part of the <a class="reference internal" href="#full-tribits-project-configuration">Full TriBITS
Project Configuration</a>, there are also TriBITS tools that only process as
subset of project's files.  This reduced processing is performed in order to
build up the project's package dependencies data-structure and to write the
file <a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a>.  For example, the script
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> and the function <a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a> both drive this
type of processing.  In particular, the CMake -P script
<tt class="docutils literal">TribitsDumpDepsXmlScript.cmake</tt> reads all of the project's
dependency-related files and dumps out the <a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a>
file.  This reduced processing (as executed in <tt class="docutils literal">cmake <span class="pre">-P</span>
TribitsDumpDepsXmlScript.cmake</tt>) is described below.</p>
<p id="reduced-dependency-processing-of-tribits-project-files"><strong>Reduced Dependency Processing of TriBITS Project:</strong></p>
<div class="line-block">
<div class="line">1.  Read <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> (sets <a class="reference internal" href="#project-name">PROJECT_NAME</a>)</div>
<div class="line">2. <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> <tt class="docutils literal">)</tt></div>
<div class="line">3.  Call <tt class="docutils literal">TRIBITS_READ_PACKAGES_PROCESS_DEPENDENCIES_WRITE_XML()</tt>:</div>
<div class="line-block">
<div class="line">a)  For each <tt class="docutils literal">&lt;repoDir&gt;</tt> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> <tt class="docutils literal">)</tt></div>
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> <tt class="docutils literal">)</tt></div>
</div>
<div class="line">b)  For each <tt class="docutils literal">&lt;repoDir&gt;</tt> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a> <tt class="docutils literal">)</tt></div>
</div>
<div class="line">c)  <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a> <tt class="docutils literal">)</tt></div>
<div class="line">d)  For each <tt class="docutils literal">&lt;packageDir&gt;</tt> in all defined top-level packages:</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> <tt class="docutils literal">)</tt></div>
<div class="line-block">
<div class="line">- Sets all package-specific options (see <a class="reference internal" href="#tribits-package-cache-variables">TriBITS Package Cache Variables</a>)</div>
</div>
<div class="line">* For each <tt class="docutils literal">&lt;spkgDir&gt;</tt> in all subpackages for this package:</div>
<div class="line-block">
<div class="line">* <tt class="docutils literal">INCLUDE(</tt> <a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> <tt class="docutils literal">)</tt></div>
<div class="line-block">
<div class="line">- Sets all subpackage-specific options</div>
</div>
</div>
</div>
<div class="line">e) Write the file <a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a></div>
<div class="line-block">
<div class="line">(specified using <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#outputting-package-dependency-information">${PROJECT_NAME}_DEPS_XML_OUTPUT_FILE</a>)</div>
</div>
</div>
</div>
<p>When comparing the above reduced dependency processing to the <a class="reference internal" href="#full-processing-of-tribits-project-files">Full Processing
of TriBITS Project Files</a> it is important to note that that several files are
<strong>not</strong> processed in the reduced algorithm shown above.  The files that are
<strong>not</strong> processed include <a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a>,
<a class="reference internal" href="#repodir-version-cmake">&lt;repoDir&gt;/Version.cmake</a> and
<a class="reference internal" href="#repodir-cmake-callbacksetupextraoptions-cmake">&lt;repoDir&gt;/cmake/CallbackSetupExtraOptions.cmake</a> (in addition to not
processing any of the <tt class="docutils literal">CMakeLists.txt</tt> files obviously).  Therefore, one
cannot put anything in these non-processed files that would impact the
definition of TriBITS repositories, packages, TPLs, etc.  Anything that would
affect the dependencies data-structure that gets written out as
<a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a> must be contained in the files that are
processed shown in the reduced processing above.</p>
<p>Debugging issues with <a class="reference internal" href="#reduced-dependency-processing-of-tribits-project-files">Reduced Dependency Processing of TriBITS Project
Files</a> is more difficult because one cannot easily turn on <a class="reference internal" href="#file-processing-tracing">File Processing
Tracing</a> like one can when doing the full CMake configure.  However, options
may be added to the various tools to show this file processing and help debug
problems.</p>
</div>
<div class="section" id="file-processing-tracing">
<h3><a class="toc-backref" href="#id28">File Processing Tracing</a></h3>
<p>In order to aid in debugging problems with <a class="reference internal" href="#full-tribits-project-configuration">Full TriBITS Project
Configuration</a> and <a class="reference internal" href="#reduced-package-dependency-processing">Reduced Package Dependency Processing</a>, TriBITS defines
the CMake cache option <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#project-trace-file-processing">${PROJECT_NAME}_TRACE_FILE_PROCESSING</a>.  When
enabled, TriBITS will print out when any of the project-related,
repository-related, or package-related file is being processed by TriBITS.
When <tt class="docutils literal">${PROJECT_NAME}_TRACE_FILE_PROCESSING=ON</tt>, lines starting with <tt class="docutils literal"><span class="pre">&quot;--</span>
File Trace:&quot;</tt> are printed to <tt class="docutils literal">cmake</tt> stdout for files that TriBITS
automatically processes where there may be any confusion about what files are
processed and when.</p>
<p>For example, for <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>, the configure file trace for the
configure command:</p>
<pre class="literal-block">
$ cmake \
  -DTribitsExProj_TRIBITS_DIR=&lt;tribitsDir&gt; \
  -DTribitsExProj_ENABLE_MPI=ON \
  -DTribitsExProj_ENABLE_ALL_PACKAGES=ON \
  -DTribitsExProj_ENABLE_TESTS=ON \
  -DTribitsExProj_TRACE_FILE_PROCESSING=ON \
  -DTribitsExProj_ENABLE_CPACK_PACKAGING=ON \
  -DTribitsExProj_DUMP_CPACK_SOURCE_IGNORE_FILES=ON \
  &lt;tribitsDir&gt;/doc/examples/TribitsExampleProject \
  | grep &quot;^-- File Trace:&quot;
</pre>
<p>looks something like:</p>
<pre class="literal-block">
-- File Trace: PROJECT    INCLUDE    [...]/Version.cmake
-- File Trace: REPOSITORY INCLUDE    [...]/cmake/CallbackSetupExtraOptions.cmake
-- File Trace: REPOSITORY INCLUDE    [...]/PackagesList.cmake
-- File Trace: REPOSITORY INCLUDE    [...]/TPLsList.cmake
-- File Trace: PACKAGE    INCLUDE    [...]/packages/simple_cxx/cmake/Dependencies.cmake
-- File Trace: PACKAGE    INCLUDE    [...]/packages/mixed_lang/cmake/Dependencies.cmake
-- File Trace: PACKAGE    INCLUDE    [...]/packages/with_subpackages/cmake/Dependencies.cmake
-- File Trace: PACKAGE    INCLUDE    [...]/packages/with_subpackages/a/cmake/Dependencies.cmake
-- File Trace: PACKAGE    INCLUDE    [...]/packages/with_subpackages/b/cmake/Dependencies.cmake
-- File Trace: PACKAGE    INCLUDE    [...]/packages/with_subpackages/c/cmake/Dependencies.cmake
-- File Trace: PACKAGE    INCLUDE    [...]/packages/wrap_external/cmake/Dependencies.cmake
-- File Trace: PROJECT    CONFIGURE  [...]/cmake/ctest/CTestCustom.cmake.in
-- File Trace: REPOSITORY READ       [...]/Copyright.txt
-- File Trace: REPOSITORY INCLUDE    [...]/Version.cmake
-- File Trace: PACKAGE    ADD_SUBDIR [...]/packages/simple_cxx/CMakeLists.txt
-- File Trace: PACKAGE    ADD_SUBDIR [...]/packages/simple_cxx/test/CMakeLists.txt
-- File Trace: PACKAGE    ADD_SUBDIR [...]/packages/mixed_lang/CMakeLists.txt
-- File Trace: PACKAGE    ADD_SUBDIR [...]/packages/mixed_lang/test/CMakeLists.txt
-- File Trace: PACKAGE    ADD_SUBDIR [...]/packages/with_subpackages/CMakeLists.txt
-- File Trace: PACKAGE    ADD_SUBDIR [...]/packages/with_subpackages/a/CMakeLists.txt
-- File Trace: PACKAGE    ADD_SUBDIR [...]/packages/with_subpackages/a/tests/CMakeLists.txt
-- File Trace: PACKAGE    ADD_SUBDIR [...]/packages/with_subpackages/b/CMakeLists.txt
-- File Trace: PACKAGE    ADD_SUBDIR [...]/packages/with_subpackages/b/tests/CMakeLists.txt
-- File Trace: PACKAGE    ADD_SUBDIR [...]/packages/with_subpackages/c/CMakeLists.txt
-- File Trace: PACKAGE    ADD_SUBDIR [...]/packages/with_subpackages/c/tests/CMakeLists.txt
-- File Trace: PROJECT    INCLUDE    [...]/cmake/CallbackDefineProjectPackaging.cmake
-- File Trace: REPOSITORY INCLUDE    [...]/cmake/CallbackDefineRepositoryPackaging.cmake
</pre>
<p>However, every file that TriBITS processes is not printed in this file trace
if it should be obvious that the file is being processed.  For example, the
package's configured header file created using <a class="reference internal" href="#tribits-configure-file">TRIBITS_CONFIGURE_FILE()</a>
does not result in a file trace print statement because this is an
unconditional command that is explicitly called in one of the package's
<tt class="docutils literal">CMakeLists.txt</tt> files so it should be clear that this file is being
processed and exactly when it is processed.</p>
</div>
</div>
<div class="section" id="coexisting-projects-repositories-and-packages">
<h2><a class="toc-backref" href="#id29">3.3&nbsp;&nbsp;&nbsp;Coexisting Projects, Repositories, and Packages</a></h2>
<p>Certain simplifications are allowed when defining TriBITS projects,
repositories and packages.  The known allowed simplifications are described
below.</p>
<p><strong>TriBITS Repository Dir == TriBITS Project Dir</strong>: It is allowed for a TriBITS
Project and a TriBITS Repository to be the same source directory and in fact
this is the default for every TriBITS project (unless the
<a class="reference internal" href="#projectdir-cmake-nativerepositorieslist-cmake">&lt;projectDir&gt;/cmake/NativeRepositoriesList.cmake</a> is defined).  In this case,
the repository name <a class="reference internal" href="#repository-name">REPOSITORY_NAME</a> and the project name <a class="reference internal" href="#project-name">PROJECT_NAME</a>
are the same as well.  This is quite common and is in fact the default that
every TriBITS Project is also a TriBITS repository (and therefore must contain
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> and <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> files).  This
is the case, for example, with the <a class="reference internal" href="#trilinos">Trilinos</a> and the
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> projects and repositories.  In this case, the
Project's and the Repository's <tt class="docutils literal">Version.cmake</tt> and <tt class="docutils literal">Copyright.txt</tt> files
are also one and the same, as they should be (see <a class="reference internal" href="#project-and-repository-versioning-and-release-mode">Project and Repository
Versioning and Release Mode</a>).</p>
<p><strong>TriBITS Package Dir == TriBITS Repository Dir</strong>: It is also allowed for a
TriBITS Repository to have only one package and to have that package be the
base repository directory.  The TriBITS Repository and the single TriBITS
Package would typically have the same name in this case (but that is actually
not required but it is confusing if they are not the same).  For example, in
the TriBITS test project <a class="reference internal" href="#mocktrilinos">MockTrilinos</a>, the repository and package
<tt class="docutils literal">extraRepoOnePackage</tt> are the same directory.  In this case, the file
<tt class="docutils literal">extraRepoOnePackage/PackagesList.cmake</tt> looks like:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_PACKAGES(
  extraRepoOnePackage   .     ST
  )

</pre>
<p>(Note the dot <tt class="docutils literal">'.'</tt> for the package directory.)</p>
<p>This is also how the real TriBITS repository and package <a class="reference external" href="https://github.com/CNERG/DataTransferKit">DataTransferKit</a> is
set up (at least that is the way it was when this document was first written).</p>
<p>However, to maximize flexibility, it is recommended that a TriBITS package and
its TriBITS repository <strong>not</strong> share the same directory or the same name.
This allows a TriBITS repository to define more packages later.</p>
<p id="tribits-package-tribits-repository-tribits-project"><strong>TriBITS Package Dir == TriBITS Repository Dir == TriBITS Project Dir</strong>: In
the extreme, it is possible to collapse a single TriBITS package, repository,
and project into the same base source directory.  They can also share the same
name for the package, repository and package.  One example of this is the
<tt class="docutils literal">TriBITS</tt> project and <a class="reference internal" href="#the-tribits-test-package">The TriBITS Test Package</a> themselves, which are both
rooted in the base <tt class="docutils literal">TriBITS/</tt> source directory of the stand-alone TriBITS
repository.  There are a few restrictions and modifications needed to get this
to work:</p>
<ul class="simple">
<li>The base <tt class="docutils literal">CMakeLists.txt</tt> file must be modified to allow it to be
processed both as the base project <tt class="docutils literal">CMakeLists.txt</tt> file and as the
package's base <tt class="docutils literal">CMakeLists.txt</tt> file.  In the case of
<tt class="docutils literal">TriBITS/CMakeLists.txt</tt>, a big if statement is used.</li>
</ul>
<!-- ToDo: Create a new macro called TRIBITS_PROJECT_AND_PACKAGE() that will -->
<!-- automatically take care of the details of a TriBITS package also being a -->
<!-- TriBITS project. -->
<p>Other than that simple modification to the top-level <tt class="docutils literal">CMakeLists.txt</tt> file,
a TriBITS project, repository, and package can all be rooted in the same
source directory.</p>
<p>The primary use case for collapsing a project, repository, and package into a
single base source directory would be to support the stand-alone build of a
TriBITS package as its own entity that uses an independent installation of the
TriBITS (or a minimal snapshotof TriBITS).  If a given TriBITS package has no
required <a class="reference internal" href="#upstream">upstream</a> TriBITS package dependencies and minimal TPL dependencies
(or only uses <a class="reference internal" href="#standard-tribits-tpls">Standard TriBITS TPLs</a> already defined in the
<tt class="docutils literal">tribits/tpls/</tt> directory), then creating a stand-alone project build of a
single TriBITS package requires fairly little extra overhead or duplication.
However, as mentioned above, one cannot use the same name for the package and
the project.</p>
</div>
<div class="section" id="standard-tribits-tpls">
<h2><a class="toc-backref" href="#id30">3.4&nbsp;&nbsp;&nbsp;Standard TriBITS TPLs</a></h2>
<p>TriBITS contains find modules for a few standard TPLs that are either integral
to the TriBITS system or are likely to be used across many independent TriBITS
repositories.  The goal of maintaining a few of these in the later case under
TriBITS is to enforce conformity in case these independent repositories are
combined into a single meta-project.</p>
<p>The standard TriBITS TPLs are contained under the directory:</p>
<pre class="literal-block">
tribits/tpls/
</pre>
<p>The current list of standard TriBITS TPLs is:</p>
<pre class="literal-block">
FindTPLCUDA.cmake
FindTPLMPI.cmake
FindTPLPETSC.cmake

</pre>
<p>The TPLs <tt class="docutils literal">MPI</tt> and <tt class="docutils literal">CUDA</tt> are standard because they are special in that
they define compilers and other special tools that are used in
<a class="reference internal" href="#tribits-add-library">TRIBITS_ADD_LIBRARY()</a>, <a class="reference internal" href="#tribits-add-executable">TRIBITS_ADD_EXECUTABLE()</a>, <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>
and other commands.</p>
<p>These standard TPLs are used in a <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file as:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_TPLS(
  MPI   &quot;${${PROJECT_NAME}_TRIBITS_DIR}/tpls/&quot;  PT
  CUDA  &quot;${${PROJECT_NAME}_TRIBITS_DIR}/tpls/&quot;  ST
  ...
  )
</pre>
<p>Other than the special TPLs <tt class="docutils literal">MPI</tt> and <tt class="docutils literal">CUDA</tt>, other TPLs that are
candidates to put into TriBITS are those that are likely to be used by
different stand-alone TriBITS repositories that need to be combined into a
single TriBITS meta-project.  By using a standard TPL definition, it is
guaranteed that the TPL used will be consistent with all of the repositories.</p>
<p>Note that just because packages in two repositories reference the same TPL
does not necessarily mean that it needs to be a standard TriBITS TPL.  For
example, if the TPL <tt class="docutils literal">BLAS</tt> is defined in an <a class="reference internal" href="#upstream">upstream</a> repository
(e.g. Trilinos), then a package in a <a class="reference internal" href="#downstream">downstream</a> repository can list a
dependency on the TPL <tt class="docutils literal">BLAS</tt> without having to define its own <tt class="docutils literal">BLAS</tt> TPL
in its repository's <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file.  For more details, see
<a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>.</p>
<!-- Where to set variables? -->
<!-- - - - - - - - - - - - - - - - - - - - - - - - -->
<!-- A TriBITS project, repository, package have a number of files in which
variables can be set and commands can be called in order to affect how the
project is defined and configured.  With so many files that can be included by
TriBITS, it can be difficult to know where the right place is to set a given
set of variables.  The primary considerations for where to set a variable
depend on: -->
<!-- ToDo: Describe considerations on where to set variables ... -->
</div>
</div>
<div class="section" id="example-tribits-projects">
<h1><a class="toc-backref" href="#id31">4&nbsp;&nbsp;&nbsp;Example TriBITS Projects</a></h1>
<p>In this section, a few different example TriBITS projects and packages are
previewed.  Most of these examples exist in the TriBITS source directory
<tt class="docutils literal">tribits</tt> itself so they are available to all users of TriBITS.  These
examples also provide a means to test the TriBITS system itself (see <a class="reference internal" href="#the-tribits-test-package">The
TriBITS Test Package</a>).</p>
<p>The first example covered is the bare bones <a class="reference internal" href="#tribitshelloworld">TribitsHelloWorld</a> example
project.  The second example covered in detail is <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>.
This example covers all the basics for setting up a simple multi-package
TriBITS project.  The third example outlined is <a class="reference internal" href="#mocktrilinos">MockTrilinos</a> which mostly
exists to test the TriBITS system itself but also contains some nice examples
of a few different TriBITS features and behaviors.  The forth example is the
<a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a> project which is used to demonstrate TriBITS behavior
in this document.  Also mentioned is the <a class="reference internal" href="#trilinos">Trilinos</a> project itself which can
be a useful example of the usage of TriBITS (see disclaimers in the section
<a class="reference internal" href="#trilinos">Trilinos</a>).  The last example mentioned is <a class="reference internal" href="#the-tribits-test-package">The TriBITS Test Package</a>
itself which allows the TriBITS system to be tested and installed from any
TriBITS project that lists it, including the <tt class="docutils literal">TriBITS</tt> project itself
(see <a class="reference internal" href="#coexisting-projects-repositories-and-packages">Coexisting Projects, Repositories, and Packages</a>).</p>
<p>The directory <tt class="docutils literal">tribits/doc/examples/</tt> contains some other example TriBITS
projects and repositories as well that are referred to in this and other
documents.</p>
<div class="section" id="tribitshelloworld">
<h2><a class="toc-backref" href="#id32">4.1&nbsp;&nbsp;&nbsp;TribitsHelloWorld</a></h2>
<p><tt class="docutils literal">TribitsHelloWorld</tt> is about the simplest possible TriBITS project that you
can imagine and is contained under the directory:</p>
<pre class="literal-block">
tribits/doc/examples/TribitsHelloWorld/
</pre>
<p>This example project contains only a single TriBITS package and no frills at
all (does not support MPI or Fortran).  However, it does show how minimal a
<a class="reference internal" href="#tribits-project">TriBITS Project</a> (which is also a <a class="reference internal" href="#tribits-repository">TriBITS Repository</a>) and a <a class="reference internal" href="#tribits-package">TriBITS
Package</a> can be and still demonstrates some of the value of TriBITS over raw
CMake.  The simple <tt class="docutils literal">HelloWorld</tt> package is used to compare with the raw
CMakeLists.txt file in the <tt class="docutils literal">RawHeloWorld</tt> example project in the <a class="reference external" href="../overview/TribitsOverview.pdf">TriBITS
Overview</a> document.</p>
<p>The directory structure for this example his shown below:</p>
<pre class="literal-block">
  TribitsHelloWorld/
    CMakeLists.txt
    PackagesList.cmake
    ProjectName.cmake
    README
    TPLsList.cmake
    hello_world/
      CMakeLists.txt
      cmake/
        Dependencies.cmake
      hello_world_lib.cpp
      hello_world_lib.hpp
      hello_world_main.cpp
      hello_world_unit_tests.cpp

</pre>
<p>This has all of the required <a class="reference internal" href="#tribits-project-core-files">TriBITS Project Core Files</a>, <a class="reference internal" href="#tribits-repository-core-files">TriBITS
Repository Core Files</a>, and <a class="reference internal" href="#tribits-package-core-files">TriBITS Package Core Files</a>.  It just builds a
simple library, a simple executable, a test executable, and the tests them as
shown by the file <tt class="docutils literal">TribitsHelloWorld/hello_world/CMakeLists.txt</tt> which is:</p>
<pre class="literal-block">
TRIBITS_PACKAGE(HelloWorld)
TRIBITS_ADD_LIBRARY(hello_world_lib
  HEADERS hello_world_lib.hpp SOURCES hello_world_lib.cpp)
TRIBITS_ADD_EXECUTABLE(hello_world NOEXEPREFIX SOURCES hello_world_main.cpp
  INSTALLABLE)
TRIBITS_ADD_TEST(hello_world NOEXEPREFIX PASS_REGULAR_EXPRESSION &quot;Hello World&quot;)
TRIBITS_ADD_EXECUTABLE_AND_TEST(unit_tests SOURCES hello_world_unit_tests.cpp
  PASS_REGULAR_EXPRESSION &quot;All unit tests passed&quot;)
TRIBITS_PACKAGE_POSTPROCESS()

</pre>
<p>The build and test of this simple project is tested in the <a class="reference internal" href="#the-tribits-test-package">The TriBITS Test
Package</a> file:</p>
<pre class="literal-block">
tribits/doc/examples/UnitTests/CMakeLists.txt
</pre>
<p>Note that this little example is a fully functional <a class="reference internal" href="#tribits-repository">TriBITS Repository</a> and
can be embedded in to a larger TriBITS meta-project and be seamlessly built
along with any other such TriBITS-based software.</p>
<!-- ToDo: Put in reference to the example meta-project. -->
</div>
<div class="section" id="tribitsexampleproject">
<h2><a class="toc-backref" href="#id33">4.2&nbsp;&nbsp;&nbsp;TribitsExampleProject</a></h2>
<p><tt class="docutils literal">TribitsExampleProject</tt> in an example <a class="reference internal" href="#tribits-project">TriBITS Project</a> and <a class="reference internal" href="#tribits-repository">TriBITS
Repository</a> contained in the TriBITS source tree under:</p>
<pre class="literal-block">
tribits/doc/examples/TribitsExampleProject/
</pre>
<p>When this is used as the base TriBITS project, this is the directory
corresponds to <tt class="docutils literal">&lt;projectDir&gt;</tt> and <tt class="docutils literal">&lt;repoDir&gt;</tt> referenced in <a class="reference internal" href="#tribits-project-core-files">TriBITS
Project Core Files</a> and <a class="reference internal" href="#tribits-repository-core-files">TriBITS Repository Core Files</a>, respectively.</p>
<p>Several files from this project are used as examples in the section <a class="reference internal" href="#tribits-project-structure">TriBITS
Project Structure</a>.  Here, a fuller description is given of this project and
demonstrates some how TriBITS works.  From this simple example project, one
can quickly see how the basic structural elements of a TriBITS project,
repository, and package (and subpackage) are pulled together.</p>
<p>This simple project shows how what is listed in files:</p>
<ul class="simple">
<li><a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a>,</li>
<li><a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a>, and</li>
<li><a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a></li>
</ul>
<p>are used to specify the packages and SE packages in a TriBITS project and
repository.  More details about the contents of the <tt class="docutils literal">Dependencies.cmake</tt>
files is described in the section <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable
Logic</a>.</p>
<p>The name of this project <tt class="docutils literal">PROJECT_NAME</tt> is given in its
<tt class="docutils literal">TribitsExampleProject/ProjectName.cmake</tt> file:</p>
<pre class="literal-block">
# Must set the project name at very beginning before including anything else
SET(PROJECT_NAME TribitsExProj)

# Turn on export depenency generation for WrapExteranl package
SET(${PROJECT_NAME}_GENERATE_EXPORT_FILE_DEPENDENCIES_DEFAULT ON)

</pre>
<p>The variable <tt class="docutils literal">PROJECT_NAME=TribitsExProj</tt> is used to prefix (using
<tt class="docutils literal"><span class="pre">&quot;${PROJECT_NAME}_&quot;</span></tt>) all of the project's global TriBITS variables like
<tt class="docutils literal">TribitsExProj_ENABLE_TESTS</tt>, <tt class="docutils literal">TribitsExProj_ENABLE_ALL_PACKAGES</tt>, etc.</p>
<p id="tribitsexampleproject-files-and-directories">The directory structure and key files for this example project are shown in
the partial list of <a class="reference internal" href="#tribitsexampleproject-files-and-directories">TribitsExampleProject Files and Directories</a> below:</p>
<pre class="literal-block">
TribitsExampleProject/
  CMakeLists.txt
  Copyright.txt
  PackagesList.cmake
  ProjectName.cmake
  project-checkin-test-config.py
  TPLsList.cmake
  Version.cmake
  ...
  cmake/
    CallbackDefineProjectPackaging.cmake
    CallbackDefineRepositoryPackaging.cmake
    CallbackSetupExtraOptions.cmake
  packages/
    simple_cxx/
      CMakeLists.txt
      cmake/
        CheckFor__int64.cmake
        Dependencies.cmake
        SimpleCxx_config.h.in
      src/
        CMakeLists.txt
        SimpleCxx_HelloWorld.cpp
        SimpleCxx_HelloWorld.hpp
      test/
        CMakeLists.txt
        SimpleCxx_HelloWorld_Tests.cpp
    mixed_lang/ ...
    with_subpackages/
      CMakeLists.txt
      cmake/
        Dependencies.cmake
      A/
        CMakeLists.txt
        cmake/
          Dependencies.cmake
        ...
      B/ ...
      C/ ...
    wrap_external/ ...
</pre>
<p>Above, the sub-directories under <tt class="docutils literal">packages/</tt> are sorted according to the
order listed in the <tt class="docutils literal">TribitsExampleProject/PackagesList.cmake</tt> file:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_PACKAGES(
  SimpleCxx          packages/simple_cxx         PT
  MixedLang          packages/mixed_lang         PT
  ExternalPkg        ExternalPkg                 ST
  WithSubpackages    packages/with_subpackages   PT
  WrapExternal       packages/wrap_external      ST
  )

TRIBITS_DISABLE_PACKAGE_ON_PLATFORMS(WrapExternal Windows)
TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES(ExternalPkg)

</pre>
<p>From this file, we get the list of top-level packages <tt class="docutils literal">SimpleCxx</tt>,
<tt class="docutils literal">MixedLang</tt>, <tt class="docutils literal">WithSubpackages</tt>, and <tt class="docutils literal">WrapExternal</tt> (and their base
package directories and testing group, see <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a>).
(NOTE: By default the package <tt class="docutils literal">ExternalPkg</tt> is not defined because its
directory is missing, see <a class="reference internal" href="#how-to-insert-a-package-into-an-upstream-repo">How to insert a package into an upstream repo</a>.)</p>
<p>A full listing of package files in <a class="reference internal" href="#tribitsexampleproject-files-and-directories">TribitsExampleProject Files and
Directories</a> is only shown for the <tt class="docutils literal">SimpleCxx</tt> package directory
<tt class="docutils literal">packages/simple_cxx/</tt>.  For this package, <tt class="docutils literal">&lt;packageDir&gt; =
<span class="pre">&lt;repoDir&gt;/packages/simple_cxx</span></tt> and <tt class="docutils literal">PACKAGE_NAME = SimpleCxx</tt>.  As
explained in <a class="reference internal" href="#tribits-package-core-files">TriBITS Package Core Files</a>, the files
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> and <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a>
must exist for every package directory listed in
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> and we see these files under in the directory
<tt class="docutils literal">packages/simple_cxx/</tt>.  The package <tt class="docutils literal">SimpleCxx</tt> does not have any
<a class="reference internal" href="#upstream">upstream</a> SE package dependencies.</p>
<p>Now consider the example top-level package <tt class="docutils literal">WithSubpackages</tt> which,
as the name suggests, is broken down into subpackages.  The
<tt class="docutils literal">WithSubpackages</tt> dependencies file:</p>
<pre class="literal-block">
TribitsExampleProject/packages/with_subpackages/cmake/Dependencies.cmake
</pre>
<p>with contents:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_DEFINE_DEPENDENCIES(
  SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS
    A   a   PT  REQUIRED
    B   b   ST  OPTIONAL
    C   c   ST  OPTIONAL
  )

</pre>
<p>references the three subpackages with sub-directories <tt class="docutils literal">&lt;spkgDir&gt;</tt> = <tt class="docutils literal">A</tt>,
<tt class="docutils literal">B</tt>, and <tt class="docutils literal">C</tt> under the parent package directory
<tt class="docutils literal">packages/package_with_packages/</tt> which are shown in <a class="reference internal" href="#tribitsexampleproject-files-and-directories">TribitsExampleProject
Files and Directories</a>.  This gives another set of three SE packages
<tt class="docutils literal">WithSubpackagesA</tt>, <tt class="docutils literal">WithSubpackagesB</tt>,
and <tt class="docutils literal">WithSubpackagesC</tt>.  Combining <tt class="docutils literal">&lt;packageDir&gt; =
packages/package_with_packages</tt> and <tt class="docutils literal">&lt;spkgDir&gt;</tt> for each subpackage gives
the subpackage directories:</p>
<pre class="literal-block">
TribitsExampleProject/packages/with_subpackages/a/
TribitsExampleProject/packages/with_subpackages/b/
TribitsExampleProject/packages/with_subpackages/c/
</pre>
<p>Together with the top-level parent SE package <tt class="docutils literal">WithSubpackages</tt>
itself, this top-level package provides four <a class="reference internal" href="#tribits-se-packages">TriBITS SE Packages</a> giving the
final list of SE packages provided by this TriBITS repo as:</p>
<pre class="literal-block">
SimpleCxx MixedLang WithSubpackagesA WithSubpackagesB WithSubpackagesC \
  WithSubpackages WrapExternal 7
</pre>
<p>The above list of SE packages is printed (with the number of packages printed
at the end) by TriBITS to the <tt class="docutils literal">cmake</tt> stdout on the line starting with
<tt class="docutils literal">&quot;Final set of <span class="pre">non-enabled</span> SE packages:&quot;</tt> when no packages are enabled (see
<a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#selecting-the-list-of-packages-to-enable">Selecting the list of packages to enable</a>).  (Note that TriBITS does not put
in line-brakes with continuation characters <tt class="docutils literal">&quot;\&quot;</tt> as shown above.)  TriBITS
defines enable/disable cache variables for each of these defined SE packages
like <tt class="docutils literal">TribitsExProj_ENABLE_SimpleCxx</tt> and
<tt class="docutils literal">TribitsExProj_ENABLE_WithSubpackagesA</tt>, and defines all
the variables listed in <a class="reference internal" href="#tribits-package-cache-variables">TriBITS Package Cache Variables</a> that are settable
by the users or by the dependency logic described in section <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package
Dependencies and Enable/Disable Logic</a>.</p>
<p>When starting a new TriBITS project, repository, or package, one should
consider basing these on the examples in <tt class="docutils literal">TribitsExampleProject</tt>.  In fact,
the skeletons for any of the</p>
<ul class="simple">
<li><a class="reference internal" href="#tribits-project-core-files">TriBITS Project Core Files</a>,</li>
<li><a class="reference internal" href="#tribits-repository-core-files">TriBITS Repository Core Files</a>,</li>
<li><a class="reference internal" href="#tribits-package-core-files">TriBITS Package Core Files</a>, or</li>
<li><a class="reference internal" href="#tribits-subpackage-core-files">TriBITS Subpackage Core Files</a></li>
</ul>
<p>should be copied from this example project as they represent best practice
when using TriBITS for the typical use cases.</p>
</div>
<div class="section" id="mocktrilinos">
<h2><a class="toc-backref" href="#id34">4.3&nbsp;&nbsp;&nbsp;MockTrilinos</a></h2>
<p>The TriBITS project <tt class="docutils literal">MockTrilinos</tt> is contained under the directory:</p>
<pre class="literal-block">
tribits/package_arch/UnitTests/MockTrilinos/
</pre>
<p>This TriBITS project is not a full TriBITS project (i.e. it does not build
anything).  Instead, it is primarily used to test the TriBITS system using
tests defined in the <a class="reference internal" href="#the-tribits-test-package">The TriBITS Test Package</a>.  The <tt class="docutils literal">MockTrilinos</tt>
project is actually given the name <tt class="docutils literal">PROJECT_NAME = Trilinos</tt> and contains a
subset of Trilinos packages with slightly modified dependencies from a
snapshot of the real Trilinos project from May 2009.  The list of packages
in:</p>
<pre class="literal-block">
tribits/package_arch/UnitTests/MockTrilinos/PackagesList.cmake
</pre>
<p>is:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_PACKAGES(
  TrilinosFramework   cmake                           PT
  Teuchos             packages/teuchos                PT
  RTOp                packages/rtop                   PT
  Epetra              packages/epetra                 PT
  Zoltan              packages/zoltan                 PT
  Shards              packages/shards                 PT
  Triutils            packages/triutils               PT
  Tpetra              packages/tpetra                 PT
  EpetraExt           packages/epetraext              PT
  Stokhos             packages/stokhos                EX
  Sacado              packages/sacado                 ST
  Thyra               packages/thyra                  PT
  Isorropia           packages/isorropia              PT
  AztecOO             packages/aztecoo                PT
  Galeri              packages/galeri                 PT
  Amesos              packages/amesos                 PT
  Intrepid            packages/intrepid               PT
  Ifpack              packages/ifpack                 PT
  ML                  packages/ml                     PT
  Belos               packages/belos                  ST
  Stratimikos         packages/stratimikos            PT
  RBGen               packages/rbgen                  PT
  Phalanx             packages/phalanx                ST
  Panzer              packages/panzer                 ST
  )

# NOTE: Sacado was really PT but for testing purpose it is made ST
# NOTE: Belos was really PT but for testing purpose it is made ST

TRIBITS_DISABLE_PACKAGE_ON_PLATFORMS(ML BadSystem1)
TRIBITS_DISABLE_PACKAGE_ON_PLATFORMS(Ifpack BadSystem1 BadSystem2)

</pre>
<p>All of the package directories listed above have
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files but generally do not have
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> files since most of usage of <tt class="docutils literal">MockTrilinos</tt>
just involves the testing of the algorithms and behaviors described in the
section <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable Logic</a>.</p>
<p><tt class="docutils literal">MockTrilinos</tt> also contains a number of extra TriBITS repositories used in
various tests.  These extra repositories offer examples of different types of
TriBITS repositories like:</p>
<ul class="simple">
<li><tt class="docutils literal">extraRepoOnePackage</tt>: Contains just the single package
<tt class="docutils literal">extraRepoOnePackage</tt> which is defined in the base repository directory.</li>
<li><tt class="docutils literal">extraRepoOnePackageThreeSubpackages</tt>: Contains just the single package
<tt class="docutils literal">extraRepoOnePackageThreeSubpackages</tt> which is defined in the base
repository directory but is broken up into subpackages.</li>
<li><tt class="docutils literal">extraRepoTwoPackages</tt>: Contains just two packages but provides an example
of defining multiple repositories with possible missing required and
optional <a class="reference internal" href="#upstream">upstream</a> packages (see <a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a>).</li>
<li><tt class="docutils literal">extraTrilinosRepo</tt>: Just a typical extra repo with add-on packages and
TPLs that depends on a few upstream <tt class="docutils literal">MockTrilinos</tt> packages.</li>
</ul>
<p>New test extra repositories are added when new types of tests are needed that
would require new package and TPL dependency structures since existing
dependency tests based on <tt class="docutils literal">MockTrilinos</tt> are expensive to change by their
very nature.</p>
<p>The primary reason that the <tt class="docutils literal">MockTrilinos</tt> test project is mentioned in this
developers guide is because it contains a variety of packages, subpackages,
and TPLs with a variety of different types of dependencies.  This variety is
is needed to more fully test the TriBITS system but this project and the tests
also serve as examples and extra documentation for the behavior of the TriBITS
system.  Several of the dependency-related examples referenced in this
document come from <tt class="docutils literal">MockTrilinos</tt>.</p>
<p>Most of the dependency tests involving <tt class="docutils literal">MockTrilinos</tt> are specified in:</p>
<pre class="literal-block">
tribits/package_arch/UnitTests/DependencyUnitTests/CMakeLists.txt
</pre>
<p>A great deal about the current behavior of TriBITS <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and
Enable/Disable Logic</a> can be learned from inspecting these tests.  There are
also some faster-running unit tests involving <tt class="docutils literal">MockTrilinos</tt> defined in the
file:</p>
<pre class="literal-block">
tribits/package_arch/UnitTests/TribitsAdjustPackageEnables_UnitTests.cmake
</pre>
</div>
<div class="section" id="reducedmocktrilinos">
<h2><a class="toc-backref" href="#id35">4.4&nbsp;&nbsp;&nbsp;ReducedMockTrilinos</a></h2>
<p>The TriBITS project <tt class="docutils literal">ReducedMockTrilinos</tt> is contained under the directory:</p>
<pre class="literal-block">
tribits/package_arch/UnitTests/ReducedMockTrilinos/
</pre>
<p>It is a scaled-down version of the <a class="reference internal" href="#mocktrilinos">MockTrilinos</a> test project with just a
handful of packages and some modified dependencies.  Its primary purpose for
this example project is to be used for examples in the section <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package
Dependencies and Enable/Disable Logic</a> and to test a few features of the
TriBITS system not tested in other tests.</p>
<p>The list of packages in:</p>
<pre class="literal-block">
tribits/package_arch/UnitTests/ReducedMockTrilinos/PackagesList.cmake
</pre>
<p>is:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_PACKAGES(
  Teuchos             packages/teuchos                PT
  RTOp                packages/rtop                   PT
  Epetra              packages/epetra                 PT
  Triutils            packages/triutils               ST
  EpetraExt           packages/epetraext              ST
  Thyra               packages/thyra                  PT
  )

</pre>
<p>All of the listed packages are standard TriBITS packages except for the mock
<tt class="docutils literal">Thyra</tt> package which is broken down into subpackages.  More details of this
example project are described in <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable
Logic</a>.</p>
</div>
<div class="section" id="trilinos">
<h2><a class="toc-backref" href="#id36">4.5&nbsp;&nbsp;&nbsp;Trilinos</a></h2>
<p>The real Trilinos project and repository itself is an advanced example for the
usage of TriBITS.  Almost every single-repository use case for TriBITS is
demonstrated somewhere in Trilinos.  While some of the usage of TriBITS in
Trilinos may not be not exemplary (e.g., because it represents old usage, or
was written by CMake/TriBITS beginners) it does represent real working usage.
Given that Trilinos is a widely available software repository, anyone should be
able to access a newer version of Trilinos and mine it for CMake and TriBITS
examples.</p>
</div>
<div class="section" id="the-tribits-test-package">
<h2><a class="toc-backref" href="#id37">4.6&nbsp;&nbsp;&nbsp;The TriBITS Test Package</a></h2>
<p>The last TriBITS example mentioned here is the TriBITS test package named
(appropriately) <tt class="docutils literal">TriBITS</tt> itself.  The directory for the <tt class="docutils literal">TriBITS</tt> test
package is the base TriBITS source directory <tt class="docutils literal">tribits</tt>.  This allows any
TriBITS project to add testing for the TriBITS system by just listing this
package and its directory in its repository's <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a>
file.  For example, the Trilinos repository which currently snapshots the
TriBITS source tree lists the <tt class="docutils literal">TriBITS</tt> package with:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_PACKAGES(
  TriBITS   cmake/tribits  PT   # Only tests, no libraries/capabilities!
  ...
  )
</pre>
<p>No <a class="reference internal" href="#downstream">downstream</a> packages list a dependency on <tt class="docutils literal">TriBITS</tt> in their
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files.  Listing the <tt class="docutils literal">TriBITS</tt>
package in only done in the <tt class="docutils literal">PackagesList.cmake</tt> file for testing TriBITS.</p>
<p>Other TriBITS projects/repositories that don't snapshot TriBITS but also want
to test TriBITS (perhaps just to mine its tests for examples) can do so by
including the <tt class="docutils literal">TriBITS</tt> test package in their <tt class="docutils literal">PackagesList.cmake</tt> file
using:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_PACKAGES(
  TriBITS   ${${PROJECT_NAME}_TRIBITS_DIR}   PT
  ...
  )
</pre>
<p>Once the <tt class="docutils literal">TriBITS</tt> test package is added to the list of project/repository
packages, it can be enabled just like any other package by adding the
following to the <tt class="docutils literal">cmake</tt> command-line options:</p>
<pre class="literal-block">
-D &lt;Project&gt;_ENABLE_TriBITS=ON \
-D &lt;Project&gt;_ENABLE_TESTS=ON
</pre>
<p>One can then inspect the added tests prefixed by <tt class="docutils literal">&quot;TriBITS_&quot;</tt> to see what
tests are defined and how they are run.  There is a wealth of information
about the TriBITS system embedded in these tests and where documentation and
these tests disagreed, believe the tests!</p>
</div>
</div>
<div class="section" id="package-dependencies-and-enable-disable-logic">
<h1><a class="toc-backref" href="#id38">5&nbsp;&nbsp;&nbsp;Package Dependencies and Enable/Disable Logic</a></h1>
<p>Arguably, the more important feature/aspect of the TriBITS system is the
partitioning of a large software project into packages and managing the
dependencies between these packages to support building, testing, and
deploying different pieces as needed (see discussion of <a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering
Packaging Principles</a>).  This is especially useful in incremental CI testing
of large projects.  However, maintaining such dependencies is also a critical
component in creating and maintaining Self-Sustaining Software (see the
<a class="reference external" href="../lifecycle_model/TribitsLifecycleModel.pdf">TriBITS Lifecycle Model</a>).  The fundamental mechanism for breaking up a
large software into manageable pieces is to partition the software into
different <a class="reference internal" href="#tribits-packages">TriBITS Packages</a> and then define the dependencies between these
packages (which are defined inside of the
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files for each package).</p>
<p>Note that the basic idea of breaking up a large set of software into pieces,
defining dependencies between the pieces, and then applying algorithms to
manipulate the dependency data-structures is nothing new.  If fact, nearly
every binary package deployment system provided in various Linux OS
distributions have the concept of packages and dependencies and will
automatically install all of the necessary <a class="reference internal" href="#upstream-dependencies">upstream dependencies</a> when a
<a class="reference internal" href="#downstream-dependency">downstream dependency</a> install is requested.  The main difference (and the
added complexity) with TriBITS is that it can handle both required and
optional dependencies since it can build from source.  A binary package
installation system, however, typically can't support optional dependencies
because only pre-built binary libraries and tools are available to install.</p>
<p>This section is organized and broken-down as follows.  First, the subsection
<a class="reference internal" href="#example-reducedmocktrilinos-project-dependency-structure">Example ReducedMockTrilinos Project Dependency Structure</a> presents the
<a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a> example project, describes its dependency structure,
and uses it to begin to describe how TriBITS sets up and manages package and
TPL dependencies.  The packages in this <a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a> example project
are used in the following subsections so one will be constantly referred back
to this subsection.  The following subsection <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling
Behaviors</a> defines and describes the nitty-gritty details of the TriBITS
package and TPL dependency structure and the algorithms that manipulate the
various package, TPL, and test enables and disables.  Specific examples for
the TriBITS dependency handling algorithms are given in the subsection
<a class="reference internal" href="#example-enable-disable-use-cases">Example Enable/Disable Use Cases</a>.  Finally, the subsection
<a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a> describes the standard XML output
data-structure that gets created by TriBITS that defines a project's package
and TPL dependencies.</p>
<div class="section" id="example-reducedmocktrilinos-project-dependency-structure">
<h2><a class="toc-backref" href="#id39">5.1&nbsp;&nbsp;&nbsp;Example ReducedMockTrilinos Project Dependency Structure</a></h2>
<p>To demonstrate the TriBITS package and TPL dependency handling system, the
small simple <a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a> project is used.  The list of packages for
this project is defined in the file <tt class="docutils literal">ReducedMockTrilinos/PackagesList.cmake</tt>
(see <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a>) which contents:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_PACKAGES(
  Teuchos             packages/teuchos                PT
  RTOp                packages/rtop                   PT
  Epetra              packages/epetra                 PT
  Triutils            packages/triutils               ST
  EpetraExt           packages/epetraext              ST
  Thyra               packages/thyra                  PT
  )

</pre>
<p>All of the listed packages are standard TriBITS packages except for the mock
<tt class="docutils literal">Thyra</tt> package which is broken down into subpackages as shown in
<tt class="docutils literal">packages/thyra/cmake/Dependnecies.cmake</tt> (see
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a>) which is:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_DEFINE_DEPENDENCIES(
  SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS
    CoreLibs      src                  PT  REQUIRED
    GoodStuff     good_stuff           ST  OPTIONAL
    CrazyStuff    crazy_stuff          EX  OPTIONAL
    Epetra        adapters/epetra      PT  OPTIONAL
    EpetraExt     adapters/epetraext   ST  OPTIONAL
  )

</pre>
<p>This gives the full list of top-level TriBITS packages:</p>
<pre class="literal-block">
Teuchos RTOp Epetra Triutils EpetraExt Thyra
</pre>
<p>Adding in the subpackages defined in the top-level <tt class="docutils literal">Thyra</tt> package, the full
set of <a class="reference internal" href="#tribits-se-packages">TriBITS SE Packages</a> for this project is:</p>
<pre class="literal-block">
Teuchos RTOp Epetra Triutils EpetraExt ThyraCoreLibs ThyraGoodStuff \
  ThyraCrazyStuff ThyraEpetra ThyraEpetraExt Thyra
</pre>
<p>Note that one can see this full list of top-level packages and SE packages in
the <tt class="docutils literal">cmake</tt> configure output lines starting with:</p>
<pre class="literal-block">
Final set of non-enabled packages:
Final set of non-enabled SE packages:
</pre>
<p>respectively, when configuring with no package enables as shown in the example
<a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default configure with no packages enabled on input</a>.</p>
<p>The list of <a class="reference internal" href="#tribits-tpls">TriBITS TPLs</a> for this example project given in the file
<tt class="docutils literal">ReducedMockTrilinos/TPLsList.cmake</tt> (see <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a>) which
is:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_TPLS(
  MPI            &quot;${${PROJECT_NAME}_TRIBITS_DIR}/tpls/&quot;    PT
  BLAS           cmake/TPLs/    PT
  LAPACK         cmake/TPLs/    PT
  Boost          cmake/TPLs/    ST
  UMFPACK        cmake/TPLs/    ST
  AMD            cmake/TPLs/    EX
  PETSC          cmake/TPLs/    ST
  )

</pre>
<p>Take note of the <a class="reference internal" href="#se-package-test-group">SE Package Test Group</a> (i.e. <a class="reference internal" href="#pt">PT</a>, <a class="reference internal" href="#st">ST</a>, or <a class="reference internal" href="#ex">EX</a>)
assigned to each SE package and TPL as it plays a significant role in how the
TriBITS dependency system handles enables and disables.</p>
<p>The dependency structure of this simple TriBITS project is shown below in
<a class="reference internal" href="#reducedmocktrilinos-dependencies">ReducedMockTrilinos Dependencies</a>.</p>
<p id="reducedmocktrilinos-dependencies"><strong>ReducedMockTrilinos Dependencies:</strong></p>
<pre class="literal-block">
Printing package dependencies ...

-- Teuchos_LIB_REQUIRED_DEP_TPLS: BLAS LAPACK
-- Teuchos_LIB_OPTIONAL_DEP_TPLS: Boost MPI

-- RTOp_LIB_REQUIRED_DEP_PACKAGES: Teuchos

-- Epetra_LIB_REQUIRED_DEP_TPLS: BLAS LAPACK
-- Epetra_LIB_OPTIONAL_DEP_TPLS: MPI

-- Triutils_LIB_REQUIRED_DEP_PACKAGES: Epetra

-- EpetraExt_LIB_REQUIRED_DEP_PACKAGES: Teuchos Epetra
-- EpetraExt_LIB_OPTIONAL_DEP_PACKAGES: Triutils
-- EpetraExt_LIB_OPTIONAL_DEP_TPLS: UMFPACK AMD PETSC

-- ThyraCoreLibs_LIB_REQUIRED_DEP_PACKAGES: Teuchos RTOp

-- ThyraGoodStuff_LIB_REQUIRED_DEP_PACKAGES: ThyraCoreLibs

-- ThyraCrazyStuff_LIB_REQUIRED_DEP_PACKAGES: ThyraGoodStuff

-- ThyraEpetra_LIB_REQUIRED_DEP_PACKAGES: Epetra ThyraCoreLibs

-- ThyraEpetraExt_LIB_REQUIRED_DEP_PACKAGES: ThyraEpetra EpetraExt

-- Thyra_LIB_REQUIRED_DEP_PACKAGES: ThyraCoreLibs
-- Thyra_LIB_OPTIONAL_DEP_PACKAGES: ThyraGoodStuff ThyraCrazyStuff ThyraEpetra ThyraEpetraExt


</pre>
<p>The above dependency structure printout is produced by configuring with
<tt class="docutils literal">${PROJECT_NAME}_DUMP_PACKAGE_DEPENDENCIES=ON</tt> (which also results in more
dependency information than what is shown above, e.g. like computed forward
package dependencies).  Note that the top-level SE package <tt class="docutils literal">Thyra</tt> is shown
to depend on its subpackages (not the other way around).  (Many people are
confused about the nature of the dependencies between packages and
subpackages.  See <a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> for more
discussion.)</p>
<!-- ToDo: Show diagram with this dependency structure. -->
<p>A number of user-settable CMake cache variables determine what SE packages
(and TPLs) and what tests and examples get enabled.  These cache variables are
described in <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#selecting-the-list-of-packages-to-enable">Selecting the list of packages to enable</a> and are described
below.  Also, the assigned <a class="reference internal" href="#se-package-test-group">SE Package Test Group</a> (i.e. <a class="reference internal" href="#pt">PT</a>, <a class="reference internal" href="#st">ST</a>, and
<a class="reference internal" href="#ex">EX</a>) also affects what packages get enabled or disabled.</p>
<p>Any of these SE packages can be enabled or disabled with
<tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=(ON|OFF)</span></tt> (the default enable is
typically empty <tt class="docutils literal">&quot;&quot;</tt>, see <a class="reference internal" href="#pt-st-se-packages-given-default-unset-enable-disable-state">PT/ST SE packages given default unset
enable/disable state</a>).  For <tt class="docutils literal">ReducedMockTrilinos</tt>, this gives the
enable/disable cache variables (with the initial default values):</p>
<pre class="literal-block">
Trilinos_ENABLE_Teuchos=&quot;&quot;
Trilinos_ENABLE_RTOp&quot;&quot;
Trilinos_ENABLE_Epetra=&quot;&quot;
Trilinos_ENABLE_Triutils=&quot;&quot;
Trilinos_ENABLE_EpetraExt=&quot;&quot;
Trilinos_ENABLE_ThyraCore=&quot;&quot;
Trilinos_ENABLE_ThyraGoodStuff=&quot;&quot;
Trilinos_ENABLE_ThyraCrazyStuff=&quot;OFF&quot;  # Because it is 'EX'
Trilinos_ENABLE_ThyraEpetra=&quot;&quot;
Trilinos_ENABLE_ThyraEpetraExt=&quot;&quot;
</pre>
<p>Every TriBITS SE package is assumed to have tests and/or examples so TriBITS
defines the following cache variables as well (with the initial default
values):</p>
<pre class="literal-block">
Teuchos_ENABLE_TESTS=&quot;&quot;
RTOp_ENABLE_TESTS=&quot;&quot;
Epetra_ENABLE_TESTS=&quot;&quot;
Triutils_ENABLE_TESTS=&quot;&quot;
EpetraExt_ENABLE_TESTS=&quot;&quot;
ThyraCoreLibs_ENABLE_TESTS=&quot;&quot;
ThyraGoodStuff_ENABLE_TESTS=&quot;&quot;
ThyraEpetra_ENABLE_TESTS=&quot;&quot;
ThyraEpetraExt_ENABLE_TESTS=&quot;&quot;
Thyra_ENABLE_TESTS=&quot;&quot;
</pre>
<p>NOTE: TriBITS only sets the variables <tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;_ENABLE_TESTS</tt> into
the cache if the SE package <tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;</tt> becomes enabled at some
point.  This cuts down the clutter in the CMake cache for large projects with
lots of packages where the user only enables a subset of the packages.</p>
<p>NOTE: TriBITS also defines the cache variables
<tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;_ENABLE_EXAMPLES</tt> for each enabled TriBITS package which
is handled the same way as the <tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;_ENABLE_TEST</tt> variables.</p>
<p>Also, every defined TPL is given its own <tt class="docutils literal">TPL_ENABLE_&lt;TRIBITS_TPL&gt;</tt>
enable/disable cache variable.  For the TPLs in <tt class="docutils literal">ReducedMockTrilinos</tt>, this
gives the enable/disable cache variables (with default values):</p>
<pre class="literal-block">
TPL_ENABLE_MPI=&quot;&quot;
TPL_ENABLE_BLAS=&quot;&quot;
TPL_ENABLE_LAPACK=&quot;&quot;
TPL_ENABLE_Boost=&quot;&quot;
TPL_ENABLE_UMFPACK=&quot;&quot;
TPL_ENABLE_AMD=&quot;&quot;
TPL_ENABLE_PETSC=&quot;&quot;
</pre>
<p>In addition, for every optional SE package and TPL dependency, TriBITS defines
a cache variable <tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;_ENABLE_&lt;OPTIONAL_DEP&gt;</tt>.  For the
optional dependencies shown in <a class="reference internal" href="#reducedmocktrilinos-dependencies">ReducedMockTrilinos Dependencies</a>, that gives
the additional cache variables (with default values):</p>
<pre class="literal-block">
Teuchos_ENABLE_Boost=&quot;&quot;
Teuchos_ENABLE_MPI=&quot;&quot;
Teuchos_ENABLE_Boost=&quot;&quot;
Epetra_ENABLE_MPI=&quot;&quot;
EpetraExt_ENABLE_Triutils=&quot;&quot;
EpetraExt_ENABLE_UMFPACK=&quot;&quot;
EpetraExt_ENABLE_AMD=&quot;&quot;
EpetraExt_ENABLE_PETSC=&quot;&quot;
Thyra_ENABLE_ThyraGoodStuff=&quot;&quot;
Thyra_ENABLE_ThyraCrazyStuff=&quot;&quot;
Thyra_ENABLE_ThyraEpetra=&quot;&quot;
Thyra_ENABLE_ThyraEpetraExt=&quot;&quot;
</pre>
<p>The above optional package-specific cache variables allow one to control
whether or not support for <a class="reference internal" href="#upstream">upstream</a> dependency X is turned on in package Y
independent of whether or not X and Y are themselves both enabled.  For
example, if the packages <tt class="docutils literal">Triutils</tt> and <tt class="docutils literal">EpetraExt</tt> are both enabled, one
can explicitly disable support for the optional dependency <tt class="docutils literal">Triutils</tt> in
<tt class="docutils literal">EpetraExt</tt> by setting <tt class="docutils literal">EpetraExt_ENABLE_Triutils=OFF</tt>.  One may want to
do this for several reasons but the bottom line is that this gives the user
more detailed control over package dependencies.  See the <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency
Handling Behaviors</a> and <a class="reference internal" href="#explicit-disable-of-an-optional-package-dependency">Explicit disable of an optional package
dependency</a> for more discussion and examples.</p>
<p>Before getting into specific <a class="reference internal" href="#example-enable-disable-use-cases">Example Enable/Disable Use Cases</a>, some of the
<a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a> are first defined below.</p>
</div>
<div class="section" id="tribits-dependency-handling-behaviors">
<h2><a class="toc-backref" href="#id40">5.2&nbsp;&nbsp;&nbsp;TriBITS Dependency Handling Behaviors</a></h2>
<p>Below, some of the rules and behaviors of the TriBITS dependency management
system are described.  Examples refer to the <a class="reference internal" href="#example-reducedmocktrilinos-project-dependency-structure">Example ReducedMockTrilinos
Project Dependency Structure</a>.  More detailed examples of these behaviors are
given in the section <a class="reference internal" href="#example-enable-disable-use-cases">Example Enable/Disable Use Cases</a>.</p>
<p>In brief, the rules/behaviors of the TriBITS package and TPL dependency
management system are:</p>
<ol class="arabic simple" start="0">
<li><a class="reference internal" href="#no-circular-dependencies-of-any-kind-are-allowed">No circular dependencies of any kind are allowed</a></li>
<li><a class="reference internal" href="#pt-st-se-packages-given-default-unset-enable-disable-state">PT/ST SE packages given default unset enable/disable state</a></li>
<li><a class="reference internal" href="#ex-se-packages-disabled-by-default">EX SE packages disabled by default</a></li>
<li><a class="reference internal" href="#se-package-enable-triggers-auto-enables-of-upstream-dependencies">SE package enable triggers auto-enables of upstream dependencies</a></li>
<li><a class="reference internal" href="#se-package-disable-triggers-auto-disables-of-downstream-dependencies">SE package disable triggers auto-disables of downstream dependencies</a></li>
<li><a class="reference internal" href="#pt-st-tpls-given-default-unset-enable-disable-state">PT/ST TPLs given default unset enable/disable state</a></li>
<li><a class="reference internal" href="#ex-tpls-given-default-unset-enable-disable-state">EX TPLs given default unset enable/disable state</a></li>
<li><a class="reference internal" href="#required-tpls-are-auto-enabled-for-enabled-se-packages">Required TPLs are auto-enabled for enabled SE packages</a></li>
<li><a class="reference internal" href="#optional-tpls-only-enabled-explicitly-by-the-user">Optional TPLs only enabled explicitly by the user</a></li>
<li><a class="reference internal" href="#tpl-disable-triggers-auto-disables-of-downstream-dependencies">TPL disable triggers auto-disables of downstream dependencies</a></li>
<li><a class="reference internal" href="#disables-trump-enables-where-there-is-a-conflict">Disables trump enables where there is a conflict</a></li>
<li><a class="reference internal" href="#enable-disable-of-parent-package-is-enable-disable-for-subpackages">Enable/disable of parent package is enable/disable for subpackages</a></li>
<li><a class="reference internal" href="#subpackage-enable-does-not-auto-enable-the-parent-package">Subpackage enable does not auto-enable the parent package</a></li>
<li><a class="reference internal" href="#support-for-optional-se-package-tpl-is-enabled-by-default">Support for optional SE package/TPL is enabled by default</a></li>
<li><a class="reference internal" href="#support-for-optional-se-package-tpl-can-be-explicitly-disabled">Support for optional SE package/TPL can be explicitly disabled</a></li>
<li><a class="reference internal" href="#explicit-enable-of-optional-se-package-tpl-support-auto-enables-se-package-tpl">Explicit enable of optional SE package/TPL support auto-enables SE package/TPL</a></li>
<li><a class="reference internal" href="#st-se-packages-only-auto-enabled-if-st-code-is-enabled">ST SE packages only auto-enabled if ST code is enabled</a></li>
<li><a class="reference internal" href="#project-enable-all-forward-dep-packages-enables-downstream-packages-tests">&lt;Project&gt;_ENABLE_ALL_FORWARD_DEP_PACKAGES enables downstream packages/tests</a></li>
<li><a class="reference internal" href="#project-enable-all-packages-enables-all-pt-cond-st-se-packages">&lt;Project&gt;_ENABLE_ALL_PACKAGES enables all PT (cond. ST) SE packages</a></li>
<li><a class="reference internal" href="#project-enable-tests-only-enables-explicitly-enabled-se-package-tests">&lt;Project&gt;_ENABLE_TESTS only enables explicitly enabled SE package tests</a></li>
<li><a class="reference internal" href="#if-no-se-packages-are-enabled-nothing-will-get-built">If no SE packages are enabled, nothing will get built</a></li>
<li><a class="reference internal" href="#tribits-prints-all-enables-and-disables-to-stdout">TriBITS prints all enables and disables to stdout</a></li>
<li><a class="reference internal" href="#tribits-auto-enables-disables-done-using-non-cache-local-variables">TriBITS auto-enables/disables done using non-cache local variables</a></li>
</ol>
<p>In more detail, these rules/behaviors are:</p>
<ol class="arabic simple" id="no-circular-dependencies-of-any-kind-are-allowed" start="0">
<li><strong>No circular dependencies of any kind are allowed</strong>: The zeroth rule of
the TriBITS dependency management system is that no TriBITS SE package (or
its tests) can declare a dependency on a <a class="reference internal" href="#downstream">downstream</a> SE package, period!
This is one of the most basic <a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering Packaging Principles</a>
stated as the <em>ADP (Acyclic Dependencies Principle)</em>, i.e. &quot;Allow no cycles
in the package dependency graph&quot;.  By default, the TriBITS system will
check for circular dependencies and will fail the configure if any are
found. For a more detailed discussion of circular package dependencies, see
<a class="reference internal" href="#design-considerations-for-tribits">Design Considerations for TriBITS</a>.</li>
</ol>
<ol class="arabic simple" id="pt-st-se-packages-given-default-unset-enable-disable-state">
<li><strong>PT/ST SE packages given default unset enable/disable state</strong>: An SE
package <tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;</tt> with testing group <tt class="docutils literal">PT</tt> or <tt class="docutils literal">ST</tt> is given
an <strong>unset enable/disable state by default</strong>
(i.e. <tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=&quot;&quot;</span></tt>).  For example, the
<tt class="docutils literal">PT</tt> package <tt class="docutils literal">Teuchos</tt> is not enabled or disabled by default and is
given the initial value <tt class="docutils literal"><span class="pre">Trilinos_ENABLE_Teuchos=&quot;&quot;</span></tt>.  For an example,
see <a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default configure with no packages enabled on input</a>.  This allows
<tt class="docutils literal">PT</tt>, and <tt class="docutils literal">ST</tt> packages to be enabled or disabled using other logic
defined by TriBITS which is described below.</li>
</ol>
<ol class="arabic simple" id="ex-se-packages-disabled-by-default" start="2">
<li><strong>EX SE packages disabled by default</strong>: An SE package <tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;</tt>
with testing group <tt class="docutils literal">EX</tt> is <strong>disabled by default</strong>
(i.e. <tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=OFF</span></tt>).  For an example,
see <a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default configure with no packages enabled on input</a>.  This results
in all required <a class="reference internal" href="#downstream">downstream</a> SE packages to be disabled by default.
However, the user can explicitly set
<tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=ON</span></tt> for an <tt class="docutils literal">EX</tt> package and
it will be enabled (unless one of its required dependencies are not enabled
for some reason).</li>
</ol>
<ol class="arabic simple" id="se-package-enable-triggers-auto-enables-of-upstream-dependencies" start="3">
<li><strong>SE package enable triggers auto-enables of upstream dependencies</strong>: Any
SE package <tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;</tt> can be explicitly <strong>enabled</strong> by the user
by setting the cache variable
<tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=ON</span></tt>
(e.g. <tt class="docutils literal">Trilinos_ENABLE_EpetraExt=ON</tt>).  When an SE package is enabled in
this way, the TriBITS system will try to enable all of the required
upstream SE packages and TPLs defined by the package (specified in its
<tt class="docutils literal">Dependencies.cmake</tt> file).  If an enabled SE package can't be enabled
and has to be disabled, either a warning is printed or processing will stop
with an error (depending on the value of
<tt class="docutils literal">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</tt>, see <a class="reference internal" href="#disables-trump-enables-where-there-is-a-conflict">Disables
trump enables where there is a conflict</a>).  In addition, if
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES=ON</tt>, then TriBITS will try
to enable all of the specified optional <a class="reference internal" href="#pt">PT</a> SE packages as well (and also
optional upstream <a class="reference internal" href="#st">ST</a> SE packages if
<tt class="docutils literal">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</tt>).  For an example, see
<a class="reference internal" href="#explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled">Explicit enable of a package, its tests, an optional TPL, with ST
enabled</a>.</li>
</ol>
<ol class="arabic simple" id="se-package-disable-triggers-auto-disables-of-downstream-dependencies" start="4">
<li><strong>SE package disable triggers auto-disables of downstream dependencies</strong>:
Any SE package <tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;</tt> can be explicitly <strong>disabled</strong> by the
user by setting the cache variable
<tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=OFF</span></tt>
(e.g. <tt class="docutils literal">Trilinos_ENABLE_Teuchos=OFF</tt>).  When an SE package is explicitly
disabled, it will result in the disable of all <a class="reference internal" href="#downstream">downstream</a> SE packages
that have required dependency on it.  It will also disable optional support
for the disabled packages in downstream packages that list it as an
optional dependency.  For an example, see <a class="reference internal" href="#explicit-disable-of-a-package">Explicit disable of a package</a>.</li>
</ol>
<ol class="arabic simple" id="pt-st-tpls-given-default-unset-enable-disable-state" start="5">
<li><strong>PT/ST TPLs given default unset enable/disable state</strong>: A TriBITS TPL
<tt class="docutils literal">&lt;TRIBITS_TPL&gt;</tt> with testing group <tt class="docutils literal">PT</tt> or <tt class="docutils literal">ST</tt> is given an <strong>unset
enable/disable state by default</strong> (i.e. <tt class="docutils literal"><span class="pre">TPL_ENABLE_&lt;TRIBITS_TPL&gt;=&quot;&quot;</span></tt>).
For example, the <tt class="docutils literal">PT</tt> TPL <tt class="docutils literal">BLAS</tt> is not enabled or disabled by default
(i.e. <tt class="docutils literal"><span class="pre">TPL_ENABLE_BLAS=&quot;&quot;</span></tt>).  For an example, see <a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default configure with
no packages enabled on input</a>.  This allows <tt class="docutils literal">PT</tt>, and <tt class="docutils literal">ST</tt> TPLs to be
enabled or disabled using other logic.</li>
</ol>
<ol class="arabic simple" id="ex-tpls-given-default-unset-enable-disable-state" start="6">
<li><strong>EX TPLs given default unset enable/disable state</strong>: A TriBITS TPL
<tt class="docutils literal">&lt;TRIBITS_TPL&gt;</tt> with testing group <tt class="docutils literal">EX</tt>, is given an <strong>unset
enable/disable state by default</strong> (i.e. <tt class="docutils literal"><span class="pre">TPL_ENABLE_&lt;TRIBITS_TPL&gt;=&quot;&quot;</span></tt>,
same as for <tt class="docutils literal">PT</tt> and <tt class="docutils literal">EX</tt> TPLs).  For an example, see <a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default
configure with no packages enabled on input</a>.  This is different behavior
than for <tt class="docutils literal">EX</tt> SE packages described above which provides an initial hard
disable.  However, since TriBITS will never automatically enable an
optional TPL (see <a class="reference internal" href="#optional-tpls-only-enabled-explicitly-by-the-user">Optional TPLs only enabled explicitly by the user</a>) and
since only <a class="reference internal" href="#downstream">downstream</a> <tt class="docutils literal">EX</tt> SE packages are allowed to have a required
dependencies on an <tt class="docutils literal">EX</tt> TPL, there is no need to set the default enable
for an <tt class="docutils literal">EX</tt> TPL to <tt class="docutils literal">OFF</tt>.  If an <tt class="docutils literal">EX</tt> SE package has a required
dependency on an <tt class="docutils literal">EX</tt> TPL, just enabling the <tt class="docutils literal">EX</tt> SE package should
automatically enable the <tt class="docutils literal">EX</tt> TPL as described in <a class="reference internal" href="#required-tpls-are-auto-enabled-for-enabled-se-packages">Required TPLs are
auto-enabled for enabled SE packages</a>.</li>
</ol>
<ol class="arabic simple" id="required-tpls-are-auto-enabled-for-enabled-se-packages" start="7">
<li><strong>Required TPLs are auto-enabled for enabled SE packages</strong>: All TPLs listed
as required TPL dependencies for the final set of enabled SE packages are
<strong>set to enabled</strong> (i.e. <tt class="docutils literal"><span class="pre">TPL_ENABLE_&lt;TRIBITS_TPL&gt;=ON</span></tt>), unless the
listed TPLs are already explicit disabled (in which case the SE package
would be disabled or an error would occur, see <a class="reference internal" href="#disables-trump-enables-where-there-is-a-conflict">Disables trump enables
where there is a conflict</a>).  For example, if the <tt class="docutils literal">Teuchos</tt> package is
enabled, then that will trigger the enable of its required TPLs <tt class="docutils literal">BLAS</tt>
and <tt class="docutils literal">LAPACK</tt>.  For an example, see <a class="reference internal" href="#explicit-enable-of-a-package-and-its-tests">Explicit enable of a package and its
tests</a>.</li>
</ol>
<ol class="arabic simple" id="optional-tpls-only-enabled-explicitly-by-the-user" start="8">
<li><strong>Optional TPLs only enabled explicitly by the user</strong>: Optional TPLs,
regardless of their testing group <tt class="docutils literal">PT</tt>, <tt class="docutils literal">ST</tt> or <tt class="docutils literal">EX</tt>, will only be
enabled if they are explicitly enabled by the user.  For example, just
because the package <tt class="docutils literal">Teuchos</tt> is enabled, the optional TPLs <tt class="docutils literal">Boost</tt> and
<tt class="docutils literal">MPI</tt> will <strong>not</strong> be enabled by default, even if
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES=ON</tt>.  To enable the
optional TPL <tt class="docutils literal">Boost</tt>, for example, and enable support for <tt class="docutils literal">Boost</tt> in
the <tt class="docutils literal">Teuchos</tt> package, the user must explicitly set
<tt class="docutils literal">TPL_ENABLE_Boost=ON</tt>.  For an example, see <a class="reference internal" href="#explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled">Explicit enable of a
package, its tests, an optional TPL, with ST enabled</a>.</li>
</ol>
<ol class="arabic simple" id="tpl-disable-triggers-auto-disables-of-downstream-dependencies" start="9">
<li><strong>TPL disable triggers auto-disables of downstream dependencies</strong>: Any TPLs
that are explicitly disabled (i.e. <tt class="docutils literal"><span class="pre">TPL_ENABLE_&lt;TRIBITS_TPL&gt;=OFF</span></tt>) will
result in the disable of all <a class="reference internal" href="#downstream">downstream</a> dependent SE packages that have
a required dependency on the TPL.  For example, if the user sets
<tt class="docutils literal">TPL_ENABLE_LAPACK=OFF</tt>, then this will result in the disable of SE
packages <tt class="docutils literal">Teuchos</tt> and <tt class="docutils literal">Epetra</tt>, and all of the required SE packages
downstream from them.  Also, the explicitly disabled TPL will result in the
disable of optional support in all downstream SE packages.  For example, if
the user sets <tt class="docutils literal">TPL_ENABLE_MPI=OFF</tt>, then TriBITS will automatically set
<tt class="docutils literal">Teuchos_ENABLE_MPI=OFF</tt> and <tt class="docutils literal">Epetra_ENABLE_MPI=OFF</tt>.  For examples,
see <a class="reference internal" href="#explicit-disable-of-an-optional-tpl">Explicit disable of an optional TPL</a> and <a class="reference internal" href="#explicit-disable-of-a-required-tpl">Explicit disable of a
required TPL</a>.</li>
</ol>
<ol class="arabic" id="disables-trump-enables-where-there-is-a-conflict" start="10">
<li><p class="first"><strong>Disables trump enables where there is a conflict</strong> and TriBITS will
never override a disable in order to satisfy some dependency.  For
example, if the user sets <tt class="docutils literal">Trilinos_ENABLE_Teuchos=OFF</tt> and
<tt class="docutils literal">Trilinos_ENABLE_RTOp=ON</tt>, then TriBITS will <strong>not</strong> override the
disable of <tt class="docutils literal">Teuchos</tt> in order to satisfy the required dependency of
<tt class="docutils literal">RTOp</tt>.  In cases such as this, the behavior of the TriBITS dependency
adjustment system will depend on the setting of the top-level user cache
variable <a class="reference internal" href="#project-name-disable-enabled-forward-dep-packages">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</a>:</p>
<ul class="simple" id="project-name-disable-enabled-forward-dep-packages-on">
<li>If <tt class="docutils literal">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=ON</tt>, then
TriBITS will disable the explicit enable and continue on.  In the above
example, TriBITS will override <tt class="docutils literal">Trilinos_ENABLE_RTOp=ON</tt> and set
<tt class="docutils literal">Trilinos_ENABLE_RTOp=OFF</tt> and print a verbose warning to the
<tt class="docutils literal">cmake</tt> stdout.</li>
</ul>
<ul class="simple" id="project-name-disable-enabled-forward-dep-packages-off">
<li>If <tt class="docutils literal">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=OFF</tt>, then
TriBITS will generate a detailed error message printed to <tt class="docutils literal">cmake</tt>
stdout and then abort processing.  In the above example, TriBITS will
report that <tt class="docutils literal">RTOp</tt> is enabled but the required SE package <tt class="docutils literal">Teuchos</tt>
is disabled and therefore <tt class="docutils literal">RTOp</tt> can't be enabled and processing must
stop.</li>
</ul>
<p>For an example of both behaviors, see <a class="reference internal" href="#conflicting-explicit-enable-and-disable">Conflicting explicit enable and
disable</a>.</p>
</li>
</ol>
<ol class="arabic" id="enable-disable-of-parent-package-is-enable-disable-for-subpackages" start="11">
<li><p class="first"><strong>Enable/disable of parent package is enable/disable for subpackages</strong>: An
explicit enable/disable of a top-level parent package with subpackages
with <tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=(ON|OFF)</span></tt> is equivalent
to the explicit enable/disable of all of the parent package's subpackages.
For example, explicitly setting <tt class="docutils literal">Trilinos_ENABLE_Thyra=ON</tt> is equivalent
to explicitly setting:</p>
<pre class="literal-block">
Trilinos_ENABLE_ThyraCoreLibs=ON
Trilinos_ENABLE_ThyraGoodStuff=ON   # Only if enabling ST code!
Trilinos_ENABLE_ThyraEpetra=ON
Trilinos_ENABLE_ThyraEpetraExt=ON   # Only if enabling ST code!
</pre>
<p>(Note that <tt class="docutils literal">Trilinos_ENABLE_ThyraCrazyStuff</tt> is <strong>not</strong> set to <tt class="docutils literal">ON</tt>
because it is already set to <tt class="docutils literal">OFF</tt> by default, see <a class="reference internal" href="#ex-se-packages-disabled-by-default">EX SE packages
disabled by default</a>.)  Likewise, explicitly setting
<tt class="docutils literal">Trilinos_ENABLE_Thyra=OFF</tt> is equivalent to explicitly setting all of
the <tt class="docutils literal">Thyra</tt> subpackages to <tt class="docutils literal">OFF</tt> at the outset.  For a <tt class="docutils literal">PT</tt> example,
see <a class="reference internal" href="#explicit-enable-of-a-package-and-its-tests">Explicit enable of a package and its tests</a>.  For a <tt class="docutils literal">ST</tt> example,
see <a class="reference internal" href="#explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled">Explicit enable of a package, its tests, an optional TPL, with ST
enabled</a>.</p>
</li>
</ol>
<ol class="arabic simple" id="subpackage-enable-does-not-auto-enable-the-parent-package" start="12">
<li><strong>Subpackage enable does not auto-enable the parent package</strong>: Enabling an
SE package that is a subpackage does <strong>not</strong> automatically enable the
parent package (except for at the very end, mostly just for show).  For
example, enabling the SE package <tt class="docutils literal">ThyraEpetra</tt> does not result in enable
of the parent <tt class="docutils literal">Thyra</tt> package, (except when
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_ALL_FORWARD_DEP_PACKAGES=ON</tt> for course).  For
an example, see <a class="reference internal" href="#explicit-enable-of-a-subpackage">Explicit enable of a subpackage</a>. This means that if a
<a class="reference internal" href="#downstream">downstream</a> package declares a dependency on the SE package
<tt class="docutils literal">ThyraEpetra</tt>, but not the parent package <tt class="docutils literal">Thyra</tt>, then the <tt class="docutils literal">Thyra</tt>
package (and its other subpackages and their dependencies) will not get
auto-enabled.  This is a key aspect of the TriBITS SE package management
system.</li>
</ol>
<ol class="arabic simple" id="support-for-optional-se-package-tpl-is-enabled-by-default" start="13">
<li><strong>Support for optional SE package/TPL is enabled by default</strong>: For an SE
package <tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;</tt> with an optional dependency on an
<a class="reference internal" href="#upstream">upstream</a> SE package or TPL <tt class="docutils literal">&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;</tt>, TriBITS
will automatically set the intra-enable variable
<tt class="docutils literal"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;=ON</span></tt> if
<tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;</tt> and <tt class="docutils literal">&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;</tt> are <strong>both
enabled</strong>.  For example, if the packages <tt class="docutils literal">Triutils</tt> and <tt class="docutils literal">EpetraExt</tt>
are both enabled, then TriBITS will automatically set
<tt class="docutils literal">EpetraExt_ENABLE_Triutils=ON</tt> by default and enables support for
<tt class="docutils literal">Triutils</tt> in <tt class="docutils literal">EpetraExt</tt>.  Likewise, if <tt class="docutils literal">Teuchos</tt> and the optional
TPL <tt class="docutils literal">Boost</tt> are both enabled, then TriBITS will automatically set
<tt class="docutils literal">Teuchos_ENABLE_Boost=ON</tt> by default.  This is obviously the logical
behavior.  See the full context for these examples in <a class="reference internal" href="#explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled">Explicit enable of
a package, its tests, an optional TPL, with ST enabled</a>.</li>
</ol>
<ol class="arabic simple" id="support-for-optional-se-package-tpl-can-be-explicitly-disabled" start="14">
<li><strong>Support for optional SE package/TPL can be explicitly disabled:</strong> Even
though TriBITS will automatically set
<tt class="docutils literal"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;=ON</span></tt> by default if
<tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;</tt> and <tt class="docutils literal">&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;</tt> are both
enabled at the project level (as described above), the user can explicitly
set <tt class="docutils literal"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;=OFF</span></tt> which
will turn off optional package-level support for the upstream SE package
or TPL <tt class="docutils literal">&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;</tt> in the downstream SE package
<tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;</tt>.  For example, the user can enable <tt class="docutils literal">EpetraExt</tt> and
<tt class="docutils literal">Triutils</tt> at the project level, but set
<tt class="docutils literal">EpetraExt_ENABLE_Triutils=OFF</tt> which will turn off package-level
support for <tt class="docutils literal">Triutils</tt> in the <tt class="docutils literal">EpetraExt</tt> package.  Likewise, the user
can enable <tt class="docutils literal">Teuchos</tt>, <tt class="docutils literal">Epetra</tt> and the optional TPL <tt class="docutils literal">Boost</tt>, but set
<tt class="docutils literal">Epetra_ENABLE_Boost=ON</tt>.  This would provide support for <tt class="docutils literal">Boost</tt> in
<tt class="docutils literal">Teuchos</tt> but not in <tt class="docutils literal">Epetra</tt>.  For examples, see <a class="reference internal" href="#explicit-disable-of-an-optional-package-dependency">Explicit disable of
an optional package dependency</a> and <a class="reference internal" href="#explicit-disable-of-an-optional-tpl-dependency">Explicit disable of an optional TPL
dependency</a>.</li>
</ol>
<ol class="arabic simple" id="explicit-enable-of-optional-se-package-tpl-support-auto-enables-se-package-tpl" start="15">
<li><strong>Explicit enable of optional SE package/TPL support auto-enables SE
package/TPL</strong>: If the user explicitly enables the TriBITS SE package
<tt class="docutils literal">&lt;TRIBITS_PACKAGE&gt;</tt> and explicitly sets
<tt class="docutils literal"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;=ON</span></tt> on input,
then that will automatically enable the SE package or TPL
<tt class="docutils literal">&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;</tt> (and all of its upstream dependencies
accordingly).  For example, if the user sets
<tt class="docutils literal">Trilinos_ENABLE_EpetraExt=ON</tt> and <tt class="docutils literal">EpetraExt_ENABLE_Triutils=ON</tt>,
then that will result in the auto-enable of
<tt class="docutils literal">Trilinos_ENABLE_Triutils=ON</tt> regardless of the value of
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES</tt> or
<tt class="docutils literal">${PROJECT_NAME}_SECONDARY_TESTED_CODE</tt>. This true even if the optional
SE package or TPL is <tt class="docutils literal">EX</tt>.  For example, setting
<tt class="docutils literal">Thyra_ENABLE_ThyraCrazyStuff=ON</tt> will result in the enabling of the
<tt class="docutils literal">EX</tt> package <tt class="docutils literal">ThyraCrazyStuff</tt>.  However, always remember that
<a class="reference internal" href="#disables-trump-enables-where-there-is-a-conflict">Disables trump enables where there is a conflict</a>.  For example, see
<a class="reference internal" href="#explicit-enable-of-an-optional-package-dependency">Explicit enable of an optional package dependency</a>.</li>
</ol>
<ol class="arabic simple" id="st-se-packages-only-auto-enabled-if-st-code-is-enabled" start="16">
<li><strong>ST SE packages only auto-enabled if ST code is enabled</strong>: TriBITS will
only enable an optional <tt class="docutils literal">ST</tt> SE package when
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES=ON</tt> if
<tt class="docutils literal">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</tt> is also set.  Otherwise, when
an optional <tt class="docutils literal">ST</tt> <a class="reference internal" href="#upstream">upstream</a> dependent SE package is not enabled due to
<tt class="docutils literal">${PROJECT_NAME}_SECONDARY_TESTED_CODE=OFF</tt>, then a one-line warning is
printed to stdout.  For example, if the <tt class="docutils literal">EpetraExt</tt> package is enabled
but <tt class="docutils literal">ST</tt> code is not enabled, then the optional SE package <tt class="docutils literal">Triutils</tt>
will not be enabled (for an example, see <a class="reference internal" href="#explicit-enable-of-a-package-and-its-tests">Explicit enable of a package and
its tests</a>).  However, when <tt class="docutils literal">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</tt>
and <tt class="docutils literal">EpetraExt</tt> is enabled, then <tt class="docutils literal">Triutils</tt> will be enabled too (for an
example, see <a class="reference internal" href="#explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled">Explicit enable of a package, its tests, an optional TPL,
with ST enabled</a>).  The TriBITS default is
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES=ON</tt>.  This helps to avoid
problems when users try to set a permutation of enables/disables which is
not regularly tested.</li>
</ol>
<ol class="arabic simple" id="project-enable-all-forward-dep-packages-enables-downstream-packages-tests" start="17">
<li><strong>&lt;Project&gt;_ENABLE_ALL_FORWARD_DEP_PACKAGES enables downstream packages/tests</strong>:
Setting the user cache-variable
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_ALL_FORWARD_PACKAGES=ON</tt> will result in the
<a class="reference internal" href="#downstream">downstream</a> <tt class="docutils literal">PT</tt> SE packages and tests to be enabled (and all <tt class="docutils literal">PT</tt>
and <tt class="docutils literal">ST</tt> SE packages and tests when
<tt class="docutils literal">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</tt>) for all explicitly enabled
SE packages.  For example, configuring with <tt class="docutils literal">Trilinos_ENABLE_Epetra=ON</tt>,
<tt class="docutils literal">Trilinos_ENABLE_TESTS=ON</tt>, and
<tt class="docutils literal">Trilinos_ENABLE_ALL_FORWARD_PACKAGES=ON</tt> will result the package
enables (and test and example enables) for the SE packages <tt class="docutils literal">Triutils</tt>,
<tt class="docutils literal">EpetraExt</tt>, <tt class="docutils literal">ThyraCoreLibs</tt>, <tt class="docutils literal">ThyraEpetra</tt> and <tt class="docutils literal">Thyra</tt>.  For an
example, see <a class="reference internal" href="#explicit-enable-of-a-package-and-downstream-packages-and-tests">Explicit enable of a package and downstream packages and
tests</a>.</li>
</ol>
<ol class="arabic" id="project-enable-all-packages-enables-all-pt-cond-st-se-packages" start="18">
<li><p class="first"><strong>&lt;Project&gt;_ENABLE_ALL_PACKAGES enables all PT (cond. ST) SE packages</strong>:
Setting the user cache-variable <tt class="docutils literal">${PROJECT_NAME}_ENABLE_ALL_PACKAGES=ON</tt>
will result in the enable of all <tt class="docutils literal">PT</tt> SE packages when
<tt class="docutils literal">${PROJECT_NAME}_SECONDARY_TESTED_CODE=OFF</tt> and all <tt class="docutils literal">PT</tt> and <tt class="docutils literal">ST</tt> SE
packages when <tt class="docutils literal">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</tt>.  For an
example, see <a class="reference internal" href="#enable-all-packages">Enable all packages</a>.  When the project is a meta-project,
this will only enable the project's primary meta-project packages (PMPP).
That is, a package will only be enabled due to
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_ALL_PACKAGES=ON</tt> when its parent repository does
not have <a class="reference internal" href="#repository-name-no-primary-meta-project-packages">${REPOSITORY_NAME}_NO_PRIMARY_META_PROJECT_PACKAGES</a> set to
<tt class="docutils literal">TRUE</tt>.  However, if:</p>
<pre class="literal-block">
${REPOSITORY_NAME}_NO_PRIMARY_META_PROJECT_PACKAGES=TRUE
</pre>
<p>then the SE package may be enabled if it (or its parent package) is listed
in <a class="reference internal" href="#repository-name-no-primary-meta-project-packages-except">${REPOSITORY_NAME}_NO_PRIMARY_META_PROJECT_PACKAGES_EXCEPT</a>.</p>
</li>
</ol>
<ol class="arabic simple" id="project-enable-tests-only-enables-explicitly-enabled-se-package-tests" start="19">
<li><strong>&lt;Project&gt;_ENABLE_TESTS only enables explicitly enabled SE package
tests</strong>: Setting <tt class="docutils literal">${PROJECT_NAME}_ENABLE_TESTS=ON</tt> will <strong>only enable
tests for explicitly enabled SE packages</strong> on input.  For example,
configuring with <tt class="docutils literal">Trilinos_ENABLE_RTOp=ON</tt> and
<tt class="docutils literal">Trilinos_ENABLE_TESTS=ON</tt> will only result in the enable of tests for
<tt class="docutils literal">RTOp</tt>, not <tt class="docutils literal">Teuchos</tt> (even through TriBITS will enable <tt class="docutils literal">Teuchos</tt>
because it is a required dependency of <tt class="docutils literal">RTOp</tt>).  See an example, see
<a class="reference internal" href="#explicit-enable-of-a-package-and-its-tests">Explicit enable of a package and its tests</a>.  When the project is a
meta-project, this will only enable tests for the project's primary
meta-project packages (PMPP).  The uses the same logic as for
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_ALL_PACKAGES</tt>, see
<a class="reference internal" href="#project-enable-all-packages-enables-all-pt-cond-st-se-packages">&lt;Project&gt;_ENABLE_ALL_PACKAGES enables all PT (cond. ST) SE packages</a>.</li>
</ol>
<ol class="arabic simple" id="if-no-se-packages-are-enabled-nothing-will-get-built" start="20">
<li><strong>If no SE packages are enabled, nothing will get built</strong>: Most TriBITS
projects are set up such that if the user does not explicitly enable at
least one SE package in some way, then nothing will be enabled or built.
In this case, when <tt class="docutils literal">${PROJECT_NAME}_ALLOW_NO_PACKAGES=TRUE</tt> a warning
will be printed and configuration will complete.  However, if
<tt class="docutils literal">${PROJECT_NAME}_ALLOW_NO_PACKAGES=FALSE</tt>, then the configure will die
with an error message.  For example, the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script sets
<tt class="docutils literal">${PROJECT_NAME}_ALLOW_NO_PACKAGES=OFF</tt> to make sure that something gets
enabled and tested in order to accept the results of the test and allow a
push.  For an example, see <a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default configure with no packages enabled on
input</a>.</li>
</ol>
<ol class="arabic simple" id="tribits-prints-all-enables-and-disables-to-stdout" start="21">
<li><strong>TriBITS prints all enables and disables to stdout</strong>: TriBITS prints out
(to <tt class="docutils literal">cmake</tt> stdout) the initial set of enables/disables on input, prints
a line whenever it sets (or overrides) an enable or disable, and prints
out the final set of enables/disables.  Therefore, the user just needs to
grep the <tt class="docutils literal">cmake</tt> stdout to find out why any particular SE package or TPL
is enabled or disabled in the end.  In addition, will print out when
tests/examples for a given SE package gets enabled and when support for
optional SE packages and TPLs is enabled or not.  Examples of this output
is given in all of the below examples but a detailed description of this
output is given in <a class="reference internal" href="#explicit-enable-of-a-package-and-its-tests">Explicit enable of a package and its tests</a>.</li>
</ol>
<ol class="arabic simple" id="tribits-auto-enables-disables-done-using-non-cache-local-variables" start="22">
<li><strong>TriBITS auto-enables/disables done using non-cache local variables</strong>:
TriBITS setting (or overrides) of enable/disable cache variables are done
by setting local non-cache variables at the top project-level scope.  This
is done so they don't get set in the cache and so that the same dependency
enable/disable logic is redone, from scratch, with each re-configure.
This results in the same enable/disable logic output as for the initial
configure.  This is to avoid confusion by the user about why some SE
packages and TPLs are enabled and some are not on subsequent reconfigures.</li>
</ol>
<p>TriBITS prints out a lot of information about the enable/disable logic as it
applies the above rules/behaviors.  For a large TriBITS project with lots of
packages, this can produce a lot of output to stdout.  One just needs to
understand what TriBITS is printing out and where to look in the output for
different information.  The examples in the section <a class="reference internal" href="#example-enable-disable-use-cases">Example Enable/Disable
Use Cases</a> show what this output looks like for the various enable/disable
scenarios and tries to explains in more detail the reasons for why the given
behavior is implemented the way that it is.  Given this output, the rule
definitions given above, and the detailed <a class="reference internal" href="#example-enable-disable-use-cases">Example Enable/Disable Use Cases</a>,
one should always be able to figure out exactly why the final set of
enables/disables is the way it is, even in the largest and most complex of
TriBITS projects.  (NOTE: The same can <em>not</em> be said for many other large
software configuration and deployment systems where basic decisions about what
to enable and disable are hidden from the user and can be very difficult to
track down and debug.)</p>
<p>The above behaviors address the majority of the functionality of the TriBITS
dependency management system.  However, when dealing with TriBITS projects
with multiple repositories, some other behaviors are supported through the
definition of a few more variables.  The following TriBITS repository-related
variables alter what packages in a given TriBITS repository get enabled
implicitly or not by TriBITS:</p>
<blockquote>
<p><tt class="docutils literal">${REPOSITORY_NAME}_NO_IMPLICIT_PACKAGE_ENABLE</tt></p>
<blockquote>
If set to <tt class="docutils literal">ON</tt>, then the packages in Repository <tt class="docutils literal">${REPOSITORY_NAME}</tt>
will not be implicitly enabled in any of the package adjustment logic.</blockquote>
<p><tt class="docutils literal">${REPOSITORY_NAME}_NO_IMPLICIT_PACKAGE_ENABLE_EXCEPT</tt></p>
<blockquote>
List of packages in the Repository <tt class="docutils literal">${REPOSITORY_NAME}</tt> that will be
allowed to be implicitly enabled.  Only checked if
<tt class="docutils literal">${REPOSITORY_NAME}_NO_IMPLICIT_PACKAGE_ENABLE</tt> is true.</blockquote>
</blockquote>
<p>The above variables typically are defined in the outer TriBITS Project's CTest
driver scripts or even in top-level project files in order to adjust how
packages in its listed repositories are handled.  What these variable do is to
allow a large project to turn off the auto-enable of optional SE packages in a
given TriBITS repository to provide more detailed control of what gets used
from a given TriBITS repository.  This, for example, is used in the CASL VERA
project to mange some of its extra repositories and packages to further reduce
the number of packages that get auto-enabled.</p>
<!-- ToDo: We should likely change this so that only tests and example don't get -->
<!-- enabled by default, not the packages itself.  This is mainly used to avoid -->
<!-- certain packages from getting enabled in the CI server when updates are -->
<!-- received.  This needs to be explained in the section on the CI server. -->
</div>
<div class="section" id="example-enable-disable-use-cases">
<h2><a class="toc-backref" href="#id41">5.3&nbsp;&nbsp;&nbsp;Example Enable/Disable Use Cases</a></h2>
<p>Below, a few of the standard enable/disable use cases for a TriBITS project
are given using the <a class="reference internal" href="#example-reducedmocktrilinos-project-dependency-structure">Example ReducedMockTrilinos Project Dependency
Structure</a> that demonstrate the <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a>.</p>
<p>The use cases covered are:</p>
<ul class="simple">
<li><a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default configure with no packages enabled on input</a></li>
<li><a class="reference internal" href="#explicit-enable-of-a-package-and-its-tests">Explicit enable of a package and its tests</a></li>
<li><a class="reference internal" href="#explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled">Explicit enable of a package, its tests, an optional TPL, with ST enabled</a></li>
<li><a class="reference internal" href="#explicit-disable-of-a-package">Explicit disable of a package</a></li>
<li><a class="reference internal" href="#conflicting-explicit-enable-and-disable">Conflicting explicit enable and disable</a></li>
<li><a class="reference internal" href="#explicit-enable-of-an-optional-tpl">Explicit enable of an optional TPL</a></li>
<li><a class="reference internal" href="#explicit-disable-of-an-optional-tpl">Explicit disable of an optional TPL</a></li>
<li><a class="reference internal" href="#explicit-disable-of-a-required-tpl">Explicit disable of a required TPL</a></li>
<li><a class="reference internal" href="#explicit-enable-of-a-subpackage">Explicit enable of a subpackage</a></li>
<li><a class="reference internal" href="#explicit-enable-of-an-optional-package-dependency">Explicit enable of an optional package dependency</a></li>
<li><a class="reference internal" href="#explicit-disable-of-an-optional-package-dependency">Explicit disable of an optional package dependency</a></li>
<li><a class="reference internal" href="#explicit-enable-of-an-optional-tpl-dependency">Explicit enable of an optional TPL dependency</a></li>
<li><a class="reference internal" href="#explicit-disable-of-an-optional-tpl-dependency">Explicit disable of an optional TPL dependency</a></li>
<li><a class="reference internal" href="#explicit-enable-of-a-package-and-downstream-packages-and-tests">Explicit enable of a package and downstream packages and tests</a></li>
<li><a class="reference internal" href="#enable-all-packages">Enable all packages</a></li>
</ul>
<p>All of these use cases and more can be easily run from the command-line by
first setting:</p>
<blockquote>
$ export REDUCED_MOCK_TRILINOS=&lt;base-dir&gt;/tribits/package_arch/UnitTests/ReducedMockTrilinos</blockquote>
<p>and then copy and pasting the <tt class="docutils literal">cmake</tt> commands shown below.  Just make sure
to run these in a temp directory because this actually configures a CMake
project in the local directory.  Just make sure and run:</p>
<pre class="literal-block">
$ rm -r CMake*
</pre>
<p>before each run to clear the CMake cache.</p>
<p>These use cases are now described in detail below.</p>
<p id="default-configure-with-no-packages-enabled-on-input"><strong>Default configure with no packages enabled on input</strong></p>
<p>The first use-case to consider is the configure of a TriBITS project without
enabling any packages.  For the <tt class="docutils literal">ReducedMockTrilinos</tt> project, this is done
with:</p>
<pre class="literal-block">
$ cmake ${REDUCED_MOCK_TRILINOS}
</pre>
<p>which produces the relevant dependency-related output:</p>
<pre class="literal-block">
Explicitly enabled packages on input (by user):  0
Explicitly enabled SE packages on input (by user):  0
Explicitly disabled packages on input (by user or by default):  0
Explicitly disabled SE packages on input (by user or by default):  ThyraCrazyStuff 1
Explicitly enabled TPLs on input (by user):  0
Explicitly disabled TPLs on input (by user or by default):  0

...

Final set of enabled packages:  0
Final set of enabled SE packages:  0
Final set of non-enabled packages:  Teuchos RTOp Epetra Triutils EpetraExt Thyra 6
Final set of non-enabled SE packages:  Teuchos RTOp Epetra Triutils EpetraExt \
 ThyraCoreLibs ThyraGoodStuff ThyraCrazyStuff ThyraEpetra ThyraEpetraExt Thyra 11
Final set of enabled TPLs:  0
Final set of non-enabled TPLs:  MPI BLAS LAPACK Boost UMFPACK AMD PETSC 7

...

***
*** WARNING:  There were no packages configured so no libraries or tests/examples will be built!
***

</pre>
<p>The above example demonstrates the following behaviors of the TriBITS
dependency handling system:</p>
<ul class="simple">
<li><a class="reference internal" href="#pt-st-se-packages-given-default-unset-enable-disable-state">PT/ST SE packages given default unset enable/disable state</a></li>
<li><a class="reference internal" href="#ex-se-packages-disabled-by-default">EX SE packages disabled by default</a> (i.e., the <tt class="docutils literal">EX</tt> SE package
<tt class="docutils literal">ThyraCrazyStuff</tt> is set to <tt class="docutils literal">OFF</tt> by default at the very beginning).</li>
<li><a class="reference internal" href="#pt-st-tpls-given-default-unset-enable-disable-state">PT/ST TPLs given default unset enable/disable state</a></li>
<li><a class="reference internal" href="#ex-tpls-given-default-unset-enable-disable-state">EX TPLs given default unset enable/disable state</a></li>
<li><a class="reference internal" href="#if-no-se-packages-are-enabled-nothing-will-get-built">If no SE packages are enabled, nothing will get built</a></li>
</ul>
<p id="explicit-enable-of-a-package-and-its-tests"><strong>Explicit enable of a package and its tests</strong></p>
<p>One of the most typical use cases is for the user to explicitly enable one or
more top-level TriBITS package and enable its tests.  This configuration would
be used to drive local development on a specific set of packages (i.e. tests
do not need to be enabled for packages not being changed).</p>
<p>Consider the configure of the <tt class="docutils literal">ReducedMockTrilinos</tt> project enabling the
top-level <tt class="docutils literal">Thyra</tt> package and its tests with:</p>
<pre class="literal-block">
$ cmake -DTrilinos_ENABLE_Thyra:BOOL=ON \
   -DTrilinos_ENABLE_TESTS:BOOL=ON \
   ${REDUCED_MOCK_TRILINOS}
</pre>
<p>which produces the relevant dependency-related output:</p>
<pre class="literal-block">
Explicitly enabled packages on input (by user):  Thyra 1
Explicitly enabled SE packages on input (by user):  Thyra 1
Explicitly disabled packages on input (by user or by default):  0
Explicitly disabled SE packages on input (by user or by default):  ThyraCrazyStuff 1
Explicitly enabled TPLs on input (by user):  0
Explicitly disabled TPLs on input (by user or by default):  0

Enabling subpackages for hard enables of parent packages due to \
 Trilinos_ENABLE_&lt;PARENT_PACKAGE&gt;=ON ...

-- Setting subpackage enable Trilinos_ENABLE_ThyraCoreLibs=ON because parent \
 package Trilinos_ENABLE_Thyra=ON
-- Setting subpackage enable Trilinos_ENABLE_ThyraEpetra=ON because parent package \
 Trilinos_ENABLE_Thyra=ON

Disabling forward required SE packages and optional intra-package support that have a \
 dependancy on disabled SE packages Trilinos_ENABLE_&lt;TRIBITS_PACKAGE&gt;=OFF ...

-- Setting Thyra_ENABLE_ThyraCrazyStuff=OFF because Thyra has an optional library \
 dependence on disabled package ThyraCrazyStuff

Enabling all tests and/or examples that have not been explicitly disabled because \
 Trilinos_ENABLE_[TESTS,EXAMPLES]=ON ...

-- Setting ThyraCoreLibs_ENABLE_TESTS=ON
-- Setting ThyraCoreLibs_ENABLE_EXAMPLES=ON
-- Setting ThyraEpetra_ENABLE_TESTS=ON
-- Setting ThyraEpetra_ENABLE_EXAMPLES=ON
-- Setting Thyra_ENABLE_TESTS=ON
-- Setting Thyra_ENABLE_EXAMPLES=ON

Enabling all required (and optional since Trilinos_ENABLE_ALL_OPTIONAL_PACKAGES=ON) \
 upstream SE packages for current set of enabled packages ...

-- WARNING: Not Setting Trilinos_ENABLE_ThyraGoodStuff=ON even though Thyra \
 has an optional dependence on ThyraGoodStuff because Trilinos_ENABLE_SECONDARY_TESTED_CODE=OFF
-- WARNING: Not Setting Trilinos_ENABLE_ThyraEpetraExt=ON even though Thyra \
 has an optional dependence on ThyraEpetraExt because Trilinos_ENABLE_SECONDARY_TESTED_CODE=OFF
-- Setting Trilinos_ENABLE_Epetra=ON because ThyraEpetra has a required dependence on Epetra
-- Setting Trilinos_ENABLE_Teuchos=ON because ThyraCoreLibs has a required dependence on Teuchos
-- Setting Trilinos_ENABLE_RTOp=ON because ThyraCoreLibs has a required dependence on RTOp

Enabling all optional intra-package enables &lt;TRIBITS_PACKAGE&gt;_ENABLE_&lt;DEPPACKAGE&gt; that are 
 not currently disabled if both sets of packages are enabled ...

-- Setting Thyra_ENABLE_ThyraEpetra=ON since Trilinos_ENABLE_Thyra=ON AND Trilinos_ENABLE_ThyraEpetra=ON

Enabling all remaining required TPLs for current set of enabled packages ...

-- Setting TPL_ENABLE_BLAS=ON because it is required by the enabled package Teuchos
-- Setting TPL_ENABLE_LAPACK=ON because it is required by the enabled package Teuchos

Final set of enabled packages:  Teuchos RTOp Epetra Thyra 4
Final set of enabled SE packages:  Teuchos RTOp Epetra ThyraCoreLibs ThyraEpetra Thyra 6
Final set of non-enabled packages:  Triutils EpetraExt 2
Final set of non-enabled SE packages:  Triutils EpetraExt ThyraGoodStuff ThyraCrazyStuff ThyraEpetraExt 5
Final set of enabled TPLs:  BLAS LAPACK 2
Final set of non-enabled TPLs:  MPI Boost UMFPACK AMD PETSC 5

Getting information for all enabled TPLs ...

Processing enabled TPL: BLAS
Processing enabled TPL: LAPACK

Configuring individual enabled Trilinos packages ...

Processing enabled package: Teuchos (Libs)
Processing enabled package: RTOp (Libs)
Processing enabled package: Epetra (Libs)
Processing enabled package: Thyra (CoreLibs, Epetra, Tests, Examples)

</pre>
<p>This is a configuration that a developer would use to develop on the <tt class="docutils literal">Thyra</tt>
package and its subpackages for example.  There is no need to be enabling the
tests and examples for upstream packages unless those packages are going to be
changed as well.</p>
<p>This case demonstrates a number of TriBITS dependency handling behaviors that
are worth some discussion.</p>
<p>First, note that enabling the parent package <tt class="docutils literal">Thyra</tt> with
<tt class="docutils literal">Trilinos_ENABLE_Thyra=ON</tt> right away results in the auto-enable of its
<tt class="docutils literal">PT</tt> subpackages <tt class="docutils literal">ThyraCoreLibs</tt> and <tt class="docutils literal">ThyraEpetra</tt> which demonstrates
the behavior <a class="reference internal" href="#enable-disable-of-parent-package-is-enable-disable-for-subpackages">Enable/disable of parent package is enable/disable for
subpackages</a>.  Note that the <tt class="docutils literal">ST</tt> subpackages <tt class="docutils literal">ThyraGoodStuff</tt> and
<tt class="docutils literal">ThyraEpetraExt</tt> where <em>not</em> enabled because
<tt class="docutils literal">${PROJECT_NAME}_SECONDARY_TESTED_CODE=OFF</tt> (which is off by default) which
demonstrates the behavior <a class="reference internal" href="#st-se-packages-only-auto-enabled-if-st-code-is-enabled">ST SE packages only auto-enabled if ST code is
enabled</a>.</p>
<p>Second, note the auto-enable of required upstream SE packages <tt class="docutils literal">Epetra</tt>,
<tt class="docutils literal">RTOp</tt> and <tt class="docutils literal">Teuchos</tt> shown in lines like:</p>
<pre class="literal-block">
-- Setting Trilinos_ENABLE_Teuchos=ON because ThyraCoreLibs has a required dependence on Teuchos
</pre>
<p>Lastly, note that the final set of enabled packages, SE packages,
tests/examples and TPLs can be clearly seen when processing the TPLs and
top-level packages in the lines:</p>
<pre class="literal-block">
Getting information for all enabled TPLs ...

-- Processing enabled TPL: BLAS
-- Processing enabled TPL: LAPACK

Configuring individual enabled Trilinos packages ...

Processing enabled package: Teuchos (Libs)
Processing enabled package: RTOp (Libs)
Processing enabled package: Epetra (Libs)
Processing enabled package: Thyra (CoreLibs, Epetra, Tests, Examples)
</pre>
<p>Note that subpackage enables are listed with their parent packages along with
if the tests and/or examples are enabled.  Top-level level packages that don't
have subpackages just show if the <tt class="docutils literal">Libs</tt> or also the <tt class="docutils literal">Tests</tt> and
<tt class="docutils literal">Examples</tt> have been enabled as well.</p>
<p id="explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled"><strong>Explicit enable of a package, its tests, an optional TPL, with ST enabled</strong></p>
<p>An extended use case shown here is for the explicit enable of a package and its
tests along with the enable of an optional TPL and with <tt class="docutils literal">ST</tt> code enabled.
This is a configuration that would be used to support the local development of
a TriBITS package that involves modifying <tt class="docutils literal">ST</tt> software.</p>
<p>Consider the configure of the <tt class="docutils literal">ReducedMockTrilinos</tt> project with:</p>
<pre class="literal-block">
$ cmake -DTPL_ENABLE_Boost:BOOL=ON \
   -DTrilinos_ENABLE_Thyra:BOOL=ON \
   -DTrilinos_ENABLE_TESTS:BOOL=ON \
   -DTrilinos_ENABLE_SECONDARY_TESTED_CODE:BOOL=ON \
   -DTrilinos_ENABLE_TESTS:BOOL=ON \
   ${REDUCED_MOCK_TRILINOS}
</pre>
<p>which produces the relevant dependency-related output:</p>
<pre class="literal-block">
Explicitly enabled packages on input (by user):  Thyra 1
Explicitly enabled SE packages on input (by user):  Thyra 1
Explicitly disabled packages on input (by user or by default):  0
Explicitly disabled SE packages on input (by user or by default):  ThyraCrazyStuff 1
Explicitly enabled TPLs on input (by user):  Boost 1
Explicitly disabled TPLs on input (by user or by default):  0

Enabling subpackages for hard enables of parent packages due to \
 Trilinos_ENABLE_&lt;PARENT_PACKAGE&gt;=ON ...

-- Setting subpackage enable Trilinos_ENABLE_ThyraCoreLibs=ON because parent package \
 Trilinos_ENABLE_Thyra=ON
-- Setting subpackage enable Trilinos_ENABLE_ThyraGoodStuff=ON because parent package \
 Trilinos_ENABLE_Thyra=ON
-- Setting subpackage enable Trilinos_ENABLE_ThyraEpetra=ON because parent package \
 Trilinos_ENABLE_Thyra=ON
-- Setting subpackage enable Trilinos_ENABLE_ThyraEpetraExt=ON because parent package \
 Trilinos_ENABLE_Thyra=ON

Disabling forward required SE packages and optional intra-package support that have a \
 dependancy on disabled SE packages Trilinos_ENABLE_&lt;TRIBITS_PACKAGE&gt;=OFF ...

-- Setting Thyra_ENABLE_ThyraCrazyStuff=OFF because Thyra has an optional library \
 dependence on disabled package ThyraCrazyStuff

Enabling all tests and/or examples that have not been explicitly disabled because \
 Trilinos_ENABLE_[TESTS,EXAMPLES]=ON ...

-- Setting ThyraCoreLibs_ENABLE_TESTS=ON
-- Setting ThyraGoodStuff_ENABLE_TESTS=ON
-- Setting ThyraEpetra_ENABLE_TESTS=ON
-- Setting ThyraEpetraExt_ENABLE_TESTS=ON
-- Setting Thyra_ENABLE_TESTS=ON

Enabling all required (and optional since Trilinos_ENABLE_ALL_OPTIONAL_PACKAGES=ON) \
 upstream SE packages for current set of enabled packages ...

-- Setting Trilinos_ENABLE_EpetraExt=ON because ThyraEpetraExt has a required dependence on EpetraExt
-- Setting Trilinos_ENABLE_Epetra=ON because ThyraEpetra has a required dependence on Epetra
-- Setting Trilinos_ENABLE_Teuchos=ON because ThyraCoreLibs has a required dependence on Teuchos
-- Setting Trilinos_ENABLE_RTOp=ON because ThyraCoreLibs has a required dependence on RTOp
-- Setting Trilinos_ENABLE_Triutils=ON because EpetraExt has an optional dependence on Triutils

Enabling all optional intra-package enables &lt;TRIBITS_PACKAGE&gt;_ENABLE_&lt;DEPPACKAGE&gt; that are \
 not currently disabled if both sets of packages are enabled ...

-- Setting EpetraExt_ENABLE_Triutils=ON since Trilinos_ENABLE_EpetraExt=ON \
 AND Trilinos_ENABLE_Triutils=ON
-- Setting Thyra_ENABLE_ThyraGoodStuff=ON since Trilinos_ENABLE_Thyra=ON \
 AND Trilinos_ENABLE_ThyraGoodStuff=ON
-- Setting Thyra_ENABLE_ThyraEpetra=ON since Trilinos_ENABLE_Thyra=ON \
 AND Trilinos_ENABLE_ThyraEpetra=ON
-- Setting Thyra_ENABLE_ThyraEpetraExt=ON since Trilinos_ENABLE_Thyra=ON \
 AND Trilinos_ENABLE_ThyraEpetraExt=ON

Enabling all remaining required TPLs for current set of enabled packages ...

-- Setting TPL_ENABLE_BLAS=ON because it is required by the enabled package Teuchos
-- Setting TPL_ENABLE_LAPACK=ON because it is required by the enabled package Teuchos

Enabling all optional package TPL support for currently enabled TPLs ...

-- Setting Teuchos_ENABLE_Boost=ON since TPL_ENABLE_Boost=ON

Final set of enabled packages:  Teuchos RTOp Epetra Triutils EpetraExt Thyra 6
Final set of enabled SE packages:  Teuchos RTOp Epetra Triutils EpetraExt ThyraCoreLibs \
 ThyraGoodStuff ThyraEpetra ThyraEpetraExt Thyra 10
Final set of non-enabled packages:  0
Final set of non-enabled SE packages:  ThyraCrazyStuff 1
Final set of enabled TPLs:  BLAS LAPACK Boost 3
Final set of non-enabled TPLs:  MPI UMFPACK AMD PETSC 4

Getting information for all enabled TPLs ...

Processing enabled TPL: BLAS
Processing enabled TPL: LAPACK
Processing enabled TPL: Boost

Configuring individual enabled Trilinos packages ...

Processing enabled package: Teuchos (Libs)
Processing enabled package: RTOp (Libs)
Processing enabled package: Epetra (Libs)
Processing enabled package: Triutils (Libs)
Processing enabled package: EpetraExt (Libs)
Processing enabled package: Thyra (CoreLibs, GoodStuff, Epetra, EpetraExt, Tests, Examples)

</pre>
<p>A few more behaviors of the TriBITS system that this particular configuration
use-case shows are described below.</p>
<p>First, note the enable of the <tt class="docutils literal">ST</tt> <tt class="docutils literal">Thyra</tt> subpackages in lines like:</p>
<pre class="literal-block">
-- Setting subpackage enable Trilinos_ENABLE_ThyraGoodStuff=ON because parent package \
 Trilinos_ENABLE_Thyra=ON
</pre>
<p>Second, note the auto-enable of support for optional SE packages in lines
like:</p>
<pre class="literal-block">
-- Setting EpetraExt_ENABLE_Triutils=ON since Trilinos_ENABLE_EpetraExt=ON \
 AND Trilinos_ENABLE_Triutils=ON
</pre>
<p>Third, note the auto-enable of support for the optional TPL <tt class="docutils literal">Boost</tt> in the
line:</p>
<pre class="literal-block">
-- Setting Teuchos_ENABLE_Boost=ON since TPL_ENABLE_Boost=ON
</pre>
<p id="explicit-disable-of-a-package"><strong>Explicit disable of a package</strong></p>
<p>Another common use case is to enable a package but to disable an optional
upstream package.  This type of configuration would be used as part of a
&quot;black list&quot; approach to enabling only a subset of packages and optional
support.  The &quot;black list&quot; approach is to enable a package with
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES=ON</tt> (the TriBITS default) but
then to turn off a specific set of packages that you don't want.  This is
contrasted with a &quot;white list&quot; approach where you would configure with
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES=OFF</tt> and then have to manually
enable all of the optional packages you want.  Experience with projects like
Trilinos show that the &quot;black list&quot; approach is generally to be preferred for
a few reasons.</p>
<p>Consider the configure of the <tt class="docutils literal">ReducedMockTrilinos</tt> project enabling <tt class="docutils literal">Thyra</tt> but disabling <tt class="docutils literal">Epetra</tt> with:</p>
<pre class="literal-block">
$ cmake  -DTrilinos_ENABLE_Thyra:BOOL=ON \
   -DTrilinos_ENABLE_Epetra:BOOL=OFF \
   -DTrilinos_ENABLE_TESTS:BOOL=ON \
   ${REDUCED_MOCK_TRILINOS}
</pre>
<p>which produces the relevant dependency-related output:</p>
<pre class="literal-block">
Disabling forward required SE packages and optional intra-package support that have a \
 dependancy on disabled SE packages Trilinos_ENABLE_&lt;TRIBITS_PACKAGE&gt;=OFF ...

-- Setting Trilinos_ENABLE_Triutils=OFF because Triutils has a required library dependence \
 on disabled package Epetra
-- Setting Trilinos_ENABLE_EpetraExt=OFF because EpetraExt has a required library \
 disabled package Epetra
-- Setting Trilinos_ENABLE_ThyraEpetra=OFF because ThyraEpetra has a required library \
 disabled package Epetra
-- Setting Trilinos_ENABLE_ThyraEpetraExt=OFF because ThyraEpetraExt has a required library \
 disabled package EpetraExt
-- Setting Thyra_ENABLE_ThyraCrazyStuff=OFF because Thyra has an optional library \
 disabled package ThyraCrazyStuff
-- Setting Thyra_ENABLE_ThyraEpetra=OFF because Thyra has an optional library \
 disabled package ThyraEpetra
-- Setting Thyra_ENABLE_ThyraEpetraExt=OFF because Thyra has an optional library \
 disabled package ThyraEpetraExt

Final set of enabled packages:  Teuchos RTOp Thyra 3
Final set of enabled SE packages:  Teuchos RTOp ThyraCoreLibs Thyra 4
Final set of non-enabled packages:  Epetra Triutils EpetraExt 3
Final set of non-enabled SE packages:  Epetra Triutils EpetraExt ThyraGoodStuff \
 ThyraCrazyStuff ThyraEpetra ThyraEpetraExt 7
Final set of enabled TPLs:  BLAS LAPACK 2
Final set of non-enabled TPLs:  MPI Boost UMFPACK AMD PETSC 5

Configuring individual enabled Trilinos packages ...

Processing enabled package: Teuchos (Libs)
Processing enabled package: RTOp (Libs)
Processing enabled package: Thyra (CoreLibs, Tests, Examples)


</pre>
<p>Note how the disable of <tt class="docutils literal">Epetra</tt> wipes out all of the required and optional
SE packages and intra-package dependencies that depend on <tt class="docutils literal">Epetra</tt>.  What is
left is only the <tt class="docutils literal">ThyraCoreLibs</tt> and its upstream dependencies that don't
depend on <tt class="docutils literal">Epetra</tt> (which is only <tt class="docutils literal">RTOp</tt> and <tt class="docutils literal">Teuchos</tt>).</p>
<p id="conflicting-explicit-enable-and-disable"><strong>Conflicting explicit enable and disable</strong></p>
<p>One use case that occasionally comes up is when a set of inconsistent enables
and disables are set.  While this seems illogical that anyone would ever do
this, when it comes to larger more complex projects with lots of packages and
lots of dependencies, this can happen very easily.  In some cases, someone is
enabling a set of packages they want and is trying to weed out as many of the
(what they think) are optional dependencies that they don't need and
accidentally disables a package that is an indirect required dependency of one
of the packages they want (in which case the configure should likely fail and
provide a good error message).  The other use case where conflicting
enables/disables can occur is in CTest drivers using <a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a>
where an upstream package has failed and is explicitly disabled (in which case
it should gracefully disable downstream dependent packages).  TriBITS can
either be set up to have the disable override the explicit enable or stop the
configure in error depending on the value of the cache variable
<a class="reference internal" href="#project-name-disable-enabled-forward-dep-packages">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</a> (see <a class="reference internal" href="#disables-trump-enables-where-there-is-a-conflict">Disables trump
enables where there is a conflict</a>).</p>
<p>For example, consider what happens with the <tt class="docutils literal">ReducedMockTrilinos</tt> project if
someone tries to enable the <tt class="docutils literal">RTOp</tt> package and disable the <tt class="docutils literal">Teuchos</tt>
package.  This is not consistent because <tt class="docutils literal">RTOp</tt> has a required dependency on
<tt class="docutils literal">Teuchos</tt>.  The default behavior of TriBITS is this case is shown in the
below configure:</p>
<pre class="literal-block">
$ cmake -DTrilinos_ENABLE_Epetra:BOOL=ON \
   -DTrilinos_ENABLE_RTOp:BOOL=ON \
   -DTrilinos_ENABLE_Teuchos:BOOL=OFF \
   ${REDUCED_MOCK_TRILINOS}
</pre>
<p>which produces the relevant dependency-related output:</p>
<pre class="literal-block">
Explicitly enabled packages on input (by user):  RTOp Epetra 2
Explicitly disabled packages on input (by user or by default):  Teuchos 1

Disabling forward required SE packages and optional intra-package support that have \
 a dependancy on disabled SE packages Trilinos_ENABLE_&lt;TRIBITS_PACKAGE&gt;=OFF ...

   ***
   *** ERROR: Setting Trilinos_ENABLE_RTOp=OFF which was 'ON' because RTOp has a required \
 library dependence on disabled package Teuchos!
   ***

</pre>
<p>As shown above, the TriBITS default (which is
<tt class="docutils literal">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=OFF</tt>) results in a
configure-time error with a good error message.</p>
<p>However, if one sets
<tt class="docutils literal">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=ON</tt> and configures
with:</p>
<pre class="literal-block">
$ cmake -DTrilinos_ENABLE_Epetra:BOOL=ON \
   -DTrilinos_ENABLE_RTOp:BOOL=ON \
   -DTrilinos_ENABLE_Teuchos:BOOL=OFF \
   -DTrilinos_DISABLE_ENABLED_FORWARD_DEP_PACKAGES:BOOL=ON \
   ${REDUCED_MOCK_TRILINOS}
</pre>
<p>then the disable trumps the enable and results in a successful configure as
shown in the following relevant dependency-related output:</p>
<pre class="literal-block">
Explicitly enabled packages on input (by user):  RTOp Epetra 2
Explicitly disabled packages on input (by user or by default):  Teuchos 1

Disabling forward required SE packages and optional intra-package support that \
 have a dependancy on disabled SE packages Trilinos_ENABLE_&lt;TRIBITS_PACKAGE&gt;=OFF ...

 ***
 *** WARNING: Setting Trilinos_ENABLE_RTOp=OFF which was 'ON' because RTOp has \
 a required library dependence on disabled package Teuchos but \
 Trilinos_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=ON!
 ***

Final set of enabled packages:  Epetra 1
Final set of non-enabled packages:  Teuchos RTOp Triutils EpetraExt Thyra 5

</pre>
<p>As shown above, what you end up with is just the enabled package <tt class="docutils literal">Epetra</tt>
which does not have a required dependency on the disabled package <tt class="docutils literal">Teuchos</tt>.
Developers of large complex TriBITS projects would be wise to set the default
for <a class="reference internal" href="#project-name-disable-enabled-forward-dep-packages">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</a> to <tt class="docutils literal">ON</tt>,
especially in automated builds and testing.</p>
<p id="explicit-enable-of-an-optional-tpl"><strong>Explicit enable of an optional TPL</strong>:</p>
<p>ToDo: Set Trilinos_ENABLE_Thyra=ON and TPL_ENABLE_MPI=ON</p>
<p id="explicit-disable-of-an-optional-tpl"><strong>Explicit disable of an optional TPL</strong>:</p>
<p>ToDo: Set Trilinos_ENABLE_Thyra=ON and TPL_ENABLE_MPI=OFF</p>
<p id="explicit-disable-of-a-required-tpl"><strong>Explicit disable of a required TPL</strong></p>
<p>ToDo: Set Trilinos_ENABLE_Epetra=ON and Trilinos_ENABLE_BLAS=OFF</p>
<p id="explicit-enable-of-a-subpackage"><strong>Explicit enable of a subpackage</strong></p>
<p>ToDo: Enable ThyraEpetra and show how it enables other SE packages and at the
end, enables the Thyra package (just for show).</p>
<p id="explicit-enable-of-an-optional-package-dependency"><strong>Explicit enable of an optional package dependency</strong></p>
<p>ToDo: Set Trilinos_ENABLE_EpetraExt=ON and EpetraExt_ENABLE_Triutils=ON and
shows how it enables Trilinos_ENABLE_Triutils=ON even through ST code is not
enabled.</p>
<p id="explicit-disable-of-an-optional-package-dependency"><strong>Explicit disable of an optional package dependency</strong></p>
<p>ToDo: Set Trilinos_ENABLE_EpetraExt=ON, Trilinos_ENABLE_Triutils=ON, and
EpetraExt_ENABLE_Triutils=OFF.  Discuss how EpetraExt's and ThyraEpetraExt's
CMakeLists.txt files might turn off some features if they detects that
EpetraExt/Triutils support is turned off.</p>
<p id="explicit-enable-of-an-optional-tpl-dependency"><strong>Explicit enable of an optional TPL dependency</strong></p>
<p>ToDo: The current ReducedMockTrilinos is not set up to give a good example of
this.  We should add an optional Boost dependency to say, Epetra.  Then we
could show the enable of Teuchos and Epetra and Epetra_ENABLE_Boost=ON.  That
would enable Boost and enable support for Boost in Epetra but would not
provide support for Boost in Teuchos.</p>
<p id="explicit-disable-of-an-optional-tpl-dependency"><strong>Explicit disable of an optional TPL dependency</strong></p>
<p>ToDo: The current ReducedMockTrilinos is not set up to give a good example of
this.  We should add an optional Boost dependency to say, Epetra.  Then we
could show the enable of Teuchos and Epetra and TPL_ENABLE_Boost=ON but set
Epetra_ENABLE_Boost=OFF.  That would provide support for Boost in Teuchos but
not in Epetra.</p>
<p id="explicit-enable-of-a-package-and-downstream-packages-and-tests"><strong>Explicit enable of a package and downstream packages and tests</strong></p>
<p>ToDo: Set Trilinos_ENABLE_RTOp=ON,
Trilinos_ENABLE_ALL_FORWARD_DEP_PACKAGES=ON, and Trilinos_ENABLE_TESTS=ON and
show what packages and tests/examples get enabled.  This is the use case for
the checkin-test.py script for PT enabled code.</p>
<p id="enable-all-packages"><strong>Enable all packages</strong></p>
<p>The last use case to consider is enabling all defined packages.  This
configuration would be used for either doing a full test of all of the
packages defined or to create a distribution of the project.</p>
<p>Enabling all <tt class="docutils literal">PT</tt> packages the with:</p>
<pre class="literal-block">
$ cmake -DTrilinos_ENABLE_ALL_PACKAGES:BOOL=ON \
   -DTrilinos_DUMP_PACKAGE_DEPENDENCIES:BOOL=ON \
   ${REDUCED_MOCK_TRILINOS}
</pre>
<p>produces the relevant dependency-related output:</p>
<pre class="literal-block">
Enabling all SE packages that are not currently disabled because of Trilinos_ENABLE_ALL_PACKAGES=ON ...

-- Setting Trilinos_ENABLE_Teuchos=ON
-- Setting Trilinos_ENABLE_RTOp=ON
-- Setting Trilinos_ENABLE_Epetra=ON
-- Setting Trilinos_ENABLE_ThyraCoreLibs=ON
-- Setting Trilinos_ENABLE_ThyraEpetra=ON
-- Setting Trilinos_ENABLE_Thyra=ON

Enabling all remaining required TPLs for current set of enabled packages ...

-- Setting TPL_ENABLE_BLAS=ON because it is required by the enabled package Teuchos
-- Setting TPL_ENABLE_LAPACK=ON because it is required by the enabled package Teuchos

Final set of enabled packages:  Teuchos RTOp Epetra Thyra 4
Final set of enabled SE packages:  Teuchos RTOp Epetra ThyraCoreLibs ThyraEpetra Thyra 6
Final set of non-enabled packages:  Triutils EpetraExt 2
Final set of non-enabled SE packages:  Triutils EpetraExt ThyraGoodStuff ThyraCrazyStuff ThyraEpetraExt 5
Final set of enabled TPLs:  BLAS LAPACK 2
Final set of non-enabled TPLs:  MPI Boost UMFPACK AMD PETSC 5

Getting information for all enabled TPLs ...

Processing enabled TPL: BLAS
Processing enabled TPL: LAPACK

Configuring individual enabled Trilinos packages ...

Processing enabled package: Teuchos (Libs)
Processing enabled package: RTOp (Libs)
Processing enabled package: Epetra (Libs)
Processing enabled package: Thyra (CoreLibs, Epetra)

</pre>
<p>As shown above, only the <tt class="docutils literal">PT</tt> SE packages get enabled.  To also enable the
<tt class="docutils literal">ST</tt> packages as well, one additionally set
<tt class="docutils literal">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</tt> at configure time.</p>
</div>
<div class="section" id="project-packagedependencies-xml">
<h2><a class="toc-backref" href="#id42">5.4&nbsp;&nbsp;&nbsp;&lt;Project&gt;PackageDependencies.xml</a></h2>
<p>The TriBITS CMake configure system can write out the project's package
dependencies into a file <tt class="docutils literal">&lt;Project&gt;Dependencies.xml</tt> (or any name one wants
to give it).  This file is used by a number of the TriBITS SE-related tools.
The structure of this XML file, showing one of the more interesting mock
packages from the <a class="reference internal" href="#mocktrilinos">MockTrilinos</a> project is shown below:</p>
<pre class="literal-block">
&lt;PackageDependencies project=&quot;Trilinos&quot;&gt;
  ...
  &lt;Package name=&quot;Amesos&quot; dir=&quot;packages/amesos&quot; type=&quot;PT&quot;&gt;
    &lt;LIB_REQUIRED_DEP_PACKAGES value=&quot;Teuchos,Epetra&quot;/&gt;
    &lt;LIB_OPTIONAL_DEP_PACKAGES value=&quot;EpetraExt&quot;/&gt;
    &lt;TEST_REQUIRED_DEP_PACKAGES/&gt;
    &lt;TEST_OPTIONAL_DEP_PACKAGES value=&quot;Triutils,Galeri&quot;/&gt;
    &lt;LIB_REQUIRED_DEP_TPLS/&gt;
    &lt;LIB_OPTIONAL_DEP_TPLS value=&quot;SuperLUDist,ParMETIS,UMFPACK,SuperLU,MUMPS&quot;/&gt;
    &lt;TEST_REQUIRED_DEP_TPLS/&gt;
    &lt;TEST_OPTIONAL_DEP_TPLS/&gt;
    &lt;EmailAddresses&gt;
      &lt;Regression address=&quot;amesos-regression&#64;repo.site.gov&quot;/&gt;
    &lt;/EmailAddresses&gt;
    &lt;ParentPackage value=&quot;&quot;/&gt;
  &lt;/Package&gt;
  ...
&lt;/PackageDependencies&gt;
</pre>
<p>This XML file contains the names, directories, testing groups (<tt class="docutils literal">type</tt>),
CDash email address, and all of the SE package and TPL dependencies for every
SE package in the TriBITS project.  There are several python tools under
<tt class="docutils literal">tribits/python/</tt> that read in this file and use the created data-structure
for various tasks.  A TriBITS project configure can create this file as a
byproduct (see ???), or the CMake -P script <tt class="docutils literal">TribitsDumpDepsXmlScript.cmake</tt>
can be used to create this file on the fly without having to configure a
TriBITS project (see the <tt class="docutils literal"><span class="pre">checkin-test.out</span></tt> log file generated by
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> for an example of how to run this script to generate the
<tt class="docutils literal">&lt;Project&gt;Dependencies.xml</tt> file).</p>
</div>
</div>
<div class="section" id="tribits-automated-testing">
<h1><a class="toc-backref" href="#id43">6&nbsp;&nbsp;&nbsp;TriBITS Automated Testing</a></h1>
<p>Much of the value provided by the TriBITS system is support for testing of
complex complex projects.  Many different types of testing are required in a
complex project and development effort.  A large project with lots of
repositories and packages provides a number of testing and development
challenges but also provides a number of opportunities to do testing in an
efficient way; especially pre-push and post-push continuous integration (CI)
testing.  In addition, a number of post-push automated nightly test cases must
be managed.  TriBITS takes full advantage of the features of raw CMake, CTest,
and CDash in support of testing and where gaps exist, TriBITS provides tools
and customizations.</p>
<p>The following subsections describe several aspects to the TriBITS support for
testing.  The subsection <a class="reference internal" href="#test-classifications-for-repositories-packages-and-tests">Test Classifications for Repositories, Packages, and
Tests</a> defines the different types of test-related classifications that are
defined by TriBITS.  These different test classifications are then used to
define a number of different standard <a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested Layers of TriBITS Project
Testing</a> which include different types of CI testing as well as nightly and
other tests.  One of the most important types of CI testing, pre-push testing,
is then described in more detail in the subsection <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing using
checkin-test.py</a>.  The subsection <a class="reference internal" href="#tribits-package-by-package-ctest-dash-driver">TriBITS Package-by-Package CTest/Dash
Driver</a> describes the usage of the advanced <a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a>
function to do incremental project testing of a projects using advanced
<tt class="docutils literal">ctest <span class="pre">-S</span></tt> scripts.  The final subsection <a class="reference internal" href="#tribits-cdash-customizations">TriBITS CDash Customizations</a>
describes how projects can use a CDash server to more effectively display test
results and provide notifications for failures that are compartmentalized for
a large project.</p>
<div class="section" id="test-classifications-for-repositories-packages-and-tests">
<h2><a class="toc-backref" href="#id44">6.1&nbsp;&nbsp;&nbsp;Test Classifications for Repositories, Packages, and Tests</a></h2>
<p>TriBITS defines a few different testing-related classifications for a TriBITS
project.  These different classifications are used to select subsets of the
project's repositories, packages (and code within these packages), and tests
to be included in a given project build and test definition.  These different
classification are:</p>
<ul class="simple">
<li><a class="reference internal" href="#repository-test-classification">Repository Test Classification</a></li>
<li><a class="reference internal" href="#se-package-test-group">SE Package Test Group</a></li>
<li><a class="reference internal" href="#test-test-category">Test Test Category</a></li>
</ul>
<p>These different test-related classifications are used to defined several
different <a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested Layers of TriBITS Project Testing</a>.  First, the <a class="reference internal" href="#repository-test-classification">Repository
Test Classification</a> determines what repositories are even processed in order
for their SE packages to even consider being enabled.  Second, if a repository
is selected, then the <a class="reference internal" href="#se-package-test-group">SE Package Test Group</a> determines what SE packages
(and optional code in those packages) are even enabled such that their
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> files are even processed (i.e. according to
<a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a>).  Lastly, if an SE package gets
enabled, then the <a class="reference internal" href="#test-test-category">Test Test Category</a> determines what test executables and
test cases get defined using the functions <a class="reference internal" href="#tribits-add-executable">TRIBITS_ADD_EXECUTABLE()</a>,
<a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> and <a class="reference internal" href="#tribits-add-advanced-test">TRIBITS_ADD_ADVANCED_TEST()</a>.</p>
<p>More detailed descriptions of <a class="reference internal" href="#repository-test-classifications">Repository Test Classifications</a>, <a class="reference internal" href="#se-package-test-groups">SE Package
Test Groups</a>, and <a class="reference internal" href="#test-test-categories">Test Test Categories</a> are given in the following
subsections.</p>
<p id="repository-test-classifications"><span id="repository-test-classification"></span><strong>Repository Test Classification</strong></p>
<p>The first type of test-related classification is for extra repositories
defined in the file <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> (pulled
in trough the <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#project-extrarepos-file">${PROJECT_NAME}_EXTRAREPOS_FILE</a> cache variable) using the
<tt class="docutils literal">REPO_CLASSIFICATION</tt> field in the macro call
<a class="reference internal" href="#tribits-project-define-extra-repositories">TRIBITS_PROJECT_DEFINE_EXTRA_REPOSITORIES()</a>.  These classifications map to
the standard CTest dashboard types <tt class="docutils literal">Continuous</tt>, <tt class="docutils literal">Nightly</tt>, and
<tt class="docutils literal">Experimental</tt> (see <a class="reference external" href="http://www.cmake.org/Wiki/CMake/Testing_With_CTest">CTest documentation</a> and <a class="reference internal" href="#tribits-package-by-package-ctest-dash-driver">TriBITS Package-by-Package
CTest/Dash Driver</a> for details).</p>
<ul class="simple" id="repository-test-continuous">
<li>Repositories marked <strong>Continuous</strong> match the standard CTest dashboard type
<tt class="docutils literal">Continuous</tt>.  These repositories are pulled in when
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE=Continuous</tt>, or
<tt class="docutils literal">Nightly</tt>.  Repositories marked as <tt class="docutils literal">Continuous</tt> are cloned, updated, and
processed by default in all project automated testing described in <a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested
Layers of TriBITS Project Testing</a>.  NOTE: One should <strong>not</strong> confuse this
with the <a class="reference internal" href="#test-test-category-continuous">Test Test Category CONTINUOUS</a>.</li>
</ul>
<ul class="simple" id="repository-test-nightly">
<li>Repositories marked <strong>Nightly</strong> match the standard CTest dashboard type
<tt class="docutils literal">Nightly</tt>.  These repositories are pulled in by default when
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE=Nightly</tt>.  Repositories
marked as <tt class="docutils literal">Nightly</tt> are not processed by default as part of either
<a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a> or <a class="reference internal" href="#post-push-ci-testing">Post-Push CI Testing</a>.  One would mark a
repository as <tt class="docutils literal">Nightly</tt> for few reasons.  First, an extra repo may be
marked as <tt class="docutils literal">Nightly</tt> if it may not be available to all developers to clone
and only the nightly testing processes and machines may have access.  Also,
an extra repo may also be marked as <tt class="docutils literal">Nightly</tt> if it does not contain any
packages that the project wants to pay the cost to include in even
<a class="reference internal" href="#post-push-ci-testing">Post-Push CI Testing</a>.  NOTE: One should <strong>not</strong> confuse this with the
<a class="reference internal" href="#test-test-category-nightly">Test Test Category NIGHTLY</a>.</li>
</ul>
<ul class="simple" id="repository-test-experimental">
<li>Repositories marked <strong>Experimental</strong> match the standard CTest dashboard type
<tt class="docutils literal">Experimental</tt>.  Repositories marked as <tt class="docutils literal">Experimental</tt> are not processed
by default as part of any automated testing described in the subsection
<a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested Layers of TriBITS Project Testing</a> (except for perhaps some
experimental builds).  The main reason that an extra repo may be marked as
<tt class="docutils literal">Experimental</tt> is that it may only contain <tt class="docutils literal">EX</tt> SE packages and
therefore none of these packages would be enabled by default anyway.  Also,
a repo may be marked as <tt class="docutils literal">Experimental</tt> if it is developed in a very sloppy
way such that one cannot even assume that the repository's
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a>, <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPlsList.cmake</a>, and
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files are not without errors.
Since these files are always processed if the repository is included, then
any errors in these files will cause the entire configure to fail!</li>
</ul>
<!-- ToDo: Determine, add unit tests for, and document exactly how -->
<!-- 'Experimental' repos are handled -->
<!-- w.r.t. ${PROJECT_NAME}_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE.  Currently it -->
<!-- looks like there are not processed if -->
<!-- ${PROJECT_NAME}_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE=Experimental.  I am not -->
<!-- sure why we bother with Experimental repos other than to just ignore them. -->
<!-- However, it does seem they get cloned no matter what their classification -->
<!-- in the TribitsCTestDriverCore.cmake script. -->
<p id="se-package-test-groups"><span id="se-package-test-group"></span><strong>SE Package Test Group</strong></p>
<p>Once a set of TriBITS repositories are selected in accordance with their
<a class="reference internal" href="#repository-test-classification">Repository Test Classification</a>, that determines the set of SE packages and
TPLs defined for the TriBITS project.  Given the set of defined SE packages
and TPLs, the set of SE packages that get enabled is determined by the <strong>SE
Package Test Group</strong> which is defined and described here.</p>
<p>Every <a class="reference internal" href="#tribits-se-package">TriBITS SE Package</a> and <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a> is assigned a test group. These
test groups are for <em>Primary Tested</em> (<a class="reference internal" href="#pt">PT</a>) code, <em>Secondary Tested</em> (<a class="reference internal" href="#st">ST</a>)
code, and <em>Experimental</em> (<a class="reference internal" href="#ex">EX</a>) code.  The test group defines <em>what</em> SE
packages and TPL get selected (or are excluded from being selected) to include
in a given build for testing-related purposes.  SE packages may also
conditionally build in additional code based on the testing group.  The
detailed rules for when an SE package or TPL are selected or excluded from the
build based on the test group is given in <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling
Behaviors</a>.  We only summarize those rules here.</p>
<p>More detailed descriptions of the test groups are given below.</p>
<ul class="simple" id="pt">
<li><strong>Primary Tested (PT)</strong> Code is of the highest priority to keep working for
the current development effort.  SE packages and TPLs may be selected to be
<tt class="docutils literal">PT</tt> for a number of reasons.  First, if the capability provided by the
code is mature and if a regression would cause major harm to a customer, the
code should likely be marked as <tt class="docutils literal">PT</tt>.  Also, if the build and correct
functioning of the code is needed by other development team members to
support their day-to-day development activities, then the code should be
marked as <tt class="docutils literal">PT</tt> as well.  A TPL, on the other hand, is marked as <tt class="docutils literal">PT</tt> if
it is required by a <tt class="docutils literal">PT</tt> SE package.  Every project developer is expected
to have every <tt class="docutils literal">PT</tt> TPL installed on every machine where they do
development on and from which they push to the global repo (see
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script).  <tt class="docutils literal">PT</tt> SE packages and TPLs are the foundation
for <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a>.</li>
</ul>
<ul class="simple" id="st">
<li><strong>Secondary Tested (PT)</strong> Code is still very important code for the project
and represents important capability to maintain but is excluded from the
<tt class="docutils literal">PT</tt> set of code for one of a few different reasons.  First, code may be
marked as <tt class="docutils literal">ST</tt> if is not critical to drive most day-to-day development
activities.  If <tt class="docutils literal">ST</tt> code breaks, it usually will not cause immediate and
major harm to most developers.  Also, code may be marked as <tt class="docutils literal">ST</tt> if it has
required dependencies on <tt class="docutils literal">ST</tt> TPLs which are either hard to install or may
not be available on all platforms where developers do their development and
fro where they push changes to the global repo.  In addition, code my be
marked as <tt class="docutils literal">ST</tt> if the project is just too big and developers can't be
expected to build and test all of this code with every push (so a decision
is made to only make some code as <tt class="docutils literal">PT</tt> so that pushes don't take too
long).  <tt class="docutils literal">ST</tt> code can be included in the TriBITS auto-enable algorithms by
setting the variable <tt class="docutils literal">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</tt> (see
<a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a>).  Otherwise, <tt class="docutils literal">ST</tt> code <strong>is
not</strong> enabled by auto-enable algorithms.  Typically, <tt class="docutils literal">ST</tt> code is excluded
from the default builds in <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a> but <tt class="docutils literal">ST</tt> code <strong>is</strong>
typically tested in <a class="reference internal" href="#post-push-ci-testing">Post-Push CI Testing</a>, <a class="reference internal" href="#nightly-testing">Nightly Testing</a> as well as
in other testing cases.</li>
</ul>
<ul class="simple" id="ex">
<li><strong>Experimental (EX)</strong> Code is usually too unstable, buggy, or non-portable
to be maintained as part of the project's automated testing processes.  Or
the code may not be important enough to the project to bother paying the
cost to test it in the project's automated testing processes.  The ability
to mark some code as <tt class="docutils literal">EX</tt> allows the developers of that code to include
their code in the project's VC repos along with the rest of the project's
code and be able to take advantage of all of the development tools provided
by the project (using TriBITS) but at the same time not having to &quot;sign up&quot;
for all of the responsibilities of maintaining working software that every
developer has to take a part in helping to keep working.</li>
</ul>
<p>The test group for each type of entity is assigned in the following places:</p>
<ul class="simple">
<li>The top-level <a class="reference internal" href="#tribits-package">TriBITS Package</a>'s test group is assigned using the
<tt class="docutils literal">CLASSIFICATION</tt> field in the macro call
<a class="reference internal" href="#tribits-repository-define-packages">TRIBITS_REPOSITORY_DEFINE_PACKAGES()</a> in its parent repository's
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file.</li>
<li>A <a class="reference internal" href="#tribits-subpackage">TriBITS Subpackage</a>'s test group is assigned using the
<tt class="docutils literal">CLASSIFICATIONS</tt> field of the <a class="reference internal" href="#subpackages-dirs-classifications-optreqs">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</a>
argument in the macro call <a class="reference internal" href="#tribits-package-define-dependencies">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a> in its
parent package's <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file.</li>
<li>A <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>'s test group is assigned using the <tt class="docutils literal">CLASSIFICATION</tt> field
in the macro call <a class="reference internal" href="#tribits-repository-define-tpls">TRIBITS_REPOSITORY_DEFINE_TPLS()</a> in its parent
repository's <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file.</li>
</ul>
<p>After these files are processed, the variable <a class="reference internal" href="#package-name-testgroup">${PACKAGE_NAME}_TESTGROUP</a>
gives the test group for each defined SE Package while the variable
<tt class="docutils literal">${TPL_NAME}_TESTGROUP</tt> gives the test group for each defined TPL.</p>
<p>Note that the test group classification <tt class="docutils literal">PT</tt>/<tt class="docutils literal">ST</tt>/<tt class="docutils literal">EX</tt> is <em>not</em> to be
confused with the <em>maturity level</em> of the SE package as discussed in the
<a class="reference external" href="../lifecycle_model/TribitsLifecycleModel.pdf">TriBITS Lifecycle Model</a>.  The test group classification in no way implies
the maturity of the given TriBITS SE Package or piece of code.  Instead, the
test group is just used to sub-select packages (and pieces of code within
those packages) that are the most important to sustain for the various current
development group's activities.  While more-mature code would typically never
be classified as <tt class="docutils literal">EX</tt> (Experimental), there are cases were immature packages
may be classified as <tt class="docutils literal">ST</tt> or even <tt class="docutils literal">PT</tt>.  For example, a very important
research project may be driving the development of a very new algorithm with
the low <em>maturity level</em> of <em>Research Stable</em> (<tt class="docutils literal">RS</tt>) or even <em>Exploratory</em>
(<tt class="docutils literal">EP</tt>) because keeping that code working may be critical to keeping the
research project on track.</p>
<p>In addition to just selecting <tt class="docutils literal">PT</tt> and <tt class="docutils literal">ST</tt> SE packages as a whole, a
TriBITS <tt class="docutils literal">PT</tt> SE package can also contain conditional code and test
directories that get enabled when <tt class="docutils literal">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</tt>
and therefore represents more <tt class="docutils literal">ST</tt> code.  The package's
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> files can contain simple if statements and can
use the <a class="reference internal" href="#tribits-set-st-for-dev-mode">TRIBITS_SET_ST_FOR_DEV_MODE()</a> function to automatically select
extra code to enable when <tt class="docutils literal">ST</tt> is enabled or when the project is in release
mode.</p>
<!-- ToDo: Provide examples in TribitsExampleProject of ST and EX SE packages -->
<!-- and of conditional ST and EX code in an PT SE package.  This is important -->
<!-- to round out the examples. -->
<p id="test-test-categories"><span id="test-test-category"></span><strong>Test Test Category</strong></p>
<p>Once a package is even defined (due to its parent repository's selection
consistent with its <a class="reference internal" href="#repository-test-classification">Repository Test Classification</a>) and is the package is
enabled (consistent with its <a class="reference internal" href="#se-package-test-group">SE Package Test Group</a>) then the set of
individual test executables and test cases that are included or not in that
package depends on the <tt class="docutils literal">CATEGORIES</tt> argument in the functions
<a class="reference internal" href="#tribits-add-executable">TRIBITS_ADD_EXECUTABLE()</a>, <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> and
<a class="reference internal" href="#tribits-add-advanced-test">TRIBITS_ADD_ADVANCED_TEST()</a>, and the <a class="reference internal" href="#project-name-test-categories">${PROJECT_NAME}_TEST_CATEGORIES</a>
variable.  This <strong>Test Test Category</strong> defines the last &quot;knob&quot; that the
development team has in controlling what tests get run in a particular test
scenario as described in the section <a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested Layers of TriBITS Project
Testing</a>.</p>
<p>The currently allowed values for the <em>Test Test Category</em> are <tt class="docutils literal">BASIC</tt>,
<tt class="docutils literal">CONTINUOUS</tt>, <tt class="docutils literal">NIGHTLY</tt>, <tt class="docutils literal">WEEKLY</tt>, and <tt class="docutils literal">PERFORMANCE</tt>.  Tests are
enabled based on their assigned test test category matching the categories set
in the CMake cache variable <a class="reference internal" href="#project-name-test-categories">${PROJECT_NAME}_TEST_CATEGORIES</a>.  The test test
categories <tt class="docutils literal">BASIC</tt>, <tt class="docutils literal">CONTINUOUS</tt>, <tt class="docutils literal">NIGHTLY</tt>, and <tt class="docutils literal">WEEKLY</tt> are subsets
of each other.  That is, a <tt class="docutils literal">BASIC</tt> test is automatically included in the set
of <tt class="docutils literal">CONTINUOUS</tt>, <tt class="docutils literal">NIGHTLY</tt>, and <tt class="docutils literal">WEEKLY</tt> tests (as set using
<tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt>).</p>
<p>The different test test categories are described below in more detail:</p>
<ul class="simple" id="test-test-category-basic">
<li>Tests marked <strong>BASIC</strong> represent key functionality that is needed by nearly
every developer that works on the project and so must be protected at all
times and are therefore included in <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a>.  Tests marked as
<tt class="docutils literal">BASIC</tt> are enabled for the values of <tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt>
of <tt class="docutils literal">BASIC</tt>, <tt class="docutils literal">CONTINUOUS</tt>, <tt class="docutils literal">NIGHT</tt>, and <tt class="docutils literal">WEEKLY</tt>.  The category
<tt class="docutils literal">BASIC</tt> is the default test test category given to all test executables
and tests that don't specify the <tt class="docutils literal">CATEGORIES</tt> argument.</li>
</ul>
<ul class="simple" id="test-test-category-continuous">
<li>Tests marked <strong>CONTINUOUS</strong> also represent importantly functionality but are
typically not run in <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a> testing but instead are run in
<a class="reference internal" href="#post-push-ci-testing">Post-Push CI Testing</a>, <a class="reference internal" href="#nightly-testing">Nightly Testing</a>, and other types of testing.
Tests marked as <tt class="docutils literal">CONTINUOUS</tt> are enabled for the values of
<tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt> equal to <tt class="docutils literal">CONTINUOUS</tt>, <tt class="docutils literal">NIGHT</tt>, and
<tt class="docutils literal">WEEKLY</tt>.  A test may be marked <tt class="docutils literal">CONTINUOUS</tt> and not <tt class="docutils literal">BASIC</tt> for a few
different reasons.  For example, the code needed to run the test may take
too long to build or the test itself may take too long to run in order to
afford including it in <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a>.</li>
</ul>
<ul class="simple" id="test-test-category-nightly">
<li>Tests marked <strong>NIGHTLY</strong> usually take even longer to build and/or run than
<tt class="docutils literal">CONTINUOUS</tt> tests and therefore are too expensive to include in
<a class="reference internal" href="#post-push-ci-testing">Post-Push CI Testing</a>.  Tests may also be marked as <tt class="docutils literal">NIGHTLY</tt> even if
they might run relatively fast if there is a desire to not cause the CI
server to fail if these tests fail.  In this case, the decision is to take
the testing and maintenance of these tests and the capabilities they
represent &quot;offline&quot; so that they don't influence the daily development cycle
for the project but instead are addressed in a &quot;secondary feedback loop&quot;.
Tests marked as <tt class="docutils literal">NIGHTLY</tt> are enabled for the values of
<tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt> equal to <tt class="docutils literal">NIGHT</tt>, and <tt class="docutils literal">WEEKLY</tt>.</li>
</ul>
<ul class="simple" id="test-test-category-weekly">
<li>Tests marked <strong>WEEKLY</strong> are usually reserved for very expensive tests that
are too expensive to run nightly.  <tt class="docutils literal">WEEKLY</tt> tests may only be run once a
week (see <a class="reference internal" href="#weekly-testing">Weekly Testing</a>) but may be run on shorter or longer time
intervals depending on circumstances (e.g. the availability of test machines
and free processes, just how expensive all of the tests actually are, etc.).
Tests marked as <tt class="docutils literal">WEEKLY</tt> are enabled only for the value of
<tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt> equal to <tt class="docutils literal">WEEKLY</tt>.</li>
</ul>
<ul class="simple" id="test-test-category-performance">
<li>Tests marked <strong>PERFORMANCE</strong> are a special category of tests that are
specially designed to measure the serial (non-parallel) run-time performance
of parts of the software (see <a class="reference internal" href="#performance-testing">Performance Testing</a>).  Tests marked as
<tt class="docutils literal">PERFORMANCE</tt> are enabled only for the value of
<tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt> equal to <tt class="docutils literal">PERFORMANCE</tt>.</li>
</ul>
<p>Every TriBITS project has a default setting for
<tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt> that is set for a basic <tt class="docutils literal">cmake</tt>
configure of the project (see <a class="reference internal" href="#project-name-test-categories-default">${PROJECT_NAME}_TEST_CATEGORIES_DEFAULT</a> for
more details).  In addition, the different testing processes described in the
section <a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested Layers of TriBITS Project Testing</a> set this to different
values.</p>
</div>
<div class="section" id="nested-layers-of-tribits-project-testing">
<h2><a class="toc-backref" href="#id45">6.2&nbsp;&nbsp;&nbsp;Nested Layers of TriBITS Project Testing</a></h2>
<p>Now that the different types of <a class="reference internal" href="#test-classifications-for-repositories-packages-and-tests">Test Classifications for Repositories,
Packages, and Tests</a> have been defined, this section describes how these
different test-related classifications are used to select repositories,
packages (and code) and tests to run in the standard project testing
processes.  More than any other section in this document, this section will
describe and assume a certain class of software development processes (namely
agile processes) where testing and <em>continuous integration</em> (CI) are critical
components.  However, detailed descriptions of these processes are deferred to
the later sections <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing using checkin-test.py</a> and <a class="reference internal" href="#tribits-package-by-package-ctest-dash-driver">TriBITS
Package-by-Package CTest/Dash Driver</a>.</p>
<p>The standard TriBITS-defined project testing processes are:</p>
<ul class="simple">
<li><a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a></li>
<li><a class="reference internal" href="#post-push-ci-testing">Post-Push CI Testing</a></li>
<li><a class="reference internal" href="#nightly-testing">Nightly Testing</a></li>
<li><a class="reference internal" href="#weekly-testing">Weekly Testing</a></li>
<li><a class="reference internal" href="#performance-testing">Performance Testing</a></li>
</ul>
<!-- ToDo: Discuss why we would want to create standardized test cases?  The -->
<!-- answer is that it standardized how testing is done across multiple TriBITS -->
<!-- projects so that larger meta-projects and run tests in a consistent way. -->
<!-- ToDo: Show a diagram for these different testing processes and show how -->
<!-- they nest inside of each other for the most part. -->
<p>These standard testing processes are outlined in more detail below and show
how the different test-related categories are used to define each of these.</p>
<p id="pre-push-ci-testing"><strong>Pre-Push CI Testing</strong></p>
<p>The first level of testing is <em>Pre-Push CI Testing</em> that is performed before
changes to the project are pushed to the master branch(es) in the global
repository(s).  With TriBITS, this type of testing and the following push is
typically done using the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script.  This category of testing
is described in much more detail in <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing using checkin-test.py</a>.
All of the &quot;default builds&quot; used with the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script select
repositories, SE packages and code, and individual tests using the following
test-related classifications:</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="23%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Classification Type</th>
<th class="head">Classification</th>
<th class="head">(See Reference)</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Repository Test Classif.</td>
<td><tt class="docutils literal">Continuous</tt></td>
<td>(<a class="reference internal" href="#repository-test-continuous">Repository Test Continuous</a>)</td>
</tr>
<tr><td>SE Package Test Group</td>
<td><tt class="docutils literal">PT</tt></td>
<td>(<a class="reference internal" href="#pt">PT</a>)</td>
</tr>
<tr><td>Test Test Category</td>
<td><tt class="docutils literal">BASIC</tt></td>
<td>(<a class="reference internal" href="#test-test-category-basic">Test Test Category BASIC</a>)</td>
</tr>
</tbody>
</table>
<p>Typically a TriBITS project will define a &quot;standard development environment&quot;
which is comprised of a standard compiler (e.g. GCC 4.6.1), TPL versions
(e.g. OpenMPI 1.4.2, Boost 4.9, etc.), and other tools (e.g. cmake 2.8.11, git
1.8.2, etc.).  This standard development environment is expected to be used to
test changes to the project's code before any push.  By using a standard
development environment, if the code builds and all the tests pass for the
&quot;default&quot; pre-push builds for one developer, then that maximizes the
probability that the code will also build and all tests will pass for every
other developer using the same development environment.  This is critical to
keep the development team maximally productive.  Portability is also important
for most projects but portability testing is best done in a secondary feedback
look using <a class="reference internal" href="#nightly-testing">Nightly Testing</a> builds.  TriBITS has some support for helping to
set up a standard software development environment as described in section
<a class="reference internal" href="#tribits-development-toolset">TriBITS Development Toolset</a>.</p>
<p>The basic assumption of all CI processes (including the one described here) is
that if anyone pulls the project's development sources at any time, then all
of the code will build and all of the tests will pass for the &quot;default&quot; build
cases.  For a TriBITS project, this means that the project's
<tt class="docutils literal"><span class="pre">--default-builds</span></tt> (see above) will all pass for every <tt class="docutils literal">PT</tt> package.  All
of these software development processes make this basic assumption and agile
software development methods fall apart if this is not true.</p>
<p id="post-push-ci-testing"><strong>Post-Push CI Testing</strong></p>
<p>After changes are pushed to the master branch(es) in the global repository(s),
<em>Post-Push CI Testing</em> is performed where a CI server detects the changes and
immediately fires off a CI build using CTest to test the changes and the
results are posted to a CDash server (in the &quot;Continuous&quot; section on the
project's dashboard page).  This process is driven by CTest driver code that
calls <a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a> as described in the section <a class="reference internal" href="#tribits-package-by-package-ctest-dash-driver">TriBITS
Package-by-Package CTest/Dash Driver</a>.  Various types of specific CI builds
can be constructed and run (see <a class="reference internal" href="#ctest-cdash-ci-server">CTest/CDash CI Server</a>) but these post-push
CI builds typically select repositories, SE packages and code, and individual
tests using the following test-related classifications:</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="23%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Classification Type</th>
<th class="head">Classification</th>
<th class="head">(See Reference)</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Repository Test Classif.</td>
<td><tt class="docutils literal">Continuous</tt></td>
<td>(<a class="reference internal" href="#repository-test-continuous">Repository Test Continuous</a>)</td>
</tr>
<tr><td>SE Package Test Group</td>
<td><tt class="docutils literal">PT</tt> &amp; <tt class="docutils literal">ST</tt></td>
<td>(<a class="reference internal" href="#pt">PT</a> and <a class="reference internal" href="#st">ST</a>)</td>
</tr>
<tr><td>Test Test Category</td>
<td><tt class="docutils literal">CONTINUOUS</tt></td>
<td>(<a class="reference internal" href="#test-test-category-continuous">Test Test Category CONTINUOUS</a>)</td>
</tr>
</tbody>
</table>
<p>Post-push CI testing would assume to use the same standard development
environment as used for <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a>.  Also, the project may also
choose to run additional automated post-push CI builds that exactly match the
pre-push CI default builds to help check on the health of these builds
continuously and not just rely on the development team to always perform the
pre-push CI builds correctly before pushing.</p>
<p id="nightly-testing"><strong>Nightly Testing</strong></p>
<p>In addition to pre-push and post-push CI testing, a typical TriBITS project
will set up multiple <em>Nightly Testing</em> builds (or once-a-day builds, they
don't need to only run at night).  These builds are also driven by CTest
driver scripts described in the section <a class="reference internal" href="#tribits-package-by-package-ctest-dash-driver">TriBITS Package-by-Package CTest/Dash
Driver</a> and post results to the project's CDash server (in the &quot;Nightly&quot;
section on the project's dashboard page).  Nightly builds don't run in a
continuous loop but instead are run once a day (e.g. driven by a cron job) and
there tends to be many different nightly build cases that test the project
using different compilers (e.g.  GCC, Intel, Microsoft, etc., and different
versions of each), different TPL versions (e.g. different OpenMPI versions,
different MPICH versions, etc.), different platforms (e.g. Linux, Windows,
etc.), and varying many other options and settings on these different
platforms.  What all nightly builds have in common is that they tend to select
repositories, SE packages and code, and individual tests using the following
test-related classifications:</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="23%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Classification Type</th>
<th class="head">Classification</th>
<th class="head">(See Reference)</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Repository Test Classif.</td>
<td><tt class="docutils literal">Nightly</tt></td>
<td>(<a class="reference internal" href="#repository-test-nightly">Repository Test Nightly</a>)</td>
</tr>
<tr><td>SE Package Test Group</td>
<td><tt class="docutils literal">PT</tt> &amp; <tt class="docutils literal">ST</tt></td>
<td>(<a class="reference internal" href="#pt">PT</a> and <a class="reference internal" href="#st">ST</a>)</td>
</tr>
<tr><td>Test Test Category</td>
<td><tt class="docutils literal">NIGHTLY</tt></td>
<td>(<a class="reference internal" href="#test-test-category-nightly">Test Test Category NIGHTLY</a>)</td>
</tr>
</tbody>
</table>
<p>The nightly builds comprise the basic &quot;heart beat&quot; for the project.</p>
<p id="weekly-testing"><strong>Weekly Testing</strong></p>
<p><em>Weekly Testing</em> builds are just an extension to the <a class="reference internal" href="#nightly-testing">Nightly Testing</a> builds
that add on more expensive tests marked using the <a class="reference internal" href="#test-test-category-weekly">Test Test Category
WEEKLY</a>.  For projects that define weekly tests and weekly builds, individual
test cases can typically take 24 hours or longer to run so they can't even be
run every day in nightly testing.  What standard weekly builds have in common
is that they tend to select repositories, SE packages and code, and individual
tests using the following test-related classifications:</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="23%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Classification Type</th>
<th class="head">Classification</th>
<th class="head">(See Reference)</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Repository Test Classif.</td>
<td><tt class="docutils literal">Nightly</tt></td>
<td>(<a class="reference internal" href="#repository-test-nightly">Repository Test Nightly</a>)</td>
</tr>
<tr><td>SE Package Test Group</td>
<td><tt class="docutils literal">PT</tt> &amp; <tt class="docutils literal">ST</tt></td>
<td>(<a class="reference internal" href="#pt">PT</a> and <a class="reference internal" href="#st">ST</a>)</td>
</tr>
<tr><td>Test Test Category</td>
<td><tt class="docutils literal">WEEKLY</tt></td>
<td>(<a class="reference internal" href="#test-test-category-weekly">Test Test Category WEEKLY</a>)</td>
</tr>
</tbody>
</table>
<p>Project developer teams should strive to limit the number of test cases that
are marked as <tt class="docutils literal">WEEKLY</tt> since these tests will <em>not</em> get run nightly and
developers will tend to never enable them when doing more extensive testing
using <tt class="docutils literal"><span class="pre">--st-extra-builds</span></tt> with the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script in extended
pre-push testing.</p>
<p id="performance-testing"><strong>Performance Testing</strong></p>
<p><em>Performance Testing</em> builds are a special class of builds that have tests
that are specifically designed to test the run-time performance of a particular
piece of code or algorithm.  These tests tend to be sensitive to loads on the
machine and therefore typically need to be run on an unloaded machine for
reliable results.  Details on how to write good performance tests with hard
pass/fail time limits is beyond the scope of this document.  All TriBITS does
is to define the special <a class="reference internal" href="#test-test-category-performance">Test Test Category PERFORMANCE</a> to allow TriBITS
packages to declare these tests in a consistent way so that they can be run
along with performance tests defined in other TriBITS packages.  From a
TriBITS standpoint, all performance testing builds would tend to select
repositories, SE packages and code, and individual tests using the following
test-related classifications:</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="23%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Classification Type</th>
<th class="head">Classification</th>
<th class="head">(See Reference)</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Repository Test Classif.</td>
<td><tt class="docutils literal">Nightly</tt></td>
<td>(<a class="reference internal" href="#repository-test-nightly">Repository Test Nightly</a>)</td>
</tr>
<tr><td>SE Package Test Group</td>
<td><tt class="docutils literal">PT</tt> &amp; <tt class="docutils literal">ST</tt></td>
<td>(<a class="reference internal" href="#pt">PT</a> and <a class="reference internal" href="#st">ST</a>)</td>
</tr>
<tr><td>Test Test Category</td>
<td><tt class="docutils literal">PERFORMANCE</tt></td>
<td>(<a class="reference internal" href="#test-test-category-performance">Test Test Category PERFORMANCE</a>)</td>
</tr>
</tbody>
</table>
<!-- ToDo: I need to set up automated testing for TriBITS to use as the example -->
<!-- for all of these types of testing.  There is no better example that one -->
<!-- that actually works.  It would also be nice t have a snapshot repo of -->
<!-- TribitsExampleProject that also had this testing enabled for it but I am -->
<!-- not sure that really makes sense. -->
</div>
<div class="section" id="pre-push-testing-using-checkin-test-py">
<span id="checkin-test-py"></span><h2><a class="toc-backref" href="#id46">6.3&nbsp;&nbsp;&nbsp;Pre-push Testing using checkin-test.py</a></h2>
<p>CMake provides the integrated tool CTest (executable <tt class="docutils literal">ctest</tt>) which is used
to define and run different tests.  However, a lot more needs to be done to
effectively test changes for a large project before pushing to the master
branch(es) in the main repository(s).  Things get especially complicated and
tricky when multiple version-control (VC) repositories are involved.  The
TriBITS system provides the tool <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> for automating the
process of:</p>
<ol class="arabic simple">
<li>Determining if the local VC repo(s) are ready to integrate with the remote
master branch(es),</li>
<li>Pulling and integrating the most current changes from the remote VC repo(s),</li>
<li>Figuring out what TriBITS packages need to be enabled and testing (by
examining VC file diffs),</li>
<li>Configuring only the necessary TriBITS packages and tests (and their
downstream dependencies by default) and building, running tests, and
reporting results (via email), and</li>
<li>Only if all specified builds and tests pass, amending the last commit
message with the test results, then pushing local commits to the remove VC
repo(s) and sending out summary emails.</li>
</ol>
<p>When using the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script, every TriBITS project defines one
or more &quot;default builds&quot; (specified through the <tt class="docutils literal"><span class="pre">--default-builds</span></tt> argument)
for pre-push CI testing that form the criteria for if it is okay to push code
changes or not.  The &quot;default builds&quot; select repositories, SE packages and
code, and individual test as described in <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a>.  A TriBITS
project defines its default pre-push builds using the file
<a class="reference internal" href="#projectdir-project-checkin-test-config-py">&lt;projectDir&gt;/project-checkin-test-config.py</a>.  For an example, the file
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal"><span class="pre">project-checkin-test-config.py</span></tt> is shown below:</p>
<pre class="literal-block">
#
# Define project-specific options for the checkin-test script for
# TribitsExampleProject.
#

configuration = {

    # Default command line arguments
    'defaults': {
        '--send-email-to-on-push': 'trilinos-checkin-tests&#64;software.sandia.gov',
        },

    # CMake options (-DVAR:TYPE=VAL) cache variables.
    'cmake': {
        
        # Options that are common to all builds.
        'common': [],

        # Defines --default-builds, in order.
        'default-builds': [
            # Options for the MPI_DEBUG build.
            ('MPI_DEBUG', [
                '-DTPL_ENABLE_MPI:BOOL=ON',
                '-DCMAKE_BUILD_TYPE:STRING=RELEASE',
                '-DTribitsExProj_ENABLE_DEBUG:BOOL=ON',
                '-DTribitsExProj_ENABLE_CHECKED_STL:BOOL=ON',
                '-DTribitsExProj_ENABLE_DEBUG_SYMBOLS:BOOL=ON',
                ]),
            # Options for the SERIAL_RELEASE build.
            ('SERIAL_RELEASE', [
                '-DTPL_ENABLE_MPI:BOOL=OFF',
                '-DCMAKE_BUILD_TYPE:STRING=RELEASE',
                '-DTribitsExProj_ENABLE_DEBUG:BOOL=OFF',
                '-DTribitsExProj_ENABLE_CHECKED_STL:BOOL=OFF',
                ]),
            ], # default-builds

        }, # cmake

    } # configuration

</pre>
<p>This gives <tt class="docutils literal"><span class="pre">--default-builds=MPI_DEBUG,SERIAL_RELEASE</span></tt>.  As shown, typically
two default builds are defined so that various options can be toggled between
the two builds.  Typical options to toggle include enabling/disabling MPI and
enabling/disabling run-time debug mode checking (i.e. toggle
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_DEBUG</tt>).  Typically, other important options will
also be toggled between these two builds.  For example, Trilinos toggles the
enable/disable of C++ explicit template instantiation support between these
two builds.</p>
<p>Note that both of the default builds shown above, including the <tt class="docutils literal">MPI_DEBUG</tt>
build, actually set optimized compiler flags with
<tt class="docutils literal"><span class="pre">-DCMAKE_BUILD_TYPE:STRING=RELEASE</span></tt>.  What makes the <tt class="docutils literal">MPI_DEBUG</tt> build a
&quot;debug&quot; build is turning on optional run-time debug-mode checking, not
disabling optimized code.  This is important so that the defined tests run
fast.  For most projects, the default pre-push builds should <strong>not</strong> be used
to debug code by running a debugger.  Instead, they are designed to test
changes to the project's code efficiently before pushing changes.  A
development team should not have to test the chosen compiler's ability to
generate non-optimized debug code and suffer slower test times before pushing.</p>
<p>Note that turning on <tt class="docutils literal"><span class="pre">-DTribitsExProj_ENABLE_CHECKED_STL=ON</span></tt> as shown above
can only be used when the TPLs have no C++ code using the C++ STL or if that
particular build points to C++ TPLs also compiled with checked STL enabled.
The <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> default builds do not depend on any C++ TPLs that
might use the C++ STL so enabling this option adds additional positive
debug-mode checking for C++ code.</p>
<p>The <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script is a fairly sophisticated piece of software
that is well tested and very robust.  The level of testing of this tool is
likely greater than any of the software that it will be used to test (unless
the project is a real-time flight control system or nuclear reactor control
system or something).  This is needed so as to provide confidence in the
developers that the tool will only push their changes if everything checks out
as it should.  There are a lot of details and boundary cases that one has to
consider and a number of use cases that need to be supported by such a tool.
For more detailed documentation, see <a class="reference internal" href="#checkin-test-py-help">checkin-test.py --help</a>.</p>
<p>Note that the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script can also be used to implement
&quot;poor-man's&quot; post-push testing processes as described in <a class="reference internal" href="#post-push-ci-and-nightly-testing-using-checkin-test-py">Post-Push CI and
Nightly Testing using checkin-test.py</a>.  However, most software projects will
want to go with the more elaborate and more feature-full CTest/CDash system
described in <a class="reference internal" href="#tribits-package-by-package-ctest-dash-driver">TriBITS Package-by-Package CTest/Dash Driver</a>.</p>
<!-- ToDo: Describe the standard workflow for using the checkin-test.py script. -->
<!-- ToDo: Describe why the - -default-builds must only include PT code and not -->
<!-- ST due to changing the behavior of the PT software.  As an example, discuss -->
<!-- Boost usage in Teuchos and how that changes behavior of a few things. -->
<!-- Another example is BinUtils. -->
<!-- ToDo: Describe the system for mapping changed files to changed packages. -->
<!-- Discuss how important the directory structure is. -->
<!-- ToDo: Describe the local test, remote push process by pulling from the -->
<!-- Trilinos developers webpage. -->
<!-- ToDo: Describe the role that checkin-test.py plays in multi-repo ACI -->
</div>
<div class="section" id="tribits-package-by-package-ctest-dash-driver">
<h2><a class="toc-backref" href="#id47">6.4&nbsp;&nbsp;&nbsp;TriBITS Package-by-Package CTest/Dash Driver</a></h2>
<p>The TriBITS system uses a sophisticated and highly customized CTest driver
script to test TriBITS projects and submit results to a CDash server.  The
primary code for driving this is contained in the CTest function
<a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a> contained in the file
<tt class="docutils literal">TribitsCTestDriverCore.cmake</tt>.  This script loops through all of the
specified TriBITS packages for a given TriBITS project and does a configure,
built, and test and then submits results to the specified CDash server
incrementally.  If the configure or library build of any upstream TriBITS
package fails, then that TriBITS package is disabled in all downstream TriBITS
package builds so as not to propagate already known failures.  Each TriBITS
top-level package is assigned its own CDash regression email address (see
<a class="reference internal" href="#cdash-regression-email-addresses">CDash regression email addresses</a>) and each package configure/build/test is
given its own row for the build in the CDash server.  A CTest script using
<a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a> is run in one of three different modes.  First, it
can run standard once-a-day, from-scratch builds as described in <a class="reference internal" href="#ctest-cdash-nightly-testing">CTest/CDash
Nightly Testing</a>.  Second, it can run as a CI server as described in
<a class="reference internal" href="#ctest-cdash-ci-server">CTest/CDash CI Server</a>.  Third, it can run in experimental mode testing a
local repository using the TriBITS-defined <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#dashboard-submissions">make dashboard</a> target.</p>
<!-- ToDo: Discuss the behavior of Continuous, Nightly, and Experimental -->
<!-- CTest/CDash tracks and what that means in terms of sending out CDash error -->
<!-- emails and allowing for multiple builds of the same name in a single test -->
<!-- day. -->
<!-- ToDo: Document CTEST_TEST_TIMEOUT and DART_TESTING_TIMEOUT and how these -->
<!-- interact. -->
<!-- ToDo: Import and format the contents of tribits/ctest/README related to -->
<!-- this topic. -->
<div class="section" id="ctest-cdash-nightly-testing">
<h3><a class="toc-backref" href="#id48">CTest/CDash Nightly Testing</a></h3>
<p>When a TriBITS CTest script using <a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a> is run in
&quot;Nightly&quot; testing mode, it builds the project from scratch package-by-package
and submits results to the TriBITS project's CDash project on the designated
CDash server.</p>
<!-- ToDo: Give example of the package-by-package build. -->
</div>
<div class="section" id="ctest-cdash-ci-server">
<h3><a class="toc-backref" href="#id49">CTest/CDash CI Server</a></h3>
<p>When a TriBITS ctest driver script is used in continuous integration (CI)
mode, it starts every day with a clean from-scratch build and then performs
incremental rebuilds as new commits are pulled from the master branch in the
main repository(s).  In this mode, a continuous loop is performed after the
initial baseline build constantly pulling commits from the master git
repository(s).  If any package changes are detected (looking at git file
diffs), then the tests and examples for those packages and all downstream
packages are enabled and run using a reconfigure/rebuild.  Since all of the
upstream package libraries are already built, this rebuild and retest can take
place in a fraction of the time of a complete from-scratch build and test of
the project.</p>
<!-- ToDo Give some examples of the behavior of this process for the -->
<!-- ReducedMockTrilins project.  We could show example output from the script -->
<!-- that shows how it behaves. -->
<!-- ToDo: Discuss the usage of ${REPOSITORY_NAME}_NO_IMPLICIT_PACKAGE_ENABLE -->
<!-- and ${REPOSITORY_NAME}_NO_IMPLICIT_PACKAGE_ENABLE_EXCEPT to allow the CI -->
<!-- server to directly processing and running tests for upstream packages which -->
<!-- are not primary packages in the TriBITS meta-project. -->
<!-- ToDo: Mention that failing packages are always explicitly processed even if -->
<!-- the current CI iteration does not pull any changes. -->
<!-- ToDo: Give some examples from ReducedMockTrilinos of how file changes -->
<!-- result in package enables and rebuilds. -->
</div>
</div>
<div class="section" id="tribits-cdash-customizations">
<h2><a class="toc-backref" href="#id50">6.5&nbsp;&nbsp;&nbsp;TriBITS CDash Customizations</a></h2>
<p>CDash is not currently designed to accommodate multi-package, multi-repository
VC projects in the way they are supported by TriBITS.  However, CDash provides
some ability to customize a CDash project and submits to address missing
features.  Each TriBITS package is given a CTest/CDash &quot;Label&quot; with the name
of the TriBITS package.  CDash will then aggregate the different package
configure/build/test runs for each package into aggregated &quot;builds&quot;.  The
commits pulled for each of the extra VC repos listed in the
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file are shown in an
uploaded CDash &quot;Notes&quot; file for each TriBITS package configure/build/test
submit.  This uploaded &quot;Notes&quot; file also contains a cleaned up version of the
CMakeCache.txt file as well as a copy of the <tt class="docutils literal">ctest <span class="pre">-s</span></tt> script that ran the
case.</p>
<p>CDash offers numerous features such as the ability to construct a number of
different types of queries and is extremely helpful in using past test data.</p>
<!-- ToDo: Describe more on what CDash provides and how TriBITS uses it.  This -->
<!-- could be a *long* section with a lot of screen shots. -->
<div class="section" id="cdash-regression-email-addresses">
<h3><a class="toc-backref" href="#id51">CDash regression email addresses</a></h3>
<p>Every TriBITS Package has a regression email address associated with it that
gets uploaded to a CDash project on a CDash server that is used to determine
what email address to use when a package has configure, build, or test
failures.  Because of the complex organizational nature of different projects
and different integration models, a single static email address for a given
package in every project build is not practical.</p>
<p>The TriBITS system allows for a package's regression email address to be
specified in the following order of precedence:</p>
<p id="repository-name-repository-override-package-email-list">1) <strong>${REPOSITORY_NAME}_REPOSITORY_OVERRIDE_PACKAGE_EMAIL_LIST</strong> (typically
defined in <a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a>): Defines a
single email address for all packages for the repository
<tt class="docutils literal">${REPOSITORY_NAME}</tt> and overrides all other package email regression
specification variables.  This is typically used by a meta-project to redefine
the regression email addresses for all of the packages in an externally
developed repository.</p>
<p>2) <strong>REGRESSION_EMAIL_LIST</strong> (defined in
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a>): Package-specific email address
specified in the packages's <tt class="docutils literal">Dependencies.cmake</tt> file using
<a class="reference internal" href="#tribits-package-define-dependencies">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a>.</p>
<p id="repository-name-repository-email-url-address-base">3) <strong>${REPOSITORY_NAME}_REPOSITORY_EMAIL_URL_ADDRESS_BASE</strong> (set in
<a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a>): A base email address
specified at the Repository level creating package-specific email addresses
(e.g. <tt class="docutils literal"><span class="pre">&lt;lower-case-package-name&gt;-regression&#64;some.repo.gov</span></tt>, where
<tt class="docutils literal">${REPOSITORY_NAME}_REPOSITORY_EMAIL_URL_ADDRESS_BASE=some.repo.gov</tt>).
This variable is used, for example, by the Trilinos project to provide
automatic regression email addresses for packages.</p>
<p id="repository-name-repository-master-email-address">4) <strong>${REPOSITORY_NAME}_REPOSITORY_MASTER_EMAIL_ADDRESS</strong> (set in
<a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a>): A single email address
for all packages specified at the Repository level
(e.g. <tt class="docutils literal"><span class="pre">my-repo-regression&#64;some.repo.gov</span></tt>).  This variable is used for
smaller repositories with smaller development groups who just want all
regression emails for the repository's packages going to a single email
address.  This reduces the overhead of managing a bunch of individual package
email addresses but at the expense of spamming too many people with CDash
failure emails.</p>
<p id="project-name-project-email-url-address-base">5) <strong>${PROJECT_NAME}_PROJECT_EMAIL_URL_ADDRESS_BASE</strong> (set in
<a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a>): A base email address
specified at the Project level creating package-specific email addresses
(e.g. <tt class="docutils literal"><span class="pre">&lt;lower-case-package-name&gt;-regression&#64;some.project.gov</span></tt>, where
<tt class="docutils literal">${PROJECT_NAME}_PROJECT_EMAIL_URL_ADDRESS_BASE=some.project.gov</tt>).  If not
already set, this variable will be set to
<tt class="docutils literal">${REPOSITORY_NAME}_REPOSITORY_EMAIL_URL_ADDRESS_BASE</tt> for the first
repository processed that has this set. This behavior is used, for example by
the Trilinos project to automatically assign email addresses for add-on
packages and was added to maintain backward compatibility.</p>
<p id="project-name-project-master-email-address">6) <strong>${PROJECT_NAME}_PROJECT_MASTER_EMAIL_ADDRESS</strong> (set in
<a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a>): A single default email
address for all packages specified at the Project level
(e.g. <tt class="docutils literal"><span class="pre">my-project-regression&#64;some.project.gov</span></tt>).  If not already set, this
variable will be set to
<tt class="docutils literal">${REPOSITORY_NAME}_REPOSITORY_MASTER_EMAIL_ADDRESS</tt> for the first
repository processed that has this set.  Every meta-project should set this
variable so that it will be the default email address for any new package
added.</p>
<p>WARNING: If any of the email lists or URL string variables listed above are
set to <tt class="docutils literal">&quot;OFF&quot;</tt> or <tt class="docutils literal">&quot;FALSE&quot;</tt> (or some other value that CMake interprets as
false, see <a class="reference internal" href="#cmake-language-overview-and-gotchas">CMake Language Overview and Gotchas</a>) then the variables are
treated as empty and not set.</p>
<p>If a TriBITS project does not use CDash, then no email address needs to be
assigned to packages at all (and therefore none of the above variables need be
set).</p>
<p>As a general rule, repository-level settings override project-level settings
and package-level settings override both.  Also, a project can redefine a
repository's regression email list settings by resetting the variables in the
project's <a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a> file.</p>
<p>All of the email dependency management logic must be accessible by just running
the macro:</p>
<pre class="literal-block">
TRIBITS_READ_PACKAGES_PROCESS_DEPENDENCIES_WRITE_XML()
</pre>
<p>The above email address configuration variables are read from the Repository
and Project files <a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a> and
<a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a>, respectively.  The
<tt class="docutils literal">RepositoryDependenciesSetup.cmake</tt> files are read first in the specified
repository order followed up by reading the <tt class="docutils literal">ProjectDependenciesSetup.cmake</tt>
file.  In this way, the project can override any of the repository settings.</p>
<p>In review, the precedence order for how regression email addresses are
selected for a given package is:</p>
<ol class="arabic simple">
<li>Package-specific email list is selected if defined (unless an override is
in place).</li>
<li>Repository-level option is selected over a project-level option.</li>
<li>Default email form with repository or project address base is selected over
single repository or project email address.</li>
<li>If none of the above are selected, then no email address is assigned for a
given package.</li>
</ol>
<p>What the above setup does is it results in the TriBITS system (in the
<a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a> function called in <tt class="docutils literal">ctest <span class="pre">-S</span></tt> script) creating a
file called <tt class="docutils literal">CDashSubprojectDependencies.xml</tt> that gets sent to the CDash
server. CDash then takes this file and creates, or updates, a set of CDash
users (same name as the email list name) and sets up a mapping of Labels
(which are used for TriBITS package names) to CDash user emails
addresses. CDash is automatically set up to process this XML file and create
and update CDash users. It is not, however, set up to remove labels from
existing users.  Therefore, if you change a TriBITS package's CDash regression
email address (using one of the methods described above), then you need to
manually remove the associated labels from the old email address.  CDash will
not remove them for you.</p>
<p>Therefore, to change the mapping of CDash regression email addresses to
TriBITS packages, you must perform the actions:</p>
<ol class="arabic simple">
<li>Change the TriBITS CMake files as described above that will result in the
desired email addresses in the <tt class="docutils literal">CDashSubprojectDependencies.xml</tt>
file. You can debug this by running the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script and
seeing what gets written in the generated
<a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a> file in the <tt class="docutils literal">CHECKIN</tt> directory.</li>
<li>Log onto the CDash server using an administrator account and then remove
the auto-generated account for the CDash user email address for which
labels are being removed (i.e. no longer associated with a TriBITS
package).  This is needed since CDash seems to be unable to remove labels
from an existing CDash user (however this might be fixed in a current
version of CDash).</li>
<li>The next time a CDash submit is performed by a CTest driver script calling
<a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a>, the CDash user associated with the mail list
with labels being removed will get automatically recreated with the right
list of labels (according to the current
<tt class="docutils literal">CDashSubprojectDependencies.xml</tt> file).  Also, any new CDash users for
new email addresses will be created.</li>
</ol>
<p>Hopefully that should be enough clues to manage the mapping of CDash
regression email lists to TriBITS packages.</p>
</div>
</div>
</div>
<div class="section" id="multi-repository-support">
<h1><a class="toc-backref" href="#id52">7&nbsp;&nbsp;&nbsp;Multi-Repository Support</a></h1>
<p>TriBITS has built-in support for projects involving multiple <a class="reference internal" href="#tribits-repositories">TriBITS
Repositories</a> which contain multiple <a class="reference internal" href="#tribits-packages">TriBITS Packages</a>.  The basic
configuration, build, and test of such projects requires only raw CMake/CTest,
just like any other CMake project (see <a class="reference internal" href="#tribits-system-project-dependencies">TriBITS System Project
Dependencies</a>).  Every TriBITS project automatically supports tacking on
add-on TriBITS packages and TPLs through the
<a class="reference internal" href="#project-name-extra-repositories">${PROJECT_NAME}_EXTRA_REPOSITORIES</a> cmake cache variable as described in
<a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#enabling-extra-repositories-with-add-on-packages">Enabling extra repositories with add-on packages</a>.  In addition, a TriBITS
project can be set up from the start to pull in other TriBITS Repositories
using the <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file.  A special
form of this is a <a class="reference internal" href="#tribits-meta-project">TriBITS Meta-Project</a> that contains no packages or TPLs of
its own.  The ability to create meta-projects out of individual TriBITS
repositories allows TriBITS to be used to provide coordinated builds of large
aggregations of software.</p>
<p>To help set up a full-featured development environment (i.e. not just the
basic configure, build, test, and install) for TriBITS projects with multiple
repositories, TriBITS provides some extra development tools implemented using
Python.  The primary tools supporting multi-repository projects are the
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool and the <a class="reference internal" href="#gitdist">gitdist</a> tool.</p>
<p>For projects with a standard set of extra repositories defined in the
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file, the
<tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script only requires passing in the option
<tt class="docutils literal"><span class="pre">--extra-repos-file=project</span></tt> and <tt class="docutils literal"><span class="pre">--extra-repos-type=Continuous</span></tt> (or
<tt class="docutils literal">Nightly</tt>, see <a class="reference internal" href="#repository-test-classification">Repository Test Classification</a>) and it will automatically
perform all of the various actions for all of the selected repositories.  See
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> and <a class="reference internal" href="#checkin-test-py-help">checkin-test.py --help</a> for more details.</p>
<p id="gitdist">The tool <strong>gitdist</strong> is a simple stand-alone Python script that distributes a
git command across a set of git repos.  This tool is not specific to TriBITS
but it is very useful for dealing with TriBITS projects with multiple
repositories.  It only requires that a base git repo and a set of zero or more
git repos cloned under it.  For example, consider the TriBITS meta-project
specified in the following ExtraRepositoriesList.cmake file:</p>
<pre class="literal-block">
TRIBITS_PROJECT_DEFINE_EXTRA_REPOSITORIES(
  ExtraRepo1  &quot;&quot;  GIT  someurl.com:/ExtraRepo1   &quot;&quot;          Continuous
  ExtraRepo2  packages/SomePackage/Blah  GIT  someurl2.com:/ExtraRepo2
                                                 NOPACKAGES  Nightly
  ExtraRepo3  &quot;&quot;  HG  someurl3.com:/ExtraRepo3   &quot;&quot;          Continuous
  ExtraRepo4  &quot;&quot;  SVN  someurl4.com:/ExtraRepo4  &quot;&quot;          Nightly
  )

</pre>
<p>This would be laid out in directories as:</p>
<pre class="literal-block">
BaseRepo/
  .git/
  .gitignore
  ExtraRepo1/
    .git/
  packages/SomePackage/Blah/
    .git/
  ExtraRepo3/
    .git/
  ExtraRepo4/
    .git/
</pre>
<p>to use <tt class="docutils literal">gitdist</tt> with this aggregate project, one would first set up the file
<tt class="docutils literal"><span class="pre">BaseRepo/.gitdist</span></tt> to contain just:</p>
<pre class="literal-block">
ExtraRepo1
packages/SomePackage/Blah
ExtraRepo3
ExtraRepo4
</pre>
<p>and one would set up the tracked ignore file <tt class="docutils literal"><span class="pre">BaseRepo/.gitignore</span></tt> which
contains the lines:</p>
<pre class="literal-block">
/ExtraRepo1/
/packages/SomePackage/Blah/
/ExtraRepo3/
/ExtraRepo4/
</pre>
<p>Common aggregate commands then run under the <tt class="docutils literal">BaseRepo/</tt> directory are:</p>
<pre class="literal-block">
# See status of all repos at once
gitdist status

# Pull updates to all
gitdist pull

# Push local commits to tracking branches
gitdist push
</pre>
<p>The script <tt class="docutils literal">gitdist</tt> is version controlled in the main TriBIT repo under:</p>
<pre class="literal-block">
common_tools/git/gitdist
</pre>
<p>See <a class="reference internal" href="#gitdist-help">gitdist --help</a> for more details.</p>
<p>The TriBITS approach to managing multiple VC repos described above works well
for order-10 or so VC repos but will not scale well to order-30 or more repos.
For larger numbers of VC repos, one should consider nested integration
creating snapshot git repos (e.g. using the tool <a class="reference internal" href="#snapshot-dir-py">snapshot-dir.py</a>) that
aggregate several related repositories into a single git repo.  Another
approach might be to use git submodules.  However, note that the TriBITS tools
and processes described here are <strong>not</strong> currently set up to support aggregate
VC repos that use git submodules.  The design decision with TriBITS was to
explicitly handle the different git VC repos using <a class="reference internal" href="#gitdist">gitdist</a> and the
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file.  There are advantages
and disadvantages to using git submodules verses explicitly handling the
different git repos currently employed by the TriBITS software development
tools.  It is possible that TriBITS will add support for aggregate git repos
using git submodules but only if there are important projects that choose to
use them.  The discussion of these various approaches and strategies to
dealing with aggregate repos is beyond the scope of this document.</p>
<!-- ToDo: Discuss a repo clone script (once you write it). -->
<!-- ToDo: Discuss how to handle missing packages in upstream repos. -->
</div>
<div class="section" id="development-workflows">
<h1><a class="toc-backref" href="#id53">8&nbsp;&nbsp;&nbsp;Development Workflows</a></h1>
<p>In this section, the typical development workflows for a TriBITS project are
described.  First, the <a class="reference internal" href="#basic-development-workflow">Basic Development Workflow</a> for a single-repository
TriBITS project is described.  This is followed up with a slightly more
complex <a class="reference internal" href="#multi-repository-development-workflow">Multi-Repository Development Workflow</a>.</p>
<div class="section" id="basic-development-workflow">
<h2><a class="toc-backref" href="#id54">8.1&nbsp;&nbsp;&nbsp;Basic Development Workflow</a></h2>
<p>The basic development workflow of a TriBITS project is not much different than
with any other CMake project that uses CTest to define and run tests.  One
pulls updates from the master VC repo then configures with <tt class="docutils literal">cmake</tt>, and
iteratively builds, runs tests, adds files, changes files, does a final test,
then pushes updates.  The major difference is that a well constructed
development process will use the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script to test and push
all changes that affect the build or the tests.  The basic steps in
configuring, building, running tests, etc., are given in the project's
<a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html">&lt;Project&gt;BuildQuickRef</a>. file (see <a class="reference internal" href="#project-specific-build-quick-reference">Project-Specific Build Quick
Reference</a>).</p>
</div>
<div class="section" id="multi-repository-development-workflow">
<h2><a class="toc-backref" href="#id55">8.2&nbsp;&nbsp;&nbsp;Multi-Repository Development Workflow</a></h2>
<p>The development workflow for a project with multiple VC repos is very similar
to a project with just a single VC repo if the project provides a standard
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file.  The major difference
is in making changes, creating commits, etc.  The <a class="reference internal" href="#gitdist">gitdist</a> tool makes these
steps easier and has been shown to work fairly well for up to 20 extra VC
repos (as used in the CASL VERA project).  The <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script
automatically handles all of the details of pulling, diffing, pushing etc. to
all the VC repos.</p>
<!-- ToDo: Discuss usage of 'gitdist' and the rep clone script. -->
</div>
</div>
<div class="section" id="howtos">
<h1><a class="toc-backref" href="#id56">9&nbsp;&nbsp;&nbsp;Howtos</a></h1>
<p>This section provides short, succinct lists of the steps to accomplish a few
common tasks.  Extra details are referenced.</p>
<div class="section" id="how-to-add-a-new-tribits-package">
<h2><a class="toc-backref" href="#id57">9.1&nbsp;&nbsp;&nbsp;How to Add a new TriBITS Package</a></h2>
<p>To add a new TriBITS package, it is recommended to take the template from one
of the <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> packages that most closely fits the needs of
the new package and modify it for the new package.  For example, the files for
the <tt class="docutils literal">SimpleCxx</tt> package can be copied one at a time and modified for the new
package.</p>
<p>To add a new TriBITS package (with no subpackages), do the following:</p>
<ol class="arabic simple">
<li>Chose a name <tt class="docutils literal">&lt;packageName&gt;</tt> for the new package and which TriBITS
repository (<tt class="docutils literal">&lt;repoDir&gt;</tt>) to put the package into.  <strong>WARNING!</strong> The
chosen name <tt class="docutils literal">&lt;packageName&gt;</tt> must be unique across all TriBITS
repositories (see <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS package names</a>).</li>
<li>Create the directory <tt class="docutils literal"><span class="pre">&lt;repoDir&gt;/&lt;packageDir&gt;/</span></tt> for the new package and
put in skeleton files for <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> and
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a>.  Set the desired upstream TPL and SE
package dependencies in the new <tt class="docutils literal">Dependencies.cmake</tt> file but initially
comment out everything in the <tt class="docutils literal">CMakeLists.txt</tt> file except for the
<a class="reference internal" href="#id1">TRIBITS_PACKAGE()</a> and <a class="reference internal" href="#tribits-package-postprocess">TRIBITS_PACKAGE_POSTPROCESS()</a> commands.</li>
<li>Add a row for the new package to the <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file
after all of its upstream dependent packages.  If a mistake is made and it
is listed before one of its upstream dependent packages, the TriBITS CMake
code will catch this and issue an error.</li>
<li>Configure the TriBITS project enabling the new empty package
<tt class="docutils literal">&lt;packageName&gt;</tt>.  This will enable the listed dependencies.</li>
<li>Incrementally fill in the package's <tt class="docutils literal">CMakeLists.txt</tt> files defining
libraries, executables, tests and examples.  The project should be built
and tests run as new pieces are added.</li>
</ol>
<p>Once the new package is defined, downstream SE packages can define
dependencies on this new package.</p>
<!-- ToDo: Expand on the above bullets a lot! -->
</div>
<div class="section" id="how-to-add-a-new-tribits-package-with-subpackages">
<h2><a class="toc-backref" href="#id58">9.2&nbsp;&nbsp;&nbsp;How to Add a new TriBITS Package with Subpackages</a></h2>
<p>Adding a new package with subpackages is similar to adding a new regular
package described in <a class="reference internal" href="#how-to-add-a-new-tribits-package">How to Add a new TriBITS Package</a>.  Again, it is
recommended that one copies an example package from <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>.
For example, one could copy files and directories from the example package
<tt class="docutils literal">WithSubpackages</tt>.</p>
<p>To add a new TriBITS package with packages, do the following:</p>
<ol class="arabic simple">
<li>Chose a name <tt class="docutils literal">&lt;packageName&gt;</tt> for the new package and which TriBITS
repository (<tt class="docutils literal">&lt;repoDir&gt;</tt>) to put the package into.  <strong>WARNING!</strong> The
chosen name <tt class="docutils literal">&lt;packageName&gt;</tt> must be unique across all TriBITS
repositories (see <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS package names</a>).</li>
<li>Create the directory <tt class="docutils literal"><span class="pre">&lt;repoDir&gt;/&lt;packageDir&gt;/</span></tt> for the new package and
put in skeleton files for <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> and
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a>.  Initially don't define any subpackages and
comment out everything in the <tt class="docutils literal">CMakeLists.txt</tt> file except for the
<a class="reference internal" href="#id1">TRIBITS_PACKAGE()</a> and <a class="reference internal" href="#tribits-package-postprocess">TRIBITS_PACKAGE_POSTPROCESS()</a> commands.</li>
<li>Add a new row for the new package to the <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a>
file after all of the upstream dependencies of its to-be-defined
subpackages.</li>
<li>Configure the TriBITS project enabling the new empty package
<tt class="docutils literal">&lt;packageName&gt;</tt>.</li>
<li>Incrementally add the subpackages as described in <a class="reference internal" href="#how-to-add-a-new-tribits-subpackage">How to Add a new TriBITS
Subpackage</a>, filling out the various <tt class="docutils literal">CMakeLists.txt</tt> files defining
libraries, executables, tests and examples.</li>
</ol>
<p>Once the new SE packages are defined, downstream SE packages can define
dependencies on these.</p>
</div>
<div class="section" id="how-to-add-a-new-tribits-subpackage">
<h2><a class="toc-backref" href="#id59">9.3&nbsp;&nbsp;&nbsp;How to Add a new TriBITS Subpackage</a></h2>
<p>Given an existing top-level TriBITS package that is already broken down into
subpackages (see <a class="reference internal" href="#how-to-add-a-new-tribits-package-with-subpackages">How to Add a new TriBITS Package with Subpackages</a>), adding
a new subpackage does not require changing any project-level or
repository-level files.  One only needs to add the declaration for the new
subpackages in its parent's <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file then
fill out the pieces of the new subpackage defined in the section <a class="reference internal" href="#tribits-subpackage-core-files">TriBITS
Subpackage Core Files</a>.  It is recommended to copy files from one of the
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> subpackages in the <tt class="docutils literal">WithSubpackages</tt>
package.</p>
<p>To add a new TriBITS subpackage to a top-level package that already has
subpackages, do the following:</p>
<ol class="arabic simple">
<li>Chose a name <tt class="docutils literal">&lt;spkgName&gt;</tt> for the new subpackage which only has to be
different than the other subpackages in the parent package.  This name gets
appended to the parent package's name <tt class="docutils literal">&lt;packageName&gt;</tt> to form the SE
package name <tt class="docutils literal"><span class="pre">&lt;packageName&gt;&lt;spkgName&gt;</span></tt>.</li>
<li>Create the directory <tt class="docutils literal"><span class="pre">&lt;packageDir&gt;&lt;spkgDir&gt;/</span></tt> for the new package and put
in skeleton files for <a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a>
and <a class="reference internal" href="#packagedir-spkgdir-cmakelists-txt">&lt;packageDir&gt;/&lt;spkgDir&gt;/CMakeLists.txt</a>.  Set the desired upstream TPL
and SE package dependencies in the new <tt class="docutils literal">Dependencies.cmake</tt> file but
initially comment out everything in the <tt class="docutils literal">CMakeLists.txt</tt> file except for
the <a class="reference internal" href="#id3">TRIBITS_SUBPACKAGE()</a> and <a class="reference internal" href="#tribits-subpackage-postprocess">TRIBITS_SUBPACKAGE_POSTPROCESS()</a>
commands.</li>
<li>Add a row for the new subpackage to the argument
<a class="reference internal" href="#subpackages-dirs-classifications-optreqs">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</a> in the macro call
<a class="reference internal" href="#tribits-package-define-dependencies">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a> in the parent package's
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file after all of its upstream
dependent subpackages.  If a mistake is made and it is listed before one of
its upstream dependent subpackages, the TriBITS CMake code will catch this
and issue an error.</li>
<li>Configure the TriBITS project enabling the new empty SE package
<tt class="docutils literal"><span class="pre">&lt;packageName&gt;&lt;spkgName&gt;</span></tt>.  This will enable the listed dependencies.</li>
<li>Incrementally fill in the subpackage's <tt class="docutils literal">CMakeLists.txt</tt> files defining
libraries, executables, tests and examples.  The project should be built
and tests run as new pieces are added.</li>
</ol>
</div>
<div class="section" id="how-to-add-a-new-tribits-tpl">
<h2><a class="toc-backref" href="#id60">9.4&nbsp;&nbsp;&nbsp;How to Add a new TriBITS TPL</a></h2>
<p>In order for an SE package to define a dependency on a new TPL (i.e. one that
has not already been declared in the current repo's or an upstream repo's
<a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file), one must add and modify a few
repository-level files.</p>
<p>To add a new TriBITS TPL, do the following:</p>
<ol class="arabic">
<li><p class="first">Chose a name <tt class="docutils literal">&lt;tplName&gt;</tt> for the new TPL (must be globally unique across
all TriBITS repos, see <a class="reference internal" href="#globally-unique-tribits-tpl-names">Globally unique TriBITS TPL names</a>) and which
TriBITS repository (<tt class="docutils literal">&lt;repoDir&gt;</tt>) to define the new TPL in.  The right
repo is usually the one where the package exists that needs the new TPL
dependency.</p>
</li>
<li><p class="first">Create the TPL find module, e.g. <tt class="docutils literal"><span class="pre">&lt;repoDir&gt;/tpls/FindTPL&lt;tplName&gt;.cmake</span></tt>
(see <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a> and <a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">TRIBITS_TPL_FIND_INCLUDE_DIRS_AND_LIBRARIES()</a> for details).
List the default required header files and/or libraries that must be
provided by the TPL.</p>
</li>
<li><p class="first">Add a row for the new TPL to the <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file after any
TPLs that this new TPL may depend on.</p>
</li>
<li><p class="first">Configure the TriBITS project enabling the new TPL with
<tt class="docutils literal"><span class="pre">TPL_ENABLE_&lt;tplName&gt;=ON</span></tt> and see that the new find module finds the TPL
correctly at configure time.</p>
</li>
<li><p class="first">List the new TPL in the package(s) that need this dependency in the
package's <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file (or
<a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> for a subpackage).</p>
</li>
<li><p class="first">If the TPL is an optional TPL for the package, then:</p>
<pre class="literal-block">
#cmakedefine HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;TPL_NAME_UC&gt;
</pre>
<p>should be added to the package's <tt class="docutils literal">&lt;packageName&gt;_config.h.in</tt> file (see
<a class="reference internal" href="#tribits-configure-file">TRIBITS_CONFIGURE_FILE()</a>) so that the code knows if the TPL is defined
or not.</p>
</li>
<li><p class="first">Use the TPL in the packages that define the dependency on the new TPL,
configure, test, etc.</p>
</li>
</ol>
<!-- ToDo: Provide more details on various things. -->
<!-- ToDo: Add an example of an optional TPL to some TribitsExampleProject -->
<!-- package and refer to it here. -->
</div>
<div class="section" id="how-to-add-a-new-tribits-repository">
<h2><a class="toc-backref" href="#id61">9.5&nbsp;&nbsp;&nbsp;How to Add a new TriBITS Repository</a></h2>
<p>To add a new TriBITS and/ git VC repository to a TriBITS project that already
contains other extra repositories, do the following:</p>
<ol class="arabic simple">
<li>Add a row for the new TriBITS and/or git repo to the file
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a>.  Commit this file.</li>
<li>Add an ignore for the extra repo name to the base project's git repo's
<tt class="docutils literal">.gitignore</tt> file (see <a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a>).  Commit this file.</li>
<li>Set up the new package dependencies for the new package in the new TriBITS
repo or make other adjustments.</li>
<li>Consider the potential for missing upstream repos and packages by using
<a class="reference internal" href="#tribits-allow-missing-external-packages">TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES()</a>.</li>
</ol>
<p>See <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> for more details and
links.</p>
<!-- ToDo: Provide more detail! -->
</div>
<div class="section" id="how-to-add-a-new-tribits-se-package-dependency">
<h2><a class="toc-backref" href="#id62">9.6&nbsp;&nbsp;&nbsp;How to add a new TriBITS SE Package dependency</a></h2>
<p>It is often the case where one will want to add a new dependency for an
existing <a class="reference internal" href="#downstream">downstream</a> package to an existing <a class="reference internal" href="#upstream">upstream</a> <a class="reference internal" href="#tribits-se-package">TriBITS SE
Package</a>.  This can either be a required dependency or an optional
dependency.  Here, we will refer to the downstream SE package as
<tt class="docutils literal">&lt;packageName&gt;</tt> with base directory <tt class="docutils literal">&lt;packageDir&gt;</tt> and will refer to the
upstream package as <tt class="docutils literal">&lt;upstreamPackageName&gt;</tt>.</p>
<p>The process for adding a new dependency to an existing upstream SE package is
as follows:</p>
<ol class="arabic">
<li><p class="first"><strong>Add the name of the upstream package to the downstream package's
Dependencies.cmake file:</strong> Add <tt class="docutils literal">&lt;upstreamPackagename&gt;</tt> to the call of
<a class="reference internal" href="#tribits-package-define-dependencies">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a> in the downstream package's
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file.  If this is to be a required
library dependency, then <tt class="docutils literal">&lt;upstreamPackagename&gt;</tt> is added to the
<tt class="docutils literal">LIB_REQUIRED_PACKAGES</tt> argument.  Alternatively, if this is to be an
optional library dependency, then <tt class="docutils literal">&lt;upstreamPackagename&gt;</tt> is added to the
<tt class="docutils literal">LIB_OPTIONAL_PACKAGES</tt> argument.  (For example, see the file
<tt class="docutils literal">packages/EpetaExt/cmake/Dependencies.cmake</tt> file in the
<a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a> project.)  If only the test and/or example sources,
and not the package's core library sources, will have the required or
optional dependency, then <tt class="docutils literal">&lt;upstreamPackagename&gt;</tt> is added to the
arguments <tt class="docutils literal">TEST_REQUIRED_PACKAGES</tt> or <tt class="docutils literal">TEST_OPTIONAL_PACKAGES</tt>,
respectively.</p>
</li>
<li><p class="first"><strong>For an optional dependency, add `HAVE_` preprocessor macro to the
package's configured header file:</strong> If this is an optional dependency,
typically a C/C++ processor macro will be added to the package's configured
<a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a> file using the line:</p>
<pre class="literal-block">
#cmakedefine HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_PACKAGE_NAME_UC&gt;
</pre>
<p>(see <a class="reference internal" href="#have-package-name-uc-optional-dep-package-name-uc">HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_PACKAGE_NAME_UC&gt;</a>.)</p>
<p id="warning-do-not-add-optional-defines-for-tests-examples-to-configured-header-files"><strong>Warning, do not add optional defines for tests/examples to configured
header files:</strong> If this is a test-only and/or example-only dependency then
please do <strong>not</strong> add a <tt class="docutils literal">#cmakedefine</tt> to the package's core
<a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a> file.  Instead, add the
<tt class="docutils literal">#cmakedefine</tt> line to a configured header that is only included by
sources for the tests/examples or just add a define on the compiler command
line (see the <tt class="docutils literal">DEFINES</tt> argument to <a class="reference internal" href="#tribits-add-library">TRIBITS_ADD_LIBRARY()</a> and
<a class="reference internal" href="#tribits-add-executable">TRIBITS_ADD_EXECUTABLE()</a>, but see the warning about problems with
<tt class="docutils literal">ADD_DEFINITIONS()</tt> in <a class="reference internal" href="#miscellaneous-notes-tribits-add-library">Miscellaneous Notes (TRIBITS_ADD_LIBRARY())</a>).
We don't want the package's header files to change or libraries to have to
be rebuilt if tests/examples get enabled or disabled.  Otherwise, the
<a class="reference internal" href="#tribits-package-by-package-ctest-dash-driver">TriBITS Package-by-Package CTest/Dash Driver</a> process will result in
unnecessary rebuilds of software over and over again.</p>
</li>
<li><p class="first"><strong>Use the features of the upstream package in the source files of the
downstream package sources and/or tests/examples:</strong> Usage of the features
of the upstream package <tt class="docutils literal">&lt;upstreamPackageName&gt;</tt> in the downstream package
<tt class="docutils literal">&lt;packageName&gt;</tt> will typically involve adding <tt class="docutils literal">#include
&lt;upstreamPackageName&gt;_&lt;fileName&gt;</tt> in the package's C/C++ source (or
test/example) files (or the equivalent in Fortran).  If it is an optional
dependency, then these includes will typically be protected using
preprocessor ifdefs, for example, as:</p>
<pre class="literal-block">
#include &quot;&lt;packageName&gt;_config.h&quot;

#if HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_PACKAGE_NAME_UC&gt;
#  include &quot;&lt;upstreamPackageName&gt;_&lt;fileName&gt;&quot;
#endif
</pre>
</li>
</ol>
<blockquote>
<!-- ToDo: Find an example to point to in TribitsExampleProject. -->
</blockquote>
<p>NOTE: TriBITS will automatically add the include directories for the upstream
package to the compile lines for the downstream package source builds and will
add the libraries for the upstream package to the link lines to the downstream
package library and executable links.  See documentation in the functions
<a class="reference internal" href="#tribits-add-library">TRIBITS_ADD_LIBRARY()</a> and <a class="reference internal" href="#tribits-add-executable">TRIBITS_ADD_EXECUTABLE()</a>, and the <tt class="docutils literal">DEPLIBS</tt>
argument to these functions, for more details.</p>
</div>
<div class="section" id="how-to-add-a-new-tribits-tpl-dependency">
<h2><a class="toc-backref" href="#id63">9.7&nbsp;&nbsp;&nbsp;How to add a new TriBITS TPL dependency</a></h2>
<p>It is often the case where one will want to add a new dependency for an
existing <a class="reference internal" href="#downstream">downstream</a> package to an existing <a class="reference internal" href="#upstream">upstream</a> <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>.
This can either be a required dependency or an optional dependency.  Here, we
will refer to the downstream SE package as <tt class="docutils literal">&lt;packageName&gt;</tt> with base
directory <tt class="docutils literal">&lt;packageDir&gt;</tt> and will refer to the upstream TPL as
<tt class="docutils literal">&lt;tplName&gt;</tt>.</p>
<p>The process for adding a new dependency to an existing upstream TPL is as
follows:</p>
<ol class="arabic">
<li><p class="first"><strong>Add the name of the upstream TPL to the downstream package's
Dependencies.cmake file:</strong> Add <tt class="docutils literal">&lt;tplName&gt;</tt> to the call of
<a class="reference internal" href="#tribits-package-define-dependencies">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a> in the downstream package's
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file.  If this is to be a required
library dependency, then <tt class="docutils literal">&lt;tplName&gt;</tt> is added to the
<tt class="docutils literal">LIB_REQUIRED_TPLs</tt> argument.  Alternatively, if this is to be an
optional library dependency, then <tt class="docutils literal">&lt;tplName&gt;</tt> is added to the
<tt class="docutils literal">LIB_OPTIONAL_TPL</tt> argument.  (For example, see the file
<tt class="docutils literal">packages/Teuchos/cmake/Dependencies.cmake</tt> file in the
<a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a> project.)  If only the test and/or example sources,
and not the package's core library sources, will have the required or
optional dependency, then <tt class="docutils literal">&lt;tplName&gt;</tt> is added to the arguments
<tt class="docutils literal">TEST_REQUIRED_TPLs</tt> or <tt class="docutils literal">TEST_OPTIONAL_TPLS</tt>, respectively.</p>
</li>
<li><p class="first"><strong>For an optional dependency, add `HAVE_` preprocessor macro to the
package's configured header file:</strong> If this is an optional dependency,
typically a C/C++ processor macro will be added to the package's configured
<a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a> file using the line:</p>
<pre class="literal-block">
#cmakedefine HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_TPL_NAME_UC&gt;
</pre>
<p>(see <a class="reference internal" href="#have-package-name-uc-optional-dep-tpl-name-uc">HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_TPL_NAME_UC&gt;</a>.)</p>
<p><strong>WARNING:</strong> If this is a test-only and/or example-only dependency then
please do <strong>not</strong> add a <tt class="docutils literal">#cmakedefine</tt> to the package's core
<a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a> file.  See <a class="reference internal" href="#warning-do-not-add-optional-defines-for-tests-examples-to-configured-header-files">Warning, do not
add optional defines for tests/examples to configured header files</a>.</p>
</li>
<li><p class="first"><strong>Use the features of the upstream TPL in the source files of the
downstream package sources and/or tests/examples:</strong> Usage of the features
of the upstream package <tt class="docutils literal">&lt;tplName&gt;</tt> in the downstream package
<tt class="docutils literal">&lt;packageName&gt;</tt> will typically involve adding <tt class="docutils literal">#include
&lt;tplName&gt;_&lt;fileName&gt;</tt> in the package's C/C++ source (or test/example)
files (or the equivalent in Fortran).  If it is an optional dependency,
then these includes will typically be protected using preprocessor ifdefs,
for example, as:</p>
<pre class="literal-block">
#include &quot;&lt;packageName&gt;_config.h&quot;

#if HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_TPL_NAME_UC&gt;
#  include &quot;&lt;upstreamPackageName&gt;_&lt;fileName&gt;&quot;
#endif
</pre>
</li>
</ol>
<blockquote>
<!-- ToDo: Find an example to point to in TribitsExampleProject. -->
</blockquote>
<p>NOTE: TriBITS will automatically add the include directories for the upstream
TPL to the compile lines for the downstream package source builds and will add
the libraries for the upstream TPL to the link lines to the downstream package
library and executable links.  See documentation in the functions
<a class="reference internal" href="#tribits-add-library">TRIBITS_ADD_LIBRARY()</a> and <a class="reference internal" href="#tribits-add-executable">TRIBITS_ADD_EXECUTABLE()</a>, and the <tt class="docutils literal">DEPLIBS</tt>
argument to these functions, for more details.</p>
</div>
<div class="section" id="how-to-insert-a-package-into-an-upstream-repo">
<h2><a class="toc-backref" href="#id64">9.8&nbsp;&nbsp;&nbsp;How to insert a package into an upstream repo</a></h2>
<p>Sometimes it is desired to insert a package from a downstream VC repo into an
upstream <a class="reference internal" href="#tribits-repository">TriBITS Repository</a> in order for one or more packages in the
upstream repo to define a dependency on that package.  The way this is
supported in TriBITS is to just list the inserted package into the
<tt class="docutils literal">PackagesList.cmake</tt> file of the upstream TriBITS repo after the packages it
depends on and before the packages that will use it then call the
<a class="reference internal" href="#tribits-allow-missing-external-packages">TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES()</a> function to allow the package to
be missing.  This is demonstrated in <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> with the package
<tt class="docutils literal">ExternalPkg</tt> which is <strong>not</strong> included in the default
<tt class="docutils literal">TribitsExampleProject</tt> source tree.  The
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<tt class="docutils literal">PackagesList.cmake</tt> file looks like:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_PACKAGES(
  SimpleCxx          packages/simple_cxx         PT
  MixedLang          packages/mixed_lang         PT
  ExternalPkg        ExternalPkg                 ST
  WithSubpackages    packages/with_subpackages   PT
  WrapExternal       packages/wrap_external      ST
  )

TRIBITS_DISABLE_PACKAGE_ON_PLATFORMS(WrapExternal Windows)
TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES(ExternalPkg)

</pre>
<p>In this example, the subpackage <tt class="docutils literal">ExternalPkg</tt> has a required dependency on
<tt class="docutils literal">SimpleCxx</tt> and <tt class="docutils literal">WithSubpackagesB</tt> has an optional dependency on
<tt class="docutils literal">ExternalPkg</tt>.  Therefore, the inserted package <tt class="docutils literal">ExternalPkg</tt> has upstream
and downstream dependencies.</p>
<p>What the function <tt class="docutils literal">TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES()</tt> does is to
tell TriBITS to treat <tt class="docutils literal">ExternalPkg</tt> the same as any other package if the
directory <tt class="docutils literal">TribitsExampleProject/ExternalPkg</tt> exists and to otherwise
complete ignore the package <tt class="docutils literal">ExternalPkg</tt> if the source for the package does
not exist.  In addition, TriBITS will automatically disable of all downstream
package dependencies for the missing package.</p>
<p>The way one would set up <tt class="docutils literal">TribitsExampleProject</tt> to enable <tt class="docutils literal">ExternalPkg</tt>,
if these were in separate VC (e.g. git) repos for example, would be to do:</p>
<pre class="literal-block">
$ git clone &lt;some-url-base&gt;/TribitsExampleProject
$ cd TribitsExampleProject
$ git clone &lt;some-other-url-base&gt;/ExteranlPkg
$ echo /ExternalPkg/ &gt;&gt; .git/info/excludes
</pre>
<p>Then, when you configure <tt class="docutils literal">TribitsExampleProject</tt>, the package
<tt class="docutils literal">ExternalPkg</tt> would automatically appear and could then be enabled or
disabled like any other TriBITS package.  The TriBITS test
<tt class="docutils literal">Tribits_TribitsExampleProject_ExternalPkg</tt> demonstrates this.</p>
<p>Assuming that one would put the (new) external package in a separate VC repo,
one would perform the following steps:</p>
<ol class="arabic simple">
<li>Pick a name for the new inserted external package <tt class="docutils literal">&lt;insertedPackageName&gt;</tt>
(see <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS package names</a>).  (NOTE: The external
package may already exist in which case the name would already be
selected).</li>
<li>Create a new VC repo containing the new package <tt class="docutils literal">&lt;insertedPackageName&gt;</tt>
or add it to an existing extra VC repo. (Or, add the new package to an
existing downstream repo but don't add it to the <tt class="docutils literal">PackagesList.cmake</tt>
file to downstream repo.  That would define the package twice!)</li>
<li>Clone the downstream VC repo under the upstream TriBITS repository.  (This
is currently needed since TriBITS only allows package dirs to be contained
under the repository directory.)</li>
<li>Insert the package into the <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file as
described in <a class="reference internal" href="#how-to-add-a-new-tribits-package">How to Add a new TriBITS Package</a> except one must also call
<tt class="docutils literal"><span class="pre">TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES(&lt;insertedPackageName&gt;)</span></tt> as
described above.</li>
<li>Flesh out the new package and use it in downstream SE packages just like it
was any other package.  But note that any downstream SE package that has a
required dependency on <tt class="docutils literal">&lt;insertedPackageName&gt;</tt> will always be hard
disabled when the source for <tt class="docutils literal">&lt;insertedPackageName&gt;</tt> is missing.</li>
<li>When configuring and building to get the package working, add
<tt class="docutils literal"><span class="pre">-D&lt;insertedPackageName&gt;_ALLOW_MISSING_EXTERNAL_PACKAGE=FALSE</span></tt> so that
TriBITS will catch mistakes in specifying the package directory.</li>
</ol>
</div>
</div>
<div class="section" id="additional-topics">
<h1><a class="toc-backref" href="#id65">10&nbsp;&nbsp;&nbsp;Additional Topics</a></h1>
<p>In this section, a number of miscellaneous topics and TriBITS features are
discussed.  These features and topics are either not considered primary
features of TriBITS (but can be very useful in many situations) or don't neatly
fit into one of the other sections.</p>
<div class="section" id="tribits-system-project-dependencies">
<h2><a class="toc-backref" href="#id66">10.1&nbsp;&nbsp;&nbsp;TriBITS System Project Dependencies</a></h2>
<p>The basic TriBITS system itself which is used to configure, built, test,
create tarballs, and install software has no dependencies other than a basic
installation of CMake (which typically includes the executables <tt class="docutils literal">cmake</tt>,
<tt class="docutils literal">ctest</tt>, and <tt class="docutils literal">cpack</tt>).  Great effort has been expended to implement all of
the core functionality of TriBITS just using raw CMake.  That means that
anyone who needs to configure, build, and install software that uses TriBITS
just needs a compatible CMake implementation.  CMake is becoming iniquitous
enough that many clients will already have a current-enough version of CMake
installed by default on their systems and will therefore not need to download
or install any extra software when building and installing a project that uses
TriBITS (assuming the necessary compilers etc. required by the project are
also installed).  If a current-enough version of CMake is not installed on a
given system, it is easy to download the source code and all it needs is a
basic C++ compiler to build and install.</p>
<p>However, note that a specific TriBITS project is free to use any newer CMake
features it wants and therefore these projects will require newer versions of
CMake than what is required by TriBITS (see discussion of
<tt class="docutils literal">CMAKE_MINIMUM_REQUIRED()</tt> in <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a>).  But also
note that specific TriBITS projects and packages will also require additional
tools like compilers, Python, Perl, or many other such dependencies.  It is
just that TriBITS itself does not require any of these in order to perform the
basic configure, build, test, and install of software.  The goal of TriBITS is
not to make the portability of software that uses it any worse than it already
is but instead to make it easier in most cases (that after all is the whole
goal of CMake).</p>
<p>While the core TriBITS functionality to configure, build, test, and install
software is written using only raw CMake, the more sophisticated development
tools needed to implement the full TriBITS development environment require
Python 2.4 (or higher, but not Python 3.x).  Python is needed for tools like
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> and <a class="reference internal" href="#gitdist">gitdist</a>.  In addition, these python tools are used in
<a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a> to drive automated testing and submits to CDash.
Also not that git is the chosen version control tool for the TriBITS software
development tools and all the VC-related functionality in TriBITS.  But none
of this is required for doing the most basic building, testing, or
installation of a project using TriBITS.</p>
</div>
<div class="section" id="project-specific-build-quick-reference">
<h2><a class="toc-backref" href="#id67">10.2&nbsp;&nbsp;&nbsp;Project-Specific Build Quick Reference</a></h2>
<p>If a project that uses TriBITS is going to have a significant user base that
will configure, build, and test the project, then having some documentation
that explains how to do this would be useful.  For this purpose, TriBITS
provides a mechanism to quickly create a project-specific build quick
reference document in restructured text (RST) format and with HTML and
LaTeX/PDF outputs.  This document are generally created in the base project
source tree and given then name <tt class="docutils literal"><span class="pre">&lt;Project&gt;BuildQuickRef.[rst,html,pdf]</span></tt>.
This document consists of two parts.  One part is a generic template
document:</p>
<pre class="literal-block">
tribits/doc/build_quick_ref/TribitsBuildQuickRefBody.rst
</pre>
<p>provided in the TriBITS source tree that uses the place-holder <tt class="docutils literal">&lt;Project&gt;</tt>
for the for the real project name.  The second part is a project-specific
template file:</p>
<pre class="literal-block">
&lt;projectDir&gt;/cmake/&lt;Project&gt;BuildQuickRefTemplate.rst
</pre>
<p>which provides the outer RST document (with title, authors, abstract,
introduction, other introductory sections).  From these two files, the
script:</p>
<pre class="literal-block">
tribits/doc/build_quick_ref/create-project-build-quickref.py
</pre>
<p>is used to replace <tt class="docutils literal">&lt;Project&gt;</tt> in the <tt class="docutils literal">TribitsBuildQuickRefBody.rst</tt> file
with the real project name (read from the project's <tt class="docutils literal">ProjectName.cmake</tt> file
by default) and then generates the read-only files:</p>
<pre class="literal-block">
&lt;projectDir&gt;/
  &lt;Project&gt;BuildQuickRef.rst
  &lt;Project&gt;BuildQuickRef.html
  &lt;Project&gt;BuildQuickRef.pdf
</pre>
<p>For a simple example of this, see:</p>
<pre class="literal-block">
tribits/doc/examples/TribitsExampleProject/cmake/create-build-quickref.sh
</pre>
<p>A project-independent version of this file is provided in the
<a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html">TribitsBuildQuickRef</a>.[rst,html,pdf] which is referred to many times in this
developers guide.</p>
</div>
<div class="section" id="project-and-repository-versioning-and-release-mode">
<h2><a class="toc-backref" href="#id68">10.3&nbsp;&nbsp;&nbsp;Project and Repository Versioning and Release Mode</a></h2>
<p>TriBITS has built-in support for project and repository versioning and
release-mode control.  When the project contains the file
<a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a>, it is used to define the project's official
version.  The idea is that when it is time to branch for a release, the only
file that needs to be changed is the file <a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a>.</p>
<p>Each TriBITS repository can also contain a <a class="reference internal" href="#repodir-version-cmake">&lt;repoDir&gt;/Version.cmake</a> file
that sets version-related variables which TriBITS packages in that repository
can use to derive development and release version information.  If the TriBITS
repository also contains a <a class="reference internal" href="#repodir-copyright-txt">&lt;repoDir&gt;/Copyright.txt</a> file, then the
information in <tt class="docutils literal"><span class="pre">&lt;repoDir&gt;/Version.cmake</span></tt> and <tt class="docutils literal"><span class="pre">&lt;repoDir&gt;/Copyright.txt</span></tt> are
used to configure a repository version header file:</p>
<pre class="literal-block">
${${REPOSITORY_NAME}_BINARY_DIR}/${REPOSITORY_NAME}_version.h
</pre>
<p>The configured header file <tt class="docutils literal">${REPOSITORY_NAME}_version.h</tt> defines C
pre-processor macros that give the repository version number in several
formats, which allows C/C++ code (or any software that uses the C
preprocessor) to write conditional code like:</p>
<pre class="literal-block">
#if Trilinos_MAJOR_MINOR_VERSION &gt; 100200
  /* Contains feature X */
  ...
#else
  /* Does not contain feature X */
  ...
#endif
</pre>
<p>Of course when the TriBITS project and the TriBITS repository are the same
directory, the <tt class="docutils literal"><span class="pre">&lt;projectDir&gt;/Version.cmake</span></tt> and <tt class="docutils literal"><span class="pre">&lt;repoDir&gt;/Version.cmake</span></tt>
files are the same file, which works just fine.</p>
</div>
<div class="section" id="tribits-environment-probing-and-setup">
<h2><a class="toc-backref" href="#id69">10.4&nbsp;&nbsp;&nbsp;TriBITS Environment Probing and Setup</a></h2>
<p>Part of the TriBITS Framework is to probe the environment, set up the
compilers, and get ready to compile code.  This was mentioned in <a class="reference internal" href="#full-processing-of-tribits-project-files">Full
Processing of TriBITS Project Files</a>.  This is executed by the TriBITS macro
<tt class="docutils literal">TRIBITS_SETUP_ENV()</tt>.  Some of to things this macro does are:</p>
<p id="probe-and-set-up-the-environment"><strong>Probe and set up the environment:</strong></p>
<ul class="simple">
<li>Set <tt class="docutils literal">CMAKE_BUILD_TYPE</tt></li>
<li>Set up for MPI (MPI compilers, etc.)</li>
<li>Set up C, C++, and Fortran compilers</li>
<li>Find Perl (sets <tt class="docutils literal">PERL_EXECUTABLE</tt>)</li>
<li>Determine mixed language C/Fortran linking</li>
<li>Set up C++11, OpenMP, and Windows support</li>
<li>Find Doxygen (sets <tt class="docutils literal">DOXYGEN_EXECUTABLE</tt>)</li>
<li>Perform some other configure-time tests (see <tt class="docutils literal">cmake</tt> output)</li>
</ul>
<p>At the completion of this part of the processing, the TriBITS CMake project is
ready to compile code.  All of the major variables set as part of this process
are printed to the <tt class="docutils literal">cmake</tt> stdout.</p>
</div>
<div class="section" id="configure-time-system-tests">
<h2><a class="toc-backref" href="#id70">10.5&nbsp;&nbsp;&nbsp;Configure-time System Tests</a></h2>
<p>CMake has good support for defining configure-time checks of the system to
help in configuring the project.  One can check for whether a header file
exists, if the compiler supports a given data-type or language feature, or
perform almost any other type of check that one can imagine that can be done
using the configured compilers, libraries, system tools, etc.  An example was
given in <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>.  Just follow that example, look at some of
the built-in CMake configure-time test modules, and consult provided on-line
CMake documentation in order to learn how to create a configure-time test for
almost anything.</p>
<!-- ToDo: Provide more detail how to integrate a configure-time test into a -->
<!-- TriBITS project and TriBITS package. -->
</div>
<div class="section" id="creating-source-distributions">
<h2><a class="toc-backref" href="#id71">10.6&nbsp;&nbsp;&nbsp;Creating Source Distributions</a></h2>
<p>The TriBITS system uses CMake's built-in CPack support to create source
distributions in a variety of zipped and tarred formats.  (Note that the term
&quot;source tarball&quot; or just &quot;tarball&quot; may be used below but should be interpreted
as &quot;source distribution&quot;.)  TriBITS will automatically add support for CPack
when the variable <a class="reference internal" href="#project-name-enable-cpack-packaging">${PROJECT_NAME}_ENABLE_CPACK_PACKAGING</a> is set to <tt class="docutils literal">ON</tt>.
The commands for creating a source distribution are described in <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#creating-a-tarball-of-the-source-tree">Creating a
tarball of the source tree</a> using the built-in <tt class="docutils literal">package_source</tt> build
target. The value added by TriBITS is that TriBITS will automatically exclude
the source for any defined packages that are not enabled and TriBITS provides
a framework for systematically excluded files and directories from individual
repositories and packages.  In addition, the source for non-enabled
subpackages can also be excluded depending on the value of
<a class="reference internal" href="#project-name-exclude-disabled-subpackages-from-distribution">${PROJECT_NAME}_EXCLUDE_DISABLED_SUBPACKAGES_FROM_DISTRIBUTION</a>.  All of
this allows one to create distributions which only includes subsets of a
larger project (even a single package in some cases).</p>
<p>Unlike other build systems (like autotools), CMake will put <strong>EVERYTHING</strong>
into the source distribution (e.g. tarball) that it sitting in the source tree
by default.  Therefore, setting up for a source distribution usually means
deciding what extra files and directories should be excluded.  Beyond the
directories for non-enabled packages, further files can be selected to be
excluded on a package-by-package based and at the repository level (see
below).</p>
<p>Individual packages can list additional files/directories under the package's
source tree to be excluded from the project's source distribution using a call
to <a class="reference internal" href="#tribits-exclude-files">TRIBITS_EXCLUDE_FILES()</a> in their <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file.
Note that if the package is not enabled, these excludes will never get added!
That is no problem if these excludes only apply to the given package since
TriBITS will add an exclude for the entire package but is a problem if a
package lists excludes for files outside of the package's source tree.</p>
<p>Additional files and entire directories can also be excluded at the repository
level by listing them in the
<a class="reference internal" href="#repodir-cmake-callbackdefinerepositorypackaging-cmake">&lt;repoDir&gt;/cmake/CallbackDefineRepositoryPackaging.cmake</a> file which
typically just appends the built-in CMake variable
<tt class="docutils literal">CPACK_SOURCE_IGNORE_FILES</tt>.  However, if a repository is not processed,
this file is never processed and therefore no files will be excluded from a
repository sitting in the source tree that is not processed (see below).</p>
<p>There are a number of project-level settings that need to be defined and these
are specified in the file
<a class="reference internal" href="#projectdir-cmake-callbackdefineprojectpackaging-cmake">&lt;projectDir&gt;/cmake/CallbackDefineProjectPackaging.cmake</a>.</p>
<p>The <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> is set up for creating source distributions and
this is demonstrated in one of the tests defined in:</p>
<pre class="literal-block">
tribits/doc/examples/UnitTests/CMakeLists.txt
</pre>
<p>There are a few points of caution to note about creating source distributions.</p>
<p><strong>NOTE:</strong> It is worth stressing again that <strong>EVERY</strong> file that is in the
source tree will be included in the source distribution (tarball) unless there
is an exclude regex matching it appended to the variable
<tt class="docutils literal">CPACK_SOURCE_IGNORE_FILES</tt>.  TriBITS can only add excludes for defined
non-enabled packaged.  Every other file listed in the source tree will be
included in the tarball.</p>
<p><strong>NOTE:</strong> The entries in <tt class="docutils literal">CPACK_SOURCE_IGNORE_FILES</tt> are interpreted as
<strong>REGULAR EXPRESSIONS</strong> not globs so if you add <tt class="docutils literal"><span class="pre">&quot;someFile.*&quot;</span></tt> as an
exclude, it will exclude every file in the entire source tree that has
<tt class="docutils literal">&quot;someFile&quot;</tt> in the name!  This is because, in regex terminology, the
trailing <tt class="docutils literal"><span class="pre">&quot;.*&quot;</span></tt> means &quot;match any character zero or more times&quot; and
<tt class="docutils literal">&quot;someFile&quot;</tt> can match anywhere in the file name path.  Also, note that if
you add in an exclude like <tt class="docutils literal"><span class="pre">&quot;*.pyc&quot;</span></tt> (i.e. trying to exclude all of the
generated Python bite code files) that it will exclude every file that has
<tt class="docutils literal">&quot;pyc&quot;</tt> in the name and <strong>not</strong> just those with the file extension
<tt class="docutils literal">&quot;pyc&quot;</tt>.  For example, the exclude <tt class="docutils literal">&quot;.pyc&quot;</tt> would exclude the files
<tt class="docutils literal">&quot;puppyc&quot;</tt>, <tt class="docutils literal">&quot;lpycso&quot;</tt>, etc.  If you want to exclude all files with
extension <tt class="docutils literal">&quot;pyc&quot;</tt>, you have to add the exclude regex <tt class="docutils literal"><span class="pre">&quot;.*[.]pyc$&quot;</span></tt>!  One's
lack of understanding of this fact will cost someone hours of lost time
debugging what happens when random files are missing when one tries to
configure what is left.  Somethings, what is left will actually configure and
might almost build!</p>
<p><strong>NOTE:</strong> Extra repositories that are sitting in the source tree but not
processed by TriBITS for some reason (e.g. due to explicitly listing in the
variable <a class="reference internal" href="#project-name-extra-repositories">${PROJECT_NAME}_EXTRA_REPOSITORIES</a> only a subset of the repositories
listed in <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> ) will get added
to the source distribution in full by default even though there are no enabled
packages from these repos.  These non-processed repo dirs are like any other
random directory sitting in the source tree, they will get copied over into
the source distribution!.</p>
<p><strong>NOTE:</strong> When debugging tarball creation problems, always configure with the
variable <tt class="docutils literal">&lt;Project&gt;_DUMP_CPACK_SOURCE_IGNORE_FILES=ON</tt>.  If you don't see a
regex listed for the file or directory you expect to be excluded, then that
file/directory it will be included in the source distribution!</p>
</div>
<div class="section" id="multi-repository-almost-continuous-integration">
<h2><a class="toc-backref" href="#id72">10.7&nbsp;&nbsp;&nbsp;Multi-Repository Almost Continuous Integration</a></h2>
<p>The <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script can be used to the implement staged integration
of the various repositories in a multi-repo TriBITS project (see
<a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a>) .  This is referred to here as Almost Continuous
Integration (ACI).  The basic concept of Almost Continuous Integration (ACI)
is defined and described in the paper [<a class="reference internal" href="#integration-strategies-for-cse-2009">Integration Strategies for CSE,
2009</a>].</p>
<p>This topic is broken down into the following subsections:</p>
<ul class="simple">
<li><a class="reference internal" href="#aci-multi-git-tribits-repo-integration-example">ACI Multi-Git/TriBITS Repo Integration Example</a></li>
<li><a class="reference internal" href="#aci-local-sync-git-repo-setup">ACI Local Sync Git Repo Setup</a></li>
<li><a class="reference internal" href="#aci-integration-build-directory-setup">ACI Integration Build Directory Setup</a></li>
<li><a class="reference internal" href="#aci-sync-driver-script">ACI Sync Driver Script</a></li>
<li><a class="reference internal" href="#aci-cron-job-setup">ACI Cron Job Setup</a></li>
<li><a class="reference internal" href="#addressing-aci-failures-and-summary">Addressing ACI Failures and Summary</a></li>
</ul>
<div class="section" id="aci-introduction">
<h3><a class="toc-backref" href="#id73">ACI Introduction</a></h3>
<p>The TriBITS system allows for setting up composite meta-builds of large
collections of software pulled in from many different git/TriBITS code
repositories as described in the section <a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a>.  The
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script is a key tool to enable the testing of a set of
packages in different git/TriBITS repos before pushing to remote tracking
branches for the set of git repos; all in one robust command invocation.</p>
<p>While the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script was originally designed and its default
behavior is to test a set of local commits created by a developer before
pushing changes to one or more (public) git repos, it can also be used to set
up an Almost Continuous Integration (ACI) process to keep these various
git/TriBITS repos in sync thereby integrating the work of various disconnected
development teams and projects.  To use the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script for ACI
requires some setup and changing what the script does a little by passing in
additional options that a regular developer typically never uses.</p>
<p>The following subsections describe how to use the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script to
implement an ACI process for a given set of git/TriBITS repositories and also
provides a little background and context behind ACI.</p>
</div>
<div class="section" id="aci-multi-git-tribits-repo-integration-example">
<h3><a class="toc-backref" href="#id74">ACI Multi-Git/TriBITS Repo Integration Example</a></h3>
<p>In order to set up the context for the ACI process, consider the following
simple TriBITS project with two extra repositories:</p>
<pre class="literal-block">
BaseProj/
    ExtraRepo1
    ExtraRepo2
</pre>
<p>Here, <tt class="docutils literal">BaseProj</tt> is the base TriBITS project/repository and <tt class="docutils literal">ExtraRepo1</tt>
and <tt class="docutils literal">ExtraRepo2</tt> are extra repositories that supply additional TriBITS
packages that are appended to the TriBITS packages defined in <tt class="docutils literal">BaseProj</tt>
(see <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a>).  Also, assume that
<tt class="docutils literal">BaseProj</tt>, <tt class="docutils literal">ExtraRepo1</tt>, and <tt class="docutils literal">ExtraRepo2</tt> are developed by three
different development teams that all have different funding sources and
different priorities so they tend not to work closely together or consider the
other efforts too much when developing their software.  However, in this
example, there is great value in combining all of this software into a single
integrated TriBITS meta-project.  This combined meta-build is driven by a 4th
integration/development team.  In this case, the core developers for each of
these three different git/TriBITS repos do not test compatibility with the
other git/TriBITS repos when pushing commits to their own git/TriBITS repos.
This gives three different git repos on three different machines:</p>
<ul>
<li><p class="first"><tt class="docutils literal">BaseProj</tt> main repo:  Pushed to by the core BaseProj team:</p>
<pre class="literal-block">
url1.gov:/git/BaseProj
</pre>
</li>
<li><p class="first"><tt class="docutils literal">ExtraRepo1</tt> main repo:  Pushed to by the core ExtraRepo1 team:</p>
<pre class="literal-block">
url2.gov:/git/ExtraRepo1
</pre>
</li>
<li><p class="first"><tt class="docutils literal">ExtraRepo2</tt> main repo:  Pushed to by the core ExtraRepo2 team:</p>
<pre class="literal-block">
url3.gov:/git/ExtraRepo2
</pre>
</li>
</ul>
<p>Because of the independent development processes of these three teams, unless
these development teams maintain 100% backward compatibility w.r.t. the
interfaces and behavior of the combined software, one cannot expect at any
time to be able to pull the code from these three different git repos and be
able to successfully build all of the code and have all of the tests pass.
Therefore, how does the 4th integration team expect to be able to build, test,
and possibly extend the combined software?  In this case, the integration team
would set up their own clones of all three git/TriBITS repos on their own
machine such as:</p>
<p><strong>Integration project mirrored git repos</strong>:</p>
<pre class="literal-block">
url4.gov:/git/BaseProj
url4.gov:/git/ExtraRepo1
url4.gov:/git/ExtraRepo2
</pre>
<p>Once an initial collaboration effort between the integration team and the
three other development teams is able to get a version of all three
git/TriBITS repos to work correctly in the combined meta-project, these
versions (assume the master branches) would be pushed to the git repos on the
git integration server <tt class="docutils literal">url4.gov</tt>.  The state where the TriBITS packages in
the three different git/TriBITS repos in the master branch on <tt class="docutils literal">url4.gov</tt> all
work together correctly constitutes the initial condition for the ACI process
described below.  From that initial condition, the ACI processes ensures that
updates the master branches for the git/TriBITS repos on <tt class="docutils literal">url4.gov</tt> do not
break any builds or tests of the integrated software.</p>
<p>In order to describe how to set up an ACI process using the
<tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script, the following subsections will focus on the update
of the git/TriBITS <tt class="docutils literal">ExtraRepo1</tt> repo keeping the other two git/TriBITS repos
<tt class="docutils literal">BaseProj</tt> and <tt class="docutils literal">ExtraRepo2</tt> constant as the ACI use case.</p>
</div>
<div class="section" id="aci-local-sync-git-repo-setup">
<h3><a class="toc-backref" href="#id75">ACI Local Sync Git Repo Setup</a></h3>
<p>In order to set up an ACI process for the multi-git/TriBITS repo example
outlined above, first local repos are created by cloning the repos on the
integration server url4.gov as follows (all of which become 'origin'):</p>
<pre class="literal-block">
$ cd $SYNC_BASE_DIR
$ git clone url4.gov:/git/BaseProj
$ cd BaseProj
$ git clone url4.gov:/git/ExtraRepo1
$ git clone url4.gov:/git/ExtraRepo2
</pre>
<p>where, <tt class="docutils literal"><span class="pre">SYNC_BASE_DIR=~/sync_base_dir</span></tt> for example, which must already be
created.</p>
<p>An <tt class="docutils literal">.gitdist</tt> file can be created to aid in multi-repo git commands using the
tool <a class="reference internal" href="#gitdist">gitdist</a>.  This file is located in the <tt class="docutils literal">BaseProj</tt> directory and can be
created as:</p>
<pre class="literal-block">
$ cd $SYNC_BASE_DIR/BaseProj
$ echo ExtraRepo1 &gt; .gitdist
$ echo ExtraRepo2 &gt;&gt; .gitdist
$ cat .gitdist
ExtraRepo1
ExtraRepo2
</pre>
<p>Next, the remotes that define the integration pattern are created as follows:</p>
<pre class="literal-block">
$ cd $SYNC_BASE_DIR/BaseProj
$ git remote add integrate-from url4.gov:/git/BaseProj
$ cd ExtraRepo1
$ git remote add integrate-from url2.gov:/git/ExtraRepo1
$ cd ..
$ cd ExtraRepo2
$ git remote add integrate-from url4.gov:/git/ExtraRepo2
$ cd ..
</pre>
<!-- ToDo: It would be great the create a remote for only ExtraRepo1 and pass in -->
<!-- - -extra-pull-from=ExtraRepo1:integrate-from:master.  This would avoid the -->
<!-- other dummy ' integrate-from' remotes. -->
<p>This gives the remotes:</p>
<pre class="literal-block">
$ cd $SYNC_BASE_DIR/BaseProj
$ gitdist remote -v | grep -v push | grep -v &quot;^$&quot;
*** Base Git Repo: BaseProj
origin                url4.gov:/git/BaseProj (fetch)
integrate-from        url4.gov:/git/BaseProj (fetch)
*** Git Repo: ExtraRepo1
origin                url4.gov:/git/ExtraRepo1 (fetch)
integrate-from        url2.gov:/git/ExtraRepo1 (fetch)
*** Git Repo: ExtraRepo2
origin                url4.gov:/git/ExtraRepo2 (fetch)
integrate-from        url4.gov:/git/ExtraRepo2 (fetch)
</pre>
<p>The remote <tt class="docutils literal"><span class="pre">integrate-from</span></tt> is used by the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> wrapper
script (see below) to pull and merge in additional changes that will be tested
and pushed to the 'origin' repos on <tt class="docutils literal">url4.gov</tt>.  In this case, the
<tt class="docutils literal">BaseProj</tt> and <tt class="docutils literal">ExtraRepo2</tt> repos have the remote <tt class="docutils literal"><span class="pre">integrate-from</span></tt> that
points to the same repos as 'origin' (and will therefore not result in any
merging) but the <tt class="docutils literal">ExtraRepo1</tt> remote <tt class="docutils literal"><span class="pre">integrate-from</span></tt> will result in
updates being pulled from the main development repo on <tt class="docutils literal">url2.gov</tt>, thereby
facilitating the update of <tt class="docutils literal">ExtraRepo1</tt> in the integrated meta-project.</p>
</div>
<div class="section" id="aci-integration-build-directory-setup">
<h3><a class="toc-backref" href="#id76">ACI Integration Build Directory Setup</a></h3>
<p>After the git repos are cloned and the remotes are set up, a build base
directory is set up as:</p>
<pre class="literal-block">
$ cd $SYNC_BASE_DIR
$ mkdir BUILDS
$ mkdir BUILDS/CHECKIN
</pre>
<p>An ACI wrapper script for <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> is created to drive the clones.
It is assumed that this script would be called only once a day and not
continuously in a loop (but that is possible as well but is not documented
here).</p>
<p>NOTE: Other build directory structures are possible, it all depends how one
writes the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> wrapper scripts but the above directory
structure is fairly standard in the usage of the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script.</p>
</div>
<div class="section" id="aci-sync-driver-script">
<h3><a class="toc-backref" href="#id77">ACI Sync Driver Script</a></h3>
<p>The sync driver script for this example should be called something like
<tt class="docutils literal">sync_ExtraRepo1.sh</tt>, placed under version control, and would look something
like:</p>
<pre class="literal-block">
#!/bin/bash -e

EXTRA_ARGS=$&#64;

# Set up the environment (i.e. PATH; needed for cron jobs)
...

SYNC_BASE_DIR=~/sync_base_dir
CHECKIN_TEST_WRAPPER=$SYNC_BASE_DIR/BaseProj/sampleScripts/checkin-test-foo.sh

cd $SYNC_BASE_DIR/BUILDS/CHECKIN

$CHECKIN_TEST_WRAPPER \
  --extra-pull-from=integrate-from:master \
  --abort-gracefully-if-no-changes-to-push \
  --send-email-to=base-proj-integrators&#64;url4.gov \
  --send-email-to-on-push=base-proj-integrators&#64;url4.gov \
  --no-append-test-results --no-rebase \
  --do-all --push \
  -j16 \
  --wipe-clean \
  $EXTRA_ARGS
</pre>
<p>NOTE, in the above example <tt class="docutils literal">sync_ExtraRepo1.sh</tt> script, the variable
<tt class="docutils literal">CHECKIN_TEST_WRAPPER</tt> is set to a wrapper script:</p>
<pre class="literal-block">
BaseProj/sampleScripts/checkin-test-foo.sh
</pre>
<p>which would be set up to call the project's <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script with
configure options for the specific machine.  The location and the nature of
the wrapper script will vary from project to project and machine to machine.
In some simple cases, <tt class="docutils literal">CHECKIN_TEST_WRAPPER</tt> might just be set to be the raw
machine-independent <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script for the project.</p>
<p>A description of each option passed into this invocation of the
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script is given below (see <a class="reference internal" href="#checkin-test-py-help">checkin-test.py --help</a> for
more details):</p>
<blockquote>
<p><tt class="docutils literal"><span class="pre">--extra-pull-from=integrate-from:master</span></tt></p>
<blockquote>
This option instructs the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script to pull and merge in
commits that define the integration.  This same remote name and remote
branch name has to be the same in all git repos (todo: remove this
requirement).  If it is not, then this option can't be used and instead
the wrapper script should do the pulls up front manually before calling
the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script.  The disadvantage of doing the pulls
manually is that if they fail for some reason, they will not be seen by
the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script and no notification email would go out.
However, integrating <tt class="docutils literal">master</tt> branches in different git repos is a very
common use case when good Lean/Agile CI practices are used by all of the
projects.</blockquote>
<p><tt class="docutils literal"><span class="pre">--abort-gracefully-if-no-changes-to-push</span></tt></p>
<blockquote>
The option <tt class="docutils literal"><span class="pre">--abort-gracefully-if-no-changes-to-push</span></tt> makes the
<tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script gracefully terminate without sending out any
emails if after all the pulls, there are no local changes to push to the
'origin' repos.  This can happen, for example, if no commits were pushed
to the main development git repo for <tt class="docutils literal">ExtraRepo1</tt> at
<tt class="docutils literal"><span class="pre">url2.gov:/git/ExtraRepo1</span></tt> since the last time this sync process was
run.  This avoids getting confusing and annoying emails like <tt class="docutils literal">&quot;PUSH
FAILED&quot;</tt>.  The reason this option is not generally needed for local
developer usage of the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script is that in general a
developer will not run the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script with <tt class="docutils literal"><span class="pre">--push</span></tt>
unless they have made local changes; it just does not make any sense at
all to do that and if they do by accident, they should get an error email.
However, for an automated ACI sync process, there is no easy way to know a
priori if changes need to be synced so the script supports this option to
deal with that case gracefully.</blockquote>
<p><tt class="docutils literal"><span class="pre">--send-email-to=base-proj-integrators&#64;url4.gov</span></tt></p>
<blockquote>
The results of the builds will be sent this email address.  If you only
want an email sent when a push actually happens, you can set
<tt class="docutils literal"><span class="pre">--send-email-to=''</span></tt> and rely on <tt class="docutils literal"><span class="pre">--send-email-to-on-push</span></tt>.</blockquote>
<p><tt class="docutils literal"><span class="pre">--send-email-to-on-push=base-proj-integrators&#64;url4.gov</span></tt></p>
<blockquote>
A confirmation and summary email will be sent to this address if the push
happens.  This can be a different email address than set by the
<tt class="docutils literal"><span class="pre">--send-email-to</span></tt> option.  It is highly recommended that a mail list be
used for this email address since this will be the only more permanent
logging of the ACI process.</blockquote>
<p><tt class="docutils literal"><span class="pre">--no-append-test-results</span> <span class="pre">--no-rebase</span></tt></p>
<blockquote>
These options are needed to stop the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script from
modifying the commits being tested and pushed from one public git repo to
another.  The option <tt class="docutils literal"><span class="pre">--no-append-test-results</span></tt> is needed to instruct
the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script to <em>NOT</em> amend the last commit with the
test results.  The option <tt class="docutils literal"><span class="pre">--no-rebase</span></tt> is needed to avoid rebasing the
new commits pulled.  While the default behavior of the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt>
script is to amend the last commit message and rebase the local commits
(which is considered best practice when testing local commits), this is a
very bad thing to do when a ACI sync server is only testing and moving
commits between public repos.  Amending the last commit would change the
SHA1 of the commit (just as a rebase would) and would fork the history and
mess up a number of workflows that otherwise should work smoothly.  Since
an email logging what was tested will go out if a push happens due to the
<tt class="docutils literal"><span class="pre">--send-email-to-on-push</span></tt> argument, there is no value in appending the
test results to the last commit pulled and merged (which will generally
not be a merge commit but just a fast-forward).  There are cases, however,
where appending the test results in an ACI process might be acceptable but
they are not discussed here.</blockquote>
<p><tt class="docutils literal"><span class="pre">--do-all</span> <span class="pre">--push</span> <span class="pre">-j16</span></tt></p>
<blockquote>
These are standard options that always get used when invoking the
<tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script and need no further explanation.</blockquote>
<p><tt class="docutils literal"><span class="pre">--wipe-clean</span></tt></p>
<blockquote>
This option is added if you want to make the sync server more robust to
changes that might require a clean configure from script.  If you care
more about using less computer resources and testing that rebuilds work
smoothly, remove this option.</blockquote>
</blockquote>
<p>Note that the option <tt class="docutils literal"><span class="pre">--enable-packages</span></tt> is not set in the above invocation
of the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script, and therefore the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt>
script will decide on its own what packages to test just based on what
packages have changed files in the <tt class="docutils literal">ExtraRepo1</tt> git/TriBITS extra
repository.  This is the preferred way to go since any affected packages will
automatically be enabled as determined by the TriBITS package dependency
structure and therefore this driver script will require no modifications if
the dependency structure changes over time.  However, there are cases and
various reasons where the exact list of packages to be tested (or not tested)
should be specified using the <tt class="docutils literal"><span class="pre">--enable-packages</span></tt> option (or the
<tt class="docutils literal"><span class="pre">--disable-packages</span></tt> option, respectively).  However, these should not be
needed with well structured portable TriBITS repos and packages.</p>
<p>The sync script can be created and tested locally to ensure that it works
correctly first, before setting it as a cron job as described next.</p>
<p>Note, if using this in a continuous sync server that runs many times in a day
in a loop, you also want to set the option
<tt class="docutils literal"><span class="pre">--abort-gracefully-if-no-updates</span></tt> in addition to the option
<tt class="docutils literal"><span class="pre">--abort-gracefully-if-no-changes-to-push</span></tt>.  That is because if the updated
repos are in a broken state such that there are always local changes at every
CI iteration (because they have not been pushed to origin), you don't want to
do a new CI build unless something has changed that would otherwise perhaps
make the error go away.  That allows the CI server to sit ready to try out any
change that gets pulled that might allow the integrated build to work and then
push the updates.</p>
</div>
<div class="section" id="aci-cron-job-setup">
<h3><a class="toc-backref" href="#id78">ACI Cron Job Setup</a></h3>
<p>Once the sync script <tt class="docutils literal">sync_ExtraRepo1.sh</tt> has been locally tested, then it
should be committed to a version control git repo and then run automatically
as a cron job.  For example, the cron script shown below would fire off the
daily ACI process at 8pm local time every night:</p>
<pre class="literal-block">
# ----------------- minute (0 - 59)
# |  -------------- hour (0 - 23)
# |  |  ----------- day of month (1 - 31)
# |  |  |  -------- month (1 - 12)
# |  |  |  |  ----- day of week (0 - 7) (Sunday=0 or 7)
# |  |  |  |  |
# *  *  *  *  *  command to be executed
 00 20  *  *  *  ~/sync_base_dir/sync_ExtraRepo1.sh &amp;&gt; ~/sync_base_dir/sync_ExtraRepo1.out
</pre>
<p>In the above crontab file (set with <tt class="docutils literal">'crontab <span class="pre">-e'</span></tt> or <tt class="docutils literal">'crontab
<span class="pre">my-crontab-file.txt'</span></tt>), the script:</p>
<pre class="literal-block">
~/sync_base_dir/sync_ExtraRepo1.sh
</pre>
<p>is assumed to be a soft symbolic link to some version controlled copy of the
ACI sync script.  For example, it might make sense for this script to be
version controlled in the <tt class="docutils literal">BaseProj</tt> repo and therefore the symbolic link
would be created with something like:</p>
<pre class="literal-block">
$ cd ~/sync_base_dir/
$ ln -s BaseProj/sampleScripts/sync_ExtraRepo1.sh .
</pre>
<p>Such a setup would ensure that sync scripts would always be up-to-date due to
the git pulls part of the ACI process.</p>
</div>
<div class="section" id="addressing-aci-failures-and-summary">
<h3><a class="toc-backref" href="#id79">Addressing ACI Failures and Summary</a></h3>
<p>After the above cron job starts running (setup described above), the
<tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script will send out emails to the email addresses passed
into the underlying <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script.  If the emails report an
update, configure, build, or test failure, then someone will need to log onto
the machine where the ACI sync server is running and investigate what went
wrong, just like they would if the were running the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script
for testing locally modified changes before pushing.</p>
<p>In the above example, only a single git/TriBITS repo is integrated in this ACI
sync scripts.  For a complete system, other ACI sync scripts would be written
to sync the two other git/TriBITS repos in order to maintain some
independence.  Or, a single ACI sync script that tries to update all three
git/TriBITS repos at could would be written and used.  The pattern of
integrations chosen will depend many different factors and these patterns can
change over time according to current needs and circumstances.</p>
<p>In summary, the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script can be used to set up robust and
effective Almost Continuous Integration (ACI) sync servers that can be used to
integrate large collections of software in logical configurations at any
logical frequency.  Such an approach, together with the practice of <a class="reference internal" href="#regulated-backward-compatibility-and-deprecated-code">Regulated
Backward Compatibility and Deprecated Code</a>, can allow very large collections
of software to be kept integrated in short time intervals using ACI.</p>
</div>
</div>
<div class="section" id="post-push-ci-and-nightly-testing-using-checkin-test-py">
<h2><a class="toc-backref" href="#id80">10.8&nbsp;&nbsp;&nbsp;Post-Push CI and Nightly Testing using checkin-test.py</a></h2>
<p>While the post-push CI and Nightly testing processes using <tt class="docutils literal">ctest <span class="pre">-S</span></tt>
scripts using <a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a> (see <a class="reference internal" href="#tribits-package-by-package-ctest-dash-driver">TriBITS Package-by-Package
CTest/Dash Driver</a>) which posts results to a CDash server (see <a class="reference internal" href="#tribits-cdash-customizations">TriBITS CDash
Customizations</a>) is a very attractive testing system with many advantages,
setting up a CDash server can be a bit difficult and a CDash server can
require non-trivial storage and CPU resources (due to the MySQL DB of test
results) and requires some amount of extra maintenance.  As an intermediate
approach, one can consider just using the project's <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script
to implement basic post-push CI and/or Nightly testing servers using simple
cron jobs and a some other helper scripts.  The <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script
will robustly pull new commits, configure the project, build, run tests, and
send out emails with results and pass/fail.  A bunch of builds can be run at
once using multiple builds specified in the <tt class="docutils literal"><span class="pre">--default-builds</span></tt>,
<tt class="docutils literal"><span class="pre">--st-extra-builds</span></tt>, and <tt class="docutils literal"><span class="pre">--extra-build</span></tt> arguments, or different
invocations of the <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> script can be run in parallel for
better machine utilization.</p>
<p>What one gives up with this approach over the full-blow CTest/CDash
implementation is:</p>
<ol class="arabic simple">
<li>Test results over multiple builds/days are not archived in a database for
later retrieval and query.  Only the latest build's detailed results are
accessible.</li>
<li>Detailed test results (pass or fail) cannot be easily looked up on a
website.  Only detailed results from the last build can be found and one
has to go to the machine where the build was run from to see the results.</li>
</ol>
<p>The process for setting up a basic nightly build using <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> as
a cron job is a subset of the steps needed to set up a driver and cron job for
the more complex ACI process described in <a class="reference internal" href="#aci-sync-driver-script">ACI Sync Driver Script</a> and <a class="reference internal" href="#aci-cron-job-setup">ACI
Cron Job Setup</a>.  Setting up a CI server using <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> is a
little more involved than setting up a nightly build (and less desirable
because it blows away old CI iteration results pretty fast) but can be done
using existing tools.</p>
<!-- ToDo: Show how to set up a cron job using checkin-test.py. -->
<p>For smaller, private, less-critical projects with few developers, setting up
CI and Nightly testing using <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> may be quite adequate.  In
fact, post-push testing processes implemented with <tt class="docutils literal"><span class="pre">checkin-test.py</span></tt> are
much more solid and feature-full than have been employed in many software
projects that we have seen over the years that were larger, more public, had
many developers, and and were quite important to many users and development
teams.</p>
</div>
<div class="section" id="tribits-dashboard-driver">
<h2><a class="toc-backref" href="#id81">10.9&nbsp;&nbsp;&nbsp;TriBITS Dashboard Driver</a></h2>
<p>TriBITS also includes a system based on CMake/CTest/CDash to drive the builds
of a TriBITS project and post results to another CDash project.  This system
is contained under the directory:</p>
<pre class="literal-block">
tribits/ctest/tdd/
</pre>
<p>If the TriBITS project name is <tt class="docutils literal">&lt;projectName&gt;</tt>, the TDD driver CDash project
is typically called <tt class="docutils literal">&lt;projectName&gt;Driver</tt>.  Using CTest to drive the Nightly
builds of a TriBITS project makes sense because CTest can run different builds
in parallel, can time-out builds that are taking too long, and will report
results to a dashboard and submit notification emails when things fail.
However, this is the most confusing and immature part of the TriBITS system.
The <a class="reference internal" href="#tribits-package-by-package-ctest-dash-driver">TriBITS Package-by-Package CTest/Dash Driver</a> system using the
<a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a> can be used without this TriBITS Dashboard Driver
(TDD) system.</p>
<!-- ToDo: Import and format the contents of tribits/ctest/README related to -->
<!-- this topic into this section. -->
</div>
<div class="section" id="regulated-backward-compatibility-and-deprecated-code">
<h2><a class="toc-backref" href="#id82">10.10&nbsp;&nbsp;&nbsp;Regulated Backward Compatibility and Deprecated Code</a></h2>
<p>The motivation and ideas behind regulated backward compatibility and
deprecated code are described in the <a class="reference external" href="../lifecycle_model/TribitsLifecycleModel.pdf">TriBITS Lifecycle Model</a> document.
Here, the details of the implementation in the TriBITS system are given and
how transitions between non-backward compatible versions is accomplished.</p>
<p>This section describes the process to use for deprecating code within a major
version sequence and finally removing deprecated code when transitioning to a
new the major repository version X to X+1 for the TriBITS version numbering
scheme X.Y.Z.  This information is given as a process with different phases.</p>
<p>The processing for managing deprecated code is as follows and more details are
given below:</p>
<ul class="simple">
<li><a class="reference internal" href="#setting-up-support-for-deprecated-code-handling">Setting up support for deprecated code handling</a></li>
<li><a class="reference internal" href="#deprecating-code-but-maintaining-backward-compatibility">Deprecating code but maintaining backward compatibility</a><ul>
<li><a class="reference internal" href="#deprecating-c-c-classes-structs-functions-typdefs-etc">Deprecating C/C++ classes, structs, functions, typdefs, etc.</a></li>
<li><a class="reference internal" href="#deprecating-preprocessor-macros">Deprecating preprocessor macros</a></li>
<li><a class="reference internal" href="#deprecating-an-entire-header-and-or-source-file">Deprecating an entire header and/or source file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hiding-deprecated-code-to-certify-and-facilitate-later-removal">Hiding deprecated code to certify and facilitate later removal</a><ul>
<li><a class="reference internal" href="#hiding-c-c-entities">Hiding C/C++ entities</a></li>
<li><a class="reference internal" href="#hiding-entire-deprecated-header-and-source-files">Hiding entire deprecated header and source files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#physically-removing-deprecated-code">Physically removing deprecated code</a><ul>
<li><a class="reference internal" href="#removing-entire-deprecated-header-and-source-files">Removing entire deprecated header and source files</a></li>
<li><a class="reference internal" href="#removing-deprecated-code-from-remaining-files">Removing deprecated code from remaining files</a></li>
</ul>
</li>
</ul>
<div class="section" id="setting-up-support-for-deprecated-code-handling">
<h3><a class="toc-backref" href="#id83">Setting up support for deprecated code handling</a></h3>
<p>Setting up support for managing deprecated code in a TriBITS package requires
just two simple changes to the TriBITS-related files in a package.  First, the
top-level package <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file needs to have a call
to:</p>
<pre class="literal-block">
TRIBITS_ADD_SHOW_DEPRECATED_WARNINGS_OPTION()
</pre>
<p>Second, the package's configure header:</p>
<pre class="literal-block">
&lt;packageDir&gt;/cmake/&lt;PACKAGE_UCNAME&gt;_config.h.in
</pre>
<p>file needs to have:</p>
<pre class="literal-block">
&#64;&lt;PACKAGE_UCNAME&gt;_DEPRECATED_DECLARATIONS&#64;
</pre>
<p>where <tt class="docutils literal">&lt;PACKAGE_UCNAME&gt;</tt> is the upper-case name of the TriBITS package.</p>
<p>That is all that is needed to provide support for TriBITS deprecated code.</p>
<p>When a TriBITS project is configured with:</p>
<pre class="literal-block">
-D&lt;Project&gt;_SHOW_DEPRECATED_WARNINGS=ON
</pre>
<p>by default, all packages will show deprecated warnings.  These deprecated
warnings can be turned on and off on a package-by-package basis by setting:</p>
<pre class="literal-block">
-D&lt;PackageName&gt;_SHOW_DEPRECATED_WARNINGS=[ON|OFF]
</pre>
<p>This gives developers and users a little extra control over what deprecated
warnings are shown.</p>
<p>In addition, deprecated code can be hidden from the build to help certify that
downstream code is clean by configuring with:</p>
<pre class="literal-block">
-D&lt;Project&gt;_HIDE_DEPRECATED_CODE=ON
</pre>
<p>This will remove the deprecated code from the build and install (see details
below) so that other software in the TriBITS project can be shown to build
clean without deprecated code and so that outside client code can be shown to
be clean of deprecated code.</p>
<p>As with deprecated warnings, showing or hiding deprecated code can be
controlled on a package-by-package basis by setting:</p>
<pre class="literal-block">
-D&lt;PackageName&gt;_HIDE_DEPRECATED_CODE=[ON|OFF]
</pre>
<p>In this case, hiding deprecated code on a package-by-package basis may not
work because deprecated code in a downstream package might rely on deprecated
code in an upstream package (which might have its deprecated code hidden).</p>
</div>
<div class="section" id="deprecating-code-but-maintaining-backward-compatibility">
<h3><a class="toc-backref" href="#id84">Deprecating code but maintaining backward compatibility</a></h3>
<p>One of the most important aspects of the <a class="reference external" href="../lifecycle_model/TribitsLifecycleModel.pdf">TriBITS Lifecycle Model</a> for
later-stage Production Growth and Production Maintenance code is to provide
backward compatibility between a continuous stream of versions of the software
within a major version number X in the version numbering scheme X.Y.Z.  In all
cases, if a piece of client code builds and runs correctly against version
X0.Y0.Z0, it should also build, without modification, against versions
X0.Y1,Z1 for all Y1 &gt;= Y0 and all Z1 and up to (but not including) X0+1.0.0.
There are many types of constructs that one will want to deprecate and
therefore later remove.  When deprecating code, one wants to give users
compile-time warnings of the usage of deprecated features so that they know
what they need to remove.  One also wants to allow them to certify that their
code is free of deprecated warnings by hiding deprecated code.  Below, the
different types of entities that one wants to deprecate and how to support
hiding code (which also facilitates removing it later) are described.</p>
<div class="section" id="deprecating-c-c-classes-structs-functions-typdefs-etc">
<h4><a class="toc-backref" href="#id85">Deprecating C/C++ classes, structs, functions, typdefs, etc.</a></h4>
<p>To deprecate standard C/C++ constructs, one can just use the standard TriBITS
compile-time macro <tt class="docutils literal">&lt;PACKAGE_UCNAME&gt;_DEPRECATED</tt> which is properly ifdefed
by the TriBITS system to add a GCC/Intel deprecated attribute or not.  For
example, one would deprecate standard C/C++ constructs for the package
<tt class="docutils literal">SomePackage</tt> with:</p>
<pre class="literal-block">
// Deprecate a class (or struct)
class SOMEPACKAGE_DEPRECATED SomeClass { ... };

// Deprecate a function
SOMEPACKAGE_DEPRECATED int someFunc(...);

// Deprecate a typedef
SOMEPACKAGE_DEPRECATED typedef someTypeDef int;
</pre>
<p>The GCC and Intel C and C++ compilers both support adding extra attributes
including the <tt class="docutils literal">__deprecated__</tt> attribute.  When this attribute is applied to
a given C/C++ entity, it produces a compiler warning that can be searched for
in the compiler output and elevated to an error (when <tt class="docutils literal"><span class="pre">-Werror</span></tt> is also
passed to the compiler).</p>
</div>
<div class="section" id="deprecating-preprocessor-macros">
<h4><a class="toc-backref" href="#id86">Deprecating preprocessor macros</a></h4>
<p>A C/C++ preprocessor macro is not an entity seen by the C/C++ compiler and
therefore cannot directly take advantage of a feature such as the
<tt class="docutils literal">__deprecated__</tt> attribute of the GCC/Intel compilers.  However, in some
cases, for function-like macros can such as:</p>
<pre class="literal-block">
// The definition of the macro
#define SOME_OLD_FUNC_MACRO(ARG1, ARG2, ...) ...
...
// A use of the macro
SOME_OLD_FUNC_MACRO(a, b, ...)
</pre>
<p>there is a strategy where one can define the macro to call a dummy deprecated
function such as with:</p>
<pre class="literal-block">
SOMEPACKAGE_DEPRECATED
inline void SOME_OLD_FUNC_MACRO_is_deprecated()
{}

// The definition of the macro
#define SOME_OLD_FUNC_MACRO(ARG1, ARG2, ...) \
  { \
    SOME_OLD_FUNC_MACRO_is_deprecated(); \
    ... \
  }

...

// A use of the macro
SOME_OLD_FUNC_MACRO(a, b, ...)
</pre>
<p>In the above example, client code calling <tt class="docutils literal">SOME_OLD_FUNC_MACRO()</tt> will now
result in a deprecated compiler warning which should make it clear what is
being deprecated.</p>
<p>Note that this approach will not work in cases were a macro is only providing
a single value such as a constant (but one should not use macros for providing
constants anyway).</p>
</div>
<div class="section" id="deprecating-an-entire-header-and-or-source-file">
<h4><a class="toc-backref" href="#id87">Deprecating an entire header and/or source file</a></h4>
<p>There are times when one wants to deprecate an entire set of files and all of
the contents in those files.  In addition to deprecating the contents of the
files one will want to deprecate the entire file as well.  There are a few
steps to this.  First, one wants to put a warning in the file such as:</p>
<pre class="literal-block">
#ifdef __GNUC__
#  warning &quot;This header &lt;THIS_HEADER&gt; is deprecated!  Use &lt;NEW_HEADER&gt; instead!&quot;
#endif
</pre>
<p>The above <tt class="docutils literal">ifdef</tt> on <tt class="docutils literal">__GNUC__</tt> is needed in order avoid the non-standard
<tt class="docutils literal">#warning</tt> preprocessor directive on non-compliant compilers (but should
work on all later version GCC and Intel compilers).</p>
</div>
</div>
<div class="section" id="hiding-deprecated-code-to-certify-and-facilitate-later-removal">
<h3><a class="toc-backref" href="#id88">Hiding deprecated code to certify and facilitate later removal</a></h3>
<p>In addition to adding deprecation warnings at preprecessing or compile-time,
it is also highly desirable to allow the deprecated code to be removed from
the build to help certify that client code indeed no longer needs the
deprecated code.  The following subsections describe how to hide deprecated
code from existing files and how to hide deprecated files entirely.</p>
<div class="section" id="hiding-c-c-entities">
<h4><a class="toc-backref" href="#id89">Hiding C/C++ entities</a></h4>
<p>In the case when various C/C++ entities will be removed from an existing file,
but the file will remain, then the deprecated code can be ifdefed out, for the
package <tt class="docutils literal">SomePackage</tt> for example, using:</p>
<pre class="literal-block">
#ifndef SOMEPACKAGE_HIDE_DEPRECATED_CODE
  // Deprecate a class (or struct)
  class SOMEPACKAGE_DEPRECATED SomeClass { ... };
  ...
#endif /* SOMEPACKAGE_HIDE_DEPRECATED_CODE */
</pre>
<p>In this way, when the CMake variable <tt class="docutils literal">SomePackae_HIDE_DEPRECATED_CODE=ON</tt>,
then the deprecated code will be completely removed resulting in compile
errors for any downstream code still using them.</p>
</div>
<div class="section" id="hiding-entire-deprecated-header-and-source-files">
<h4><a class="toc-backref" href="#id90">Hiding entire deprecated header and source files</a></h4>
<p>In order to hide entire deprecated header and source files when the CMake
variable <tt class="docutils literal">&lt;PackageName&gt;_HIDE_DEPRECATED_CODE=ON</tt> is set, one needs to move
the headers and sources to another directory and provide for conditional
inclusion in the TriBITS build of the library.  For example, suppose one wants
to remove support for the deprecated files <tt class="docutils literal">SomeOldStuff.hpp</tt> and
<tt class="docutils literal">SomeOldStuff.cpp</tt>.  In this case, one would move the files onto a new
<tt class="docutils literal">deprecated/</tt> sub-directory and then write the <tt class="docutils literal">CMakeLists.txt</tt> file
like:</p>
<pre class="literal-block">
SET(HEADERS &quot;&quot;)
SET(SOURCES &quot;&quot;)

SET_AND_INC_DIRS(DIR ${CMAKE_CURRENT_SOURCE_DIR})
APPEND_GLOB(HEADERS ${DIR}/*.hpp)
APPEND_GLOB(SOURCES ${DIR}/*.cpp)

IF (NOT ${PACKAGE_NAME}_HIDE_DEPRECATED_CODE)
  INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/deprecated)
  APPEND_SET(HEADERS
    SomeOldStuff.hpp
    )
  APPEND_SET(SOURCES
    SomeOldStuff.cpp
    )
ENDIF()

...

TRIBITS_ADD_LIBRARY(
  &lt;LIBRARY_NAME&gt;
  HEADERS ${HEADERS}
  SOURCES ${SOURCES}
  )
</pre>
<p>In this way, when <tt class="docutils literal">${PACKAGE_NAME}_HIDE_DEPRECATED_CODE=TRUE</tt>, then the
directory for the deprecated headers will not be in the include path (so
downstream clients will not even be able to see them) and they will not be
installed so external clients will not be able to see them either.  However,
when <tt class="docutils literal">${PACKAGE_NAME}_HIDE_DEPRECATED_CODE=FALSE</tt>, then these files will be
included in the build and include path and downstream clients can use them.</p>
<p>Once these files need to be permanently removed, one just then needs to remove
them from the version control repository (i.e. <tt class="docutils literal">git rm &lt;files_to_remove&gt;</tt>)
and them remove them from the above <tt class="docutils literal">CMakeLists.txt</tt> code.</p>
</div>
</div>
<div class="section" id="physically-removing-deprecated-code">
<h3><a class="toc-backref" href="#id91">Physically removing deprecated code</a></h3>
<p>The final step in the code deprecation cycle is to actually remove the
deprecated code.  This is necessary to clean house, remove clutter and finally
get the payoff in the reduction of technical debt that occurs when removing
what is no longer needed or wanted.</p>
<p>It is recommended to remove deprecated files first, then remove deprecated
file fragments from remaining files.  Also, it is recommended to create git
commits after each step.</p>
<p>It is also recommended that some time before deprecated code is actually
removed, that a TriBITS repo change the default of
<tt class="docutils literal">&lt;Project&gt;_HIDE_DEPRECATED_CODE</tt> from <tt class="docutils literal">OFF</tt> to <tt class="docutils literal">ON</tt> so that downstream
clients will see the effects of hiding the deprecated code before the code is
actually removed.  In fact, this default should be changed several days to a
week or more before the code is actually removed.  This way, downstream code
developers will get a &quot;shock&quot; about removal of the deprecated code but can
manually configure with <tt class="docutils literal"><span class="pre">-D&lt;Project&gt;_HIDE_DEPRECATED_CODE=OFF</span></tt> to keep
building in the short-term until they can remove their usage of deprecated
code.</p>
<div class="section" id="removing-entire-deprecated-header-and-source-files">
<h4><a class="toc-backref" href="#id92">Removing entire deprecated header and source files</a></h4>
<p>To remove entire deprecated header and source files one just needs to first
remove them from the version control repository and local directories
(e.g. <tt class="docutils literal">git rm deprecated/*</tt>) and then remove any traces of them from the
<tt class="docutils literal">CMakeLists.txt</tt> file.  For the example in <a class="reference internal" href="#hiding-entire-deprecated-header-and-source-files">Hiding entire deprecated header
and source files</a>, one would just remove the files <tt class="docutils literal">SomeOldStuff.hpp</tt> and
<tt class="docutils literal">SomeOldStuff.cpp</tt> from the <tt class="docutils literal">CMakeLists.txt</tt> file leaving:</p>
<pre class="literal-block">
IF (NOT ${PACKAGE_NAME}_HIDE_DEPRECATED_CODE)
  INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/deprecated)
  APPEND_SET(HEADERS
    )
  APPEND_SET(SOURCES
    )
ENDIF()
</pre>
<p>Since more files may be deprecated later, it may be a good idea to leave the
machinery for conditionally including deprecated files by leaving the above
empty CMake code or just commenting it out.</p>
<p>To find which <tt class="docutils literal">CMakeLists.txt</tt> files need to be modified, do a search like:</p>
<pre class="literal-block">
$ find . -name CMakeLists.txt -exec grep -nH HIDE_DEPRECATED_CODE {} \;
</pre>
<p>After removing the files, create a local commit of the removed files and the
updated <tt class="docutils literal">CMakeLists.txt</tt> files before removing deprecated fragments from the
source files.  In other words, do:</p>
<pre class="literal-block">
$ emacs -nw CMakeLists.txt  # Remove the references to the deprecated files
$ git rm SomeOldStuff.hpp SomeOldStuff.cpp
$ git commit -m &quot;Removing deprecated files&quot;
</pre>
</div>
<div class="section" id="removing-deprecated-code-from-remaining-files">
<h4><a class="toc-backref" href="#id93">Removing deprecated code from remaining files</a></h4>
<p>The deprecated ifdefed blocks described in <a class="reference internal" href="#hiding-c-c-entities">Hiding C/C++ entities</a> can be
removed manually but it is generally preferred to use a tool.  One simple tool
that can do this is called <tt class="docutils literal">unifdef</tt>, that can be downloaded and it is
documented at:</p>
<blockquote>
<a class="reference external" href="http://dotat.at/prog/unifdef/">http://dotat.at/prog/unifdef/</a></blockquote>
<p>Just download, build, and install the program <tt class="docutils literal">unifdef</tt> (see
<tt class="docutils literal">unifdef/INSTALL</tt> in untarred source) and then run it as described below.
In the example below, assume the program is installed in the user's home
directory under:</p>
<pre class="literal-block">
~/install/bin/unifdef
</pre>
<p>For a given TriBITS package, the program is then run as:</p>
<pre class="literal-block">
$ find . -name &quot;*pp&quot; -exec ~/install/bin/unifdef \
  -DSomePackage_HIDE_DEPRECATED_CODE {} -o {} \;
</pre>
<p>After the above command runs, look at the diffs to make sure the ifdef
deprecated code blocks were removed correctly.  For example, run:</p>
<pre class="literal-block">
$ git diff -- .
</pre>
<p>If the diffs look correct, commit the changes:</p>
<pre class="literal-block">
$ git commit -m &quot;Removing deprecated code blocks&quot; -- .
</pre>
<p>Then test everything and push using the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> script.</p>
<p>After that, all deprecated code is removed and the next period of incremental
change and deprecation begins.</p>
</div>
</div>
</div>
<div class="section" id="installation-and-backward-compatibility-testing">
<h2><a class="toc-backref" href="#id94">10.11&nbsp;&nbsp;&nbsp;Installation and Backward Compatibility Testing</a></h2>
<p>TriBITS has some built-in support for installation testing and backward
compatibility testing.  The way it works is that one can install the headers,
libraries, and executables for a TriBITS project and then configure the tests
and examples in the TriBITS project against the installed
headers/libraries/executables.  In this mode, the TriBITS project's libraries
and executables are <strong>not</strong> build and the header file locations to local
source are not included.</p>
<p>When the same version of the project sources are used to build the
tests/examples against the installed headers/libraries/executables, then this
constitutes <em>installation testing</em>.  When an older version of the project is
used to build and run tests and examples against the
headers/libraries/executables for a version of the project, then this
constitutes <em>backward compatibility testing</em> which also includes installation
testing of course.</p>
<p>ToDo: Describe how the installation testing and backward compatibility testing
process works with some examples.</p>
<p>ToDo: Discuss how this fits into the TriBITS lifecycle model.</p>
</div>
<div class="section" id="wrapping-externally-configured-built-software">
<h2><a class="toc-backref" href="#id95">10.12&nbsp;&nbsp;&nbsp;Wrapping Externally Configured/Built Software</a></h2>
<p>It is possible to take an external piece of software that uses any arbitrary
build system and wrap it as a TriBITS package and have it integrate in with
the package dependency infrastructure.  The <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> package
<tt class="docutils literal">WrapExternal</tt> shows how this can be done.  Support for this in TriBITS is
slowly evolving but some key TriBITS features that have been added to support
the arbitrary case include:</p>
<ul class="simple">
<li><a class="reference internal" href="#tribits-determine-if-current-package-needs-rebuilt">TRIBITS_DETERMINE_IF_CURRENT_PACKAGE_NEEDS_REBUILT()</a>: Uses brute-force
searches for recently modified files in upstream SE packages to determine if
the external piece of software needs to be rebuilt.</li>
<li><a class="reference internal" href="#tribits-write-flexible-package-client-export-files">TRIBITS_WRITE_FLEXIBLE_PACKAGE_CLIENT_EXPORT_FILES()</a>: Write an export
makefile or a <tt class="docutils literal">XXXConfig.cmake</tt> file for usage by the wrapped externally
configured and built software.</li>
</ul>
<!-- ToDo: Show how this is done in detail once TriBITS has nice support for -->
<!-- external software and the WrapExternal example looks cleaner. -->
<p>While it is possible to wrap nearly any externally configured and built piece
of software as a TriBITS package, in most cases, it is usually better to just
create a TriBITS build system for the software.  For projects that use a raw
CMake build system, a TriBITS build system can be created side-by-side with
the existing raw CMake build using a number of approaches. The common approach
that is not too invasive is to create a <tt class="docutils literal">CMakeLists.tribits.txt</tt> file along
side every native <tt class="docutils literal">CMakeLists.txt</tt> file in the external software project and
have the native <tt class="docutils literal">CMakeLists.txt</tt> file defined like:</p>
<pre class="literal-block">
IF (DOING_A_TRIBITS_BUILD)
  INCLUDE(&quot;${CMAKE_CURRENT_SOURCE_DIR}/CMakeLists.tribits.txt&quot;)
  RETURN()
ENDIF()

# Rest of native CMakeLists.txt file ...
</pre>
<p>Experience from the CASL VERA project has shown that, overall, there is less
hassle, less work, and better portability when creating a native TriBITS
build, even if it is a secondary build system for a given piece of software.</p>
<p>The decision whether to just wrap the build system for the existing software
or to create a (secondary) TriBITS build system for it depends on a number of
factors.</p>
<p>Note that while it is generally recommended to create a TriBITS build for an
existing piece of software, it is generally not recommended with switch over
all of the tests to use CTest (unless the existing software is going to ditch
their current test driver and reporting system).  Instead, the external
software's native test system can just be called by the wrapped TriBITS
package in one or more CTest tests.</p>
</div>
<div class="section" id="tribits-directory-snapshotting">
<h2><a class="toc-backref" href="#id96">10.13&nbsp;&nbsp;&nbsp;TriBITS directory snapshotting</a></h2>
<p>Some TriBITS projects choose to snapshot the <tt class="docutils literal">TriBITS</tt> directory source tree
into their project's source tree, typically under
<a class="reference internal" href="#projectdir-cmake-tribits">&lt;projectDir&gt;/cmake/tribits/</a>.  The independent <tt class="docutils literal">TriBITS</tt> source tree
contains a symbolic link to the tool <a class="reference internal" href="#snapshot-dir-py">snapshot-dir.py</a> that allows one to
update the snapshot of the TriBITS source tree as simply as:</p>
<pre class="literal-block">
$ cd &lt;projectDir&gt;/cmake/tribits/
$ &lt;some-base-dir&gt;/TriBITS/snapshot-dir.py
</pre>
<p>This will create a git commit in the local <tt class="docutils literal">&lt;projectDir&gt;/</tt> git repo that
looks like:</p>
<pre class="literal-block">
Automatic snapshot commit from TriBITS at 983d4f4

Origin repo remote tracking branch: 'origin/master'
Origin repo remote repo URL: 'origin = git&#64;github.com:TriBITSPub/TriBITS'

At commit:

983d4f4 Adding all checkin-test.py defaults to config file and removing checkin-test.py (Trilinos #6218)
Author: Roscoe A. Bartlett &lt;bartlettra&#64;ornl.gov&gt;
Date: Tue Sep 9 11:31:02 2014 -0400
</pre>
<p>This, of course, assumes that <tt class="docutils literal">&lt;projectDir&gt;/</tt> is a local git repo (or is in
local git repo).  If that is not the case, then one cannot use the script
<tt class="docutils literal"><span class="pre">snapshot-dir.py</span></tt> or must use it with the <tt class="docutils literal"><span class="pre">--skip-commit</span></tt> option.</p>
<p>See <a class="reference internal" href="#snapshot-dir-py-help">snapshot-dir.py --help</a> for more details.  Note the guidance on using a
different branch for the snapshot sync followed by a merge.  This allows for
one to maintain local changes to TriBITS and use git to manage the merges.
However, this will increase the changes of merge conflicts so one should
consider just directly snapshottting into the master branch to avoid merge
conflicts.</p>
</div>
<div class="section" id="tribits-development-toolset">
<h2><a class="toc-backref" href="#id97">10.14&nbsp;&nbsp;&nbsp;TriBITS Development Toolset</a></h2>
<p>Most TriBITS projects need git, a compiler (e.g. GCC), MPI, and a number of
other standard TPLs and tools in order to develop on and test the project
code.  To this end, TriBITS contains some helper scripts for downloading,
configuring, building, and installing packages like git, cmake, GCC, OpenMPI,
and others needed to set up a development environment for a typical
computational science software project.  These tools are used to set up
development environments on new machines for projects like Trilinos and CASL
VERA.  Scripts with names like <tt class="docutils literal"><span class="pre">install-gcc.py</span></tt> are defined which pull
sources from public git repos then configure, build, and install into
specified installation directories.</p>
<!-- ToDo: Discuss the installation scripts and github repos for GCC, OpenMPI, -->
<!-- CMake, etc. -->
<!-- ToDo: Move install scripts to tribits/dev_toolset/ and document specific -->
<!-- scripts here and even a top-level driver install script. -->
</div>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id98">11&nbsp;&nbsp;&nbsp;References</a></h1>
<p id="agile-software-development-2003">Martin, Robert. <em>Agile Software Development (Principles, Patterns, and
Practices)</em>. Prentice Hall. 2003.</p>
<p id="integration-strategies-for-cse-2009">Bartlett, Roscoe. <em>Integration Strategies for Computational Science &amp;
Engineering Software</em>.  2009-0655, Second International Workshop on Software
Engineering for Computational Science and Engineering, 2009.  <a class="reference external" href="http://web.ornl.gov/~8vt/CSE_SoftwareIntegration_Strategies.pdf">http://web.ornl.gov/~8vt/CSE_SoftwareIntegration_Strategies.pdf</a>.</p>
<p id="scale-2011"><em>SCALE: A Comprehensive Modeling and Simulation Suite for Nuclear Safety Analysis and Design</em>, ORNL/TM-2005/39, Version 6.1, Oak Ridge National Laboratory, Oak Ridge, Tennessee, June 2011. Available from Radiation Safety Information Computational Center at Oak Ridge National Laboratory as CCC-785.  <a class="reference external" href="http://scale.ornl.gov/">http://scale.ornl.gov/</a></p>
</div>
<div class="section" id="tribits-detailed-reference-documentation">
<h1><a class="toc-backref" href="#id99">12&nbsp;&nbsp;&nbsp;TriBITS Detailed Reference Documentation</a></h1>
<p>The following subsections contain detailed reference documentation for the
various TriBITS variables, functions, and macros that are used by TriBITS
projects that <a class="reference internal" href="#tribits-project-developers">TriBITS Project Developers</a> need to know about.  Variables,
functions and macros that are used only internally in TriBITS are generally
not documented here (see the TriBITS <tt class="docutils literal">*.cmake</tt> source files).</p>
<div class="section" id="tribits-global-project-settings">
<h2><a class="toc-backref" href="#id100">12.1&nbsp;&nbsp;&nbsp;TriBITS Global Project Settings</a></h2>
<p>TriBITS defines a number of global project-level settings that can be set by
the user and can have their default determined by each individual TriBITS
project.  If a given TriBITS project does not define its own default, a
reasonable default is set by the TriBITS system automatically.  These options
are defined and are set, for the most part, in the internal TriBITS function
<tt class="docutils literal">TRIBITS_DEFINE_GLOBAL_OPTIONS_AND_DEFINE_EXTRA_REPOS()</tt> in the TriBITS
CMake code file <tt class="docutils literal">TribitsGlobalMacros.cmake</tt> which gets called inside of the
<a class="reference internal" href="#id2">TRIBITS_PROJECT()</a> macro.  That function and that file are the definitive
source the options that a TriBITS project takes and what the default values
are but we strive to document them here as well.  Many of these global options
(i.e. cache variables) such as <tt class="docutils literal">${PROJECT_NAME}_&lt;SOME_OPTION&gt;</tt> allow the
project to define a default by setting a local variable
<tt class="docutils literal">${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT</tt> as:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT &lt;someDefault&gt;)
</pre>
<p>either in its top-level <tt class="docutils literal">CMakeLists.txt</tt> file or in its
<tt class="docutils literal">ProjectName.cmake</tt> file (depends on what variable it is as to where it
should be set).  If <tt class="docutils literal">${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT</tt> is not set by
the project, then TriBITS provides a reasonable default value.  The TriBITS
code that uses these defaults for this looks like:</p>
<pre class="literal-block">
IF (&quot;${${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT}&quot; STREQUAL &quot;&quot;)
  SET(${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT &lt;someDefault&gt;)
ENDIF()

ADVANCED_SET( ${PROJECT_NAME}_&lt;SOME_OPTION&gt;
  ${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT}
  CACHE BOOL &quot;[documentation].&quot;
  )
</pre>
<p>where <tt class="docutils literal">&lt;SOME_OPTION&gt;</tt> is an option name, for example like
<tt class="docutils literal">TEST_CATEGORIES</tt>, and <tt class="docutils literal">&lt;someDefault&gt;</tt> is the default set by TriBITS if
the project does not define a default.  In this way, if the project sets the
variable <tt class="docutils literal">${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT</tt> before this code executes,
then <tt class="docutils literal"><span class="pre">${${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT}</span></tt> will be used as the default
for the cache variable <tt class="docutils literal">${PROJECT_NAME}_&lt;SOME_OPTION&gt;</tt> which, of course, can
be overridden by the user when calling <tt class="docutils literal">cmake</tt> in a number of ways.</p>
<p>Most of these global options that can be overridden externally by setting the
cache variable <tt class="docutils literal">${PROJECT_NAME}_&lt;SOME_OPTION&gt;</tt> should be documented in the
<a class="reference internal" href="#project-specific-build-quick-reference">Project-Specific Build Quick Reference</a> document.  A generic version of this
document is found in <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html">TribitsBuildQuickRef</a>.  Some of the more unusual
options that might only be of interest to developers mentioned below may not
be documented in <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html">TribitsBuildQuickRef</a>.</p>
<p>The global project-level TriBITS options for which defaults can be provided by
a given TriBITS project are:</p>
<ul class="simple">
<li><a class="reference internal" href="#project-name-cpack-source-generator">${PROJECT_NAME}_CPACK_SOURCE_GENERATOR</a></li>
<li><a class="reference internal" href="#project-name-disable-enabled-forward-dep-packages">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</a></li>
<li><a class="reference internal" href="#project-name-elevate-st-to-pt">${PROJECT_NAME}_ELEVATE_ST_TO_PT</a></li>
<li><a class="reference internal" href="#project-name-enable-cpack-packaging">${PROJECT_NAME}_ENABLE_CPACK_PACKAGING</a></li>
<li><a class="reference internal" href="#project-name-enable-cxx11">${PROJECT_NAME}_ENABLE_CXX11</a></li>
<li><a class="reference internal" href="#project-name-enable-cxx">${PROJECT_NAME}_ENABLE_CXX</a></li>
<li><a class="reference internal" href="#project-name-enable-c">${PROJECT_NAME}_ENABLE_C</a></li>
<li><a class="reference internal" href="#project-name-enable-development-mode">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE</a></li>
<li><a class="reference internal" href="#project-name-enable-export-makefiles">${PROJECT_NAME}_ENABLE_EXPORT_MAKEFILES</a></li>
<li><a class="reference internal" href="#project-name-enable-fortran">${PROJECT_NAME}_ENABLE_Fortran</a></li>
<li><a class="reference internal" href="#project-name-enable-install-cmake-config-files">${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES</a></li>
<li><a class="reference internal" href="#project-name-exclude-disabled-subpackages-from-distribution">${PROJECT_NAME}_EXCLUDE_DISABLED_SUBPACKAGES_FROM_DISTRIBUTION</a></li>
<li><a class="reference internal" href="#project-name-generate-export-file-dependencies">${PROJECT_NAME}_GENERATE_EXPORT_FILE_DEPENDENCIES</a></li>
<li><a class="reference internal" href="#project-name-install-libraries-and-headers">${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS</a></li>
<li><a class="reference internal" href="#project-name-show-test-start-end-date-time">${PROJECT_NAME}_SHOW_TEST_START_END_DATE_TIME</a></li>
<li><a class="reference internal" href="#project-name-test-categories">${PROJECT_NAME}_TEST_CATEGORIES</a></li>
<li><a class="reference internal" href="#project-name-use-gnuinstalldirs">${PROJECT_NAME}_USE_GNUINSTALLDIRS</a></li>
<li><a class="reference internal" href="#mpi-exec-max-numprocs">MPI_EXEC_MAX_NUMPROCS</a></li>
</ul>
<p>These options are described below.</p>
<p id="project-name-cpack-source-generator"><strong>${PROJECT_NAME}_CPACK_SOURCE_GENERATOR</strong></p>
<blockquote>
<p>The variable <tt class="docutils literal">${PROJECT_NAME}_CPACK_SOURCE_GENERATOR</tt> determines the CPack
source generation types that are created when the <tt class="docutils literal">package_source</tt> target
is run.  The TriBITS default is set to <tt class="docutils literal">TGZ</tt>.  However, this default can
be overridden by setting, for example:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_CPACK_SOURCE_GENERATOR_DEFAULT &quot;TGZ;TBZ2&quot;)
</pre>
<p>This variable should generally be set in the file:</p>
<pre class="literal-block">
&lt;projectDir&gt;/cmake/CallbackDefineProjectPackaging.cmake
</pre>
<p>instead of in the base-level <tt class="docutils literal">CMakeLists.txt</tt> file so that it goes along
with rest of the project-specific CPack packaging options.</p>
</blockquote>
<p id="project-name-disable-enabled-forward-dep-packages"><strong>${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</strong></p>
<blockquote>
<p>If <a class="reference internal" href="#project-name-disable-enabled-forward-dep-packages-on">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=ON</a> (the TriBITS
default value), then any explicitly enabled packages that have disabled
<a class="reference internal" href="#upstream">upstream</a> required packages or TPLs will be disabled.  If
<a class="reference internal" href="#project-name-disable-enabled-forward-dep-packages-off">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=OFF</a>, then an
configure error will occur.  For more details also see
<a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html">TribitsBuildQuickRef</a> and <a class="reference internal" href="#disables-trump-enables-where-there-is-a-conflict">Disables trump enables where there is a
conflict</a>.  A project can define a different default value by setting:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES_DEFAULT FALSE)
</pre>
</blockquote>
<p id="project-name-elevate-st-to-pt"><strong>${PROJECT_NAME}_ELEVATE_ST_TO_PT</strong></p>
<blockquote>
<p>If <tt class="docutils literal">${PROJECT_NAME}_ELEVATE_ST_TO_PT</tt> is set to <tt class="docutils literal">ON</tt>, then all <tt class="docutils literal">ST</tt> SE
packages will be elevated to <tt class="docutils literal">PT</tt> packages.  The TriBITS default is
obviously <tt class="docutils literal">OFF</tt>.  The default can be changed by setting:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_ELEVATE_ST_TO_PT_DEFAULT ON)
</pre>
<p>There are projects, especially meta-projects, where the distinction between
<tt class="docutils literal">PT</tt> and <tt class="docutils literal">ST</tt> code is not helpful or the assignment of <tt class="docutils literal">PT</tt> and <tt class="docutils literal">ST</tt>
packages in a repository is not appropriate with respect to the outer
meta-project.  An example project like this CASL VERA.  Changing the default
to <tt class="docutils literal">ON</tt> allows any and packages to be considered in pre-push testing.</p>
</blockquote>
<p id="project-name-enable-cpack-packaging"><strong>${PROJECT_NAME}_ENABLE_CPACK_PACKAGING</strong></p>
<blockquote>
<p>If <tt class="docutils literal">${PROJECT_NAME}_ENABLE_CPACK_PACKAGING</tt> is <tt class="docutils literal">ON</tt>, then CPack support
is enabled and some TriBITS code is run that is needed to set up
data-structures that are used by the built-in CMake target
<tt class="docutils literal">package_source</tt>.  The TriBITS default is <tt class="docutils literal">OFF</tt> with the idea that the
average developer or user will not be wanting to create source distributions
with CPack.  However, this default can be changed by setting:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_ENABLE_CPACK_PACKAGING_DEFAULT ON)
</pre>
</blockquote>
<p id="project-name-enable-cxx11"><strong>${PROJECT_NAME}_ENABLE_CXX11</strong></p>
<blockquote>
<p>If <tt class="docutils literal">${PROJECT_NAME}_ENABLE_CXX11</tt> is <tt class="docutils literal">ON</tt>, then C++ compiler options
that turn on C++11 support will be searched for.  By default, TriBITS sets
this to <tt class="docutils literal">OFF</tt> for all systems.  However, if project requires C++11 support
by default, then the project should set the default:</p>
<blockquote>
SET(${PROJECT_NAME}_ENABLE_CXX11_DEFAULT TRUE)</blockquote>
</blockquote>
<p id="project-name-enable-cxx"><strong>${PROJECT_NAME}_ENABLE_CXX</strong></p>
<blockquote>
<p>If <tt class="docutils literal">${PROJECT_NAME}_ENABLE_CXX</tt> is <tt class="docutils literal">ON</tt>, then C++ language support for
the project will be enabled and the C++ compiler must be found.  By default,
TriBITS sets this to <tt class="docutils literal">ON</tt> for all systems.  A project never requires C++
can set this to off by default by setting:</p>
<blockquote>
SET(${PROJECT_NAME}_ENABLE_CXX_DEFAULT FALSE)</blockquote>
</blockquote>
<p id="project-name-enable-c"><strong>${PROJECT_NAME}_ENABLE_C</strong></p>
<blockquote>
<p>If <tt class="docutils literal">${PROJECT_NAME}_ENABLE_C</tt> is <tt class="docutils literal">ON</tt>, then C language support for the
project will be enabled and the C compiler must be found.  By default,
TriBITS sets this to <tt class="docutils literal">ON</tt> for all systems.  A project never requires C can
set this to off by default by setting:</p>
<blockquote>
SET(${PROJECT_NAME}_ENABLE_C_DEFAULT FALSE)</blockquote>
<p>If a project does not have any native C code a good default would be:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_ENABLE_C_DEFAULT FALSE)
</pre>
<p>NOTE: It is usually not a good idea to always force off C, or any compiler,
because extra repositories and packages might be added by someone that might
require the compiler and we don't want to unnecessarily limit the generality
of a given TriBITS build.  Setting the default for all platforms should be
sufficient.</p>
</blockquote>
<p id="project-name-enable-development-mode-default"><span id="project-name-enable-development-mode"></span><strong>${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE</strong></p>
<blockquote>
The variable <tt class="docutils literal">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE</tt> switches the
TriBITS project from development mode to release mode.  The default for this
variable <tt class="docutils literal">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE_DEFAULT</tt> should be set
in the project's <a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a> file and switched from <tt class="docutils literal">ON</tt>
to <tt class="docutils literal">OFF</tt> when creating a release (see <a class="reference internal" href="#project-and-repository-versioning-and-release-mode">Project and Repository Versioning
and Release Mode</a>).  When <tt class="docutils literal">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE</tt> is
<tt class="docutils literal">ON</tt>, several other variables are given defaults appropriate for
development mode.  For example, <tt class="docutils literal">${PROJECT_NAME}_ASSERT_MISSING_PACKAGES</tt>
is set to <tt class="docutils literal">ON</tt> by default in development mode but is set to <tt class="docutils literal">OFF</tt> by
default in release mode.  In addition, strong compiler warnings are enabled
by default in development mode but are disabled by default in release mode.
This variable also affects the behavior of <a class="reference internal" href="#tribits-set-st-for-dev-mode">TRIBITS_SET_ST_FOR_DEV_MODE()</a>.</blockquote>
<p id="project-name-enable-export-makefiles"><strong>${PROJECT_NAME}_ENABLE_EXPORT_MAKEFILES</strong></p>
<blockquote>
<p>If <tt class="docutils literal">${PROJECT_NAME}_ENABLE_EXPORT_MAKEFILES</tt> is <tt class="docutils literal">ON</tt>, then
<tt class="docutils literal"><span class="pre">Makefile.export.&lt;PackageName&gt;</span></tt> will get created at configure time in the
build tree and installed into the install tree.  See <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html">TribitsBuildQuickRef</a>
for details.  The TriBITS default is <tt class="docutils literal">ON</tt> but a project can decide to turn
this off by default by setting:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_ENABLE_EXPORT_MAKEFILES_DEFAULT OFF)
</pre>
<p>A project might want to disable the generation of export makefiles by default
if its main purpose is to provide executables.  There is no reason to provide
an export makefile if libraries and headers are not actually installed (see
<a class="reference internal" href="#project-name-install-libraries-and-headers">${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS</a>)</p>
</blockquote>
<p id="project-name-enable-fortran"><strong>${PROJECT_NAME}_ENABLE_Fortran</strong></p>
<blockquote>
<p>If <tt class="docutils literal">${PROJECT_NAME}_ENABLE_Fortran</tt> is <tt class="docutils literal">ON</tt>, then Fortran support for
the project will be enabled and the Fortran compiler(s) must be found.  By
default, TriBITS sets this to <tt class="docutils literal">ON</tt> for non-Windows systems (i.e. <tt class="docutils literal">WIN32</tt>
is not set by CMake) but is <tt class="docutils literal">OFF</tt> for a Windows system.  A project that
always requires Fortran, for example, it can set the default:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_ENABLE_Fortran_DEFAULT TRUE)
</pre>
<p>If a project does not have any native Fortran code a good default would be:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_ENABLE_Fortran_DEFAULT OFF)
</pre>
<p>NOTE: It is usually not a good idea to always force off Fortran, or any
compiler, because extra repositories and packages might be added by someone
that might require the compiler and we don't want to unnecessarily limit the
generality of a given TriBITS build.  Setting the default for all platforms
should be sufficient.</p>
</blockquote>
<p id="project-name-enable-install-cmake-config-files"><strong>${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES</strong></p>
<blockquote>
<p>If <tt class="docutils literal">${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES</tt> is set to <tt class="docutils literal">ON</tt>,
then <tt class="docutils literal">&lt;PackageName&gt;Config.cmake</tt> files are created at configure time in
the build tree and installed into the install tree.  These files are used by
external CMake projects to pull in the list of compilers, compiler options,
include directories and libraries.  The TriBITS default is <tt class="docutils literal">ON</tt> but a
project can change the default by setting, for example:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES_DEFAULT OFF)
</pre>
<p>A project would want to turn off the creation and installation of
<tt class="docutils literal">&lt;PackageName&gt;Config.cmake</tt> files if it was only installing and providing
executables (see <a class="reference internal" href="#project-name-install-libraries-and-headers">${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS</a>).</p>
</blockquote>
<p id="project-name-exclude-disabled-subpackages-from-distribution"><strong>${PROJECT_NAME}_EXCLUDE_DISABLED_SUBPACKAGES_FROM_DISTRIBUTION</strong></p>
<blockquote>
<p>If <tt class="docutils literal">${PROJECT_NAME}_EXCLUDE_DISABLED_SUBPACKAGES_FROM_DISTRIBUTION</tt> is
<tt class="docutils literal">TRUE</tt>, then the directories for subpackages that are not enabled are left
out of the source tarball.  This reduces the size of the tarball as much as
possible but does require that the TriBITS packages and subpackages be
properly set up to allow disabled subpackages from being excluded.  The
TriBITS default is <tt class="docutils literal">TRUE</tt> but this can be changed by setting:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_EXCLUDE_DISABLED_SUBPACKAGES_FROM_DISTRIBUTION_DEFAULT FALSE)
</pre>
</blockquote>
<p id="project-name-generate-export-file-dependencies"><strong>${PROJECT_NAME}_GENERATE_EXPORT_FILE_DEPENDENCIES</strong></p>
<blockquote>
<p>If <tt class="docutils literal">${PROJECT_NAME}_GENERATE_EXPORT_FILE_DEPENDENCIES</tt> is <tt class="docutils literal">ON</tt>, then the
data-structures needed to generate <tt class="docutils literal"><span class="pre">Makefile.export.&lt;PackageName&gt;</span></tt> and
<tt class="docutils literal">&lt;PackageName&gt;Config.cmake</tt> are created.  These data structures are also
needed in order to generate export makefiles on demand using the function
<a class="reference internal" href="#tribits-write-flexible-package-client-export-files">TRIBITS_WRITE_FLEXIBLE_PACKAGE_CLIENT_EXPORT_FILES()</a>.  The default in
TriBITS is to turn this <tt class="docutils literal">ON</tt> automatically by default if
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_EXPORT_MAKEFILES</tt> or
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES</tt> are <tt class="docutils literal">ON</tt>.  Else, by
default, TriBITS sets this to <tt class="docutils literal">OFF</tt>.  The only reason for the project to
override the default is to set it to <tt class="docutils literal">ON</tt> as with:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_GENERATE_EXPORT_FILE_DEPENDENCIES_DEFAULT ON)
</pre>
<p>is so that the necessary data-structures are generated in order to use the
function <a class="reference internal" href="#tribits-write-flexible-package-client-export-files">TRIBITS_WRITE_FLEXIBLE_PACKAGE_CLIENT_EXPORT_FILES()</a>.</p>
</blockquote>
<p id="project-name-install-libraries-and-headers"><strong>${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS</strong></p>
<blockquote>
<p>If <tt class="docutils literal">${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS</tt> is set to <tt class="docutils literal">ON</tt>, then
any defined libraries or header files that are listed in calls to
<a class="reference internal" href="#tribits-add-library">TRIBITS_ADD_LIBRARY()</a> will be installed (unless options are passed into
<a class="reference internal" href="#tribits-add-library">TRIBITS_ADD_LIBRARY()</a> that disable installs).  If set to <tt class="docutils literal">OFF</tt>, then
headers and libraries will <em>not</em> be installed by default and only
<tt class="docutils literal">INSTALLABLE</tt> executables added with <a class="reference internal" href="#tribits-add-executable">TRIBITS_ADD_EXECUTABLE()</a> will be
installed.  However, as described in <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html">TribitsBuildQuickRef</a>, shared
libraries will always be installed if enabled since they are needed by the
installed executables.</p>
<p>For a TriBITS project that primarily is delivering libraries
(e.g. Trilinos), then it makes sense to leave the TriBITS default which is
<tt class="docutils literal">ON</tt> or explicitly set:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS_DEFAULT ON)
</pre>
<p>For a TriBITS project that is primarily delivering executables (e.g. VERA),
then it makes sense to set the default to:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS_DEFAULT OFF)
</pre>
</blockquote>
<p id="project-name-show-test-start-end-date-time"><strong>${PROJECT_NAME}_SHOW_TEST_START_END_DATE_TIME</strong></p>
<blockquote>
<p>The cache variable <tt class="docutils literal">${PROJECT_NAME}_SHOW_TEST_START_END_DATE_TIME</tt>
determines if the start and end date/time for each advanced test (i.e. added
with <a class="reference internal" href="#tribits-add-advanced-test">TRIBITS_ADD_ADVANCED_TEST()</a>) is printed or not with each test.  The
TriBITS default is <tt class="docutils literal">OFF</tt> but a TriBITS project can change this default by
setting:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_SHOW_TEST_START_END_DATE_TIME_DEFAULT ON)
</pre>
<p>The implementation of this feature currently uses <tt class="docutils literal">EXECUTE_PROCESS(date)</tt>
and therefore will only on Linux/Unix/Mac systems and not Windows systems.</p>
<p>NOTE: In a future version of CTest, this option may turn on start and end
date/time for regular tests added with <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> (which uses a
raw command with <tt class="docutils literal">ADD_TEST()</tt>).</p>
</blockquote>
<p id="project-name-test-categories-default"><span id="project-name-test-categories"></span><strong>${PROJECT_NAME}_TEST_CATEGORIES</strong></p>
<blockquote>
<p>The cache variable <tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt> determines what tests
defined using <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> and <a class="reference internal" href="#tribits-add-advanced-test">TRIBITS_ADD_ADVANCED_TEST()</a> will
be added for <tt class="docutils literal">ctest</tt> to run (see <a class="reference internal" href="#test-test-category">Test Test Category</a>).  The TriBITS
default is <tt class="docutils literal">NIGHTLY</tt> for a standard local build.  The <a class="reference internal" href="#checkin-test-py">checkin-test.py</a>
script sets this to <tt class="docutils literal">BASIC</tt> by default.  A TriBITS project can override
the default for a basic configure using, for example:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_TEST_CATEGORIES_DEFAULT BASIC)
</pre>
<p>The justification for having the default <a class="reference internal" href="#test-test-category">Test Test Category</a> be
<tt class="docutils literal">NIGHTLY</tt> instead of <tt class="docutils literal">BASIC</tt> is that when someone is enabling a package
to develop on it or install it, we want them by default to be seeing the
full version of the test suite (shy of the <a class="reference internal" href="#test-test-category-weekly">Test Test Category WEEKLY</a>
tests which can be very expensive) for the packages they are explicitly
enabling.  Typically they will not be enabling forward/<a class="reference internal" href="#downstream">downstream</a>
dependent packages so the cost of running the test suite should not be too
prohibitive.  This all depends on how good of a job the development teams do
in making their test suites run fast and keeping the cost of running the
tests down.  See the section <a class="reference internal" href="#tribits-automated-testing">TriBITS Automated Testing</a> for a more
detailed discussion.</p>
</blockquote>
<p id="project-name-use-gnuinstalldirs"><strong>${PROJECT_NAME}_USE_GNUINSTALLDIRS</strong></p>
<blockquote>
<p>If <tt class="docutils literal">${PROJECT_NAME}_USE_GNUINSTALLDIRS</tt> is set to <tt class="docutils literal">TRUE</tt>, then the
default install paths will be determined by the standard CMake module
<tt class="docutils literal">GNUInstallDirs</tt>.  Otherwise, platform independent install paths are used
by default.</p>
<p>A project can use the paths given the cmake module <tt class="docutils literal">GNUInstallDirs</tt> by
default by setting:</p>
<pre class="literal-block">
SET(${PROJECT_NAME}_USE_GNUINSTALLDIRS_DEFAULT FALSE)
</pre>
<p>in the project's top-level <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file or its
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.  The default is <tt class="docutils literal">FALSE</tt>.</p>
</blockquote>
<p id="mpi-exec-max-numprocs"><strong>MPI_EXEC_MAX_NUMPROCS</strong></p>
<blockquote>
<p>The variable <tt class="docutils literal">MPI_EXEC_MAX_NUMPROCS</tt> gives the maximum number of processes
for an MPI test that will be allowed as defined by <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> and
<a class="reference internal" href="#tribits-add-advanced-test">TRIBITS_ADD_ADVANCED_TEST()</a>.  The TriBITS default is set to be <tt class="docutils literal">4</tt> (for
no good reason really but it needs to stay that way for backward
compatibility).  This default can be changed by setting:</p>
<pre class="literal-block">
SET(MPI_EXEC_MAX_NUMPROCS_DEFAULT &lt;newDefaultMax&gt;)
</pre>
<p>While this default can be changed for the project as a whole on all
platforms, it is likely better to change this default on a
machine-by-machine basis to correspond to the load that can be accommodated
by a given machine (or class of machines).  For example if a given machine
has 64 cores, a reasonable number for <tt class="docutils literal">MPI_EXEC_MAX_NUMPROCS_DEFAULT</tt> is
64.</p>
</blockquote>
</div>
<div class="section" id="tribits-macros-and-functions">
<h2><a class="toc-backref" href="#id101">12.2&nbsp;&nbsp;&nbsp;TriBITS Macros and Functions</a></h2>
<p>The following subsections give detailed documentation for the CMake macros and
functions that make up the core TriBITS system.  These are what are used by
TriBITS project developers in their <tt class="docutils literal">CMakeLists.txt</tt> and other files.  All
of these functions and macros should be automatically available when
processing the project's and package's variables files if used properly.
Therefore, no explicit <tt class="docutils literal">INCLUDE()</tt> statements should be needed other than
the initial include of the <tt class="docutils literal">TriBITS.cmake</tt> file in the top-level
<a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file so the command <a class="reference internal" href="#id2">TRIBITS_PROJECT()</a> can be
executed.</p>
<!-- WARNING: The file TribitsDetailedMacroFunctionDoc.rst is autogenerated from -->
<!-- the file TribitsDetailedMacroFunctionDocTemplate.rst in the script -->
<!-- generate-dev-guide.sh.  Only the file TribitsDetailedMacroFunctionDoc.rst -->
<!-- should be directly modified! -->
<div class="section" id="tribits-add-advanced-test">
<h3><a class="toc-backref" href="#id102">TRIBITS_ADD_ADVANCED_TEST()</a></h3>
<p>Function that creates an advanced test defined by stringing together one or
more executables and/or commands that is run as a <tt class="docutils literal">cmake <span class="pre">-P</span></tt> script with
very flexible pass/fail criteria.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_ADVANCED_TEST(
  &lt;testNameBase&gt;
  TEST_0 (EXEC &lt;execTarget0&gt; | CMND &lt;cmndExec0&gt;) ...
  [TEST_1 (EXEC &lt;execTarget1&gt; | CMND &lt;cmndExec1&gt;) ...]
  ...
  [TEST_N (EXEC &lt;execTargetN&gt; | CMND &lt;cmndExecN&gt;) ...]
  [OVERALL_WORKING_DIRECTORY (&lt;overallWorkingDir&gt; | TEST_NAME)]
  [FAIL_FAST]
  [RUN_SERIAL]
  [KEYWORDS &lt;keyword1&gt; &lt;keyword2&gt; ...]
  [COMM [serial] [mpi]]
  [OVERALL_NUM_MPI_PROCS &lt;overallNumProcs&gt;]
  [OVERALL_NUM_TOTAL_CORES_USED &lt;overallNumTotalCoresUsed&gt;]
  [CATEGORIES &lt;category0&gt; &lt;category1&gt; ...]
  [HOST &lt;host0&gt; &lt;host1&gt; ...]
  [XHOST &lt;host0&gt; &lt;host1&gt; ...]
  [HOSTTYPE &lt;hosttype0&gt; &lt;hosttype1&gt; ...]
  [XHOSTTYPE &lt;hosttype0&gt; &lt;hosttype1&gt; ...]
  [FINAL_PASS_REGULAR_EXPRESSION &lt;regex&gt; |
    FINAL_FAIL_REGULAR_EXPRESSION &lt;regex&gt;]
  [ENVIRONMENT &lt;var1&gt;=&lt;value1&gt; &lt;var2&gt;=&lt;value2&gt; ...]
  [TIMEOUT &lt;maxSeconds&gt;]
  [ADDED_TEST_NAME_OUT &lt;testName&gt;]
  )
</pre>
<p>This function allows one to add a single CTest test that is actually a
sequence of one or more separate commands strung together in some way to
define the final pass/fail. One will want to use this function to add a test
instead of <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> when one needs to run more than one
command, or one needs more sophisticated checking of the test result other
than just grepping STDOUT (e.g. by running separate post-processing programs
to examine output files).</p>
<p>Each atomic test case is either a package-built executable or just a basic
command.  An atomic test command block <tt class="docutils literal">TEST_&lt;idx&gt;</tt> (i.e. <tt class="docutils literal">TEST_0</tt>,
<tt class="docutils literal">TEST_1</tt>, ...) takes the form:</p>
<pre class="literal-block">
TEST_&lt;idx&gt;
   (EXEC &lt;exeRootName&gt; [NOEXEPREFIX] [NOEXESUFFIX] [ADD_DIR_TO_NAME]
          [DIRECTORY &lt;dir&gt;]
      | CMND &lt;cmndExec&gt;)
   [ARGS &lt;arg1&gt; &lt;arg2&gt; ... &lt;argn&gt;]
   [MESSAGE &quot;&lt;message&gt;&quot;]
   [WORKING_DIRECTORY &lt;workingDir&gt;]
   [NUM_MPI_PROCS &lt;numProcs&gt;]
   [NUM_TOTAL_CORES_USED &lt;numTotalCoresUsed&gt;]
   [OUTPUT_FILE &lt;outputFile&gt;]
   [NO_ECHO_OUTPUT]]
   [PASS_ANY
     | PASS_REGULAR_EXPRESSION &quot;&lt;regex&gt;&quot;
     | PASS_REGULAR_EXPRESSION_ALL &quot;&lt;regex1&gt;&quot; &quot;&lt;regex2&gt;&quot; ... &quot;&lt;regexn&gt;&quot;
     | FAIL_REGULAR_EXPRESSION &quot;&lt;regex&gt;&quot;
     | STANDARD_PASS_OUTPUT
     ]
</pre>
<p>By default, each and every atomic test or command needs to pass (as defined below) in
order for the overall test to pass.</p>
<p><em>Sections:</em></p>
<ul class="simple">
<li><a class="reference internal" href="#overall-arguments-tribits-add-advanced-test">Overall Arguments (TRIBITS_ADD_ADVANCED_TEST())</a></li>
<li><a class="reference internal" href="#test-idx-test-blocks-and-arguments-tribits-add-advanced-test">TEST_&lt;idx&gt; Test Blocks and Arguments (TRIBITS_ADD_ADVANCED_TEST())</a></li>
<li><a class="reference internal" href="#overall-pass-fail-tribits-add-advanced-test">Overall Pass/Fail (TRIBITS_ADD_ADVANCED_TEST())</a></li>
<li><a class="reference internal" href="#argument-parsing-and-ordering-tribits-add-advanced-test">Argument Parsing and Ordering (TRIBITS_ADD_ADVANCED_TEST())</a></li>
<li><a class="reference internal" href="#implementation-details-tribits-add-advanced-test">Implementation Details (TRIBITS_ADD_ADVANCED_TEST())</a></li>
<li><a class="reference internal" href="#setting-additional-test-properties-tribits-add-advanced-test">Setting Additional Test Properties (TRIBITS_ADD_ADVANCED_TEST())</a></li>
<li><a class="reference internal" href="#running-multiple-tests-at-the-same-time-tribits-add-advanced-test">Running multiple tests at the same time (TRIBITS_ADD_ADVANCED_TEST())</a></li>
<li><a class="reference internal" href="#disabling-tests-externally-tribits-add-advanced-test">Disabling Tests Externally (TRIBITS_ADD_ADVANCED_TEST())</a></li>
<li><a class="reference internal" href="#debugging-and-examining-test-generation-tribits-add-advanced-test">Debugging and Examining Test Generation (TRIBITS_ADD_ADVANCED_TEST())</a></li>
</ul>
<p id="overall-arguments-tribits-add-advanced-test"><strong>Overall Arguments (TRIBITS_ADD_ADVANCED_TEST())</strong></p>
<p>Below, some of the overall arguments are described.  The rest of the overall
arguments that control overall pass/fail are described in <a class="reference internal" href="#overall-pass-fail-tribits-add-advanced-test">Overall Pass/Fail
(TRIBITS_ADD_ADVANCED_TEST())</a>.  (NOTE: All of these arguments must be
listed outside of the <tt class="docutils literal">TEST_&lt;idx&gt;</tt> blocks, see <a class="reference internal" href="#argument-parsing-and-ordering-tribits-add-advanced-test">Argument Parsing and
Ordering (TRIBITS_ADD_ADVANCED_TEST())</a>).</p>
<blockquote>
<p><tt class="docutils literal">&lt;testNameBase&gt;</tt></p>
<blockquote>
The base name of the test (which will have <tt class="docutils literal">${PACKAGE_NAME}_</tt>
prepended to the name, see &lt;testName&gt; below) that will be used to name
the output CMake script file as well as the CTest test name passed into
<tt class="docutils literal">ADD_TEST()</tt>.  This must be the first argument to this function.</blockquote>
<p><tt class="docutils literal">OVERALL_WORKING_DIRECTORY &lt;overallWorkingDir&gt;</tt></p>
<blockquote>
If specified, then the working directory <tt class="docutils literal">&lt;overallWorkingDir&gt;</tt> will be
created and all of the test commands by default will be run from within
this directory.  If the value <tt class="docutils literal"><span class="pre">&lt;overallWorkingDir&gt;=TEST_NAME</span></tt> is
given, then the working directory will be given the name <tt class="docutils literal">&lt;testName&gt;</tt>.
If the directory <tt class="docutils literal">&lt;overallWorkingDir&gt;</tt> exists before the test runs, it
will be deleted and created again.  Therefore, if one wants to preserve
the contents of this directory between test runs then one needs to copy
the files it contains somewhere else.  This is a good option to use if
the commands create intermediate files and one wants to make sure they
get deleted before the test cases are run again.  This is also a very
useful option to use if multiple tests are defined in the same
<tt class="docutils literal">CMakeLists.txt</tt> file that read/write files with the same name.</blockquote>
<p><tt class="docutils literal">FAIL_FAST</tt></p>
<blockquote>
If specified, then the remaining test commands will be aborted when any
test command fails.  Otherwise, all of the test cases will be run.</blockquote>
<p><tt class="docutils literal">RUN_SERIAL</tt></p>
<blockquote>
If specified then no other tests will be allowed to run while this test
is running.  This is useful for devices (like CUDA cards) that require
exclusive access for processes/threads.  This just sets the CTest test
property <tt class="docutils literal">RUN_SERIAL</tt> using the built-in CMake function
<tt class="docutils literal">SET_TESTS_PROPERTIES()</tt>.</blockquote>
<p><tt class="docutils literal">COMM [serial] [mpi]</tt></p>
<blockquote>
If specified, selects if the test will be added in serial and/or MPI
mode.  See the <tt class="docutils literal">COMM</tt> argument in the script
<a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> for more details.</blockquote>
<p><tt class="docutils literal">OVERALL_NUM_MPI_PROCS &lt;overallNumProcs&gt;</tt></p>
<blockquote>
If specified, gives the default number of MPI processes that each
executable command runs on.  If <tt class="docutils literal">&lt;overallNumProcs&gt;</tt> is greater than
<tt class="docutils literal">${MPI_EXEC_MAX_NUMPROCS}</tt> then the test will be excluded.  If not
specified, then the default number of processes for an MPI build will be
<tt class="docutils literal">${MPI_EXEC_DEFAULT_NUMPROCS}</tt>.  For serial builds, this argument is
ignored.  For MPI builds with all <tt class="docutils literal">TEST_&lt;IDX&gt; CMND</tt> blocks,
<tt class="docutils literal">&lt;overallNumProcs&gt;</tt> is used to set the property <tt class="docutils literal">PROCESSORS</tt>. (see
<a class="reference internal" href="#running-multiple-tests-at-the-same-time-tribits-add-advanced-test">Running multiple tests at the same time
(TRIBITS_ADD_ADVANCED_TEST())</a>).  <strong>WARNING!</strong> If just running a serial
script or other command, then the property <tt class="docutils literal">PROCESSORS</tt> will still get
set to <tt class="docutils literal">${OVERALL_NUM_MPI_PROCS}</tt> so in order to avoid CTest
unnecessarily reserving <tt class="docutils literal">${OVERALL_NUM_MPI_PROCS}</tt> processes for a
serial non-MPI test, then one must leave off <tt class="docutils literal">OVERALL_NUM_MPI_PROCS</tt>
or explicitly pass in <tt class="docutils literal">MPI_EXEC_DEFAULT_NUMPROCS 1</tt>!</blockquote>
<p><tt class="docutils literal">OVERALL_NUM_TOTAL_CORES_USED &lt;overallNumTotalCoresUsed&gt;</tt></p>
<blockquote>
Used for <tt class="docutils literal">NUM_TOTAL_CORES_USED</tt> if missing in a <tt class="docutils literal">TEST_&lt;IDX&gt;</tt> block.</blockquote>
<p><tt class="docutils literal">CATEGORIES &lt;category0&gt; &lt;category1&gt; ...</tt></p>
<blockquote>
Gives the <a class="reference internal" href="#test-test-categories">Test Test Categories</a> for which this test will be added.
See <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> for more details.</blockquote>
<p><tt class="docutils literal">HOST &lt;host0&gt; &lt;host1&gt; ...</tt></p>
<blockquote>
The list of hosts for which to enable the test (see
<a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>).</blockquote>
<p><tt class="docutils literal">XHOST &lt;host0&gt; &lt;host1&gt; ...</tt></p>
<blockquote>
The list of hosts for which <strong>not</strong> to enable the test (see
<a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>).</blockquote>
<p><tt class="docutils literal">HOSTTYPE &lt;hosttype0&gt; &lt;hosttype1&gt; ...</tt></p>
<blockquote>
The list of host types for which to enable the test (see
<a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>).</blockquote>
<p><tt class="docutils literal">XHOSTTYPE &lt;hosttype0&gt; &lt;hosttype1&gt; ...</tt></p>
<blockquote>
The list of host types for which <strong>not</strong> to enable the test (see
<a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>).</blockquote>
<p><tt class="docutils literal">ENVIRONMENT <span class="pre">&lt;var1&gt;=&lt;value1&gt;</span> <span class="pre">&lt;var2&gt;=&lt;value2&gt;</span> ..</tt>.</p>
<blockquote>
If passed in, the listed environment variables will be set before
calling the test.  This is set using the built-in CTest test property
<tt class="docutils literal">ENVIRONMENT</tt>.</blockquote>
<p><tt class="docutils literal">TIMEOUT &lt;maxSeconds&gt;</tt></p>
<blockquote>
If passed in, gives maximum number of seconds the test will be allowed
to run before being timed-out (see <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>).  This is for
the full CTest test, not individual <tt class="docutils literal">TEST_&lt;idx&gt;</tt> commands!</blockquote>
<p><tt class="docutils literal">ADDED_TEST_NAME_OUT &lt;testName&gt;</tt></p>
<blockquote>
If specified, then on output the variable <tt class="docutils literal">&lt;testName&gt;</tt> will be set
with the name of the test passed to <tt class="docutils literal">ADD_TEST()</tt>.  Having this name
allows the calling <tt class="docutils literal">CMakeLists.txt</tt> file access and set additional
test propeties (see <a class="reference internal" href="#setting-additional-test-properties-tribits-add-advanced-test">Setting additional test properties
(TRIBITS_ADD_ADVANCED_TEST())</a>).</blockquote>
</blockquote>
<p id="test-idx-test-blocks-and-arguments-tribits-add-advanced-test"><strong>TEST_&lt;idx&gt; Test Blocks and Arguments (TRIBITS_ADD_ADVANCED_TEST())</strong></p>
<p>Each test command block <tt class="docutils literal">TEST_&lt;idx&gt;</tt> runs either a package-built test
executable or some general command executable and is defined as either
<tt class="docutils literal">EXEC &lt;exeRootName&gt;</tt> or <tt class="docutils literal">CMND &lt;cmndExec&gt;</tt> with the arguments:</p>
<blockquote>
<p><tt class="docutils literal">EXEC &lt;exeRootName&gt; [NOEXEPREFIX] [NOEXESUFFIX] [ADD_DIR_TO_NAME]
[DIRECTORY &lt;dir&gt;]</tt></p>
<blockquote>
If <tt class="docutils literal">EXEC</tt> is specified, then <tt class="docutils literal">&lt;exeRootName&gt;</tt> gives the root name of
an executable target that will be run as the command.  The full
executable name and path is determined in exactly the same way it is in
the <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> function (see <a class="reference internal" href="#determining-the-executable-or-command-to-run-tribits-add-test">Determining the Executable or
Command to Run (TRIBITS_ADD_TEST())</a>).  If this is an MPI build, then
the executable will be run with MPI using <tt class="docutils literal">NUM_MPI_PROCS &lt;numProcs&gt;</tt>
(or <tt class="docutils literal">OVERALL_NUM_MPI_PROCS &lt;overallNumProcs&gt;</tt> if <tt class="docutils literal">NUM_MPI_PROCS</tt> is
not set for this test case).  If the maximum number of MPI processes
allowed is less than this number of MPI processes, then the test will
<em>not</em> be run.  Note that <tt class="docutils literal">EXEC &lt;exeRootName&gt;</tt> when <tt class="docutils literal">NOEXEPREFIX</tt> and
<tt class="docutils literal">NOEXESUFFIX</tt> are specified is basically equivalent to <tt class="docutils literal">CMND
&lt;cmndExec&gt;</tt> except that in an MPI build, <tt class="docutils literal">&lt;exeRootName&gt;</tt> is always
run using MPI.  In this case, one can pass in <tt class="docutils literal">&lt;exeRootName&gt;</tt> to any
command one would like and it will get run with MPI in MPI mode just
link any other MPI-enabled built executable.</blockquote>
<p><tt class="docutils literal">CMND &lt;cmndExec&gt;</tt></p>
<blockquote>
<p>If <tt class="docutils literal">CMND</tt> is specified, then <tt class="docutils literal">&lt;cmndExec&gt;</tt> gives the executable for a
command to be run.  In this case, MPI will never be used to run the
executable even when configured in MPI mode
(i.e. <tt class="docutils literal">TPL_ENABLE_MPI=ON</tt>).  If one wants to run an arbitrary command
using MPI, use <tt class="docutils literal">EXEC &lt;fullPathToCmndExec&gt; NOEXEPREFIX NOEXESUFFIX</tt>
instead.  <strong>WARNING:</strong> If you want to run such tests using valgrind, you
have to use the raw executable as the <tt class="docutils literal">&lt;cmndExec&gt;</tt> argument and <em>not</em>
the script.  For example, if you have a python script
<tt class="docutils literal">my_python_test.py</tt> with <tt class="docutils literal">/usr/bin/env pyhton</tt> at the top, you can't
just use:</p>
<pre class="literal-block">
CMND &lt;path&gt;/my_python_test.py ARGS &lt;arg0&gt; &lt;arg1&gt; ...
</pre>
<p>The same goes for Perl or any other scripting language.</p>
<p>Instead, you have to use:</p>
<pre class="literal-block">
CMND ${PYTHON_EXECUTABLE} ARGS &lt;path&gt;/my_python_test.py &lt;arg0&gt; &lt;arg1&gt; ...
</pre>
</blockquote>
</blockquote>
<p>By default, the output (stdout/stderr) for each test command is captured and
is then echoed to stdout for the overall test.  This is done in order to be
able to grep the result to determine pass/fail.</p>
<p>Other miscellaneous arguments for each <tt class="docutils literal">TEST_&lt;idx&gt;</tt> block include:</p>
<blockquote>
<p><tt class="docutils literal">DIRECTORY &lt;dir&gt;</tt></p>
<blockquote>
If specified, then the executable is assumed to be in the directory
given by relative <tt class="docutils literal">&lt;dir&gt;</tt>.  See <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>.</blockquote>
<p><tt class="docutils literal">MESSAGE &quot;&lt;message&gt;&quot;</tt></p>
<blockquote>
If specified, then the string in <tt class="docutils literal">&quot;&lt;message&gt;&quot;</tt> will be printed before
this test command is run.  This allows adding some documentation about
each individual test invocation to make the test output more
understandable.</blockquote>
<p><tt class="docutils literal">WORKING_DIRECTORY &lt;workingDir&gt;</tt></p>
<blockquote>
If specified, then the working directory <tt class="docutils literal">&lt;workingDir&gt;</tt> will be
created and the test will be run from within this directory.  If the
value <tt class="docutils literal">&lt;workingDir&gt; = TEST_NAME</tt> is given, then the working directory
will be given the name <tt class="docutils literal">&lt;testName&gt;</tt>.  If the directory
<tt class="docutils literal">&lt;workingDir&gt;</tt> exists before the test runs, it will be deleted and
created again.  Therefore, if one wants to preserve the contents of this
directory between test runs then one needs to copy the given file
somewhere else.  Using a different <tt class="docutils literal">WORKING_DIRECTORY</tt> for individual
test commands allows creating independent working directories for each
test case.  This would be useful if a single
<tt class="docutils literal">OVERALL_WORKING_DIRECTORY</tt> was not sufficient for some reason.</blockquote>
<p><tt class="docutils literal">NUM_MPI_PROCS &lt;numProcs&gt;</tt></p>
<blockquote>
If specified, then <tt class="docutils literal">&lt;numProcs&gt;</tt> is the number of processors used for
MPI executables.  If not specified, this will default to
<tt class="docutils literal">&lt;overallNumProcs&gt;</tt> from <tt class="docutils literal">OVERALL_NUM_MPI_PROCS &lt;overallNumProcs&gt;</tt>.</blockquote>
<p><tt class="docutils literal">NUM_TOTAL_CORES_USED &lt;numTotalCoresUsed&gt;</tt></p>
<blockquote>
If specified, gives the total number of processes used by this
command/executable.  If this is missing, but <tt class="docutils literal">NUM_MPI_PROCS
&lt;numProcs&gt;</tt> is specified, then <tt class="docutils literal">&lt;numProcs&gt;</tt> is used instead.  If
<tt class="docutils literal">NUM_TOTAL_CORES_USED</tt> is missing BUT <tt class="docutils literal">OVERALL_NUM_TOTAL_CORES_USED
&lt;overallNumTotalCoresUsed&gt;</tt> is, then <tt class="docutils literal">&lt;overallNumTotalCoresUsed&gt;</tt> is
used for <tt class="docutils literal">&lt;numTotalCoresUsed&gt;</tt>.  This argument is used for test
scripts/executables that use more cores than MPI processes
(i.e. <tt class="docutils literal">&lt;numProcs&gt;</tt>) and its only purpose is to inform CTest and
TriBITS of the maximum number of cores that are used by the underlying
test executable/script.  When <tt class="docutils literal">&lt;numTotalCoresUsed&gt;</tt> is greater than
<tt class="docutils literal">${MPI_EXEC_MAX_NUMPROCS}</tt>, then the test will not be added.
Otherwise, the CTest property <tt class="docutils literal">PROCESSORS</tt> is set to the max over all
<tt class="docutils literal">&lt;numTotalCoresUsed&gt;</tt> so that CTest knows how to best schedule the
test w.r.t. other tests on a given number of available processes.</blockquote>
<p><tt class="docutils literal">OUTPUT_FILE &lt;outputFile&gt;</tt></p>
<blockquote>
<p>If specified, then stdout and stderr for the test case will be sent to
<tt class="docutils literal">&lt;outputFile&gt;</tt>.  By default, the contents of this file will <strong>also</strong>
be printed to STDOUT unless <tt class="docutils literal">NO_ECHO_OUT</tt> is passed as well.</p>
<p>NOTE: Contrary to CMake documentation for EXECUTE_PROCESS(), STDOUT and
STDERR may not get output in the correct order interleaved correctly,
even in serial without MPI.  Therefore, you can't write any tests that
depend on the order of STDOUT and STDERR output in relation to each
other.  Also note that all of STDOUT and STDERR will be first read into
the CTest executable process main memory before the file
<tt class="docutils literal">&lt;outputFile&gt;</tt> is written.  Therefore, don't run executables or
commands that generate massive amounts of console output or it may
exhaust main memory.  Instead, have the command or executable write
directly to a file instead of going through STDOUT.</p>
</blockquote>
<p><tt class="docutils literal">NO_ECHO_OUTPUT</tt></p>
<blockquote>
If specified, then the output for the test command will not be echoed to
the output for the entire test command.</blockquote>
</blockquote>
<p>By default, an atomic test line is assumed to pass if the executable or
commands returns a non-zero value to the shell.  However, a test case can
also be defined to pass based on:</p>
<blockquote>
<p><tt class="docutils literal">PASS_ANY</tt></p>
<blockquote>
If specified, the test command will be assumed to pass regardless of
the return value or any other output.  This would be used when a command
that is to follow will determine pass or fail based on output from this
command in some way.</blockquote>
<p><tt class="docutils literal">PASS_REGULAR_EXPRESSION &quot;&lt;regex&gt;&quot;</tt></p>
<blockquote>
If specified, the test command will be assumed to pass if it matches the
given regular expression.  Otherwise, it is assumed to fail.  TIPS:
Replace ';' with '[;]' or CMake will interpretet this as a array eleemnt
boundary.  To match '.', use '[.]'.</blockquote>
<p><tt class="docutils literal">PASS_REGULAR_EXPRESSION_ALL &quot;&lt;regex1&gt;&quot; &quot;&lt;regex2&gt;&quot; ... &quot;&lt;regexn&gt;&quot;</tt></p>
<blockquote>
If specified, the test command will be assumed to pass if the output
matches all of the provided regular expressions.  Note that this is not
a capability of raw ctest and represents an extension provided by
TriBITS.  NOTE: It is critical that you replace ';' with '[;]' or CMake
will interpretet this as a array eleemnt boundary.</blockquote>
<p><tt class="docutils literal">FAIL_REGULAR_EXPRESSION &quot;&lt;regex&gt;&quot;</tt></p>
<blockquote>
If specified, the test command will be assumed to fail if it matches the
given regular expression.  Otherwise, it is assumed to pass.</blockquote>
<p><tt class="docutils literal">STANDARD_PASS_OUTPUT</tt></p>
<blockquote>
If specified, the test command will be assumed to pass if the string
expression &quot;Final Result: PASSED&quot; is found in the output for the test.</blockquote>
</blockquote>
<p>All of the arguments for a test block <tt class="docutils literal">TEST_&lt;idx&gt;</tt> must appear directly
below their <tt class="docutils literal">TEST_&lt;idx&gt;</tt> argument and before the next test block (see
<a class="reference internal" href="#argument-parsing-and-ordering-tribits-add-advanced-test">Argument Parsing and Ordering (TRIBITS_ADD_ADVANCED_TEST())</a>).</p>
<p id="overall-pass-fail-tribits-add-advanced-test"><strong>Overall Pass/Fail (TRIBITS_ADD_ADVANCED_TEST())</strong></p>
<p>By default, the overall test will be assumed to pass if it prints:</p>
<pre class="literal-block">
&quot;OVERALL FINAL RESULT: TEST PASSED (&lt;testName&gt;)&quot;
</pre>
<p>However, this can be changed by setting one of the following optional arguments:</p>
<blockquote>
<p><tt class="docutils literal">FINAL_PASS_REGULAR_EXPRESSION &lt;regex&gt;</tt></p>
<blockquote>
If specified, the test will be assumed to pass if the output matches
<tt class="docutils literal">&lt;regex&gt;</tt>.  Otherwise, it will be assumed to fail.</blockquote>
<p><tt class="docutils literal">FINAL_FAIL_REGULAR_EXPRESSION &lt;regex&gt;</tt></p>
<blockquote>
If specified, the test will be assumed to fail if the output matches
<tt class="docutils literal">&lt;regex&gt;</tt>.  Otherwise, it will be assumed to fail.</blockquote>
</blockquote>
<p id="argument-parsing-and-ordering-tribits-add-advanced-test"><strong>Argument Parsing and Ordering (TRIBITS_ADD_ADVANCED_TEST())</strong></p>
<p>The basic tool used for parsing the arguments to this function is the macro
<a class="reference internal" href="#parse-arguments">PARSE_ARGUMENTS()</a> which has a certain set of behaviors.  The parsing
using <a class="reference internal" href="#parse-arguments">PARSE_ARGUMENTS()</a> is actually done in two phases.  There is a
top-level parsing of the &quot;overall&quot; arguments listed in <a class="reference internal" href="#overall-arguments-tribits-add-advanced-test">Overall Arguments
(TRIBITS_ADD_ADVANCED_TEST())</a> that also pulls out the test blocks.  Then
there is a second level of parsing using <tt class="docutils literal">PARSE_ARGUMENTS()</tt> for each of
the <tt class="docutils literal">TEST_&lt;idx&gt;</tt> blocks.  Because of this usage, there are a few
restrictions that one needs to be aware of when using
<tt class="docutils literal">TRIBITS_ADD_ADVANCED_TEST()</tt>.  This short sections tries to explain the
behaviors and what is allowed and what is not allowed.</p>
<p>For the most part, the &quot;overall&quot; arguments and the arguments inside of any
individual <tt class="docutils literal">TEST_&lt;idx&gt;</tt> blocks can be listed can appear in any order but
there are restrictions related to the grouping of overall arguments and
<tt class="docutils literal">TEST_&lt;idx&gt;</tt> blocks which are as follows:</p>
<ul class="simple">
<li>The <tt class="docutils literal">&lt;testNameBase&gt;</tt> argument must be the first listed (it is the only
positional argument).</li>
<li>The test cases <tt class="docutils literal">TEST_&lt;idx&gt;</tt> must be listed in order (i.e. <tt class="docutils literal">TEST_0
... TEST_1 ...</tt>) and the test cases must be consecutive integers
(e.g. can't jump from <tt class="docutils literal">TEST_5</tt> to <tt class="docutils literal">TEST_7</tt>).</li>
<li>All of the arguments for a test case must appear directly below its
<tt class="docutils literal">TEST_&lt;idx&gt;</tt> keyword and before the next <tt class="docutils literal">TEST_&lt;idx+1&gt;</tt> keyword or
before any trailing overall keyword arguments.</li>
<li>None of the overall arguments (e.g. <tt class="docutils literal">CATEGORIES</tt>) can be listed inside
of a <tt class="docutils literal">TEST_&lt;idx&gt;</tt> block but otherwise can be listed before or after all
of the <tt class="docutils literal">TEST_&lt;idx&gt;</tt> blocks.  (NOTE: The current implementation will
actually allow overall arguments to be listed after all of the local
arguments before the next TEST_&lt;idx&gt; block but this is confusing and will
not be allowed in a future implementation).</li>
</ul>
<p>Other than that, the keyword arguments and options can appear in any order.</p>
<!-- ToDo: Add some examples of bad argument ordering and what will happen. -->
<p id="implementation-details-tribits-add-advanced-test"><strong>Implementation Details (TRIBITS_ADD_ADVANCED_TEST())</strong></p>
<p>Since raw CTest does not support the features provided by this function, the
way an advanced test is implemented is that a <tt class="docutils literal">cmake <span class="pre">-P</span></tt> script with the
name <tt class="docutils literal"><span class="pre">&lt;testName&gt;.cmake</span></tt> gets created in the current binary directory that
then gets added to CTest using:</p>
<pre class="literal-block">
ADD_TEST(&lt;testName&gt; cmake [other options] -P &lt;testName&gt;.cmake)
</pre>
<p>This <tt class="docutils literal">cmake <span class="pre">-P</span></tt> script then runs the various test cases and checks the
pass/fail for each case to determine overall pass/fail and implement other
functionality described above.</p>
<p id="setting-additional-test-properties-tribits-add-advanced-test"><strong>Setting Additional Test Properties (TRIBITS_ADD_ADVANCED_TEST())</strong></p>
<p>After this function returns, if the test gets added using <tt class="docutils literal">ADD_TEST()</tt>,
then additional properties can be set and changed using
<tt class="docutils literal"><span class="pre">SET_TESTS_PROPERTIES(&lt;testName&gt;</span> <span class="pre">...)</span></tt>, where <tt class="docutils literal">&lt;testName&gt;</tt> is returned
using the <tt class="docutils literal">ADDED_TEST_NAME_OUT &lt;testName&gt;</tt> argument.  Therefore, any tests
properties that are not directly supported by this function and passed
through the argument list to this wrapper function can be set in the outer
<tt class="docutils literal">CMakeLists.txt</tt> file after the call to <tt class="docutils literal">TRIBITS_ADD_ADVANCED_TEST()</tt>.
For example:</p>
<pre class="literal-block">
TRIBITS_ADD_ADVANCED_TEST_TEST( someTest ...
  ADDED_TEST_NAME_OUT  someTest_TEST_NAME )

IF (someTest_TEST_NAME)
  SET_TESTS_PROPERTIES( ${someTest_TEST_NAME}
    PROPERTIES ATTACHED_FILES someTest.log )
ENDIF()
</pre>
<p>where the test writes a log file <tt class="docutils literal">someTest.log</tt> that we want to submit to
CDash also.</p>
<p id="running-multiple-tests-at-the-same-time-tribits-add-advanced-test"><strong>Runnning multiple tests at the same time (TRIBITS_ADD_ADVANCED_TEST())</strong></p>
<p>Just as with <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>, setting <tt class="docutils literal">NUM_MPI_PROCS &lt;numProcs&gt;</tt> or
<tt class="docutils literal">OVERALL_NUM_MPI_PROCS &lt;numOverallProcs&gt;</tt> or <tt class="docutils literal">NUM_TOTAL_CORES_USED
&lt;numTotalCoresUsed&gt;</tt> or <tt class="docutils literal">OVERALL_NUM_TOTAL_CORES_USED
&lt;overallNumTotalCoresUsed&gt;</tt> will set the <tt class="docutils literal">PROCESSORS</tt> CTest property to
allow CTest to schedule and run mutiple tests at the same time when <tt class="docutils literal">'ctest
<span class="pre">-j&lt;N&gt;'</span></tt> is used (see <a class="reference internal" href="#running-multiple-tests-at-the-same-time-tribits-add-test">Running multiple tests at the same time
(TRIBITS_ADD_TEST())</a>).</p>
<p id="disabling-tests-externally-tribits-add-advanced-test"><strong>Disabling Tests Externally (TRIBITS_ADD_ADVANCED_TEST())</strong></p>
<p>The test can be disabled externally by setting the CMake cache variable
<tt class="docutils literal">&lt;testName&gt;_DISABLE=TRUE</tt>.  This allows tests to be disabled on a
case-by-case basis.  The name <tt class="docutils literal">&lt;testName&gt;</tt> must be the <em>exact</em> name
that shows up in <tt class="docutils literal">ctest <span class="pre">-N</span></tt> when running the test.</p>
<p id="debugging-and-examining-test-generation-tribits-add-advanced-test"><strong>Debugging and Examining Test Generation (TRIBITS_ADD_ADVANCED_TEST())</strong></p>
<p>In order to see what tests get added and if not then why, configure with
<tt class="docutils literal">${PROJECT_NAME}_TRACE_ADD_TEST=ON</tt>.  That will print one line per show
that the test got added and if not then why the test was not added (i.e. due
to <tt class="docutils literal">COMM</tt>, <tt class="docutils literal">OVERALL_NUM_MPI_PROCS</tt>, <tt class="docutils literal">NUM_MPI_PROCS</tt>, <tt class="docutils literal">CATEGORIES</tt>,
<tt class="docutils literal">HOST</tt>, <tt class="docutils literal">XHOST</tt>, <tt class="docutils literal">HOSTTYPE</tt>, or <tt class="docutils literal">XHOSTTYPE</tt>).</p>
<p>Likely the best way to debugging test generation using this function is to
examine the generated file <tt class="docutils literal"><span class="pre">&lt;testName&gt;.cmake</span></tt> in the current binary
directory (see <a class="reference internal" href="#implementation-details-tribits-add-advanced-test">Implementation Details (TRIBITS_ADD_ADVANCED_TEST())</a>) and
the generated <tt class="docutils literal">CTestTestfile.cmake</tt> file that should list this test case.</p>
</div>
<div class="section" id="tribits-add-debug-option">
<h3><a class="toc-backref" href="#id103">TRIBITS_ADD_DEBUG_OPTION()</a></h3>
<p>Add the standard cache variable option <tt class="docutils literal">${PACKAGE_NAME}_ENABLE_DEBUG</tt> for
the package.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_DEBUG_OPTION()
</pre>
<p>This option is given the default <tt class="docutils literal"><span class="pre">${${PROJECT_NAME}_ENABLE_DEBUG}</span></tt> and if
true, will set the variable <tt class="docutils literal"><span class="pre">HAVE_${PACKAGE_NAME_UC}_DEBUG</span></tt> (to be used in
the package's configured header file).  This macro is typically called in
the package's <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file.</p>
</div>
<div class="section" id="tribits-add-example-directories">
<h3><a class="toc-backref" href="#id104">TRIBITS_ADD_EXAMPLE_DIRECTORIES()</a></h3>
<p>Macro called to conditionally add a set of example directories for an SE
package.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_EXAMPLE_DIRECTORIES(&lt;dir1&gt; &lt;dir2&gt; ...)
</pre>
<p>This macro typically is called from the top-level
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file for which all subdirectories are all
&quot;examples&quot; according to standard package layout.</p>
<p>This macro can be called several times within a package as desired to break
up example directories any way one would like.</p>
<p>Currently, all it does macro does is to call <tt class="docutils literal"><span class="pre">ADD_SUBDIRECTORY(&lt;diri&gt;)</span></tt> if
<tt class="docutils literal">${PACKAGE_NAME}_ENABLE_EXAMPLES</tt> or
<tt class="docutils literal">${PARENT_PACKAGE_NAME}_ENABLE_EXAMPLES</tt> are true. However, this macro may
be extended in the future in order to modify behavior related to adding
tests and examples in a uniform way.</p>
</div>
<div class="section" id="tribits-add-executable">
<h3><a class="toc-backref" href="#id105">TRIBITS_ADD_EXECUTABLE()</a></h3>
<p>Function used to create an executable (typically for a test or example),
using the built-in CMake command <tt class="docutils literal">ADD_EXECUTABLE()</tt>.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_EXECUTABLE(
  &lt;exeRootName&gt;  [NOEXEPREFIX]  [NOEXESUFFIX]  [ADD_DIR_TO_NAME]
  SOURCES &lt;src0&gt; &lt;src1&gt; ...
  [CATEGORIES &lt;category0&gt;  &lt;category1&gt; ...]
  [HOST &lt;host0&gt; &lt;host1&gt; ...]
  [XHOST &lt;host0&gt; &lt;host1&gt; ...]
  [HOSTTYPE &lt;hosttype0&gt; &lt;hosttype1&gt; ...]
  [XHOSTTYPE &lt;hosttype0&gt; &lt;hosttype1&gt; ...]
  [DIRECTORY &lt;dir&gt;]
  [TESTONLYLIBS &lt;lib0&gt; &lt;lib1&gt; ...]
  [IMPORTEDLIBS &lt;lib0&gt; &lt;lib1&gt; ...]
  [COMM [serial] [mpi]]
  [LINKER_LANGUAGE (C|CXX|Fortran)]
  [DEFINES -D&lt;define0&gt; -D&lt;define1&gt; ...]
  [INSTALLABLE]
  [ADDED_EXE_TARGET_NAME_OUT &lt;exeTargetName&gt;]
  )
</pre>
<p><em>Sections:</em></p>
<ul class="simple">
<li><a class="reference internal" href="#formal-arguments-tribits-add-executable">Formal Arguments (TRIBITS_ADD_EXECUTABLE())</a></li>
<li><a class="reference internal" href="#executable-and-target-name-tribits-add-executable">Executable and Target Name (TRIBITS_ADD_EXECUTABLE())</a></li>
<li><a class="reference internal" href="#additional-executable-and-source-file-properties-tribits-add-executable">Additional Executable and Source File Properties (TRIBITS_ADD_EXECUTABLE())</a></li>
<li><a class="reference internal" href="#install-target-tribits-add-executable">Install Target (TRIBITS_ADD_EXECUTABLE())</a></li>
</ul>
<p id="formal-arguments-tribits-add-executable"><strong>Formal Arguments (TRIBITS_ADD_EXECUTABLE())</strong></p>
<blockquote>
<p><tt class="docutils literal">&lt;exeRootName&gt;</tt></p>
<blockquote>
The root name of the exectuable (and CMake target) (see <a class="reference internal" href="#executable-and-target-name-tribits-add-executable">Executable and
Target Name (TRIBITS_ADD_EXECUTABLE())</a>).  This must be the first
argument.</blockquote>
<p><tt class="docutils literal">NOEXEPREFIX</tt></p>
<blockquote>
If passed in, then <tt class="docutils literal">${PACKAGE_NAME}_</tt> is not added the beginning of
the executable name (see <a class="reference internal" href="#executable-and-target-name-tribits-add-executable">Executable and Target Name
(TRIBITS_ADD_EXECUTABLE())</a>).</blockquote>
<p><tt class="docutils literal">NOEXESUFFIX</tt></p>
<blockquote>
If passed in, then <tt class="docutils literal"><span class="pre">${${PROJECT_NAME}_CMAKE_EXECUTABLE_SUFFIX}</span></tt> and
not added to the end of the executable name (see <a class="reference internal" href="#executable-and-target-name-tribits-add-executable">Executable and
Target Name (TRIBITS_ADD_EXECUTABLE())</a>).</blockquote>
<p><tt class="docutils literal">ADD_DIR_TO_NAME</tt></p>
<blockquote>
If passed in, the directory path relative to the package's base
directory (with &quot;/&quot; replaced by &quot;_&quot;) is added to the executable name
(see <a class="reference internal" href="#executable-and-target-name-tribits-add-executable">Executable and Target Name (TRIBITS_ADD_EXECUTABLE())</a>).  This
provides a simple way to create unique test exectuable names inside of a
given TriBITS package.  Only test executables in the same directory
would need to have unique <tt class="docutils literal">&lt;execRootName&gt;</tt> passed in.</blockquote>
<p><tt class="docutils literal">SOURCES &lt;src0&gt; &lt;src1&gt; ...</tt></p>
<blockquote>
Gives the source files that will be compiled into the built executable.
By default, these sources are assumed to be in the current working
directory (or can contain the relative path or absolute path).  If
<tt class="docutils literal">&lt;srci&gt;</tt> is an absolute path, then that full file path is used.  This
list of sources (with adjusted directory path) are passed into
<tt class="docutils literal"><span class="pre">ADD_EXECUTABLE(&lt;exeTargetName&gt;</span> ... )</tt>.  After calling this function,
the properties of the source files can be altered using the built-in
CMake command <tt class="docutils literal">SET_SOURCE_FILE_PROPERTIES()</tt>.</blockquote>
<p><tt class="docutils literal">DIRECTORY &lt;dir&gt;</tt></p>
<blockquote>
If specified, then the sources for the executable listed in <tt class="docutils literal">SOURCES
&lt;src0&gt; &lt;src1&gt; ...</tt> are assumed to be in the relative or absolute
directory <tt class="docutils literal">&lt;dir&gt;</tt> instead of the current source directory.  This
directory path is prepended to each source file name <tt class="docutils literal">&lt;srci&gt;</tt> unless
<tt class="docutils literal">&lt;srci&gt;</tt> is an absolute path.</blockquote>
<p><tt class="docutils literal">CATEGORIES &lt;category0&gt; &lt;category1&gt; ...</tt></p>
<blockquote>
Gives the <a class="reference internal" href="#test-test-categories">Test Test Categories</a> for which this test will be added.
See <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> for more details.</blockquote>
<p><tt class="docutils literal">HOST &lt;host0&gt; &lt;host1&gt; ...</tt></p>
<blockquote>
The list of hosts for which to enable the test (see <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>).</blockquote>
<p><tt class="docutils literal">XHOST &lt;host0&gt; &lt;host1&gt; ...</tt></p>
<blockquote>
The list of hosts for which <strong>not</strong> to enable the test (see
<a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>).</blockquote>
<p><tt class="docutils literal">HOSTTYPE &lt;hosttype0&gt; &lt;hosttype1&gt; ...</tt></p>
<blockquote>
The list of host types for which to enable the test (see
<a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>).</blockquote>
<p><tt class="docutils literal">XHOSTTYPE &lt;hosttype0&gt; &lt;hosttype1&gt; ...</tt></p>
<blockquote>
The list of host types for which <strong>not</strong> to enable the test (see
<a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>).</blockquote>
<p><tt class="docutils literal">TESTONLYLIBS &lt;lib0&gt; &lt;lib1&gt; ...</tt></p>
<blockquote>
<p>Specifies extra test-only libraries defined in this CMake project that
will be linked to the executable using <tt class="docutils literal">TARGET_LINK_LIBRARY()</tt>.  Note
that regular libraries (i.e. not <tt class="docutils literal">TESTONLY</tt>) defined in the current SE
package or any upstream SE packages can <em>NOT</em> be listed!  TriBITS
automatically links non <tt class="docutils literal">TESTONLY</tt> libraries in this package and
upstream packages to the executable.  The only libraries that should be
listed in this argument are either <tt class="docutils literal">TESTONLY</tt> libraries.  The include
directories for each test-only library will automatically be added
using:</p>
<pre class="literal-block">
INCLUDE_DIRECTORIES(${&lt;libi&gt;_INCLUDE_DIRS})
</pre>
<p>where <tt class="docutils literal">&lt;libi&gt;_INCLUDE_DIRS</tt> was set by:</p>
<pre class="literal-block">
TRIBITS_ADD_LIBRARY(&lt;libi&gt; ... TESTONLY ...)
</pre>
<p>Therefore, to link to a defined <tt class="docutils literal">TESTONLY</tt> library in any upstream
enabled package, one just needs to pass in the library name through
<tt class="docutils literal">TESTONLYLIBS ... &lt;libi&gt; ...</tt> and that is it!</p>
</blockquote>
<p><tt class="docutils literal">IMPORTEDLIBS &lt;lib0&gt; &lt;lib1&gt; ...</tt></p>
<blockquote>
Specifies extra external libraries that will be linked to the executable
using <tt class="docutils literal">TARGET_LINK_LIBRARY()</tt>.  This can only be used for libraries
that are built external from this CMake project and are not provided
through a proper <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>.  The latter usage of passing in
external libraries is not recommended.  External libraries should be
handled as declared <a class="reference internal" href="#tribits-tpls">TriBITS TPLs</a>.  So far, the only case where
<tt class="docutils literal">IMPORTEDLIBS</tt> has been shown to be necessary is to pass in the
standard C math library <tt class="docutils literal">m</tt>.  In every other case, a TriBITS TPL
should be used instead.</blockquote>
<p><tt class="docutils literal">COMM [serial] [mpi]</tt></p>
<blockquote>
If specified, selects if the test will be added in serial and/or MPI
mode.  See the <tt class="docutils literal">COMM</tt> argument in the script
<a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> for more details.</blockquote>
<p><tt class="docutils literal">LINKER_LANGUAGE (C|CXX|Fortran)</tt></p>
<blockquote>
If specified, overrides the linker language used by setting the built-in
CMake target property <tt class="docutils literal">LINKER_LANGUAGE</tt>.  By default, CMake chooses the
compiler to be used as the linker based on file extensions.  The most
typical use case for this option is when Fortran-only or C-only sources
are passed in through <tt class="docutils literal">SOURCES</tt> but a C++ linker is needed because
there are upstream C++ libraries.</blockquote>
<p><tt class="docutils literal">DEFINES <span class="pre">-D&lt;define0&gt;</span> <span class="pre">-D&lt;define1&gt;</span> ...</tt></p>
<blockquote>
Add the listed defines using <tt class="docutils literal">ADD_DEFINITIONS()</tt>.  These should only
affect the listed sources for the built executable and not other
compiles in this directory due to the FUNCTION scoping.</blockquote>
<p><tt class="docutils literal">INSTALLABLE</tt></p>
<blockquote>
If passed in, then an install target will be added to install the built
executable into the <tt class="docutils literal"><span class="pre">${CMAKE_INSTALL_PREFIX}/bin/</span></tt> directory (see
<a class="reference internal" href="#install-target-tribits-add-executable">Install Target (TRIBITS_ADD_EXECUTABLE())</a>).</blockquote>
<p><tt class="docutils literal">ADDED_EXE_TARGET_NAME_OUT &lt;exeTargetName&gt;</tt></p>
<blockquote>
If specified, then on output the variable <tt class="docutils literal">&lt;exeTargetName&gt;</tt> will be
set with the name of the executable target passed to
<tt class="docutils literal"><span class="pre">ADD_EXECUTABLE(&lt;exeTargetName&gt;</span> ... )</tt>.  Having this name allows the
calling <tt class="docutils literal">CMakeLists.txt</tt> file access and set additional target
propeties (see <a class="reference internal" href="#additional-executable-and-source-file-properties-tribits-add-executable">Additional Executable and Source File Properties
(TRIBITS_ADD_EXECUTABLE())</a>).</blockquote>
</blockquote>
<p id="executable-and-target-name-tribits-add-executable"><strong>Executable and Target Name (TRIBITS_ADD_EXECUTABLE())</strong></p>
<p>By default, the full name of the executable and target name
is:</p>
<pre class="literal-block">
&lt;exeTargetName&gt; = ${PACKAGE_NAME}_&lt;exeRootName&gt;
</pre>
<p>If <tt class="docutils literal">ADD_DIR_TO_NAME</tt> is set, then the directory path relative to the
package base directory (with &quot;/&quot; replaced with &quot;_&quot;), or <tt class="docutils literal">&lt;relDirName&gt;</tt>, is
added to the executable name to form:</p>
<pre class="literal-block">
&lt;exeTargetName&gt; = ${PACKAGE_NAME}_&lt;relDirName&gt;_&lt;exeRootName&gt;
</pre>
<p>If the option <tt class="docutils literal">NOEXEPREFIX</tt> is passed in, then the prefix
<tt class="docutils literal">${PACKAGE_NAME}_</tt> is removed.</p>
<p>The executable suffix <tt class="docutils literal"><span class="pre">${${PROJECT_NAME}_CMAKE_EXECUTABLE_SUFFIX}</span></tt> will be
added to the actual executable file name if the option <tt class="docutils literal">NOEXESUFFIX</tt> is
<em>not</em> passed in but this suffix is never added to the target name.</p>
<p>The reason that a default prefix is prepended to the executable and target
name is because the primary reason to create an executable is typically to
create a test or an example that is private to the package.  This prefix
helps to namespace the executable and its target so as to avoid name clashes
with targets in other packages.  It also helps to avoid clashes if the
executable gets installed into the install directory (if <tt class="docutils literal">INSTALLABLE</tt> is
specified).  For general utility executables on Linux/Unix systems,
<tt class="docutils literal">NOEXEPREFIX</tt> and <tt class="docutils literal">NOEXESUFFIX</tt> should be passed in.  In this case, one
must be careful to pick <tt class="docutils literal">&lt;exeRootName&gt;</tt> that will be sufficiently globally
unique.  Please use common sense when picking non-namespaced names.</p>
<p id="additional-executable-and-source-file-properties-tribits-add-executable"><strong>Additional Executable and Source File Properties (TRIBITS_ADD_EXECUTABLE())</strong></p>
<p>Once <tt class="docutils literal"><span class="pre">ADD_EXECUTABLE(&lt;exeTargetName&gt;</span> ... )</tt> is called and this function
exists, one can set and change properties on the <tt class="docutils literal">&lt;exeTargetName&gt;</tt>
executable target using the built-in <tt class="docutils literal">SET_TARGET_PROPERTIES()</tt> command as
well as properties on any of the source files listed in <tt class="docutils literal">SOURCES</tt> using
the built-in <tt class="docutils literal">SET_SOURCE_FILE_PROPERTIES()</tt> command just like in any CMake
project.  IF the executable is added, its name will be returned by the
argument <tt class="docutils literal">ADDED_EXE_TARGET_NAME_OUT &lt;exeTargetName&gt;</tt>.  For example:</p>
<pre class="literal-block">
TRIBITS_ADD_EXECUTABLE( someExe ...
  ADDED_EXE_TARGET_NAME_OUT  someExe_TARGET_NAME )

SET_TARGET_PROPERTIES( ${someExe_TARGET_NAME}
  PROPERTIES  LINKER_LANGUAGE  CXX )
</pre>
<p id="install-target-tribits-add-executable"><strong>Install Target (TRIBITS_ADD_EXECUTABLE())</strong></p>
<p>If <tt class="docutils literal">INSTALLABLE</tt> is passed in, then an install target using the built-in
CMake command <tt class="docutils literal">INSTALL(TARGETS &lt;exeTargetName&gt; <span class="pre">...)</span></tt> is added to install
the built executable into the <tt class="docutils literal"><span class="pre">${CMAKE_INSTALL_PREFIX}/bin/</span></tt> directory
(actual install directory path is determined by
<tt class="docutils literal">${PROJECT_NAME}_INSTALL_RUNTIME_DIR</tt>, see <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#setting-the-install-prefix-at-configure-time">Setting the install prefix at
configure time</a>) .</p>
</div>
<div class="section" id="tribits-add-executable-and-test">
<h3><a class="toc-backref" href="#id106">TRIBITS_ADD_EXECUTABLE_AND_TEST()</a></h3>
<p>Add an executable and a test (or several tests) all in one shot (just calls
<a class="reference internal" href="#tribits-add-executable">TRIBITS_ADD_EXECUTABLE()</a> followed by <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>).</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_EXECUTABLE_AND_TEST(
  &lt;exeRootName&gt;  [NOEXEPREFIX]  [NOEXESUFFIX]  [ADD_DIR_TO_NAME]
  SOURCES &lt;src0&gt; &lt;src1&gt; ...
  [NAME &lt;testName&gt; | NAME_POSTFIX &lt;testNamePostfix&gt;]
  [CATEGORIES &lt;category0&gt;  &lt;category1&gt; ...]
  [HOST &lt;host0&gt; &lt;host1&gt; ...]
  [XHOST &lt;xhost0&gt; &lt;xhost1&gt; ...]
  [XHOST_TEST &lt;xhost0&gt; &lt;xhost1&gt; ...]
  [HOSTTYPE &lt;hosttype0&gt; &lt;hosttype1&gt; ...]
  [XHOSTTYPE &lt;xhosttype0&gt; &lt;xhosttype1&gt; ...]
  [XHOSTTYPE_TEST &lt;xhosttype0&gt; &lt;xhosttype1&gt; ...]
  [DIRECTORY &lt;dir&gt;]
  [TESTONLYLIBS &lt;lib0&gt; &lt;lib1&gt; ...]
  [IMPORTEDLIBS &lt;lib0&gt; &lt;lib1&gt; ...]
  [COMM [serial] [mpi]]
  [ARGS &quot;&lt;arg0&gt; &lt;arg1&gt; ...&quot; &quot;&lt;arg2&gt; &lt;arg3&gt; ...&quot; ...]
  [NUM_MPI_PROCS &lt;numProcs&gt;]
  [LINKER_LANGUAGE (C|CXX|Fortran)]
  [STANDARD_PASS_OUTPUT
    | PASS_REGULAR_EXPRESSION &quot;&lt;regex0&gt;;&lt;regex1&gt;;...&quot;]
  [FAIL_REGULAR_EXPRESSION &quot;&lt;regex0&gt;;&lt;regex1&gt;;...&quot;]
  [WILL_FAIL]
  [ENVIRONMENT &lt;var0&gt;=&lt;value0&gt; &lt;var1&gt;=&lt;value1&gt; ...]
  [INSTALLABLE]
  [TIMEOUT &lt;maxSeconds&gt;]
  [ADDED_EXE_TARGET_NAME_OUT &lt;exeTargetName&gt;]
  [ADDED_TESTS_NAMES_OUT &lt;testsNames&gt;]
  )
</pre>
<p>This function takes a fairly common set of arguments to
<a class="reference internal" href="#tribits-add-executable">TRIBITS_ADD_EXECUTABLE()</a> and <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> but not the full set
passed to <tt class="docutils literal">TRIBITS_ADD_TEST()</tt>.  See the documentation for
<a class="reference internal" href="#tribits-add-executable">TRIBITS_ADD_EXECUTABLE()</a> and <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> to see which arguments
are accepted by which functions.</p>
<p>Arguments that are specific to this function and not directly passed on to
<tt class="docutils literal">TRIBITS_ADD_EXECUTABLE()</tt> or <tt class="docutils literal">TRIBITS_ADD_TEST()</tt> include:</p>
<blockquote>
<p><tt class="docutils literal">XHOST_TEST &lt;xhost0&gt; &lt;xhost1&gt; ...</tt></p>
<blockquote>
When specified, this disables just running the tests for the named hosts
<tt class="docutils literal">&lt;xhost0&gt;</tt>, <tt class="docutils literal">&lt;xhost0&gt;</tt> etc. but still builds the executable for the
test.  These are just passed in through the <tt class="docutils literal">XHOST</tt> argument to
<tt class="docutils literal">TRIBITS_ADD_TEST()</tt>.</blockquote>
<p><tt class="docutils literal">XHOSTTYPE_TEST &lt;xhosttype0&gt; &lt;hosttype1&gt; ...</tt></p>
<blockquote>
When specified, this disables just running the tests for the named host
types <tt class="docutils literal">&lt;hosttype0&gt;</tt>, <tt class="docutils literal">&lt;hosttype0&gt;</tt>, ..., but still builds the
executable for the test.  These are just passed in through the
<tt class="docutils literal">XHOSTTYPE</tt> argument to <tt class="docutils literal">TRIBITS_ADD_TEST()</tt>.</blockquote>
</blockquote>
<p>This is the function to use for simple test executables that you want to run
that either takes no arguments or just a simple set of arguments passed in
through <tt class="docutils literal">ARGS</tt>.  For more flexibility, just use
<tt class="docutils literal">TRIBITS_ADD_EXECUTABLE()</tt> followed by <tt class="docutils literal">TRIBITS_ADD_TEST()</tt>.</p>
</div>
<div class="section" id="tribits-add-library">
<h3><a class="toc-backref" href="#id107">TRIBITS_ADD_LIBRARY()</a></h3>
<p>Function used to add a CMake library and target using <tt class="docutils literal">ADD_LIBRARY()</tt>.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_LIBRARY(
  &lt;libBaseName&gt;
  [HEADERS &lt;h0&gt; &lt;h1&gt; ...]
  [NOINSTALLHEADERS &lt;nih0&gt; &lt;hih1&gt; ...]
  [SOURCES &lt;src0&gt; &lt;src1&gt; ...]
  [DEPLIBS &lt;deplib0&gt; &lt;deplib1&gt; ...]
  [IMPORTEDLIBS &lt;ideplib0&gt; &lt;ideplib1&gt; ...]
  [TESTONLY]
  [NO_INSTALL_LIB_OR_HEADERS]
  [CUDALIBRARY]
  [ADDED_LIB_TARGET_NAME_OUT &lt;libTargetName&gt;]
  )
</pre>
<p><em>Sections:</em></p>
<ul class="simple">
<li><a class="reference internal" href="#formal-arguments-tribits-add-library">Formal Arguments (TRIBITS_ADD_LIBRARY())</a></li>
<li><a class="reference internal" href="#include-directories-tribits-add-library">Include Directories (TRIBITS_ADD_LIBRARY())</a></li>
<li><a class="reference internal" href="#install-targets-tribits-add-library">Install Targets (TRIBITS_ADD_LIBRARY())</a></li>
<li><a class="reference internal" href="#additional-library-and-source-file-properties-tribits-add-library">Additional Library and Source File Properties (TRIBITS_ADD_LIBRARY())</a></li>
<li><a class="reference internal" href="#miscellaneous-notes-tribits-add-library">Miscellaneous Notes (TRIBITS_ADD_LIBRARY())</a></li>
</ul>
<p id="formal-arguments-tribits-add-library"><strong>Formal Arguments (TRIBITS_ADD_LIBRARY())</strong></p>
<blockquote>
<p><tt class="docutils literal">&lt;libBaseName&gt;</tt></p>
<blockquote>
<p>Required base name of the library.  The name of the actual libray name
will be prefixed by <tt class="docutils literal"><span class="pre">${${PROJECT_NAME}_LIBRARY_NAME_PREFIX}</span></tt> to
produce:</p>
<pre class="literal-block">
&lt;libTargetName&gt; = ${${PROJECT_NAME}_LIBRARY_NAME_PREFIX}&lt;libBaseName&gt;
</pre>
<p>This is the name passed to <tt class="docutils literal"><span class="pre">ADD_LIBRARY(&lt;libTargetName&gt;</span> <span class="pre">...)</span></tt>.  The
name is <em>not</em> prefixed by the package name.  CMake will of course add
any standard prefix or post-fix to the library file name appropriate for
the platform and if this is a static or shared library build (e.g. on
Linux prefix = <tt class="docutils literal">'lib'</tt>, postfix = <tt class="docutils literal">'.so'</tt> for shared lib and postfix
= <tt class="docutils literal">'.a'</tt> static lib) (see documentation for the built-in CMake command
<tt class="docutils literal">ADD_LIBRARY()</tt>.</p>
</blockquote>
<p><tt class="docutils literal">HEADERS &lt;h0&gt; &lt;h1&gt; ...</tt></p>
<blockquote>
List of public header files for using this library.  By default, these
header files are assumed to be in the current source directory.  They
can also contain the relative path or absolute path to the files if they
are not in the current source directory.  This list of headers is passed
into <tt class="docutils literal"><span class="pre">ADD_LIBRARY(...)</span></tt> as well (which is not strictly needed but is
helpful for some build tools, like MS Visual Studio).  By default, these
headers will be installed (see <a class="reference internal" href="#install-targets-tribits-add-library">Install Targets
(TRIBITS_ADD_LIBRARY())</a>).</blockquote>
<p><tt class="docutils literal">NOINSTALLHEADERS &lt;nih0&gt; &lt;hih1&gt; ...</tt></p>
<blockquote>
List of private header files which are used by this library. These
headers are not installed and do not needed to be passed in for any
purpose other than to pass them into <tt class="docutils literal">ADD_LIBRARY()</tt> as some build
tools like to have these listed (e.g. MS Visual Studio).</blockquote>
<p><tt class="docutils literal">SOURCES &lt;src0&gt; &lt;src1&gt; ...</tt></p>
<blockquote>
List of source files passed into <tt class="docutils literal">ADD_LIBRARY()</tt> that are compiled
into header files and included in the library.  The compiler used to
compile the files is determined automatically based on the file
extension (see CMake documentation for <tt class="docutils literal">ADD_LIBRARY()</tt>).</blockquote>
<p><tt class="docutils literal">DEPLIBS &lt;deplib0&gt; &lt;deplib1&gt; ...</tt></p>
<blockquote>
List of dependent libraries that are built in the current SE package
that this library is dependent on.  These libraries are passed into
<tt class="docutils literal"><span class="pre">TARGET_LINK_LIBRARIES(&lt;libTargetName&gt;</span> <span class="pre">...)</span></tt> so that CMake knows about
the dependency structure of the libraries within this SE package.
<strong>NOTE:</strong> One must <strong>not</strong> list libraries in other upstream <a class="reference internal" href="#tribits-se-packages">TriBITS SE
Packages</a> or libraries built externally from this TriBITS CMake project
in <tt class="docutils literal">DEPLIBS</tt>.  The TriBITS system automatically handles linking to
libraries in upstream TriBITS SE packages.  External libraries need to
be listed in the <tt class="docutils literal">IMPORTEDLIBS</tt> argument instead if they are not
already specified automatically using a <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>.</blockquote>
<p><tt class="docutils literal">IMPORTEDLIBS &lt;ideplib0&gt; &lt;ideplib1&gt; ...</tt></p>
<blockquote>
List of dependent libraries built externally from this TriBITS CMake
project.  These libraries are passed into
<tt class="docutils literal"><span class="pre">TARGET_LINK_LIBRARIES(&lt;libTargetName&gt;</span> <span class="pre">...)</span></tt> so that CMake knows about
the dependency.  However, note that external libraries are often better
handled as <a class="reference internal" href="#tribits-tpls">TriBITS TPLs</a>.  A well constructed TriBITS package and
library should never have to use this option!  So far, the only case
where <tt class="docutils literal">IMPORTEDLIBS</tt> has been shown to be necessary is to pass in the
standard C math library <tt class="docutils literal">m</tt>.  In every other case, a TriBITS TPL
should be used instead.</blockquote>
<p><tt class="docutils literal">TESTONLY</tt></p>
<blockquote>
If passed in, then <tt class="docutils literal">&lt;libTargetName&gt;</tt> will <strong>not</strong> be added to
<tt class="docutils literal">${PACKAGE_NAME}_LIBRARIES</tt> and an install target for the library will
not be added.  In this case, the current include directories will be set
in the global variable <tt class="docutils literal">&lt;libTargetName&gt;_INCLUDE_DIR</tt> which will be
used in <a class="reference internal" href="#tribits-add-executable">TRIBITS_ADD_EXECUTABLE()</a> when a test-only library is linked
in through its <tt class="docutils literal">DEPLIBS</tt> argument.</blockquote>
<p><tt class="docutils literal">NO_INSTALL_LIB_OR_HEADERS</tt></p>
<blockquote>
If specified, then no install targets will be added for the library
<tt class="docutils literal">&lt;libTargetName&gt;</tt> or the header files listed in <tt class="docutils literal">HEADERS</tt>.</blockquote>
<p><tt class="docutils literal">CUDALIBRARY</tt></p>
<blockquote>
If specified then <tt class="docutils literal">CUDA_ADD_LIBRARY()</tt> is used instead of
<tt class="docutils literal">ADD_LIBRARY()</tt> where <tt class="docutils literal">CUDA_ADD_LIBRARY()</tt> is assumed to be defined
by the standard <tt class="docutils literal">FindCUDA.cmake</tt> module as processed using the
standard TriBITS <tt class="docutils literal">FindTPLCUDA.cmake</tt> file (see <a class="reference internal" href="#standard-tribits-tpls">Standard TriBITS
TPLs</a>).  For this option to work, this SE package must have an enabled
direct or indirect dependency on the TriBITS CUDA TPL or a
configure-time error may occur about not knowing about
<tt class="docutils literal">CUDA_ALL_LIBRARY()</tt>.</blockquote>
<p><tt class="docutils literal">ADDED_LIB_TARGET_NAME_OUT &lt;libTargetName&gt;</tt></p>
<blockquote>
If specified, then on output the variable <tt class="docutils literal">&lt;libTargetName&gt;</tt> will be
set with the name of the library passed to <tt class="docutils literal">ADD_LIBRARY()</tt>.  Having
this name allows the calling <tt class="docutils literal">CMakeLists.txt</tt> file access and set
additional target propeties (see <a class="reference internal" href="#additional-library-and-source-file-properties-tribits-add-library">Additional Library and Source File
Properties (TRIBITS_ADD_LIBRARY())</a>).</blockquote>
</blockquote>
<p id="include-directories-tribits-add-library"><strong>Include Directories (TRIBITS_ADD_LIBRARY())</strong></p>
<p>Any base directories for the header files listed in the arguments
<tt class="docutils literal">HEADERS</tt> or <tt class="docutils literal">NOINSTALLHEADERS</tt> should be passed into the standard CMake
command <tt class="docutils literal">INCLUDE_DIRECTORIES()</tt> <em>before</em> calling this function.  These
include directories will then be added to current packages list of include
directories <tt class="docutils literal">${PACKAGE_NAME}_INCLUDE_DIRS</tt> which is then exported to
downstream SE packages..</p>
<p id="install-targets-tribits-add-library"><strong>Install Targets (TRIBITS_ADD_LIBRARY())</strong></p>
<p>By default, an install target for the library is created using
<tt class="docutils literal">INSTALL(TARGETS &lt;libTargetName&gt; <span class="pre">...)</span></tt> to install into the directory
<tt class="docutils literal"><span class="pre">${CMAKE_INSTALL_PREFIX}/lib/</span></tt> (actual install directory is given by
<tt class="docutils literal">${PROJECT}_INSTALL_LIB_DIR</tt>, see <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#setting-the-install-prefix-at-configure-time">Setting the install prefix at configure
time</a>).  However, this install target will not get created if
<tt class="docutils literal">${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS=FALSE</tt> and
<tt class="docutils literal">BUILD_SHARD_LIBS=OFF</tt>.  But when <tt class="docutils literal">BUILD_SHARD_LIBS=ON</tt>, the install
target will get created.  Also, this install target will <em>not</em> get created
if <tt class="docutils literal">TESTONLY</tt> or <tt class="docutils literal">NO_INSTALL_LIB_OR_HEADERS</tt> are passed in.</p>
<p>By default, an install target for the headers listed in <tt class="docutils literal">HEADERS</tt> will get
created using <tt class="docutils literal">INSTALL(FILES &lt;h0&gt; &lt;h1&gt; <span class="pre">...)</span></tt>, but only if <tt class="docutils literal">TESTONLY</tt> and
<tt class="docutils literal">NO_INSTALL_LIB_OR_HEADERS</tt> are not passed in as well.  These headers get
installed into the flat directory <tt class="docutils literal"><span class="pre">${CMAKE_INSTALL_PREFIX}/include/</span></tt> (the
actual install directory is given by
<tt class="docutils literal">${PROJECT_NAME}_INSTALL_INCLUDE_DIR</tt>, see <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#setting-the-install-prefix-at-configure-time">Setting the install prefix at
configure time</a>).  Note that an install target will <em>not</em> get created for
the headers listed in <tt class="docutils literal">NOINSTALLHEADERS</tt>.</p>
<p id="additional-library-and-source-file-properties-tribits-add-library"><strong>Additional Library and Source File Properties (TRIBITS_ADD_LIBRARY())</strong></p>
<p>Once <tt class="docutils literal"><span class="pre">ADD_LIBRARY(&lt;libTargetName&gt;</span> ... &lt;src0&gt; &lt;src1&gt; <span class="pre">...)</span></tt> is called, one
can set and change properties on the <tt class="docutils literal">&lt;libTargetName&gt;</tt> library target
using the built-in CMake command <tt class="docutils literal">SET_TARGET_PROPERTIES()</tt> as well as set
and change properties on any of the source files listed in <tt class="docutils literal">SOURCES</tt> using
the built-in CMake command <tt class="docutils literal">SET_SOURCE_FILE_PROPERTIES()</tt> just like in any
CMake project.  For example:</p>
<pre class="literal-block">
TRIBITS_ADD_LIBRARY( somelib ...
  ADDED_LIB_TARGET_NAME_OUT  somelib_TARGET_NAME )

SET_TARGET_PROPERTIES( ${somelib_TARGET_NAME}
  PROPERTIES  LINKER_LANGUAGE  CXX )
</pre>
<p id="miscellaneous-notes-tribits-add-library"><strong>Miscellaneous Notes (TRIBITS_ADD_LIBRARY())</strong></p>
<p><strong>WARNING:</strong> Do <strong>NOT</strong> use the built-in CMake command <tt class="docutils literal">ADD_DEFINITIONS()</tt>
to add defines <tt class="docutils literal"><span class="pre">-D&lt;someDefine&gt;</span></tt> to the compile command line that will
affect any of the header files in the package!  These CMake-added defines
are only set locally in this directory and child directories.  These defines
will <strong>NOT</strong> be set when code in peer directories (e.g. a downstream TriBITS
packages) compiles that may include these header files.  To add defines that
affect header files, please use a configured header file (see
<a class="reference internal" href="#tribits-configure-file">TRIBITS_CONFIGURE_FILE()</a>).</p>
</div>
<div class="section" id="tribits-add-option-and-define">
<h3><a class="toc-backref" href="#id108">TRIBITS_ADD_OPTION_AND_DEFINE()</a></h3>
<p>Add an option and a define variable in one shot.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_OPTION_AND_DEFINE( &lt;userOptionName&gt;  &lt;macroDefineName&gt;
  &quot;&lt;docStr&gt;&quot;  &lt;defaultValue&gt; )
</pre>
<p>This macro sets the user cache <tt class="docutils literal">BOOL</tt> variable <tt class="docutils literal">&lt;userOptionName&gt;</tt> and if
it is true, then sets the global (internal cache) macro define variable
<tt class="docutils literal">&lt;macroDefineName&gt;</tt> to <tt class="docutils literal">ON</tt>, and otherwise sets it to <tt class="docutils literal">OFF</tt>.  This is
designed to make it easy to add a user-enabled option to a configured header
file and have the define set in one shot.  This would require that the
package's configure file (see <a class="reference internal" href="#tribits-configure-file">TRIBITS_CONFIGURE_FILE()</a>) have the line:</p>
<pre class="literal-block">
#cmakedefine &lt;macroDefineName&gt;
</pre>
</div>
<div class="section" id="tribits-add-show-deprecated-warnings-option">
<h3><a class="toc-backref" href="#id109">TRIBITS_ADD_SHOW_DEPRECATED_WARNINGS_OPTION()</a></h3>
<p>Add the standard option <tt class="docutils literal">${PACKAGE_NAME}_SHOW_DEPRECATED_WARNINGS</tt> for the
package.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_SHOW_DEPRECATED_WARNINGS_OPTION()
</pre>
<p>This macro should be called in the package's &lt;packageDir&gt;/CMakeLists.txt`_
file.  This option is given the default value
<tt class="docutils literal"><span class="pre">${${PROJECT_NAME}_SHOW_DEPRECATED_WARNINGS}</span></tt>.  This option is then looked
for in <a class="reference internal" href="#tribits-configure-file">TRIBITS_CONFIGURE_FILE()</a> to add macros to add deprecated warnings
to deprecated parts of a package.</p>
</div>
<div class="section" id="tribits-add-test">
<h3><a class="toc-backref" href="#id110">TRIBITS_ADD_TEST()</a></h3>
<p>Add a test or a set of tests for a single executable or command using CTest
<tt class="docutils literal">ADD_TEST()</tt>.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_TEST(
  &lt;exeRootName&gt;  [NOEXEPREFIX]  [NOEXESUFFIX]
  [NAME &lt;testName&gt; | NAME_POSTFIX &lt;testNamePostfix&gt;]
  [DIRECTORY &lt;directory&gt;]
  [ADD_DIR_TO_NAME]
  [ARGS &quot;&lt;arg0&gt; &lt;arg1&gt; ...&quot; &quot;&lt;arg2&gt; &lt;arg3&gt; ...&quot; ...
    | POSTFIX_AND_ARGS_0 &lt;postfix0&gt; &lt;arg0&gt; &lt;arg1&gt; ...
      POSTFIX_AND_ARGS_1 ... ]
  [COMM [serial] [mpi]]
  [NUM_MPI_PROCS &lt;numProcs&gt;]
  [NUM_TOTAL_CORES_USED &lt;numTotalCoresUsed&gt;]
  [CATEGORIES &lt;category0&gt;  &lt;category1&gt; ...]
  [HOST &lt;host0&gt; &lt;host1&gt; ...]
  [XHOST &lt;host0&gt; &lt;host1&gt; ...]
  [HOSTTYPE &lt;hosttype0&gt; &lt;hosttype1&gt; ...]
  [XHOSTTYPE &lt;hosttype0&gt; &lt;hosttype1&gt; ...]
  [STANDARD_PASS_OUTPUT
    | PASS_REGULAR_EXPRESSION &quot;&lt;regex0&gt;;&lt;regex1&gt;;...&quot;]
  [FAIL_REGULAR_EXPRESSION &quot;&lt;regex0&gt;;&lt;regex1&gt;;...&quot;]
  [WILL_FAIL]
  [ENVIRONMENT &lt;var0&gt;=&lt;value0&gt; &lt;var1&gt;=&lt;value1&gt; ...]
  [TIMEOUT &lt;maxSeconds&gt;]
  [ADDED_TESTS_NAMES_OUT &lt;testsNames&gt;]
  )
</pre>
<p><em>Sections:</em></p>
<ul class="simple">
<li><a class="reference internal" href="#formal-arguments-tribits-add-test">Formal Arguments (TRIBITS_ADD_TEST())</a></li>
<li><a class="reference internal" href="#determining-the-executable-or-command-to-run-tribits-add-test">Determining the Executable or Command to Run (TRIBITS_ADD_TEST())</a></li>
<li><a class="reference internal" href="#determining-the-full-test-name-tribits-add-test">Determining the Full Test Name (TRIBITS_ADD_TEST())</a></li>
<li><a class="reference internal" href="#adding-multiple-tests-tribits-add-test">Adding Multiple Tests  (TRIBITS_ADD_TEST())</a></li>
<li><a class="reference internal" href="#determining-pass-fail-tribits-add-test">Determining Pass/Fail (TRIBITS_ADD_TEST())</a></li>
<li><a class="reference internal" href="#setting-additional-test-properties-tribits-add-test">Setting additional test properties (TRIBITS_ADD_TEST())</a></li>
<li><a class="reference internal" href="#running-multiple-tests-at-the-same-time-tribits-add-test">Running multiple tests at the same time (TRIBITS_ADD_TEST())</a></li>
<li><a class="reference internal" href="#debugging-and-examining-test-generation-tribits-add-test">Debugging and Examining Test Generation (TRIBITS_ADD_TEST())</a></li>
<li><a class="reference internal" href="#disabling-tests-externally-tribits-add-test">Disabling Tests Externally (TRIBITS_ADD_TEST())</a></li>
</ul>
<p id="formal-arguments-tribits-add-test"><strong>Formal Arguments (TRIBITS_ADD_TEST())</strong></p>
<blockquote>
<p><tt class="docutils literal">&lt;exeRootName&gt;</tt></p>
<blockquote>
The name of the executable or path to the executable to run for the test
(see <a class="reference internal" href="#determining-the-executable-or-command-to-run-tribits-add-test">Determining the Executable or Command to Run
(TRIBITS_ADD_TEST())</a>).  This name is also the default root name for
the test (see <a class="reference internal" href="#determining-the-full-test-name-tribits-add-test">Determining the Full Test Name (TRIBITS_ADD_TEST())</a>).</blockquote>
<p><tt class="docutils literal">NOEXEPREFIX</tt></p>
<blockquote>
If specified, then the prefix <tt class="docutils literal">${PACKAGE_NAME}_</tt> is assumed <strong>not</strong> to
be prepended to <tt class="docutils literal">&lt;exeRootName&gt;</tt> (see <a class="reference internal" href="#determining-the-executable-or-command-to-run-tribits-add-test">Determining the Executable or
Command to Run (TRIBITS_ADD_TEST())</a>).</blockquote>
<p><tt class="docutils literal">NOEXESUFFIX</tt></p>
<blockquote>
If specified, then the postfix
<tt class="docutils literal"><span class="pre">${${PROJECT_NAME}_CMAKE_EXECUTABLE_SUFFIX}</span></tt> is assumed <strong>not</strong> to be
post-pended to <tt class="docutils literal">&lt;exeRootName&gt;</tt> (see <a class="reference internal" href="#determining-the-executable-or-command-to-run-tribits-add-test">Determining the Executable or
Command to Run (TRIBITS_ADD_TEST())</a>).</blockquote>
<p><tt class="docutils literal">NAME &lt;testRootName&gt;</tt></p>
<blockquote>
If specified, gives the root name of the test.  If not specified, then
<tt class="docutils literal">&lt;testRootName&gt;</tt> is taken to be <tt class="docutils literal">&lt;exeRootName&gt;</tt>.  The actual test
name passed to <tt class="docutils literal">ADD_TEST()</tt> will always be prefixed as
<tt class="docutils literal">${PACKAGE_NAME}_&lt;testRootName&gt;</tt>.  The main purpose of this argument
is to allow multiple tests to be defined for the same executable.  CTest
requires all test names to be globally unique in a single project.  See
<a class="reference internal" href="#determining-the-full-test-name-tribits-add-test">Determining the Full Test Name (TRIBITS_ADD_TEST())</a>.</blockquote>
<p><tt class="docutils literal">NAME_POSTFIX &lt;testNamePostfix&gt;</tt></p>
<blockquote>
If specified, gives a postfix that will be added to the standard test
name based on <tt class="docutils literal">&lt;exeRootName&gt;</tt> (appended as <tt class="docutils literal">_&lt;NAME_POSTFIX&gt;</tt>).  If
the <tt class="docutils literal">NAME &lt;testRootName&gt;</tt> argument is given, this argument is ignored.
See <a class="reference internal" href="#determining-the-full-test-name-tribits-add-test">Determining the Full Test Name (TRIBITS_ADD_TEST())</a>.</blockquote>
<p><tt class="docutils literal">DIRECTORY &lt;dir&gt;</tt></p>
<blockquote>
If specified, then the executable is assumed to be in the directory
given by <tt class="docutils literal">&lt;dir&gt;</tt>.  The directory <tt class="docutils literal">&lt;dir&gt;</tt> can either be a relative or
absolute path.  If not specified, the executable is assumed to be in the
current binary directory <tt class="docutils literal">${CMAKE_CURRENT_BINARY_DIR}</tt>.  See
<a class="reference internal" href="#determining-the-executable-or-command-to-run-tribits-add-test">Determining the Executable or Command to Run (TRIBITS_ADD_TEST())</a>.</blockquote>
<p><tt class="docutils literal">ADD_DIR_TO_NAME</tt></p>
<blockquote>
If specified, then the directory name that this test resides in will be
added into the name of the test after the package name is added and
before the root test name (see <a class="reference internal" href="#determining-the-full-test-name-tribits-add-test">Determining the Full Test Name
(TRIBITS_ADD_TEST())</a>).  The directory name will have the package's
base directory stripped off so only the unique part of the test
directory will be used.  All directory separators <tt class="docutils literal">&quot;/&quot;</tt> will be
changed into underscores <tt class="docutils literal">&quot;_&quot;</tt>.</blockquote>
<p><tt class="docutils literal">RUN_SERIAL</tt></p>
<blockquote>
If specified then no other tests will be allowed to run while this test
is running. This is useful for devices (like CUDA GPUs) that require
exclusive access for processes/threads.  This just sets the CTest test
property <tt class="docutils literal">RUN_SERIAL</tt> using the built-in CMake function
<tt class="docutils literal">SET_TESTS_PROPERTIES()</tt>.</blockquote>
<p><tt class="docutils literal">ARGS &quot;&lt;arg0&gt; &lt;arg1&gt; <span class="pre">...&quot;</span> &quot;&lt;arg2&gt; &lt;arg3&gt; <span class="pre">...&quot;</span> ...</tt></p>
<blockquote>
If specified, then a set of arguments can be passed in quotes.  If
multiple groups of arguments are passed in different quoted clusters of
arguments then a different test will be added for each set of arguments.
In this way, many different tests can be added for a single executable
in a single call to this function.  Each of these separate tests will be
named <tt class="docutils literal">&lt;fullTestName&gt;_xy</tt> where <tt class="docutils literal">xy</tt> = <tt class="docutils literal">00</tt>, <tt class="docutils literal">01</tt>, <tt class="docutils literal">02</tt>, and so
on.  <strong>WARNING:</strong> When defining multiple tests it is preferred to use the
<tt class="docutils literal">POSTFIX_AND_ARGS_&lt;IDX&gt;</tt> form instead.  <strong>WARNING:</strong> Multiple
arguments passed to a single test invocation must be quoted or multiple
tests taking single arguments will be created instead!  See <a class="reference internal" href="#adding-multiple-tests-tribits-add-test">Adding
Multiple Tests (TRIBITS_ADD_TEST())</a> for more details and exmaples.</blockquote>
<p><tt class="docutils literal">POSTFIX_AND_ARGS_&lt;IDX&gt; &lt;postfix&gt; &lt;arg0&gt; &lt;arg1&gt; ...</tt></p>
<blockquote>
<p>If specified, gives a sequence of sets of test postfix names and
arguments lists for different tests (up to <tt class="docutils literal">POSTFIX_AND_ARGS_19</tt>).
For example, a set of three different tests with argument lists can be
specified as:</p>
<pre class="literal-block">
POSTIFX_AND_ARGS_0 postfix0 --arg1 --arg2=&quot;dummy&quot;
POSTIFX_AND_ARGS_1 postfix1  --arg2=&quot;fly&quot;
POSTIFX_AND_ARGS_2 postfix2  --arg2=&quot;bags&quot;
</pre>
<p>This will create three different test cases with the postfix names
<tt class="docutils literal">postfix0</tt>, <tt class="docutils literal">postfix1</tt>, and <tt class="docutils literal">postfix2</tt>.  The indexes must be
consecutive starting a <tt class="docutils literal">0</tt> and going up to (currently) <tt class="docutils literal">19</tt>.  The
main advantages of using these arguments instead of just <tt class="docutils literal">ARGS</tt> are
that one can give a meaningful name to each test case and one can
specify multiple arguments without having to quote them and one can
allow long argument lists to span multiple lines.  See <a class="reference internal" href="#adding-multiple-tests-tribits-add-test">Adding Multiple
Tests (TRIBITS_ADD_TEST())</a> for more details and exmaples.</p>
</blockquote>
<p><tt class="docutils literal">COMM [serial] [mpi]</tt></p>
<blockquote>
If specified, determines if the test will be added in serial and/or MPI
mode.  If the <tt class="docutils literal">COMM</tt> argument is missing, the test will be added in
both serial and MPI builds of the code.  That is if <tt class="docutils literal">COMM mpi</tt> is
passed in, then the test will <strong>not</strong> be added if
<tt class="docutils literal">TPL_ENABLE_MPI=OFF</tt>.  Likewise, if <tt class="docutils literal">COMM serial</tt> is passed in, then
the test will <strong>not</strong> be added if <tt class="docutils literal">TPL_ENABLE_MPI=ON</tt>.  If <tt class="docutils literal">COMM
serial mpi</tt> or <tt class="docutils literal">COMM mpi serial</tt> is passed in, then the value of
<tt class="docutils literal">TPL_ENABLE_MPI</tt> does not determine if the test is added or not.</blockquote>
<p><tt class="docutils literal">NUM_MPI_PROCS &lt;numProcs&gt;</tt></p>
<blockquote>
If specified, gives the number of MPI processes used to run the test
with the MPI exec program <tt class="docutils literal">${MPI_EXEC}</tt>.  If <tt class="docutils literal">&lt;numProcs&gt;</tt> is greater
than <tt class="docutils literal">${MPI_EXEC_MAX_NUMPROCS}</tt> then the test will be excluded.  If
not specified, then the default number of processes for an MPI build
(i.e. <tt class="docutils literal">TPL_ENABLE_MPI=ON</tt>) will be <tt class="docutils literal">${MPI_EXEC_DEFAULT_NUMPROCS}</tt>.
For serial builds (i.e. <tt class="docutils literal">TPL_ENABLE_MPI=OFF</tt>), this argument is
ignored.  This will also be set as the built-in test property
<tt class="docutils literal">PROCESSORS</tt> if <tt class="docutils literal">NUM_TOTAL_CORES_USED</tt> is not specified.</blockquote>
<p><tt class="docutils literal">NUM_TOTAL_CORES_USED &lt;numTotalCoresUsed&gt;</tt></p>
<blockquote>
If specified, gives the total number of processes or cores that is
reported to CTest as the built-in CTest <tt class="docutils literal">PROCESSORS</tt> property.  If
this is not specified, then <tt class="docutils literal">PROCESSORS</tt> is specified by the argument
<tt class="docutils literal">NUM_MPI_PROCS &lt;numProcs&gt;</tt>.  This argument is used for test
scripts/executables that use more cores than MPI processes
(i.e. <tt class="docutils literal">&lt;numProcs&gt;</tt>) and its only purpose is to inform CTest and
TriBITS of the maximum number of processes or cores that are used by the
underlying test executable/script.  When specified, if
<tt class="docutils literal">&lt;numTotalCoresUsed&gt;</tt> is greater than <tt class="docutils literal">${MPI_EXEC_MAX_NUMPROCS}</tt>,
then the test will not be added.  Otherwise, the CTest property
<tt class="docutils literal">PROCESSORS</tt> is set to <tt class="docutils literal">&lt;numTotalCoresUsed&gt;</tt> so that CTest knows how
to best schedule the test w.r.t. other tests on a given number of
available processes.  See <a class="reference internal" href="#running-multiple-tests-at-the-same-time-tribits-add-test">Running multiple tests at the same time
(TRIBITS_ADD_TEST())</a>.</blockquote>
<p><tt class="docutils literal">CATEGORIES &lt;category0&gt; &lt;category1&gt; ...</tt></p>
<blockquote>
If specified, gives the specific categories of the test.  Valid test
categories include <tt class="docutils literal">BASIC</tt>, <tt class="docutils literal">CONTINUOUS</tt>, <tt class="docutils literal">NIGHTLY</tt>, <tt class="docutils literal">WEEKLY</tt>
and <tt class="docutils literal">PERFORMANCE</tt>.  If not specified, the default category is
<tt class="docutils literal">BASIC</tt>.  When the test category does not match
<tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt>, then the test is <strong>not</strong> added.
When <tt class="docutils literal">CATEGORIES</tt> contains <tt class="docutils literal">BASIC</tt> it will match
<tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt> equal to <tt class="docutils literal">CONTINUOUS</tt>,
<tt class="docutils literal">NIGHTLY</tt>, and <tt class="docutils literal">WEEKLY</tt>.  When <tt class="docutils literal">CATEGORIES</tt> contains
<tt class="docutils literal">CONTINUOUS</tt> it will match <tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt> equal
to <tt class="docutils literal">CONTINUOUS</tt>, <tt class="docutils literal">NIGHTLY</tt>, and <tt class="docutils literal">WEEKLY</tt>.  When <tt class="docutils literal">CATEGORIES</tt>
contains <tt class="docutils literal">NIGHTLY</tt> it will match <tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt>
equal to <tt class="docutils literal">NIGHTLY</tt> and <tt class="docutils literal">WEEKLY</tt>.  When <tt class="docutils literal">CATEGORIES</tt> contains
<tt class="docutils literal">PERFORMANCE</tt> it will match
<tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES=PERFORMANCE</tt> only.</blockquote>
<p><tt class="docutils literal">HOST &lt;host0&gt; &lt;host1&gt; ...</tt></p>
<blockquote>
If specified, gives a list of hostnames where the test will be included.
The current hostname is determined by the built-in CMake command
<tt class="docutils literal"><span class="pre">SITE_NAME(${PROJECT_NAME}_HOSTNAME)</span></tt>.  On Linux/Unix systems, this is
typically the value returned by <tt class="docutils literal">uname <span class="pre">-n</span></tt>.  If this list is given,
the value of <tt class="docutils literal"><span class="pre">${${PROJECT_NAME}_HOSTNAME}</span></tt> must equal one of the
listed host names <tt class="docutils literal">&lt;hosti&gt;</tt> or test will <strong>not</strong> be added.  The value
of <tt class="docutils literal">${PROJECT_NAME}_HOSTNAME</tt> gets printed out in the TriBITS cmake
output under the section <tt class="docutils literal">Probing the environment</tt> (see <a class="reference internal" href="#full-processing-of-tribits-project-files">Full
Processing of TriBITS Project Files</a>).</blockquote>
<p><tt class="docutils literal">XHOST &lt;host0&gt; &lt;host1&gt; ...</tt></p>
<blockquote>
If specified, gives a list of hostnames (see <tt class="docutils literal">HOST</tt> argument) on which
the test will <strong>not</strong> be added.  This check is performed after the check
for the hostnames in the <tt class="docutils literal">HOST</tt> list if it should exist.  Therefore,
this exclusion list overrides the <tt class="docutils literal">HOST</tt> inclusion list.</blockquote>
<p><tt class="docutils literal">HOSTTYPE &lt;hosttype0&gt; &lt;hosttype1&gt; ...</tt></p>
<blockquote>
If specified, gives the names of the host system type (given by the
built-in CMake cache variable <tt class="docutils literal">CMAKE_HOST_SYSTEM_NAME</tt> which is
printed in the TriBITS cmake configure output in the section <tt class="docutils literal">Probing
the environment</tt>) for which the test is allowed to be added.  If
<tt class="docutils literal">HOSTTYPE</tt> is specified and <tt class="docutils literal">CMAKE_HOST_SYSTEM_NAME</tt> is not equal to
one of the values of <tt class="docutils literal">&lt;hosttypei&gt;</tt>, then the test will <strong>not</strong> be
added.  Typical host system type names include <tt class="docutils literal">Linux</tt>, <tt class="docutils literal">Darwain</tt>,
<tt class="docutils literal">Windows</tt>, etc.</blockquote>
<p><tt class="docutils literal">XHOSTTYPE &lt;hosttype0&gt; &lt;hosttype1&gt; ...</tt></p>
<blockquote>
If specified, gives the names of the host system type (see the
<tt class="docutils literal">HOSTTYPE</tt> argument above) for which <strong>not</strong> to include the test on.
This check is performed after the check for the host system names in the
<tt class="docutils literal">HOSTTYPE</tt> list if it should exist.  Therefore, this exclusion list
overrides the <tt class="docutils literal">HOSTTYPE</tt> inclusion list.</blockquote>
<p><tt class="docutils literal">STANDARD_PASS_OUTPUT</tt></p>
<blockquote>
If specified, then the standard test output string <tt class="docutils literal">End Result: TEST
PASSED</tt> is grepped in the test stdout for to determine success.  This
is needed for MPI tests on some platforms since the return value from
MPI executables is unreliable.  This is set using the built-in CTest
property <tt class="docutils literal">PASS_REGULAR_EXPRESSION</tt>.</blockquote>
<p><tt class="docutils literal">PASS_REGULAR_EXPRESSION <span class="pre">&quot;&lt;regex0&gt;;&lt;regex1&gt;;...&quot;</span></tt></p>
<blockquote>
If specified, then the test will be assumed to pass only if one of the
regular expressions <tt class="docutils literal">&lt;regex0&gt;</tt>, <tt class="docutils literal">&lt;regex1&gt;</tt> etc. match the output
send to stdout.  Otherwise, the test will fail.  This is set using the
built-in CTest property <tt class="docutils literal">PASS_REGULAR_EXPRESSION</tt>.  Consult standard
CMake documentation for full behavior.  TIPS: Replace ';' with '[;]' or
CMake will interpretet this as a array eleemnt boundary.  To match '.',
use '[.]'.</blockquote>
<p><tt class="docutils literal">FAIL_REGULAR_EXPRESSION <span class="pre">&quot;&lt;regex0&gt;;&lt;regex1&gt;;...&quot;</span></tt></p>
<blockquote>
If specified, then a test will be assumed to fail if one of the regular
expressions <tt class="docutils literal">&lt;regex0&gt;</tt>, <tt class="docutils literal">&lt;regex1&gt;</tt> etc. match the output send to
stdout.  Otherwise, the test will pass.  This is set using the built-in
CTest property <tt class="docutils literal">FAIL_REGULAR_EXPRESSION</tt>.  Consult standard CMake
documentation for full behavior (and see above tips for
<tt class="docutils literal">PASS_REGULAR_EXPRESSION</tt>).</blockquote>
<p><tt class="docutils literal">WILL_FAIL</tt></p>
<blockquote>
If passed in, then the pass/fail criteria will be inverted.  This is set
using the built-in CTest property <tt class="docutils literal">WILL_FAIL</tt>.  Consult standard CMake
documentation for full behavior.</blockquote>
<p><tt class="docutils literal">ENVIRONMENT <span class="pre">&lt;var0&gt;=&lt;value0&gt;</span> <span class="pre">&lt;var1&gt;=&lt;value1&gt;</span> ...</tt></p>
<blockquote>
If passed in, the listed environment variables will be set before
calling the test.  This is set using the built-in CTest property
<tt class="docutils literal">ENVIRONMENT</tt>.</blockquote>
<p><tt class="docutils literal">TIMEOUT &lt;maxSeconds&gt;</tt></p>
<blockquote>
<p>If passed in, gives maximum number of seconds the test will be allowed
to run before being timed-out.  This sets the CTest property
<tt class="docutils literal">TIMEOUT</tt>.  The value <tt class="docutils literal">&lt;maxSeconds&gt;</tt> will be scaled by the value of
<a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#project-scale-test-timeout-testing-timeout">${PROJECT_NAME}_SCALE_TEST_TIMEOUT</a>.</p>
<p><strong>WARNING:</strong> Rather than just increasing the timeout for an expensive
test, please try to either make the test run faster or relegate the test
to being run less often (i.e. set <tt class="docutils literal">CATEGORIES NIGHTLY</tt> or even
<tt class="docutils literal">WEEKLY</tt> for extremely expensive tests).  Expensive tests are one of
the worse forms of technical debt that a project can have!</p>
</blockquote>
<p><tt class="docutils literal">ADDED_TESTS_NAMES_OUT &lt;testsNames&gt;</tt></p>
<blockquote>
If specified, then on output the variable <tt class="docutils literal">&lt;testsNames&gt;</tt> will be set
with the name(S) of the tests passed to <tt class="docutils literal">ADD_TEST()</tt>.  If more than
one test is added, then this will be a list of test names.  Having this
name allows the calling <tt class="docutils literal">CMakeLists.txt</tt> file access and set
additional test propeties (see <a class="reference internal" href="#setting-additional-test-properties-tribits-add-test">Setting additional test properties
(TRIBITS_ADD_TEST())</a>).</blockquote>
</blockquote>
<p>In the end, this function just calls the built-in CMake commands
<tt class="docutils literal"><span class="pre">ADD_TEST(${TEST_NAME}</span> <span class="pre">...)</span></tt> and <tt class="docutils literal"><span class="pre">SET_TESTS_PROPERTIES(${TEST_NAME}</span>
<span class="pre">...)</span></tt> to set up a executable process for <tt class="docutils literal">ctest</tt> to run, determine
pass/fail criteria, and set some other test properties.  Therefore, this
wrapper function does not provide any fundamentally new features that are
not already available in the basic usage if CMake/CTest.  However, this
wrapper function takes care of many of the details and boiler-plate CMake
code that it takes to add such a test (or tests) and enforces consistency
across a large project for how tests are defined, run, and named (to avoid
test name clashes).</p>
<p>If more flexibility or control is needed when defining tests, then the
function <a class="reference internal" href="#tribits-add-advanced-test">TRIBITS_ADD_ADVANCED_TEST()</a> should be used instead.</p>
<p>In the following subsections, more details on how tests are defined and run
is given.</p>
<p id="determining-the-executable-or-command-to-run-tribits-add-test"><strong>Determining the Executable or Command to Run (TRIBITS_ADD_TEST())</strong></p>
<p>This function is primarily designed to make it easy to run tests for
executables built using the function <a class="reference internal" href="#tribits-add-executable">TRIBITS_ADD_EXECUTABLE()</a>.  To set up
tests to run arbitrary executables, see below.</p>
<p>By default, the executable to run is determined by first getting the
executable name which by default is assumed to be:</p>
<pre class="literal-block">
&lt;fullExeName&gt; =
  ${PACKAGE_NAME}_&lt;exeRootName&gt;${${PROJECT_NAME}_CMAKE_EXECUTABLE_SUFFIX}
</pre>
<p>which is (by no coincidence) identical to how it is selected in
<a class="reference internal" href="#tribits-add-executable">TRIBITS_ADD_EXECUTABLE()</a>.  This name can be altered by passing in
<tt class="docutils literal">NOEXEPREFIX</tt>, <tt class="docutils literal">NOEXESUFFIX</tt>, and <tt class="docutils literal">ADD_DIR_TO_NAME</tt> as described in
<a class="reference internal" href="#executable-and-target-name-tribits-add-executable">Executable and Target Name (TRIBITS_ADD_EXECUTABLE())</a>.</p>
<p>By default, this executable is assumed to be in the current CMake binary
directory <tt class="docutils literal">${CMAKE_CURRENT_BINARY_DIR}</tt> but the directory location can be
changed using the <tt class="docutils literal">DIRECTORY &lt;dir&gt;</tt> argument.</p>
<p>If an arbitrary executable is to be run (i.e. not build inside of the
project), then pass in <tt class="docutils literal">NOEXEPREFIX</tt> and <tt class="docutils literal">NOEXESUFFIX</tt> and set
<tt class="docutils literal">&lt;exeRootName&gt;</tt> to the relative or absolute path of the executable to be
run.  If <tt class="docutils literal">&lt;exeRootName&gt;</tt> is not an absolute path, then
<tt class="docutils literal"><span class="pre">${CMAKE_CURRENT_BINARY_DIR}/&lt;exeRootName&gt;</span></tt> is set as the executable to
run in this case.</p>
<p>Whatever executable path is specified using this logic, if the executable is
not found, then when <tt class="docutils literal">ctest</tt> goes to run the test, it will mark it as
<tt class="docutils literal">NOT RUN</tt>.</p>
<p id="determining-the-full-test-name-tribits-add-test"><strong>Determining the Full Test Name (TRIBITS_ADD_TEST())</strong></p>
<p>By default, the base test name is selected to be:</p>
<pre class="literal-block">
&lt;fullTestName&gt; = ${PACKAGE_NAME}_&lt;exeRootName&gt;
</pre>
<p>If <tt class="docutils literal">NAME &lt;testRootName&gt;</tt> is passed in, then <tt class="docutils literal">&lt;testRootName&gt;</tt> is used
instead of <tt class="docutils literal">&lt;exeRootName&gt;</tt> above.</p>
<p>If <tt class="docutils literal">NAME_POSTFIX &lt;testNamePostfix&gt;</tt> is passed in, then the base test name
is selected to be:</p>
<pre class="literal-block">
&lt;fullTestName&gt; = ${PACKAGE_NAME}_&lt;exeRootName&gt;_&lt;testNamePostfix&gt;
</pre>
<p>If <tt class="docutils literal">ADD_DIR_TO_NAME</tt> is passed in, then the directory name relative to the
package base directory is added to the name as well to help disambiguate the
test name (see the above).</p>
<p>Let the test name determined as described above be <tt class="docutils literal">&lt;fullTestName&gt;</tt>.  If
no arguments or only a single set of arguments are passed in through
<tt class="docutils literal">ARGS</tt>, then this is the test name actually passed in to <tt class="docutils literal">ADD_TEST()</tt>.
If multiple tests are defined, then this name becomes the base test name for
each of the tests (see <a class="reference internal" href="#adding-multiple-tests-tribits-add-test">Adding Multiple Tests (TRIBITS_ADD_TEST())</a>).</p>
<p>Finally, for any test that gets defined, if MPI is enabled
(i.e. <tt class="docutils literal">TPL_ENABLE_MPI=ON</tt>), then the terminal suffix
<tt class="docutils literal"><span class="pre">_MPI_${NUM_MPI_PROCS}</span></tt> will be added to the end of the test name (even
for multiple tests).  No such prefix is added for the serial case
(i.e. <tt class="docutils literal">TPL_ENABLE_MPI=OFF</tt>).</p>
<p id="adding-multiple-tests-tribits-add-test"><strong>Adding Multiple Tests  (TRIBITS_ADD_TEST())</strong></p>
<p>Using this function, one can add executable arguments and can even add
multiple tests in one of two ways.  One can either pass in one or more
<strong>quoted</strong> clusters of arguments using:</p>
<pre class="literal-block">
ARGS &quot;&lt;arg0&gt; &lt;arg1&gt; ...&quot; &quot;&lt;arg2&gt; &lt;arg3&gt; ...&quot; ...
</pre>
<p>or can pass in an explicit test name postfix and arguments with:</p>
<pre class="literal-block">
POSTFIX_AND_ARGS_0 &lt;postfix0&gt; &lt;arg0&gt; &lt;arg1&gt; ...
POSTFIX_AND_ARGS_1 &lt;postfix1&gt; &lt;arg2&gt; ...
...
</pre>
<p>If only one short set of arguments needs to be passed in, then passing:</p>
<pre class="literal-block">
ARGS &quot;&lt;arg0&gt; &lt;arg1&gt;&quot;
</pre>
<p>may be preferable since it will not add any postfix name to the test.  To
add more than one test case using <tt class="docutils literal">ARGS</tt>, one will use more than one
quoted set of arugments such as with:</p>
<pre class="literal-block">
ARGS &quot;&lt;arg0&gt; &lt;arg1&gt;&quot; &quot;&lt;arg2&gt; &lt;arg2&gt;&quot;
</pre>
<p>which creates 2 tests with the names <tt class="docutils literal">&lt;fullTestName&gt;_00</tt> passing
arguments <tt class="docutils literal">&quot;&lt;arg0&gt; &lt;arg1&gt;&quot;</tt> and <tt class="docutils literal">&lt;fullTestName&gt;_01</tt> passing arguments
<tt class="docutils literal">&quot;&lt;arg2&gt; &lt;arg3&gt;&quot;</tt>.  However, when passing multiple sets of arguments it is
preferable to <strong>not</strong> use <tt class="docutils literal">ARGS</tt> but instead use:</p>
<pre class="literal-block">
POSTFIX_AND_ARGS_0 test_a &lt;arg0&gt; &lt;arg1&gt;
POSTFIX_AND_ARGS_1 test_b &lt;arg2&gt; &lt;arg2&gt;
</pre>
<p>which also creates the same 2 tests but now with the improved names
<tt class="docutils literal">&lt;fullTestName&gt;_test_a</tt> passing arguments <tt class="docutils literal">&quot;&lt;arg0&gt; &lt;arg1&gt;&quot;</tt> and
<tt class="docutils literal">&lt;fullTestName&gt;_test_b</tt> passing arguments <tt class="docutils literal">&quot;&lt;arg2&gt; &lt;arg3&gt;&quot;</tt>.  In this way,
the individual tests can be given more understandable names.</p>
<p>The other advantage of the <tt class="docutils literal">POSTFIX_AND_ARGS_&lt;IDX&gt;</tt> form is that the
arugments <tt class="docutils literal">&lt;arg0&gt;</tt>, <tt class="docutils literal">&lt;arg1&gt;</tt>, ... do not need to be quoted and can
therefore be extended over multiple lines like:</p>
<pre class="literal-block">
POSTFIX_AND_ARGS_0 long_args --this-is-the-first-long-arg=very
  --this-is-the-second-long-arg=verylong
</pre>
<p>If one does not use quotes when using <tt class="docutils literal">ARGS</tt> one will actually get more
than one test.  For example, if one passes in:</p>
<pre class="literal-block">
ARGS --this-is-the-first-long-arg=very
  --this-is-the-second-long-arg=verylong
</pre>
<p>one actually gets two tests, not one test.  This is a common mistake that
people make when using the <tt class="docutils literal">ARGS</tt> form of passing arguments.  This can't
be fixed or it will break backward compatibility.  If this could be designed
fresh, the <tt class="docutils literal">ARGS</tt> argument would only create a single test and the
arguments would not be quoted.</p>
<p id="determining-pass-fail-tribits-add-test"><strong>Determining Pass/Fail (TRIBITS_ADD_TEST())</strong></p>
<p>The only means to determine pass/fail is to use the built-in CTest
properties <tt class="docutils literal">PASS_REGULAR_EXPRESSION</tt> and <tt class="docutils literal">FAIL_REGULAR_EXPRESSION</tt> which
can only grep the test's STDOUT/STDERR or to check for a 0 return value (or
invert these using <tt class="docutils literal">WILL_FAIL</tt>).  For simple tests, that is enough.
However, for more complex executables, one may need to examine one or more
output files to determine pass/fail.  Raw CMake/CTest cannot do this.  In
this case, one should use <a class="reference internal" href="#tribits-add-advanced-test">TRIBITS_ADD_ADVANCED_TEST()</a> instead to add the
test.</p>
<p id="setting-additional-test-properties-tribits-add-test"><strong>Setting additional test properties (TRIBITS_ADD_TEST())</strong></p>
<p>After this function returns, any tests that get added using <tt class="docutils literal">ADD_TEST()</tt>
can have additional properties set and changed using
<tt class="docutils literal">SET_TESTS_PROPERTIES()</tt>.  Therefore, any tests properties that are not
directly supported and passed through this wrapper function can be set in
the outer <tt class="docutils literal">CMakeLists.txt</tt> file after the call to <tt class="docutils literal">TRIBITS_ADD_TEST()</tt>.</p>
<p>If tests are added, then the names of those tests will be returned in the
variable <tt class="docutils literal">ADDED_TESTS_NAMES_OUT &lt;testsNames&gt;</tt>.  This can be used, for
example, to override the <tt class="docutils literal">PROCESSORS</tt> property for the tests with:</p>
<pre class="literal-block">
TRIBITS_ADD_TEST( someTest ...
  ADDED_TESTS_NAMES_OUT  someTest_TEST_NAME )

IF (someTest_TEST_NAME)
  SET_TESTS_PROPERTIES( ${someTest_TEST_NAME}
    PROPERTIES ATTACHED_FILES someTest.log )
ENDIF()
</pre>
<p>where the test writes a log file <tt class="docutils literal">someTest.log</tt> that we want to submit to
CDash also.</p>
<p>This approach will work no matter what TriBITS names the individual test(s)
or whether the test(s) are added or not (depending on other arguments like
<tt class="docutils literal">COMM</tt>, <tt class="docutils literal">XHOST</tt>, etc.).</p>
<p>There are many other test properties that one may want to set also and this
is the way it needs to be done.</p>
<p id="running-multiple-tests-at-the-same-time-tribits-add-test"><strong>Running multiple tests at the same time (TRIBITS_ADD_TEST())</strong></p>
<p>By default, CTest will run many tests defined with <tt class="docutils literal">ADD_TEST()</tt> at same
time as it can according to its parallel level (e.g. <tt class="docutils literal">'test <span class="pre">-j&lt;N&gt;'</span></tt> or the
CTest property <tt class="docutils literal">CTEST_PARALLEL_LEVEL</tt>).  For example, when raw <tt class="docutils literal">'ctest
<span class="pre">-j10'</span></tt> is run, CTest will run multiple tests at the same time to try to
make usage of 10 processes.  If all of the defined tests only used one
process (which is assumed by default except for MPI tests), then CTest will
run 10 tests at the same time and will launch new tests as running tests
finish.  One can also define tests using <tt class="docutils literal">ADD_TEST()</tt> that use more than
one process or use more cores than the number of MPI processes.  When
passing in <tt class="docutils literal">NUM_MPI_PROCS &lt;numProcs&gt;</tt> (see above), this TriBITS function
will set the built-in CTest property <tt class="docutils literal">PROCESSORS</tt> to <tt class="docutils literal">&lt;numProcs&gt;</tt>
using:</p>
<pre class="literal-block">
SET_TESTS_PROPERTIES(&lt;fullTestName&gt; PROPERTIES PROCESSORS &lt;numProcs&gt;)
</pre>
<p>This tells CTest that the defined test uses <tt class="docutils literal">&lt;numProcs&gt;</tt> processes and
CTest will use that information to not exceed the requested parallel level.
For example, if several <tt class="docutils literal">NUM_MPI_PROCS 3</tt> tests are defined and CTest is
run with <tt class="docutils literal">'ctest <span class="pre">-j12'</span></tt>, then CTest would schedule and run 4 of these
tests at a time (to make use of 12 processes), starting new ones as running
tests finish, until all of the tests have been run.</p>
<p>There are some situations where a test will use more processes/cores than
specified by <tt class="docutils literal">NUM_MPI_PROCS &lt;numProcs&gt;</tt> such as when the underlying
executable fires off more processes in parallel to do processing.  Also, an
MPI program may use threading and therefore use overall more cores than the
number of MPI processes. For these cases, it is critical to set
<tt class="docutils literal">NUM_TOTAL_CORES_USED &lt;numTotalCoresUsed&gt;</tt> to tell TriBITS and CTest how
many cores will be used.  This is needed to exclude the test if there are
too many processes/cores needed to run the test than are available.  If the
test is added, then this is needed to set the built-in CTest <tt class="docutils literal">PROCESSORS</tt>
property.  That is critical so that CTest can avoid overloading the machine.
For an MPI executable running on 4 processes that uses 10 threads per
process would set:</p>
<pre class="literal-block">
NUM_MPI_PROCS 4 NUM_TOTAL_CORES_USED 40
</pre>
<p>When the number of processes a test uses does not cleanly divide into the
requested CTest parallel level, it is not clear how CTest schedules the
tests (hard to find documentation on this but one could always inspect the
CTest source code to find out for sure).  However, one boundary case that is
well observed is that CTest will run all defined tests regardless of the
size of the <tt class="docutils literal">PROCESSORS</tt> property or the value of
<tt class="docutils literal">CTEST_PARALLEL_LEVEL</tt>.  For example, if there are tests where
<tt class="docutils literal">PROCESSORS</tt> is set to 20 but <tt class="docutils literal">`ctest <span class="pre">-j10'</span></tt> is run, then CTest will
still run those tests (using 20 processes) one at a time but will not
schedule any other tests while the parallel level is exceeded.</p>
<p>NOTE: <strong>Never</strong> manually override the <tt class="docutils literal">PROCESSORS</tt> property.  Instead,
always using <tt class="docutils literal">NUM_TOTAL_CORES_USED &lt;numTotalCoresUsed&gt;</tt> to set this.  This
is important becaues TriBITS needs to know how many processes/cores are
required in order to be able disable a test with too many cores/processes
for a given machine or imposed budget of processes to be used.</p>
<p id="debugging-and-examining-test-generation-tribits-add-test"><strong>Debugging and Examining Test Generation (TRIBITS_ADD_TEST())</strong></p>
<p>In order to see what tests get added and if not then why, configure with
<tt class="docutils literal">${PROJECT_NAME}_TRACE_ADD_TEST=ON</tt>.  That will print one line per show
that the test got added and if not then why the test was not added (i.e. due
to <tt class="docutils literal">COMM</tt>, <tt class="docutils literal">NUM_MPI_PROCS</tt>, <tt class="docutils literal">CATEGORIES</tt>, <tt class="docutils literal">HOST</tt>, <tt class="docutils literal">XHOST</tt>,
<tt class="docutils literal">HOSTTYPE</tt>, or <tt class="docutils literal">XHOSTTYPE</tt>).</p>
<p>Also, CMake writes a file <tt class="docutils literal">CTestTestfile.cmake</tt> in the current binary
directory which contains all of the added tests and test properties that are
set.  This is the file that is read by <tt class="docutils literal">ctest</tt> when it runs to determine
what tests to run, determine pass/fail and adjust other behavior using test
properties.  In this file, one can see the exact <tt class="docutils literal">ADD_TEST()</tt> and
<tt class="docutils literal">SET_TESTS_PROPERTIES()</tt> commands.  The is the ultimate way to debug
exactly what tests are getting added by this function (or if the test is
even being added at all).</p>
<p id="disabling-tests-externally-tribits-add-test"><strong>Disabling Tests Externally (TRIBITS_ADD_TEST())</strong></p>
<p>The test can be disabled externally by setting the CMake cache variable
<tt class="docutils literal">&lt;fullTestName&gt;_DISABLE=TRUE</tt>.  This allows tests to be disabled on a
case-by-case basis by the user (for whatever reason).  Here,
<tt class="docutils literal">&lt;fullTestName&gt;</tt> must be the <em>exact</em> name that shows up in 'ctest -N' when
running the test.  If multiple tests are added in this function through
multiple argument sets to <tt class="docutils literal">ARGS</tt> or through multiple
<tt class="docutils literal">POSTFIX_AND_ARGS_&lt;IDX&gt;</tt> arguments, then <tt class="docutils literal">&lt;fullTestName&gt;_DISABLE=TRUE</tt>
must be set for each test individually.  When a test is disabled in this
way, TriBITS will always print a warning to the <tt class="docutils literal">cmake</tt> stdout at
configure time warning that the test is being disabled.</p>
</div>
<div class="section" id="tribits-add-test-directories">
<h3><a class="toc-backref" href="#id111">TRIBITS_ADD_TEST_DIRECTORIES()</a></h3>
<p>Macro called to add a set of test directories for an SE package.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_TEST_DIRECTORIES(&lt;dir1&gt; &lt;dir2&gt; ...)
</pre>
<p>This macro only needs to be called from the top most <tt class="docutils literal">CMakeLists.txt</tt> file
for which all subdirectories are all &quot;tests&quot;.</p>
<p>This macro can be called several times within a package and it will have the
right effect.</p>
<p>Currently, all this macro does macro is to call <tt class="docutils literal"><span class="pre">ADD_SUBDIRECTORY(&lt;diri&gt;)</span></tt>
if <tt class="docutils literal">${PACKAGE_NAME}_ENABLE_TESTS</tt> or
<tt class="docutils literal">${PARENT_PACKAGE_NAME}_ENABLE_TESTS</tt> are <tt class="docutils literal">TRUE</tt>. However, this macro
may be extended in the future in order to modify behavior related to adding
tests and examples in a uniform way.</p>
</div>
<div class="section" id="tribits-allow-missing-external-packages">
<h3><a class="toc-backref" href="#id112">TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES()</a></h3>
<p>Allow listed packages to be missing and automatically excluded from the
package dependency data-structures.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES(&lt;pkg0&gt; &lt;plg1&gt; ...)
</pre>
<p>If the missing upstream SE package <tt class="docutils literal">&lt;pkgi&gt;</tt> is optional, then the effect
will be to simply ignore the missing package (never added to package's list
and not added to dependency data-structures) and remove it from the
dependency lists for downstream SE packages that have an optional dependency
on the missing upstream SE package <tt class="docutils literal">&lt;pkgi&gt;</tt>.  However, all downstream SE
packages that have a required dependency on the missing upstream SE package
<tt class="docutils literal">&lt;pkgi&gt;</tt> will be hard disabled,
i.e. <tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_{CURRENT_PACKAGE}=OFF</span></tt>.</p>
<p>This macro just sets the cache variable
<tt class="docutils literal">&lt;pkgi&gt;_ALLOW_MISSING_EXTERNAL_PACKAGE=TRUE</tt> for each SE package
<tt class="docutils literal">&lt;pkgi&gt;</tt>.  <strong>WARNING</strong>: Using this function effectively turns off error
checking for misspelled package names so it is important to only use it when
it absolutely is needed.  Therefore, when doing development involving these
packages, it is usually a good idea to set:</p>
<pre class="literal-block">
-D&lt;pkgi&gt;_ALLOW_MISSING_EXTERNAL_PACKAGE=FALSE
</pre>
<p>so that it will catch errors in the mispelling of package names or source
directories.</p>
<p>This macro is typically called in one of two different contexts:</p>
<ul class="simple">
<li>Called from <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> when the upstream
package <tt class="docutils literal">&lt;pkgi&gt;</tt> is defined in an optional upstream <a class="reference internal" href="#tribits-repository">TriBITS
Repository</a>.  This allows the downstream repos and packages to still be
enabled (assuming they don't have required dependencies on the missing
packages) when one or more upstream repos are missing.</li>
<li>Called from <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> when the package <tt class="docutils literal">&lt;pkgi&gt;</tt>
might be defined in an optional non-TriBITS repo (see <a class="reference internal" href="#how-to-insert-a-package-into-an-upstream-repo">How to insert a
package into an upstream repo</a>).</li>
</ul>
<p>For some meta-projects that composes packages from may different TriBITS
repositories, one might need to call this function from the file
<a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a>.</p>
</div>
<div class="section" id="tribits-configure-file">
<h3><a class="toc-backref" href="#id113">TRIBITS_CONFIGURE_FILE()</a></h3>
<p>Macro that configures the package's main configured header file (typically
called <tt class="docutils literal">${PACKAGE_NAME}_config.h</tt> but any name can be used).</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_CONFIGURE_FILE(&lt;packageConfigFile&gt;)
</pre>
<p>This function requires the file:</p>
<pre class="literal-block">
${PACKAGE_SOURCE_DIR}/cmake/&lt;packageConfigFile&gt;.in
</pre>
<p>exists and it creates the file:</p>
<pre class="literal-block">
${CMAKE_CURRENT_BINARY_DIR}/&lt;packageConfigFile&gt;
</pre>
<p>by calling the built-in <tt class="docutils literal">CONFIGURE_FILE()</tt> command:</p>
<pre class="literal-block">
CONFIGURE_FILE(
  ${PACKAGE_SOURCE_DIR}/cmake/&lt;packageConfigFile&gt;.in
  ${CMAKE_CURRENT_BINARY_DIR}/&lt;packageConfigFile&gt;
  )
</pre>
<p>which does basic substitution of CMake variables (see documentation for
built-in CMake <a class="reference external" href="http://www.cmake.org/cmake/help/v2.8.11/cmake.html#command:configure_file">CONFIGURE_FILE()</a> command for rules on how it performs
substitutions).  This command is typically used to configure the package's
main <a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a> file.</p>
<p>In addition to just calling <tt class="docutils literal">CONFIGURE_FILE()</tt>, this function also aids in
creating configured header files adding macros for deprecating code as
described below.</p>
<p><strong>Deprecated Code Macros</strong></p>
<p>If <tt class="docutils literal">${PARENT_PACKAGE_NAME}_SHOW_DEPRECATED_WARNINGS</tt> is <tt class="docutils literal">TRUE</tt> (see
<a class="reference internal" href="#tribits-add-show-deprecated-warnings-option">TRIBITS_ADD_SHOW_DEPRECATED_WARNINGS_OPTION()</a>), then the local CMake
variable <tt class="docutils literal">${PARENT_PACKAGE_NAME_UC}_DEPRECATED_DECLARATIONS</tt> is set which
adds a define <tt class="docutils literal">&lt;PARENT_PACKAGE_NAME_UC&gt;_DEPRECATED</tt> (where
<tt class="docutils literal">&lt;PARENT_PACKAGE_NAME_UC&gt;</tt> is the package name in all upper-case letters)
which adds a compiler-specific deprecated warning for an entity.  To take
advantage of this, just add the line:</p>
<pre class="literal-block">
&#64;&lt;PARENT_PACKAGE_NAME_UC&gt;_DEPRECATED_DECLARATIONS&#64;
</pre>
<p>to the <tt class="docutils literal"><span class="pre">&lt;packageConfigFile&gt;.in</span></tt> file and it will be expanded at configure
time.</p>
<p>Then C/C++ code can use this macro to deprecate functions, variables,
classes, etc., for example, using:</p>
<pre class="literal-block">
&lt;PARENT_PACKAGE_NAME_UC&gt;_DEPRECATED class SomeDepreatedClass { ... }.
</pre>
<p>If the particular compiler does not support deprecated warnings, then this
macro is defined to be empty.  See <a class="reference internal" href="#regulated-backward-compatibility-and-deprecated-code">Regulated Backward Compatibility and
Deprecated Code</a> for more details.</p>
</div>
<div class="section" id="tribits-copy-files-to-binary-dir">
<h3><a class="toc-backref" href="#id114">TRIBITS_COPY_FILES_TO_BINARY_DIR()</a></h3>
<p>Function that copies a list of files from a source directory to a
destination directory at configure time, typically so that it can be used in
one or more tests.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_COPY_FILES_TO_BINARY_DIR(
  &lt;targetName&gt;
  [SOURCE_FILES &lt;file1&gt; &lt;file2&gt; ...]
  [SOURCE_DIR &lt;sourceDir&gt;]
  [DEST_FILES &lt;dfile1&gt; &lt;dfile2&gt; ...]
  [DEST_DIR &lt;destDir&gt;]
  [TARGETDEPS &lt;targDep1&gt; &lt;targDep2&gt; ...]
  [EXEDEPS &lt;exeDep1&gt; &lt;exeDep2&gt; ...]
  [NOEXEPREFIX]
  [CATEGORIES &lt;category1&gt;  &lt;category2&gt; ...]
  )
</pre>
<p>This sets up all of the custom CMake commands and targets to ensure that the
files in the destination directory are always up to date just by building
the <tt class="docutils literal">ALL</tt> target.</p>
<p>This function has a few valid calling modes:</p>
<p><strong>1) Source files and destination files have the same name</strong>:</p>
<pre class="literal-block">
TRIBITS_COPY_FILES_TO_BINARY_DIR(
  &lt;targetName&gt;
  SOURCE_FILES &lt;file1&gt; &lt;file2&gt; ...
  [SOURCE_DIR &lt;sourceDir&gt;]
  [DEST_DIR &lt;destDir&gt;]
  [TARGETDEPS &lt;targDep1&gt; &lt;targDep2&gt; ...]
  [EXEDEPS &lt;exeDep1&gt; &lt;exeDep2&gt; ...]
  [NOEXEPREFIX]
  [CATEGORIES &lt;category1&gt;  &lt;category2&gt; ...]
  )
</pre>
<p>In this case, the names of the source files and the destination files
are the same but just live in different directories.</p>
<p><strong>2) Source files have a prefix different from the destination files</strong>:</p>
<pre class="literal-block">
TRIBITS_COPY_FILES_TO_BINARY_DIR(
  &lt;targetName&gt;
  DEST_FILES &lt;file1&gt; &lt;file2&gt; ...
  SOURCE_PREFIX &lt;srcPrefix&gt;
  [SOURCE_DIR &lt;sourceDir&gt;]
  [DEST_DIR &lt;destDir&gt;]
  [EXEDEPS &lt;exeDep1&gt; &lt;exeDep2&gt; ...]
  [NOEXEPREFIX]
  [CATEGORIES &lt;category1&gt;  &lt;category2&gt; ...]
  )
</pre>
<p>In this case, the source files have the same basic name as the destination
files except they have the prefix <tt class="docutils literal">&lt;srcPrefix&gt;</tt> prepended to the name.</p>
<p><strong>3) Source files and destination files have completely different names</strong>:</p>
<pre class="literal-block">
TRIBITS_COPY_FILES_TO_BINARY_DIR(
  &lt;targetName&gt;
  SOURCE_FILES &lt;sfile1&gt; &lt;sfile2&gt; ...
  [SOURCE_DIR &lt;sourceDir&gt;]
  DEST_FILES &lt;dfile1&gt; &lt;dfile2&gt; ...
  [DEST_DIR &lt;destDir&gt;]
  [EXEDEPS &lt;exeDep1&gt; &lt;exeDep2&gt; ...]
  [NOEXEPREFIX]
  [CATEGORIES &lt;category1&gt;  &lt;category2&gt; ...]
  )
</pre>
<p>In this case, the source files and destination files have completely
different prefixes.</p>
<p>The individual arguments are:</p>
<blockquote>
<p><tt class="docutils literal">SOURCE_FILES &lt;file1&gt; &lt;file2&gt; ...</tt></p>
<blockquote>
Listing of the source files relative to the source directory given by
the argument <tt class="docutils literal">SOURCE_DIR &lt;sourceDir&gt;</tt>.  If omitted, this list will be
the same as <tt class="docutils literal">DEST_FILES</tt> with the argument <tt class="docutils literal">SOURCE_PREFIX
&lt;srcPrefix&gt;</tt> appended.</blockquote>
<p><tt class="docutils literal">SOURCE_DIR &lt;sourceDir&gt;</tt></p>
<blockquote>
Optional argument that gives the (absolute) base directory for all of
the source files.  If omitted, this takes the default value of
<tt class="docutils literal">${CMAKE_CURRENT_SOURCE_DIR}</tt>.</blockquote>
<p><tt class="docutils literal">DEST_FILES &lt;file1&gt; &lt;file2&gt; ...</tt></p>
<blockquote>
Listing of the destination files relative to the destination directory
given by the argument <tt class="docutils literal">DEST_DIR &lt;destDir&gt;</tt>. If omitted, this list will
be the same as given by the <tt class="docutils literal">SOURCE_FILES</tt> list.</blockquote>
<p><tt class="docutils literal">DEST_DIR &lt;destDir&gt;</tt></p>
<blockquote>
Optional argument that gives the (absolute) base directory for all of
the destination files.  If omitted, this takes the default value of
<tt class="docutils literal">${CMAKE_CURRENT_BINARY_DIR}</tt></blockquote>
<p><tt class="docutils literal">TARGETDEPS &lt;targDep1&gt; &lt;targDep2&gt; ...</tt></p>
<blockquote>
Listing of general CMake targets that these files will be added as
dependencies to.  This results in the copies to be performed when any of
the targets <tt class="docutils literal">&lt;targDepi&gt;</tt> are built.</blockquote>
<p><tt class="docutils literal">EXEDEPS &lt;exeDep1&gt; &lt;exeDep2&gt; ...</tt></p>
<blockquote>
Listing of executable targets that these files will be added as
dependencies to.  By default, the prefix <tt class="docutils literal">${PACKAGE_NAME}_</tt> will is
appended to the names of the targets.  This ensures that if the
executable target is built that these files will also be copied as well.</blockquote>
<p><tt class="docutils literal">NOEXEPREFIX</tt></p>
<blockquote>
Option that determines if the prefix <tt class="docutils literal">${PACKAGE_NAME}_</tt> will be
appended to the arguments in the <tt class="docutils literal">EXEDEPS</tt> list.</blockquote>
</blockquote>
</div>
<div class="section" id="tribits-ctest-driver">
<h3><a class="toc-backref" href="#id115">TRIBITS_CTEST_DRIVER()</a></h3>
<p>Platform-independent package-by-package CTest/CDash driver (run by <tt class="docutils literal">ctest</tt>
<strong>NOT</strong> <tt class="docutils literal">cmake</tt>).</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_CTEST_DRIVER()
</pre>
<p>This driver code that is platform independent.  This script drives the
testing process by doing a version control (VC) source update on all of the
VC repos and then configuring and building the top-level TriBITS packages
one at a time, in order.  This function gets called from inside of a
platform and build-specific <tt class="docutils literal">ctest <span class="pre">-S</span></tt> driver script.</p>
<p>To understand this script, one must understand that it gets run in several
different modes:</p>
<p><strong>Mode 1</strong>: Run where there are already existing source and binary
directories (<tt class="docutils literal">CTEST_DASHBOARD_ROOT</tt> is set empty before call).  This is
for when the ctest driver script is run on an existing source and binary
tree.  In this case, there is one project source tree and
<tt class="docutils literal">CTEST_SOURCE_DIRECTORY</tt> and <tt class="docutils literal">CTEST_BINARY_DIRECTORY</tt> must be set by the
user before calling this function.  This is used to test a local build and
post to CDash.</p>
<p><strong>Mode 2</strong>: A new binary directory is created and new sources are cloned (or
updated) in a driver directory (<tt class="docutils literal">CTEST_DASHBOARD_ROOT</tt> is set before
call).  In this case, there are always two (partial) project source tree's,
i) a &quot;driver&quot; skeleton source tree (typically embedded with TriBITS
directory) that bootstraps the testing process, and ii) a true full &quot;source&quot;
that is (optionally) cloned and/or updated.</p>
<p>There are a few different directory locations are significant for this
script:</p>
<blockquote>
<p><tt class="docutils literal">TRIBITS_PROJECT_ROOT</tt></p>
<blockquote>
The root directory to an existing source tree where the project's
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> (defining <tt class="docutils literal">PROJECT_NAME</tt> variable)
and <tt class="docutils literal">Version.cmake</tt> file's can be found.</blockquote>
<p><tt class="docutils literal">${PROJECT_NAME}_TRIBITS_DIR</tt></p>
<blockquote>
The base directory for the TriBITS system's various CMake modules,
python scripts, and other files.  By default this is assumed to be in
the source tree under <tt class="docutils literal">${TRIBITS_PROJECT_ROOT}</tt> (see below) but it can
be overridden to point to any location.</blockquote>
<p><tt class="docutils literal">CTEST_DASHBOARD_ROOT</tt></p>
<blockquote>
If set, this is the base directory where this script runs that clones
the sources for the project.  If this directory does not exist, it will
be created.  If empty, then has no effect on the script.</blockquote>
<p><tt class="docutils literal">CTEST_SOURCE_DIRECTORY</tt></p>
<blockquote>
Determines the location of the sources that are used to define packages,
dependencies and configure and build the software.  This is a variable
that CTest directly reads and must therefore be set. This is used to set
<a class="reference internal" href="#project-source-dir">PROJECT_SOURCE_DIR</a> which is used by the TriBITS system.  If
<tt class="docutils literal">CTEST_DASHBOARD_ROOT</tt> is set, then this is hard-coded internally to
<tt class="docutils literal"><span class="pre">${CTEST_DASHBOARD_ROOT}/${CTEST_SOURCE_NAME}</span></tt>.</blockquote>
<p><tt class="docutils literal">CTEST_BINARY_DIRECTORY</tt></p>
<blockquote>
Determines the location of the binary tree where output from CMake/CTest
is put.  This is used to set to <a class="reference internal" href="#project-binary-dir">PROJECT_BINARY_DIR</a> which is used by
the TriBITS system.  If <tt class="docutils literal">CTEST_DASHBOARD_ROOT</tt> is set, then this is
hard-coded internally to <tt class="docutils literal"><span class="pre">${CTEST_DASHBOARD_ROOT}/BUILD</span></tt>.</blockquote>
</blockquote>
<p>ToDo: Document input variables that have defaults, to be set before, and can
be overridden from the env.</p>
<p>ToDo: Finish Documentation!</p>
</div>
<div class="section" id="tribits-determine-if-current-package-needs-rebuilt">
<h3><a class="toc-backref" href="#id116">TRIBITS_DETERMINE_IF_CURRENT_PACKAGE_NEEDS_REBUILT()</a></h3>
<p>Determine at configure time if any of the upstream dependencies for a
package require the current package to be rebuilt.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_DETERMINE_IF_CURRENT_PACKAGE_NEEDS_REBUILT(
  [SHOW_MOST_RECENT_FILES]
  [SHOW_OVERALL_MOST_RECENT_FILES]
  CURRENT_PACKAGE_OUT_OF_DATE_OUT &lt;currentPackageOutOfDate&gt;
  )
</pre>
<p><strong>Arguments:</strong></p>
<blockquote>
<p><tt class="docutils literal">SHOW_MOST_RECENT_FILES</tt></p>
<blockquote>
If specified, then the most recently modified file for each individual
base source and binary directory searched will be will be printed the
STDOUT.  Setting this implies <tt class="docutils literal">SHOW_OVERALL_MOST_RECENT_FILE</tt>.</blockquote>
<p><tt class="docutils literal">SHOW_OVERALL_MOST_RECENT_FILE</tt></p>
<blockquote>
If specified, then only the most recent modified file over all of the
individual directories for each category (i.e. one for upstream SE
package source dirs, one for upstream SE package binary dirs, one for
the package's source dir, and one for the package's own binary dir) is
printed to STDOUT.</blockquote>
<p><tt class="docutils literal">CURRENT_PACKAGE_OUT_OF_DATE_OUT &lt;currentPackageOutOfDate&gt;</tt></p>
<blockquote>
On output, the local variable <tt class="docutils literal">&lt;currentPackageOutOfDate&gt;</tt> will be set
to <tt class="docutils literal">TRUE</tt> if any of the upstream most modified files are more recent
than the most modified file in the package's binary directory.
Otherwise, this variable is set to <tt class="docutils literal">FALSE</tt>.</blockquote>
</blockquote>
<p><strong>Description:</strong></p>
<p>This function is designed to help take an externally configured and built
piece of software (that generates libraries) and wrap it as a TriBITS
package or subpackage.  This function uses the lower-level functions:</p>
<ul class="simple">
<li><a class="reference internal" href="#tribits-find-most-recent-source-file-timestamp">TRIBITS_FIND_MOST_RECENT_SOURCE_FILE_TIMESTAMP()</a></li>
<li><a class="reference internal" href="#tribits-find-most-recent-binary-file-timestamp">TRIBITS_FIND_MOST_RECENT_BINARY_FILE_TIMESTAMP()</a></li>
</ul>
<p>to determine the most recent modified files in the upstream TriBITS SE
packages' source and binary directories as well as the most recent source
file for the current package.  It then compares these timestamps to the most
recent binary file timestamp in this package's binary directory.  If any of
these three files are more recent than this package's most recent binary
file, then the output variable <tt class="docutils literal">&lt;currentPackageOutOfDate&gt;</tt> is set to
<tt class="docutils literal">TRUE</tt>.  Otherwise, it is set to <tt class="docutils literal">FALSE</tt>.</p>
<p>NOTE: The source and binary directories for full packages are searched, not
individual subpackage dirs.  This is to reduce the number of dirs searched.
This will, however, result in changes in non-dependent subpackages being
considered as well.</p>
<p>See the demonstration of the usage of this function in the <tt class="docutils literal">WrapExternal</tt>
package in <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>.</p>
</div>
<div class="section" id="tribits-disable-package-on-platforms">
<h3><a class="toc-backref" href="#id117">TRIBITS_DISABLE_PACKAGE_ON_PLATFORMS()</a></h3>
<p>Disable a package automatically for a list of platforms.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_DISABLE_PACKAGE_ON_PLATFORMS( &lt;packageName&gt;
  &lt;hosttype0&gt; &lt;hosttype1&gt; ...)
</pre>
<p>If any of the host-type arguments <tt class="docutils literal">&lt;hosttypei&gt;</tt> matches the
<tt class="docutils literal">${PROJECT_NAME}_HOSTTYPE</tt> variable for the current platform, then package
<tt class="docutils literal">&lt;packageName&gt;</tt> test group classification is changed to <tt class="docutils literal">EX</tt>.  Changing
the package test group classification to <tt class="docutils literal">EX</tt> results in the package being
disabled by default (see <a class="reference internal" href="#ex-se-packages-disabled-by-default">EX SE packages disabled by default</a>).  However,
an explicit enable can still enable the package.</p>
</div>
<div class="section" id="tribits-exclude-files">
<h3><a class="toc-backref" href="#id118">TRIBITS_EXCLUDE_FILES()</a></h3>
<p>Exclude package files/dirs from the source distribution by appending
<tt class="docutils literal">CPACK_SOURCE_IGNORE_FILES</tt>.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_EXCLUDE_FILES(&lt;file0&gt; &lt;file1&gt; ...)
</pre>
<p>This is called in the package's top-level <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a>
file and each file or directory name <tt class="docutils literal">&lt;filei&gt;</tt> is actually interpreted by
CMake/CPack as a regex that is prefixed by the project's and package's
source directory names so as to not exclude files and directories of the
same name and path from other packages.  If <tt class="docutils literal">&lt;filei&gt;</tt> is an absolute path
it it not prefixed but is appended to <tt class="docutils literal">CPACK_SOURCE_IGNORE_FILES</tt>
unmodified.</p>
<p>In general, do <strong>NOT</strong> put in excludes for files and directories that are
not under this package's source tree.  If the given package is not enabled,
then this command will never be called! For example, don't put in excludes
for PackageB's files in PackageA's <tt class="docutils literal">CMakeLists.txt</tt> file because if
PackageB is enabled but PackageA is not, the excludes for PackageB will
never get added to <tt class="docutils literal">CPACK_SOURCE_IGNORE_FILES</tt>.</p>
<p>Also, be careful to note that the <tt class="docutils literal">&lt;filei&gt;</tt> arguments are actually regexes
and one must be very careful not understand how CPack will use these regexes
to match files that get excluded from the tarball.  For more details, see
<a class="reference internal" href="#creating-source-distributions">Creating Source Distributions</a>.</p>
</div>
<div class="section" id="tribits-find-most-recent-binary-file-timestamp">
<h3><a class="toc-backref" href="#id119">TRIBITS_FIND_MOST_RECENT_BINARY_FILE_TIMESTAMP()</a></h3>
<p>Find the most modified binary file in a set of base directories and return
its timestamp.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_FIND_MOST_RECENT_BINARY_FILE_TIMESTAMP(
  BINARY_BASE_DIRS &lt;dir0&gt; &lt;dir1&gt; ...
  [BINARY_BASE_BASE_DIR &lt;dir&gt;]
  [MOST_RECENT_TIMESTAMP_OUT  &lt;mostRecentTimestamp&gt;]
  [MOST_RECENT_FILEPATH_BASE_DIR_OUT &lt;mostRecentFilepathBaseDir&gt;]
  [MOST_RECENT_RELATIVE_FILEPATH_OUT &lt;mostRecentRelativeFilePath&gt;]
  [SHOW_MOST_RECENT_FILES]
  [SHOW_OVERALL_MOST_RECENT_FILE]
  )
</pre>
<p>This function just calls <a class="reference internal" href="#tribits-find-most-recent-file-timestamp">TRIBITS_FIND_MOST_RECENT_FILE_TIMESTAMP()</a>
passing in a set of basic exclude regexes like <tt class="docutils literal">CMakeFiles/</tt>,
<tt class="docutils literal"><span class="pre">[.]cmake$</span></tt>, and <tt class="docutils literal">/Makefile$</tt>, etc.  These types of files usually don't
impact the build of downstream software in CMake projects.</p>
</div>
<div class="section" id="tribits-find-most-recent-file-timestamp">
<h3><a class="toc-backref" href="#id120">TRIBITS_FIND_MOST_RECENT_FILE_TIMESTAMP()</a></h3>
<p>Find the most modified file in a set of base directories and return its
timestamp.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_FIND_MOST_RECENT_FILE_TIMESTAMP(
  BASE_DIRS &lt;dir0&gt; &lt;dir1&gt; ...
  [BASE_BASE_DIR &lt;dir&gt;]
  [EXCLUDE_REGEXES &quot;&lt;re0&gt;&quot; &quot;&lt;re1&gt;&quot; ...
  [SHOW_MOST_RECENT_FILES]
  [SHOW_OVERALL_MOST_RECENT_FILE]
  [MOST_RECENT_TIMESTAMP_OUT  &lt;mostRecentTimestamp&gt;]
  [MOST_RECENT_FILEPATH_BASE_DIR_OUT &lt;mostRecentFilepathBaseDir&gt;]
  [MOST_RECENT_RELATIVE_FILEPATH_OUT &lt;mostRecentRelativeFilePath&gt;]
  )
</pre>
<p><strong>Arguments:</strong></p>
<blockquote>
<p><tt class="docutils literal">BASE_DIRS &lt;dir0&gt; &lt;dir1&gt; ...</tt></p>
<blockquote>
Gives the absolute base directory paths that will be searched for the
most recently modified files, as described above.</blockquote>
<p><tt class="docutils literal">BASE_BASE_DIR &lt;dir&gt;`</tt></p>
<blockquote>
Absolute path for which to print file paths relative to.  This makes
outputting less verbose and easier to read (optional).</blockquote>
<p><tt class="docutils literal">EXCLUDE_REGEXES &quot;&lt;re0&gt;&quot; &quot;&lt;re1&gt;&quot; ...</tt></p>
<blockquote>
Gives the regular expressions that are used to exclude files from
consideration.  Each &quot;&lt;rei&gt;&quot; regex is used with a <cite>grep -v &quot;&lt;rei&gt;&quot;</cite>
filter to exclude files before sorting by time stamp.</blockquote>
<p><tt class="docutils literal">SHOW_MOST_RECENT_FILES</tt></p>
<blockquote>
If specified, then the most recently modified file for each individual
directory <tt class="docutils literal">&lt;dir0&gt;</tt>, <tt class="docutils literal">&lt;dir1</tt>, ... will be printed the STDOUT.
Setting this implies <tt class="docutils literal">SHOW_OVERALL_MOST_RECENT_FILE</tt>.</blockquote>
<p><tt class="docutils literal">SHOW_OVERALL_MOST_RECENT_FILE</tt></p>
<blockquote>
If specified, then only the most recent modified file over all of the
individual directories is printed to STDOUT.</blockquote>
<p><tt class="docutils literal">MOST_RECENT_TIMESTAMP_OUT &lt;mostRecentTimestamp&gt;</tt></p>
<blockquote>
On output, the variable <cite>&lt;mostRecentTimestamp&gt;</cite> is set that gives the
timestamp of the most recently modified file over all the directories.
This number is given as the number of seconds since Jan. 1, 1970, 00:00
GMT.</blockquote>
<p><tt class="docutils literal">MOST_RECENT_FILEPATH_BASE_DIR_OUT &lt;mostRecentFilepathBaseDir&gt;</tt></p>
<blockquote>
On output, the variable <cite>&lt;mostRecentFilepathBaseDir&gt;</cite> gives absolute base
directory of the file with the most recent timestamp over all
directories.</blockquote>
<p><tt class="docutils literal">MOST_RECENT_RELATIVE_FILEPATH_OUT &lt;mostRecentRelativeFilePath&gt;</tt></p>
<blockquote>
On output, the variable <cite>&lt;mostRecentFilepathBaseDir&gt;</cite> gives the file
name with relative path to the file with the most recent timestamp over
all directories.</blockquote>
</blockquote>
<p><strong>Description:</strong></p>
<p>This function uses the Linux/Unix command:</p>
<pre class="literal-block">
$ find . -type f -printf '%T&#64; %p\n'
    | grep -v &quot;&lt;re0&gt;&quot; | grep -v &quot;&lt;re1&gt;&quot; | ... \
    | sort -n | tail -1
</pre>
<p>to return the most recent file in each listed directory &lt;dir0&gt;, &lt;dir1&gt;, etc.
It then determines the most recently modified file over all of the
directories and prints and returns in the variables <cite>&lt;mostRecentTimestamp&gt;</cite>,
<cite>&lt;mostRecentFilepathBaseDir&gt;</cite>, and <cite>&lt;mostRecentRelativeFilePath&gt;</cite>.</p>
</div>
<div class="section" id="tribits-find-most-recent-source-file-timestamp">
<h3><a class="toc-backref" href="#id121">TRIBITS_FIND_MOST_RECENT_SOURCE_FILE_TIMESTAMP()</a></h3>
<p>Find the most modified source file in a set of base directories and return
its timestamp.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_FIND_MOST_RECENT_SOURCE_FILE_TIMESTAMP(
  SOURCE_BASE_DIRS &lt;dir0&gt; &lt;dir1&gt; ...
  [SOURCE_BASE_BASE_DIR &lt;dir&gt;]
  [SHOW_MOST_RECENT_FILES]
  [SHOW_OVERALL_MOST_RECENT_FILE]
  [MOST_RECENT_TIMESTAMP_OUT  &lt;mostRecentTimestamp&gt;]
  [MOST_RECENT_FILEPATH_BASE_DIR_OUT &lt;mostRecentFilepathBaseDir&gt;]
  [MOST_RECENT_RELATIVE_FILEPATH_OUT &lt;mostRecentRelativeFilePath&gt;]
  )
</pre>
<p>This function just calls <a class="reference internal" href="#tribits-find-most-recent-file-timestamp">TRIBITS_FIND_MOST_RECENT_FILE_TIMESTAMP()</a>
passing in a set of basic exclude regexes like <tt class="docutils literal"><span class="pre">[.]git/</span></tt>, <tt class="docutils literal"><span class="pre">[.]svn/</span></tt>,
etc.  These types of version control files can not possibly directly impact
the source code.</p>
</div>
<div class="section" id="tribits-include-directories">
<h3><a class="toc-backref" href="#id122">TRIBITS_INCLUDE_DIRECTORIES()</a></h3>
<p>This function is to override the standard behavior of the built-in CMake
<tt class="docutils literal">INCLUDE_DIRECTORIES()</tt> command.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_INCLUDE_DIRECTORIES(
  [REQUIRED_DURING_INSTALLATION_TESTING] &lt;dir0&gt; &lt;dir1&gt; ...
  )
</pre>
<p>If specified, <tt class="docutils literal">REQUIRED_DURING_INSTALLATION_TESTING</tt> can appear anywhere
in the argument list.</p>
<p>This function allows overriding the default behavior of
<tt class="docutils literal">INCLUDE_DIRECTORIES()</tt> for installation testing, to ensure that include
directories will not be inadvertently added to the build lines for tests
during installation testing (see <a class="reference internal" href="#installation-and-backward-compatibility-testing">Installation and Backward Compatibility
Testing</a>). Normally we want the include directories to be handled as cmake
usually does.  However during TriBITS installation testing we do not want
most of the include directories to be used as the majority of the files
should come from the installation we are building against.  There is an
exception to this and that is when there are test only headers that are
needed.  For that case <tt class="docutils literal">REQUIRED_DURING_INSTALLATION_TESTING</tt> must be
passed in to ensure the include paths are added for installation testing.</p>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id123">TRIBITS_PACKAGE()</a></h3>
<p>Macro called at the very beginning of a package's top-level
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_PACKAGE(
  &lt;packageName&gt;
  [ENABLE_SHADOWING_WARNINGS]
  [DISABLE_STRONG_WARNINGS]
  [CLEANED]
  [DISABLE_CIRCULAR_REF_DETECTION_FAILURE]
  )
</pre>
<p>See <a class="reference internal" href="#tribits-package-decl">TRIBITS_PACKAGE_DECL()</a> for the documentation for the arguments and
<a class="reference internal" href="#tribits-package-decl">TRIBITS_PACKAGE_DECL()</a> and <a class="reference internal" href="#id1">TRIBITS_PACKAGE()</a> for a description the
side-effects (and variables set) after calling this macro.</p>
</div>
<div class="section" id="tribits-package-decl">
<h3><a class="toc-backref" href="#id124">TRIBITS_PACKAGE_DECL()</a></h3>
<p>Macro called at the very beginning of a package's top-level
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file when a package has subpackages.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_DECL(
  &lt;packageName&gt;
  [ENABLE_SHADOWING_WARNINGS]
  [DISABLE_STRONG_WARNINGS]
  [CLEANED]
  [DISABLE_CIRCULAR_REF_DETECTION_FAILURE]
  )
</pre>
<p>The arguments are:</p>
<blockquote>
<p><tt class="docutils literal">&lt;packageName&gt;</tt></p>
<blockquote>
Gives the name of the Package, mostly just for checking and
documentation purposes.  This must match the name of the package
provided in the <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> or an error is issued.</blockquote>
<p><tt class="docutils literal">ENABLE_SHADOWING_WARNINGS</tt></p>
<blockquote>
If specified, then shadowing warnings for the package's sources will be
turned on for supported platforms/compilers.  The default is for
shadowing warnings to be turned off.  Note that this can be overridden
globally by setting the cache variable
<tt class="docutils literal">${PROJECT_NAME}_ENABLE_SHADOWING_WARNINGS</tt>.</blockquote>
<p><tt class="docutils literal">DISABLE_STRONG_WARNINGS</tt></p>
<blockquote>
If specified, then all strong warnings for the package's sources will be
turned off, if they are not already turned off by global cache
variables.  Strong warnings are turned on by default in development
mode.</blockquote>
<p><tt class="docutils literal">CLEANED</tt></p>
<blockquote>
If specified, then warnings will be promoted to errors for compiling the
package's sources for all defined warnings.</blockquote>
<p><tt class="docutils literal">DISABLE_CIRCULAR_REF_DETECTION_FAILURE</tt></p>
<blockquote>
If specified, then the standard grep looking for RCPNode circular
references in <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> and <a class="reference internal" href="#tribits-add-advanced-test">TRIBITS_ADD_ADVANCED_TEST()</a>
that causes tests to fail will be disabled.  Note that if these warnings
are being produced then it means that the test is leaking memory and
user like may also be leaking memory.</blockquote>
</blockquote>
<p>There are several side-effects of calling this macro:</p>
<ul class="simple">
<li>The variables <tt class="docutils literal">${PACKAGE_NAME}_LIB_TARGETS</tt> (lists all of the package's
targets) and <tt class="docutils literal">${PACKAGE_NAME}_ALL_TARGETS</tt> (lists all of the package's
libraries) and are initialized to empty.</li>
<li>The local variables <tt class="docutils literal">PACKAGE_SOURCE_DIR</tt> and <tt class="docutils literal">PACKAGE_BINARY_DIR</tt> are
set for this package's use in its CMakeLists.txt files.</li>
<li>Package-specific compiler options are set up in package-scope (i.e., the
package's subdirs) in <tt class="docutils literal">CMAKE_&lt;LANG&gt;_FLAG</tt>.</li>
<li>This packages's cmake subdir <tt class="docutils literal"><span class="pre">${PACKAGE_SOURCE_DIR}/cmake</span></tt> is added to
<tt class="docutils literal">CMAKE_MODULE_PATH</tt> locally so that the package's try-compile modules
can be read in with just a raw <tt class="docutils literal">INCLUDE()</tt> leaving off the full path and
the <tt class="docutils literal">*.cmake</tt> extension.</li>
</ul>
<p>If the package does not have subpackages, just call <a class="reference internal" href="#id1">TRIBITS_PACKAGE()</a>
which calls this macro.</p>
</div>
<div class="section" id="tribits-package-def">
<h3><a class="toc-backref" href="#id125">TRIBITS_PACKAGE_DEF()</a></h3>
<p>Macro called in <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> after subpackages are
processed in order to handle the libraries, tests, and examples of the
parent package.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_DEF()
</pre>
<p>If the package does not have subpackages, just call <a class="reference internal" href="#id1">TRIBITS_PACKAGE()</a>
which calls this macro.</p>
<p>This macro has several side effects:</p>
<ul class="simple">
<li>The variable <tt class="docutils literal">PACKAGE_NAME</tt> is set in the local scope for usage by the
package's <tt class="docutils literal">CMakeLists.txt</tt> files.</li>
<li>The intra-package dependency variables (i.e. list of include directories,
list of libraries, etc.) are initialized to empty.</li>
</ul>
</div>
<div class="section" id="tribits-package-define-dependencies">
<h3><a class="toc-backref" href="#id126">TRIBITS_PACKAGE_DEFINE_DEPENDENCIES()</a></h3>
<p>Define the dependencies for a given <a class="reference internal" href="#tribits-se-package">TriBITS SE Package</a> (i.e. a top-level
<a class="reference internal" href="#tribits-package">TriBITS Package</a> or a <a class="reference internal" href="#tribits-subpackage">TriBITS Subpackage</a>) in the package's
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_DEFINE_DEPENDENCIES(
   [LIB_REQUIRED_PACKAGES &lt;pkg1&gt; &lt;pkg2&gt; ...]
   [LIB_OPTIONAL_PACKAGES &lt;pkg1&gt; &lt;pkg2&gt; ...]
   [TEST_REQUIRED_PACKAGES &lt;pkg1&gt; &lt;pkg2&gt; ...]
   [TEST_OPTIONAL_PACKAGES &lt;pkg1&gt; &lt;pkg2&gt; ...]
   [LIB_REQUIRED_TPLS &lt;tpl1&gt; &lt;tpl2&gt; ...]
   [LIB_OPTIONAL_TPLS &lt;tpl1&gt; &lt;tpl2&gt; ...]
   [TEST_REQUIRED_TPLS &lt;tpl1&gt; &lt;tpl2&gt; ...]
   [TEST_OPTIONAL_TPLS &lt;tpl1&gt; &lt;tpl2&gt; ...]
   [REGRESSION_EMAIL_LIST  &lt;regression-email-address&gt;
   [SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS
     &lt;spkg1_name&gt;  &lt;spkg1_dir&gt;  &lt;spkg1_classifications&gt;  &lt;spkg1_optreq&gt;
     &lt;spkg2_name&gt;  &lt;spkg2_dir&gt;  &lt;spkg2_classifications&gt;  &lt;spkg2_optreq&gt;
     ...
     ]
   )
</pre>
<p>Every argument in this macro is optional (that is, an SE package can have no
upstream dependencies).  The arguments that apply to all SE packages are:</p>
<blockquote>
<p><tt class="docutils literal">LIB_REQUIRED_PACKAGES</tt></p>
<blockquote>
List of required upstream SE packages that must be enabled in order to
build and use the libraries (or capabilities) in this SE package.</blockquote>
<p><tt class="docutils literal">LIB_OPTIONAL_PACKAGES</tt></p>
<blockquote>
List of additional optional upstream SE packages that can be used in
this SE package if enabled.  These upstream SE packages need not be
enabled in order to enable this SE package but not enabling one or more
of these optional upstream SE packages will result in diminished
capabilities of this SE package.</blockquote>
<p><tt class="docutils literal">TEST_REQUIRED_PACKAGES</tt></p>
<blockquote>
List of additional upstream SE packages that must be enabled in order to
build and/or run the tests and/or examples in this SE package.  If any
of these upstream SE packages are not enabled, then there will be no
tests or examples defined or run for this SE package.</blockquote>
<p><tt class="docutils literal">TEST_OPTIONAL_PACKAGES</tt></p>
<blockquote>
List of additional optional upstream SE packages that can be used by the
tests in this SE package.  These upstream SE packages need not be
enabled in order to run some basic tests or examples for this SE
package.  Typically, extra tests that depend on optional test SE
packages involve integration testing of some type.</blockquote>
<p><tt class="docutils literal">LIB_REQUIRED_TPLS</tt></p>
<blockquote>
List of required upstream TPLs that must be enabled in order to build
and use the libraries (or capabilities) in this SE package.</blockquote>
<p><tt class="docutils literal">LIB_OPTIONAL_TPLS</tt></p>
<blockquote>
List of additional optional upstream TPLs that can be used in this SE
package if enabled.  These upstream TPLs need not be enabled in order to
use this SE package but not enabling one or more of these optional
upstream TPLs will result in diminished capabilities of this SE package.</blockquote>
<p><tt class="docutils literal">TEST_REQUIRED_TPLS</tt></p>
<blockquote>
List of additional upstream TPLs that must be enabled in order to build
and/or run the tests and/or examples in this SE package.  If any of
these upstream TPLs are not enabled, then there will be no tests or
examples defined or run for this SE package.</blockquote>
<p><tt class="docutils literal">TEST_OPTIONAL_TPLS</tt></p>
<blockquote>
List of additional optional upstream TPLs that can be used by the tests
in this SE package.  These upstream TPLs need not be enabled in order to
run basic tests for this SE package.  Typically, extra tests that depend
on optional TPLs involve integration testing or some additional testing
of some type.</blockquote>
</blockquote>
<p>Only upstream SE packages can be listed (as defined by the order the SE
packages are listed in <a class="reference internal" href="#tribits-repository-define-packages">TRIBITS_REPOSITORY_DEFINE_PACKAGES()</a> in the
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file).  Otherwise an error will occur and
processing will stop.  Misspelled SE package names are caught as well.</p>
<p>Only direct SE package dependencies need to be listed.  Indirect SE package
dependencies are automatically handled.  For example, if this SE package
directly depends on SE package <tt class="docutils literal">PKG2</tt> which depends on SE package <tt class="docutils literal">PKG1</tt>
(but this SE package does not directly depend on anything in <tt class="docutils literal">PKG1</tt>) then
this SE package only needs to list a dependency on <tt class="docutils literal">PKG2</tt>, not <tt class="docutils literal">PKG1</tt>.
The dependency on <tt class="docutils literal">PKG1</tt> will be taken care of automatically by the
TriBITS dependency management system.</p>
<p>However, currently, all TPL dependencies must be listed, even the indirect
ones.  This is a requirement that will be dropped in a future version of
TriBITS.</p>
<p>The SE packages listed in <tt class="docutils literal">LIB_REQUIRED_PACKAGES</tt> are implicitly also
dependencies in <tt class="docutils literal">TEST_REQUIRED_PACKAGES</tt>.  Likewise
<tt class="docutils literal">LIB_OPTIONAL_PACKAGES</tt> are implicitly also dependencies in
<tt class="docutils literal">TEST_OPTIONAL_PACKAGES</tt>.  Same goes for TPL dependencies.</p>
<p>The upstream dependencies within a single list do not need to be listed in
any order.  For example if <tt class="docutils literal">PKG2</tt> depends on <tt class="docutils literal">PKG1</tt>, and this given SE
package depends on both, then one can list:</p>
<pre class="literal-block">
LIB_REQUIRED_PACKAGES PKG2 PKG1
</pre>
<p>or:</p>
<pre class="literal-block">
&quot;LIB_REQUIRED_PACKAGES PKG1 PKG2
</pre>
<p>Likewise the order that dependent TPLs are listed is not significant.</p>
<p>If some upstream SE packages are allowed to be missing, this can be specified
by calling the macro <a class="reference internal" href="#tribits-allow-missing-external-packages">TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES()</a>.</p>
<p>A top-level <a class="reference internal" href="#tribits-package">TriBITS Package</a> can also be broken down into <a class="reference internal" href="#tribits-subpackages">TriBITS
Subpackages</a>.  In this case, the following argument must be passed in:</p>
<blockquote>
<p id="subpackages-dirs-classifications-optreqs"><tt class="docutils literal">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</tt></p>
<blockquote>
<p>2D array with rows listing the subpackages where each row has the
columns:</p>
<ul class="simple">
<li><strong>SUBPACKAGE</strong> (Column 0): The name of the subpackage <tt class="docutils literal">&lt;spkg_name&gt;</tt>.
The full SE package name is <tt class="docutils literal"><span class="pre">${PARENT_PACKAGE_NAME}&lt;spkg_name&gt;</span></tt>.
The full SE package name is what is used in listing dependencies in
other SE packages.</li>
<li><strong>DIRS</strong> (Column 1): The subdirectory <tt class="docutils literal">&lt;spkg_dir&gt;</tt> relative to the
parent package's base directory.  All of the contents of the
subpackage should be under this subdirectory.  This is assumed by the
TriBITS testing support software when mapping modified files to SE
packages that need to be tested (see <a class="reference internal" href="#checkin-test-py">checkin-test.py</a>).</li>
<li><strong>CLASSIFICATIONS</strong> (Column 2): The <a class="reference internal" href="#test-test-category">Test Test Category</a> <a class="reference internal" href="#pt">PT</a>,
<a class="reference internal" href="#st">ST</a>, <a class="reference internal" href="#ex">EX</a> and the maturity level <tt class="docutils literal">EP</tt>, <tt class="docutils literal">RS</tt>, <tt class="docutils literal">PG</tt>, <tt class="docutils literal">PM</tt>,
<tt class="docutils literal">GRS</tt>, <tt class="docutils literal">GPG</tt>, <tt class="docutils literal">GPM</tt>, and <tt class="docutils literal">UM</tt>, separated by a coma ',' with no
spaces in between (e.g. <tt class="docutils literal">&quot;PT,GPM&quot;</tt>).  These have exactly the same
meaning as for full packages (see
<a class="reference internal" href="#tribits-repository-define-packages">TRIBITS_REPOSITORY_DEFINE_PACKAGES()</a>).</li>
<li><strong>OPTREQ</strong> (Column 3): Determines if the outer parent package has an
<tt class="docutils literal">OPTIONAL</tt> or <tt class="docutils literal">REQUIRED</tt> dependence on this subpackage.</li>
</ul>
</blockquote>
</blockquote>
<p>Other variables that this macro handles:</p>
<blockquote>
<p><tt class="docutils literal">REGRESSION_EMAIL_LIST</tt></p>
<blockquote>
The email list that is used to send CDash error messages.  If this
argument is missing, then the email list that CDash errors go to is
determined by other means (see <a class="reference internal" href="#cdash-regression-email-addresses">CDash regression email addresses</a>).</blockquote>
</blockquote>
<p>NOTE: All this macro really does is to just define the variables:</p>
<ul class="simple">
<li><tt class="docutils literal">LIB_REQUIRED_DEP_PACKAGES</tt></li>
<li><tt class="docutils literal">LIB_OPTIONAL_DEP_PACKAGES</tt></li>
<li><tt class="docutils literal">TEST_REQUIRED_DEP_PACKAGES</tt></li>
<li><tt class="docutils literal">TEST_OPTIONAL_DEP_PACKAGES</tt></li>
<li><tt class="docutils literal">LIB_REQUIRED_DEP_TPLS</tt></li>
<li><tt class="docutils literal">LIB_OPTIONAL_DEP_TPLS</tt></li>
<li><tt class="docutils literal">TEST_REQUIRED_DEP_TPLS</tt></li>
<li><tt class="docutils literal">TEST_OPTIONAL_DEP_TPLS</tt></li>
<li><tt class="docutils literal">REGRESSION_EMAIL_LIST</tt></li>
<li><tt class="docutils literal">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</tt></li>
</ul>
<p>which are then read by the TriBITS cmake code to build the SE package
dependency graph.  The advantage of using this macro instead of just
directly setting the variables is that an SE package only needs to list
dependencies that exist.  Otherwise, the <tt class="docutils literal">Dependencies.cmake</tt> file will
need to set all of the above local variables, even those that are empty.
This is a error checking property of the TriBITS system to avoid misspelling
the names of these variables.</p>
</div>
<div class="section" id="tribits-package-postprocess">
<h3><a class="toc-backref" href="#id127">TRIBITS_PACKAGE_POSTPROCESS()</a></h3>
<p>Macro called at the very end of a package's top-level
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file that performs some critical
post-processing activities.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_POSTPROCESS()
</pre>
<p>NOTE: It is unfortunate that this macro must be called in a packages's
top-level <tt class="docutils literal">CMakeLists.txt</tt> file but limitations of the CMake language make
it necessary to do so.</p>
</div>
<div class="section" id="tribits-process-subpackages">
<h3><a class="toc-backref" href="#id128">TRIBITS_PROCESS_SUBPACKAGES()</a></h3>
<p>Macro that processes the <a class="reference internal" href="#tribits-subpackages">TriBITS Subpackages</a> for a parent <a class="reference internal" href="#tribits-package">TriBITS
package</a> for packages that are broken down into subpackages.  This is
called in the parent packages top-level <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_PROCESS_SUBPACKAGES()
</pre>
<p>This macro must be called after <a class="reference internal" href="#tribits-package-decl">TRIBITS_PACKAGE_DECL()</a> but before
<a class="reference internal" href="#tribits-package-def">TRIBITS_PACKAGE_DEF()</a>.</p>
</div>
<div class="section" id="tribits-process-enabled-tpl">
<h3><a class="toc-backref" href="#id129">TRIBITS_PROCESS_ENABLED_TPL()</a></h3>
<p>Processs an enabled TPL's FindTPL${TPL_NAME}.cmake module.</p>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id130">TRIBITS_PROJECT()</a></h3>
<p>Processes a <a class="reference internal" href="#tribits-project">TriBITS Project</a>'s files and configures its software which is
called from the project's top-level <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_PROJECT()
</pre>
<p>This macro requires that the variable <a class="reference internal" href="#project-name">PROJECT_NAME</a> be defined before
calling this macro.  All default values for project settings should be set
before calling this macro (see <a class="reference internal" href="#tribits-global-project-settings">TriBITS Global Project Settings</a>).  Also,
the variable <a class="reference internal" href="#project-name-tribits-dir">${PROJECT_NAME}_TRIBITS_DIR</a> must be set as well.</p>
<p>This macro then adds all of the necessary paths to <tt class="docutils literal">CMAKE_MODULE_PATH</tt> and
then performs all processing of the TriBITS project files (see <a class="reference internal" href="#full-tribits-project-configuration">Full TriBITS
Project Configuration</a>).</p>
</div>
<div class="section" id="tribits-project-define-extra-repositories">
<h3><a class="toc-backref" href="#id131">TRIBITS_PROJECT_DEFINE_EXTRA_REPOSITORIES()</a></h3>
<p>Declare a set of extra repositories for the <a class="reference internal" href="#tribits-project">TriBITS Project</a> (i.e. in the
project's <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file).</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_PROJECT_DEFINE_EXTRA_REPOSITORIES(
  &lt;repo0_name&gt; &lt;repo0_dir&gt; &lt;repo0_type&gt; &lt;repo0_url&gt; &lt;repo0_packstat&gt; &lt;repo0_classif&gt;
  &lt;repo1_name&gt; &lt;repo1_dir&gt; &lt;repo1_type&gt; &lt;repo1_url&gt; &lt;rep10_packstat&gt; &lt;repo1_classif&gt;
  ...
 )
</pre>
<p>This macro takes in a 2D array with 6 columns, where each row defines an
extra repository.  The 6 columns (ordered 0-5) are:</p>
<ol class="arabic simple" start="0">
<li><strong>REPO_NAME</strong> (<tt class="docutils literal">&lt;repoi_name&gt;</tt>): The name given to the repository
<tt class="docutils literal">REPOSITORY_NAME</tt>.</li>
<li><strong>REPO_DIR</strong> (<tt class="docutils literal">&lt;repoi_dir&gt;</tt>): The relative directory for the repository
under the project directory <tt class="docutils literal">${PROJECT_SOURCE_DIR}</tt> (or
<tt class="docutils literal">&lt;projectDir&gt;</tt>).  If this is set to empty quoted string <tt class="docutils literal">&quot;&quot;</tt>, then
the relative directory name is assumed to be same as the repository name
<tt class="docutils literal">&lt;repoi_name&gt;</tt>.</li>
<li><strong>REPO_TYPE</strong> (<tt class="docutils literal">&lt;repoi_type&gt;</tt>): The version control (VC) type of the
repo.  Value choices include <tt class="docutils literal">GIT</tt> and <tt class="docutils literal">SVN</tt> (i.e. Subversion).
<em>WARNING:</em> Only VC repos of type <tt class="docutils literal">GIT</tt> can fully participate in the
TriBITS development tool workflows.  The other VC types are supported for
basic cloning and updating using <a class="reference internal" href="#tribits-ctest-driver">TRIBITS_CTEST_DRIVER()</a> script.</li>
<li><strong>REPO_URL</strong> (<tt class="docutils literal">&lt;repoi_url&gt;</tt>): The URL of the VC repo.  This info is
used to initially obtain the repo source code using the VC tool listed in
<tt class="docutils literal">&lt;repoi_type&gt;</tt>.  If the repos don't need to be cloned for the needed
use cases, then this can be the empty quoted string <tt class="docutils literal">&quot;&quot;</tt>.</li>
<li><strong>REPO_PACKSTAT</strong> (<tt class="docutils literal">&lt;repoi_packstat&gt;</tt>): Determines if the VC repository
contains any TriBITS packages or if it just provides directories and
files.  If the VC repo contains TriBITS packages, then this field must be
the empty quoted string <tt class="docutils literal">&quot;&quot;</tt>, and this repository is considered to be a
<a class="reference internal" href="#tribits-repository">TriBITS Repository</a> and must therefore contain the files described in
<a class="reference internal" href="#tribits-repository-core-files">TriBITS Repository Core Files</a>.  If the listed repository is <strong>not</strong> a
TriBITS repository, and just provides directories and files, then this
field must be set as <tt class="docutils literal">NOPACKAGES</tt>.</li>
<li><strong>REPO_CLASSIFICATION</strong> (<tt class="docutils literal">&lt;repoi_classif&gt;</tt>): Gives the <a class="reference internal" href="#repository-test-classification">Repository Test
Classification</a> also happens to be the CTest/CDash testing mode and the
default dashboard track.  Valid values are <tt class="docutils literal">Continuous</tt>, <tt class="docutils literal">Nightly</tt>,
and <tt class="docutils literal">Experimental</tt>.  See <a class="reference internal" href="#repository-test-classification">Repository Test Classification</a> for a
detailed description.</li>
</ol>
<p>This command is used to put together one or more VC and/or TriBITS
repositories to construct a composite <a class="reference internal" href="#tribits-project">TriBITS Project</a>.  The option
<a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#project-extrarepos-file">&lt;Project&gt;_EXTRAREPOS_FILE</a> is used to point to files that call this macro.
Repositories with <tt class="docutils literal"><span class="pre">&lt;repoi_packstat&gt;=NOPACKAGES</span></tt> are <strong>not</strong> TriBITS
Repositories and are technically not considered at all during the basic
configuration of the a TriBITS project.  They are only listed in this file
so that they can be used in the version control logic for tools that perform
version control with the repositories (such as cloning, updating, looking
for changed files, etc.).  For example, a non-TriBITS repo can be used to
grab a set of directories and files that fill in the definition of a package
in an upstream repository (see <a class="reference internal" href="#how-to-insert-a-package-into-an-upstream-repo">How to insert a package into an upstream
repo</a>).  Also, non-TriBITS repos can be used to provide extra test data for
a given package or a set of packages so that extra tests can be run.</p>
<p>It is also allowed for a repository to have <tt class="docutils literal"><span class="pre">&lt;repoi_url&gt;=&quot;&quot;</span></tt> and
<tt class="docutils literal"><span class="pre">&lt;repoi_packstat&gt;=&quot;&quot;</span></tt> which means that the given repository directory
<strong>is</strong> a TriBITS Repository (and therefore provides TriBITS packages and
TPLs) but that there is no independent VC repo used to manage the software.</p>
<p>NOTE: These repositories must be listed in the order of package
dependencies.  That is, all of the packages listed in repository <tt class="docutils literal">i</tt> must
have upstream TPL and SE package dependencies listed before this package in
this repository or in upstream repositories <tt class="docutils literal"><span class="pre">i-1</span></tt>, <tt class="docutils literal"><span class="pre">i-2</span></tt>, etc.</p>
<p>NOTE: This module just sets the local variable:</p>
<pre class="literal-block">
${PROJECT_NAME}_EXTRAREPOS_DIR_REPOTYPE_REPOURL_PACKSTAT_CATEGORY
</pre>
<p>in the current scope.  The advantages of using this macro instead of
directly setting this variable are that the macro:</p>
<ul class="simple">
<li>Asserts that the variable <tt class="docutils literal">PROJECT_NAME</tt> is defined and set.</li>
<li>Avoids misspelling the name of the variable
<tt class="docutils literal">${PROJECT_NAME}_EXTRAREPOS_DIR_REPOTYPE_REPOURL_PACKSTAT_CATEGORY</tt>.  If
one misspells the name of a macro, it is an immediate error in CMake.  A
misspelled set variable is just ignored.</li>
</ul>
</div>
<div class="section" id="tribits-repository-define-packages">
<h3><a class="toc-backref" href="#id132">TRIBITS_REPOSITORY_DEFINE_PACKAGES()</a></h3>
<p>Define the set of packages for a given <a class="reference internal" href="#tribits-repository">TriBITS Repository</a>.  This macro is
typically called from inside of a <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file for a
given TriBITS repo.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_PACKAGES(
   &lt;pkg0&gt;  &lt;pkg0_dir&gt;  &lt;pkg0_classif&gt;
   &lt;pkg1&gt;  &lt;pkg1_dir&gt;  &lt;pkg1_classif&gt;
   ...
   )
</pre>
<p>This macro sets up a 2D array of <tt class="docutils literal">NumPackages</tt> by <tt class="docutils literal">NumColumns</tt> listing
out the packages for a TriBITS repository.  Each row (with 3 column entries)
specifies a package which contains the columns (ordered 0-2):</p>
<ol class="arabic simple" start="0">
<li><strong>PACKAGE</strong> (<tt class="docutils literal">&lt;pkgi&gt;</tt>): The name of the TriBITS package.  This name
must be unique across all other TriBITS packages in this or any other
TriBITS repo that might be combined into a single TriBITS project
meta-build (see <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS package names</a>).  The name
should be a valid identifier (e.g. matches the regex
<tt class="docutils literal"><span class="pre">[a-zA-Z_][a-zA-Z0-9_]*</span></tt>).  The package names tend to used mixed case
(e.g. <tt class="docutils literal">`SomePackge</tt> not <tt class="docutils literal">SOMEPACKGE</tt>).</li>
<li><strong>DIR</strong> (<tt class="docutils literal">&lt;pkgi_dir&gt;</tt>): The relative directory for the package
<tt class="docutils literal">&lt;packageDir&gt;</tt>.  This directory is relative to the TriBITS repository
base directory <tt class="docutils literal">&lt;repoDir&gt;</tt>.  Under this directory will be a
package-specific <tt class="docutils literal">cmake/</tt> directory with the file
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> and a base-level
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file.  The entire contents of the package
including all of the source code and all of the tests should be contained
under this directory.  The TriBITS testing infrastructure relies on the
mapping of changed files to these base directories when deciding what
packages are modified and need to be retested (along with downstream
packages).  For details, see <a class="reference internal" href="#checkin-test-py">checkin-test.py</a>.</li>
<li><strong>CLASSIFICATION</strong> (<tt class="docutils literal">&lt;pkgi_classif&gt;</tt>): Gives the <a class="reference internal" href="#se-package-test-group">SE Package Test
Group</a> <a class="reference internal" href="#pt">PT</a>, <a class="reference internal" href="#st">ST</a>, or <a class="reference internal" href="#ex">EX</a> and the maturity level <tt class="docutils literal">EP</tt>, <tt class="docutils literal">RS</tt>,
<tt class="docutils literal">PG</tt>, <tt class="docutils literal">PM</tt>, <tt class="docutils literal">GRS</tt>, <tt class="docutils literal">GPG</tt>, <tt class="docutils literal">GPM</tt>, <tt class="docutils literal">UM</tt>.  These are separated
by a coma with no space in between such as <tt class="docutils literal">&quot;RS,PT&quot;</tt> for a &quot;Research
Stable&quot;, &quot;Primary Tested&quot; package.  No spaces are allowed so that CMake
treats this a one field in the array.  The maturity level can be left off
in which case it is assumed to be <tt class="docutils literal">UM</tt> for &quot;Unspecified Maturity&quot;.
This classification for individual packages can be changed to <tt class="docutils literal">EX</tt> for
specific platforms by calling <a class="reference internal" href="#tribits-disable-package-on-platforms">TRIBITS_DISABLE_PACKAGE_ON_PLATFORMS()</a>.</li>
</ol>
<p><strong>IMPORTANT:</strong> The packages must be listed in increasing order of package
dependencies.  That is <a class="reference internal" href="#no-circular-dependencies-of-any-kind-are-allowed">No circular dependencies of any kind are allowed</a>
(see the <em>ADP (Acyclic Dependencies Principle)</em> in <a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering
Packaging Principles</a>).  Package <tt class="docutils literal">i</tt> can only list dependencies (in
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a>) for packages listed before this
package in this list (or in upstream TriBITS repositories).  This avoids an
expensive package sorting algorithm and makes it easy to flag packages with
circular dependencies or misspelling of package names.</p>
<p>NOTE: For some rare use cases, the package directory <tt class="docutils literal">&lt;pkgi_dir&gt;</tt> is
allowed to be specified as an absolute directory but this absolute directory
must be a subdirectory of the project source base directory given by
<a class="reference internal" href="#project-source-dir">PROJECT_SOURCE_DIR</a>.  If not, <tt class="docutils literal">MESSAGE(FATAL_ERROR <span class="pre">...)</span></tt> is called and
processing stops immediately.</p>
<p>NOTE: This macro just sets the variable:</p>
<pre class="literal-block">
${REPOSITORY_NAME}_PACKAGES_AND_DIRS_AND_CLASSIFICATIONS
</pre>
<p>in the current scope.  The advantages of using this macro instead of
directly setting this variable are that the macro:</p>
<ul class="simple">
<li>Asserts that the variable <tt class="docutils literal">REPOSITORY_NAME</tt> is defined and set</li>
<li>Avoids having to hard-code the assumed repository name
<tt class="docutils literal">${REPOSITORY_NAME}</tt>.  This provides more flexibility for how other
TriBITS projects choose to name a given TriBITS repo (i.e. the name of
repo subdirs).</li>
<li>Avoid misspelling the name of the variable
<tt class="docutils literal">${REPOSITORY_NAME}_PACKAGES_AND_DIRS_AND_CLASSIFICATIONS</tt>.  If one
misspells the name of the macro, it is an immediate error in CMake.</li>
</ul>
</div>
<div class="section" id="tribits-repository-define-tpls">
<h3><a class="toc-backref" href="#id133">TRIBITS_REPOSITORY_DEFINE_TPLS()</a></h3>
<p>Define the list of <a class="reference internal" href="#tribits-tpls">TriBITS TPLs</a> for a given <a class="reference internal" href="#tribits-repository">TriBITS Repository</a> which
includes the TPL name, find module, and classification .  This macro is
typically called from inside of the repository's <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a>
file.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_REPOSITORY_DEFINE_TPLS(
  &lt;tpl0_name&gt;   &lt;tpl0_findmod&gt;  &lt;tpl0_classif&gt;
  &lt;tpl1_name&gt;   &lt;tpl1_findmod&gt;  &lt;tpl1_classif&gt;
  ...
  )
</pre>
<p>This macro sets up a 2D array of <tt class="docutils literal">NumTPLS</tt> by <tt class="docutils literal">NumColumns</tt> listing out
the <a class="reference internal" href="#tribits-tpls">TriBITS TPLs</a> for a <a class="reference internal" href="#tribits-repository">TriBITS Repository</a>.  Each row (with 3 entries)
specifies a TPL which contains the columns (ordered 0-2):</p>
<ol class="arabic simple" start="0">
<li><strong>TPL</strong> (<tt class="docutils literal">&lt;tpli_name&gt;</tt>): The name of the TriBITS TPL <tt class="docutils literal">&lt;tplName&gt;</tt>.
This name must be unique across all other TriBITS TPLs in this or any
other TriBITS repo that might be combined into a single TriBITS project
meta-build (see <a class="reference internal" href="#globally-unique-tribits-tpl-names">Globally unique TriBITS TPL names</a>).  However, a TPL
can be redefined from an upstream repo (see below).  The name should be a
valid identifier (e.g. matches the regex <tt class="docutils literal"><span class="pre">[a-zA-Z_][a-zA-Z0-9_]*</span></tt>).
TPL names typically use mixed case (e.g. <tt class="docutils literal">SomeTpl</tt> and not
<tt class="docutils literal">SOMETPL</tt>).</li>
<li><strong>FINDMOD</strong> (<tt class="docutils literal">&lt;tpli_findmod&gt;</tt>): The relative path for the find module,
usually with the name <tt class="docutils literal"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></tt>.  This path is relative
to the repository base directory.  If just the base path for the find
module is given, ending with <tt class="docutils literal">&quot;/&quot;</tt> (e.g. <tt class="docutils literal">&quot;cmake/tpls/&quot;</tt>), then the
find module will be assumed to be under that this directory with the
standard name (e.g. <tt class="docutils literal"><span class="pre">cmake/tpls/FindTPL&lt;tplName&gt;.cmake</span></tt>).  A standard
way to write a <tt class="docutils literal"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></tt> module is to use the function
<a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">TRIBITS_TPL_FIND_INCLUDE_DIRS_AND_LIBRARIES()</a>.</li>
<li><strong>CLASSIFICATION</strong> (<tt class="docutils literal">&lt;pkgi_classif&gt;</tt>): Gives the <a class="reference internal" href="#se-package-test-group">SE Package Test
Group</a> <a class="reference internal" href="#pt">PT</a>, <a class="reference internal" href="#st">ST</a>, or <a class="reference internal" href="#ex">EX</a> and the maturity level <tt class="docutils literal">EP</tt>, <tt class="docutils literal">RS</tt>,
<tt class="docutils literal">PG</tt>, <tt class="docutils literal">PM</tt>, <tt class="docutils literal">GRS</tt>, <tt class="docutils literal">GPG</tt>, <tt class="docutils literal">GPM</tt>, <tt class="docutils literal">UM</tt>.  These are separated
by a coma with no space in between such as <tt class="docutils literal">&quot;RS,PT&quot;</tt> for a &quot;Research
Stable&quot;, &quot;Primary Tested&quot; package.  No spaces are allowed so that CMake
treats this a one field in the array.  The maturity level can be left off
in which case it is assumed to be <tt class="docutils literal">UM</tt> for &quot;Unspecified Maturity&quot;.</li>
</ol>
<p>A TPL defined in a upstream repo can listed again in a downstream repo,
which allows redefining the find module that is used to specify the TPL.
This allows downstream repos to add additional requirements for a given TPL
(i.e. add more libraries, headers, etc.).  However, the downstream repo's
find module file must find the TPL components that are fully compatible with
the upstream's find module.</p>
<p>This macro just sets the variable:</p>
<pre class="literal-block">
${REPOSITORY_NAME}_TPLS_FINDMODS_CLASSIFICATIONS
</pre>
<p>in the current scope.  The advantages of using this macro instead of
directly setting this variable are that the macro:</p>
<ul class="simple">
<li>Asserts that the variable <tt class="docutils literal">REPOSITORY_NAME</tt> is defined and set</li>
<li>Avoids having to hard-code the assumed repository name
<tt class="docutils literal">${REPOSITORY_NAME}</tt>.  This provides more flexibility for how other
TriBITS projects choose to name a given TriBITS repo (i.e. the name of
repo subdirs).</li>
<li>Avoids misspelling the name of the variable
<tt class="docutils literal">${REPOSITORY_NAME}_TPLS_FINDMODS_CLASSIFICATIONS</tt>.  If one misspells
the name of a macro, it is an immediate error in CMake.</li>
</ul>
</div>
<div class="section" id="tribits-set-st-for-dev-mode">
<h3><a class="toc-backref" href="#id134">TRIBITS_SET_ST_FOR_DEV_MODE()</a></h3>
<p>Function that allows packages to easily make a feature <tt class="docutils literal">ST</tt> for
development builds and <tt class="docutils literal">PT</tt> for release builds by default.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_SET_ST_FOR_DEV_MODE(&lt;outputVar&gt;)
</pre>
<p>This function is typically called in a package's top-level
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file before defining other options for the
package.  The output variable <tt class="docutils literal"><span class="pre">${&lt;outputVar&gt;}</span></tt> is set to <tt class="docutils literal">ON</tt> or <tt class="docutils literal">OFF</tt>
based on the configure state.  In development mode
(i.e. <tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE==ON</span></tt>), <tt class="docutils literal"><span class="pre">${&lt;outputVar&gt;}</span></tt>
will be set to <tt class="docutils literal">ON</tt> only if <tt class="docutils literal">ST</tt> code is enabled
(i.e. <tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_SECONDARY_TESTED_CODE==ON</span></tt>), otherwise it is
set to <tt class="docutils literal">OFF</tt>. In release mode
(i.e. <tt class="docutils literal"><span class="pre">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE==OFF</span></tt>), <tt class="docutils literal"><span class="pre">${&lt;outputVar&gt;}</span></tt>
is always set to <tt class="docutils literal">ON</tt>.  This allows some parts of a TriBITS package to be
considered <tt class="docutils literal">ST</tt> for development mode (thereby reducing testing time by not
enabling the dependent features/tests), while still having important
functionality available to users by default in a release of the package.</p>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id135">TRIBITS_SUBPACKAGE()</a></h3>
<p>Forward declare a <a class="reference internal" href="#tribits-subpackage">TriBITS Subpackage</a> called at the top of the
subpackage's <a class="reference internal" href="#packagedir-spkgdir-cmakelists-txt">&lt;packageDir&gt;/&lt;spkgDir&gt;/CMakeLists.txt</a> file.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_SUBPACKAGE(&lt;spkgName&gt;)
</pre>
<p>Once called, the following local variables are in scope:</p>
<blockquote>
<p><tt class="docutils literal">PARENT_PACKAGE_NAME</tt></p>
<blockquote>
The name of the parent package.</blockquote>
<p><tt class="docutils literal">SUBPACKAGE_NAME</tt></p>
<blockquote>
The local name of the subpackage (does not contain
the parent package name).</blockquote>
<p><tt class="docutils literal">SUBPACKAGE_FULLNAME</tt></p>
<blockquote>
The full project-level name of the subpackage (which includes the parent
package name at the beginning,
<tt class="docutils literal"><span class="pre">${PARENT_PACKAGE_NAME}${SUBPACKAGE_NAME}</span></tt>).</blockquote>
<p><tt class="docutils literal">PACKAGE_NAME</tt></p>
<blockquote>
Inside the subpackage, the same as <tt class="docutils literal">SUBPACKAGE_FULLNAME</tt>.</blockquote>
</blockquote>
</div>
<div class="section" id="tribits-subpackage-postprocess">
<h3><a class="toc-backref" href="#id136">TRIBITS_SUBPACKAGE_POSTPROCESS()</a></h3>
<p>Macro that performs standard post-processing after defining a <a class="reference internal" href="#tribits-subpackage">TriBITS
Subpackage</a> which is called at the bottom of a subpackage's
<a class="reference internal" href="#packagedir-spkgdir-cmakelists-txt">&lt;packageDir&gt;/&lt;spkgDir&gt;/CMakeLists.txt</a> file.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_SUBPACKAGE_POSTPROCESS()
</pre>
<p>NOTE: It is unfortunate that a Subpackages's CMakeLists.txt file must call
this macro but limitations of the CMake language make it necessary to do so.</p>
</div>
<div class="section" id="tribits-tpl-find-include-dirs-and-libraries">
<h3><a class="toc-backref" href="#id137">TRIBITS_TPL_FIND_INCLUDE_DIRS_AND_LIBRARIES()</a></h3>
<p>Function that sets up cache variables for users to specify where to find a
<a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>'s headers and libraries.  This function is typically called
inside of a <tt class="docutils literal"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></tt> moulde file (see
<a class="reference internal" href="#tpl-name-findmod">${TPL_NAME}_FINDMOD</a>).</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_TPL_FIND_INCLUDE_DIRS_AND_LIBRARIES(
  &lt;tplName&gt;
  [REQUIRED_HEADERS &lt;header1&gt; &lt;header2&gt; ...]
  [MUST_FIND_ALL_HEADERS]
  [REQUIRED_LIBS_NAMES &lt;libname1&gt; &lt;libname2&gt; ...]
  [MUST_FIND_ALL_LIBS]
  [NO_PRINT_ENABLE_SUCCESS_FAIL]
  )
</pre>
<p>This function can be called to specify/require header files and include
directories and/or a list of libraries.</p>
<p>The input arguments to this function are:</p>
<blockquote>
<p><tt class="docutils literal">&lt;tplName&gt;</tt></p>
<blockquote>
Name of the TPL that is listed in a <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file.</blockquote>
<p><tt class="docutils literal">REQUIRED_HEADERS</tt></p>
<blockquote>
List of header files that are searched in order to find the TPL's
include directories files using <tt class="docutils literal">FIND_PATH()</tt>.</blockquote>
<p><tt class="docutils literal">MUST_FIND_ALL_HEADERS</tt></p>
<blockquote>
If set, then all of the header files listed in <tt class="docutils literal">REQUIRED_HEADERS</tt> must
be found in order for <tt class="docutils literal">TPL_&lt;tplName&gt;_INCLUDE_DIRS</tt> to be defined.</blockquote>
<p><tt class="docutils literal">REQUIRED_LIBS_NAMES</tt></p>
<blockquote>
List of libraries that are searched for when looking for the TPL's
libraries using <tt class="docutils literal">FIND_LIBRARY()</tt>.  This list can be overridden by the
user by setting <tt class="docutils literal">&lt;tplName&gt;_LIBRARY_DIRS</tt> (see below).</blockquote>
<p><tt class="docutils literal">MUST_FIND_ALL_LIBS</tt></p>
<blockquote>
If set, then all of the library files listed in <tt class="docutils literal">REQUIRED_LIBS_NAMES</tt>
must be found or the TPL is considered not found!</blockquote>
<p><tt class="docutils literal">NO_PRINT_ENABLE_SUCCESS_FAIL</tt></p>
<blockquote>
If set, then the final success/fail will not be printed</blockquote>
</blockquote>
<p>This function implements the TPL find behavior described in <a class="reference external" href="../build_quick_ref/TribitsBuildQuickRef.html#enabling-support-for-an-optional-third-party-library-tpl">Enabling
support for an optional Third-Party Library (TPL)</a>.</p>
<p>The following (cache) variables, if set, will be used by that this function:</p>
<blockquote>
<p><tt class="docutils literal">&lt;tplName&gt;_INCLUDE_DIRS</tt> (type <tt class="docutils literal">PATH</tt>)</p>
<blockquote>
List of paths to search first for header files defined in
<tt class="docutils literal">REQUIRED_HEADERS</tt>.</blockquote>
<p><tt class="docutils literal">&lt;tplName&gt;_LIBRARY_DIRS</tt> (type <tt class="docutils literal">PATH</tt>)</p>
<blockquote>
The list of directories to search first for libraries defined in
<tt class="docutils literal">REQUIRED_LIBS_NAMES</tt>.  If, for some reason, no libraries should be
linked in for this particular configuration, then setting
<tt class="docutils literal">&lt;tplName&gt;_LIBRARY_DIRS=OFF</tt> will</blockquote>
<p><tt class="docutils literal">&lt;tplName&gt;_LIBRARY_NAMES</tt> (type <tt class="docutils literal">STRING</tt>)</p>
<blockquote>
List of library names to be looked for instead of what is specified in
<tt class="docutils literal">REQUIRED_LIBS_NAMES</tt>.</blockquote>
</blockquote>
<p>This function sets global variables to return state so it can be called from
anywhere in the call stack.  The following cache variables are defined that
are intended for the user to set and/or use:</p>
<blockquote>
<p><tt class="docutils literal">TPL_&lt;tplName&gt;_INCLUDE_DIRS</tt> (type <tt class="docutils literal">PATH</tt>)</p>
<blockquote>
A list of common-separated full directory paths that contain the TPL's
header files.  If this variable is set before calling this function,
then no headers are searched for and this variable will be assumed to
have the correct list of header paths.</blockquote>
<p><tt class="docutils literal">TPL_&lt;tplName&gt;_LIBRARIES</tt> (type <tt class="docutils literal">FILEPATH</tt>)</p>
<blockquote>
A list of commons-separated full library names (i.e. output from
<tt class="docutils literal">FIND_LIBRARY()</tt>) for all of the libraries found for the TPL.  If this
variable is set before calling this function, then no libraries are
searched for and this variable will be assumed to have the correct list
of libraries to link to.</blockquote>
<p><tt class="docutils literal">TPL_&lt;tplName&gt;_NOT_FOUND</tt> (type <tt class="docutils literal">BOOL</tt>)</p>
<blockquote>
Will be set to <tt class="docutils literal">ON</tt> if all of the parts of the TPL could not be found.</blockquote>
</blockquote>
<p>ToDo: Document the behavior of this function for finding headers and
libraries and when a find is successful and when it is not.</p>
<p>Note, if <tt class="docutils literal"><span class="pre">TPL_TENTATIVE_ENABLE_&lt;tplName&gt;=ON</span></tt>, then if all of the parts of
the TPL can't be found, then <tt class="docutils literal">TPL_ENABLE_&lt;tplName&gt;</tt> will be (forced) set
to <tt class="docutils literal">OFF</tt> in the cache.  See <a class="reference internal" href="#tribits-tpl-tentatively-enable">TRIBITS_TPL_TENTATIVELY_ENABLE()</a>.</p>
</div>
<div class="section" id="tribits-tpl-tentatively-enable">
<h3><a class="toc-backref" href="#id138">TRIBITS_TPL_TENTATIVELY_ENABLE()</a></h3>
<p>Function that sets up for an optionally enabled TPL that is attempted to be
enabled but will be disabled if all of the parts are not found.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_TPL_TENTATIVELY_ENABLE(&lt;tplName&gt;)
</pre>
<p>This function can be called from any CMakeLists.txt file to put a TPL in
tentative enable mode.</p>
<p>This should only be used for optional TPLs.  It will not work correctly for
required TPLs because any enabled packages that require this TPL will not be
disabled and instead will fail to configure or fail to build.</p>
<p>All this function does is to force set <tt class="docutils literal"><span class="pre">TPL_ENABLE_&lt;tplName&gt;=ON</span></tt> if it has
not already been set. and <tt class="docutils literal">TPL_TENTATIVE_ENABLE_&lt;tplName&gt;</tt> in the cache.</p>
<p>NOTE: This function will only tentatively enable a TPL it its enable has not
be explicitly set on input, i.e. if <tt class="docutils literal"><span class="pre">TPL_ENABLE_&lt;tplName&gt;=&quot;&quot;</span></tt>.</p>
</div>
<div class="section" id="tribits-verbose-print-var">
<h3><a class="toc-backref" href="#id139">TRIBITS_VERBOSE_PRINT_VAR()</a></h3>
<p>print a variable giving its name then value if
<tt class="docutils literal">${PROJECT_NAME}_VERBOSE_CONFIGURE=TRUE</tt>.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_VERBOSE_PRINT_VAR(&lt;varName&gt;)
</pre>
<p>This prints:</p>
<pre class="literal-block">
MESSAGE(&quot;-- &quot; &quot;${VARIBLE_NAME}='${${VARIBLE_NAME}}'&quot;)
</pre>
<p>The variable <tt class="docutils literal">&lt;varName&gt;</tt> can be defined or undefined or empty.  This uses
an explicit &quot;-- &quot; line prefix so that it prints nice even on Windows CMake.</p>
</div>
<div class="section" id="tribits-write-flexible-package-client-export-files">
<h3><a class="toc-backref" href="#id140">TRIBITS_WRITE_FLEXIBLE_PACKAGE_CLIENT_EXPORT_FILES()</a></h3>
<p>Utility function for writing <tt class="docutils literal">${PACKAGE_NAME}Config.cmake</tt> and/or the
<tt class="docutils literal"><span class="pre">Makefile.export.${PACKAGE_NAME}</span></tt> files for package <tt class="docutils literal">${PACKAGE_NAME}</tt>
with some greater flexibility than what is provided by the function
<tt class="docutils literal">TRIBITS_WRITE_PACKAGE_CLIENT_EXPORT_FILES()</tt>.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_WRITE_FLEXIBLE_PACKAGE_CLIENT_EXPORT_FILES(
  PACKAGE_NAME &lt;pakageName&gt;
  [EXPORT_FILE_VAR_PREFIX &lt;exportFileVarPrefix&gt;]
  [WRITE_CMAKE_CONFIG_FILE &lt;cmakeConfigFileFullPath&gt;]
  [WRITE_EXPORT_MAKEFILE &lt;exportMakefileFileFullPath&gt;]
  [WRITE_INSTALL_CMAKE_CONFIG_FILE]
  [WRITE_INSTALL_EXPORT_MAKEFILE]
  )
</pre>
<p>The arguments are:</p>
<blockquote>
<p><tt class="docutils literal">PACKAGE_NAME &lt;pakageName&gt;</tt></p>
<blockquote>
Gives the name of the TriBITS package for which the export files should
be created.</blockquote>
<p><tt class="docutils literal">EXPORT_FILE_VAR_PREFIX &lt;exportFileVarPrefix&gt;</tt></p>
<blockquote>
If specified, then all of the variables in the generated export files
will be prefixed with <tt class="docutils literal">&lt;exportFileVarPrefix&gt;_</tt> instead of
<tt class="docutils literal">&lt;pakageName&gt;_</tt>.</blockquote>
<p><tt class="docutils literal">WRITE_CMAKE_CONFIG_FILE &lt;cmakeConfigFileFullPath&gt;</tt></p>
<blockquote>
If specified, then the package's (<tt class="docutils literal">&lt;packageName&gt;</tt>) cmake configure
export file for use by external CMake client projects will be created as
the file <tt class="docutils literal">&lt;cmakeConfigFileFullPath&gt;</tt>.  NOTE: the argument should be
the full path!</blockquote>
<p><tt class="docutils literal">WRITE_EXPORT_MAKEFILE &lt;exportMakefileFileFullPath&gt;</tt></p>
<blockquote>
If specified, then the package's (<tt class="docutils literal">&lt;packageName&gt;</tt>) export makefile for
use by external Makefile client projects will be created in the file
&lt;exportMakefileFileFullPath&gt;.  NOTE: the argument should be the full
path!</blockquote>
<p><tt class="docutils literal">WRITE_INSTALL_CMAKE_CONFIG_FILE</tt></p>
<blockquote>
If specified, then the package's (<tt class="docutils literal">&lt;packageName&gt;</tt>) install cmake
configured export file will be installed in to the install tree as well.
The name and location of this file is hard-coded.</blockquote>
<p><tt class="docutils literal">WRITE_INSTALL_EXPORT_MAKEFILE</tt></p>
<blockquote>
If specified, then the package's (<tt class="docutils literal">&lt;packageName&gt;</tt>) install export
makefile to be installed into the install tree as well.  The name and
location of this file is hard-coded.</blockquote>
</blockquote>
<p>NOTE: The arguments to this function may look strange but the motivation is
to support very specialized use cases such as when a TriBITS package needs
to generate an export makefile for a given package but the name of the
export makefile must be different and use different variable name prefixes.
The particular use case is when wrapping an external autotools project that
depends on Trilinos and needs to read in the <tt class="docutils literal">Makefile.export.Trilinos</tt>
file but this file needs to be generated for a subset of enabled packages on
the fly during a one-pass configure.</p>
<p>NOTE: This function does <em>not</em> contain the <tt class="docutils literal">INSTALL()</tt> commands because
CMake will not allow those to even be present in scripting mode that is used
for unit testing this function.  Instead, the files to be installed are only
generated in the build tree and the install targets are added else where.</p>
</div>
</div>
<div class="section" id="general-utility-macros-and-functions">
<h2><a class="toc-backref" href="#id141">12.3&nbsp;&nbsp;&nbsp;General Utility Macros and Functions</a></h2>
<p>The following subsections give detailed documentation for some CMake macros
and functions which are <em>not</em> a core part of the TriBITS system but are
included in the TriBITS source tree, are used inside of the TriBITS system,
and are provided as a convenience to TriBITS project developers.  One will see
many of these functions and macros used throughout the implementation of
TriBITS and even in the <tt class="docutils literal">CMakeLists.txt</tt> files for different projects that
use TriBITS.</p>
<p>These macros and functions are <em>not</em> prefixed with <tt class="docutils literal">TRIBITS_</tt>.  However,
there is really not a large risk to defining and using these non-namespaces
utility functions and macros.  It turns out that CMake allows one to redefine
any macro or function, even built-in ones, inside of one's project.
Therefore, even if CMake did add new commands that clashed with these names,
there would be no conflict.  When overriding a built-in command,
e.g. <tt class="docutils literal">some_builtin_command()</tt>, one can always access the original built-in
command as <tt class="docutils literal">_some_builtin_command()</tt>.</p>
<!-- WARNING: The file UtilsMacroFunctionDoc.rst is autogenerated from -->
<!-- the file UtilsMacroFunctionDocTemplate.rst in the script -->
<!-- generate-dev-guide.sh.  Only the file UtilsMacroFunctionDoc.rst -->
<!-- should be directly modified! -->
<div class="section" id="add-subdirectories">
<h3><a class="toc-backref" href="#id142">ADD_SUBDIRECTORIES()</a></h3>
<p>Macro that adds a list of subdirectories all at once (removes boiler-place
code).</p>
<p>Usage:</p>
<pre class="literal-block">
ADD_SUBDIRECTORIES(&lt;dir1&gt; &lt;dir2&gt; ...)
</pre>
<p>instead of:</p>
<pre class="literal-block">
ADD_SUBDIRECTORY(&lt;dir1&gt;)
ADD_SUBDIRECTORY(&lt;dir2&gt;)
...
</pre>
</div>
<div class="section" id="advanced-option">
<h3><a class="toc-backref" href="#id143">ADVANCED_OPTION()</a></h3>
<p>Macro that sets an option and marks it as advanced (removes boiler-plate and
duplication).</p>
<p>Usage:</p>
<pre class="literal-block">
ADVANCED_OPTION(&lt;varName&gt; [other arguments])
</pre>
<p>This just calls the built-in CMake commands:</p>
<pre class="literal-block">
OPTION(&lt;varName&gt; [other arguments])
MARK_AS_ADVANCED(&lt;varName&gt;)
</pre>
</div>
<div class="section" id="advanced-set">
<h3><a class="toc-backref" href="#id144">ADVANCED_SET()</a></h3>
<p>Macro that sets a variable and marks it as advanced (removes boiler-plate
and duplication).</p>
<p>Usage:</p>
<pre class="literal-block">
ADVANCED_SET(&lt;varName&gt; [other arguments])
</pre>
<p>This just calls the built-in commands:</p>
<pre class="literal-block">
SET(&lt;varName&gt; [other arguments])
MARK_AS_ADVANCED(&lt;varName&gt;)
</pre>
</div>
<div class="section" id="append-cmndline-args">
<h3><a class="toc-backref" href="#id145">APPEND_CMNDLINE_ARGS()</a></h3>
<p>Utility function that appends command-line arguments to a variable of
command-line arguments.</p>
<p>Usage:</p>
<pre class="literal-block">
APPEND_CMNDLINE_ARGS(&lt;var&gt; &quot;&lt;extraArgs&gt;&quot;)
</pre>
<p>This function just appends the command-line arguments in the string
<tt class="docutils literal">&quot;&lt;extraArgs&gt;&quot;</tt> but does not add an extra space if <tt class="docutils literal">&lt;var&gt;</tt> is empty on
input.  This just makes the formatting of command-line arguments easier.</p>
</div>
<div class="section" id="append-glob">
<h3><a class="toc-backref" href="#id146">APPEND_GLOB()</a></h3>
<p>Utility macro that does a <tt class="docutils literal">FILE(GLOB <span class="pre">...)</span></tt> and appends to an existing list
(removes boiler-plate code).</p>
<p>Usage:</p>
<pre class="literal-block">
APPEND_GLOB(&lt;fileListVar&gt; &lt;glob0&gt; &lt;glob1&gt; ...)
</pre>
<p>On output, <tt class="docutils literal">&lt;fileListVar&gt;</tt> will have the list of glob files appended.</p>
</div>
<div class="section" id="append-global-set">
<h3><a class="toc-backref" href="#id147">APPEND_GLOBAL_SET()</a></h3>
<p>Utility macro that appends arguments to a global variable (reduces
boiler-plate code and mistakes).</p>
<p>Usage:</p>
<pre class="literal-block">
APPEND_GLOBAL_SET(&lt;varName&gt; &lt;arg0&gt; &lt;arg1&gt; ...)
</pre>
<p>NOTE: The variable <tt class="docutils literal">&lt;varName&gt;</tt> must exist before calling this function.
To set it empty initially use <a class="reference internal" href="#global-null-set">GLOBAL_NULL_SET()</a>.</p>
</div>
<div class="section" id="append-set">
<h3><a class="toc-backref" href="#id148">APPEND_SET()</a></h3>
<p>Utility function to append elements to a variable (reduces boiler-plate
code).</p>
<p>Usage:</p>
<pre class="literal-block">
APPEND_SET(&lt;varName&gt; &lt;arg0&gt; &lt;arg1&gt; ...)
</pre>
<p>This just calls:</p>
<pre class="literal-block">
LIST(APPEND &lt;varName&gt; &lt;arg0&gt; &lt;arg1&gt; ...)
</pre>
<p>There is better error reporting if one misspells <tt class="docutils literal">APPEND_SET</tt> than if one
misspells <tt class="docutils literal">APPEND</tt>.</p>
</div>
<div class="section" id="append-string-var">
<h3><a class="toc-backref" href="#id149">APPEND_STRING_VAR()</a></h3>
<p>Append strings to an existing string variable (reduces boiler-place code and
reduces mistakes).</p>
<p>Usage:</p>
<pre class="literal-block">
APPEND_STRING_VAR(&lt;stringVar&gt; &quot;&lt;string1&gt;&quot; &quot;&lt;string2&gt;&quot; ...)
</pre>
<p>Note that the usage of the characters <tt class="docutils literal">'['</tt>, <tt class="docutils literal">']'</tt>, <tt class="docutils literal">'{'</tt>, <tt class="docutils literal">'}'</tt> are
taken by CMake to bypass the meaning of ';' to separate string characters.
If one wants to ignore the meaning of these special characters and are okay
with just adding one string at a time, then use <a class="reference internal" href="#append-string-var-ext">APPEND_STRING_VAR_EXT()</a>.</p>
</div>
<div class="section" id="append-string-var-ext">
<h3><a class="toc-backref" href="#id150">APPEND_STRING_VAR_EXT()</a></h3>
<p>Append a single string to an existing string variable, ignoring ';' (reduces
boiler-place code and reduces mistakes).</p>
<p>Usage:</p>
<pre class="literal-block">
APPEND_STRING_VAR_EXT(&lt;stringVar&gt; &quot;&lt;string&gt;&quot;)
</pre>
<p>Simply sets <tt class="docutils literal">&lt;stringVar&gt; = <span class="pre">&quot;${&lt;stringVar&gt;}&lt;string&gt;&quot;</span></tt> and leaves in <tt class="docutils literal">';'</tt>
without creating new array elements.</p>
</div>
<div class="section" id="append-string-var-with-sep">
<h3><a class="toc-backref" href="#id151">APPEND_STRING_VAR_WITH_SEP()</a></h3>
<p>Append strings to a given string variable, joining them using a separator
string.</p>
<p>Usage:</p>
<pre class="literal-block">
APPEND_STRING_VAR_WITH_SEP(&lt;stringVar&gt; &quot;&lt;sepStr&gt;&quot; &quot;&lt;str0&gt;&quot; &quot;&lt;str1&gt;&quot; ...)
</pre>
<p>Each of the strings <tt class="docutils literal">&lt;stri&gt;</tt> are appended to <tt class="docutils literal">&lt;stringVar&gt;</tt> using the
separation string <tt class="docutils literal">&lt;sepStr&gt;</tt>.</p>
</div>
<div class="section" id="assert-defined">
<h3><a class="toc-backref" href="#id152">ASSERT_DEFINED()</a></h3>
<p>Assert that a variable is defined and if not call <tt class="docutils literal">MESSAGE(SEND_ERROR
<span class="pre">...)</span></tt>.</p>
<p>Usage:</p>
<pre class="literal-block">
ASSERT_DEFINED(&lt;varName&gt;)
</pre>
<p>This is used to get around the problem of CMake not asserting the
dereferencing of undefined variables.  For example, how does one know if one
did not misspell the name of a variable in an if statement like:</p>
<pre class="literal-block">
IF (SOME_VARBLE)
  ...
ENDIF()
</pre>
<p>?</p>
<blockquote>
<p>If one misspelled the variable <tt class="docutils literal">SOME_VARBLE</tt> (which is likely in this
case), then the if statement will always be false!  To avoid this problem
when one always expects that a variable is explicitly set, instead do:</p>
<pre class="literal-block">
ASSERT_DEFINED(SOME_VARBLE)
IF (SOME_VARBLE)
  ...
ENDIF()
</pre>
</blockquote>
<p>Now if one misspells this variable, then CMake will asset and stop
processing.  This is not a perfect solution since one can misspell the
variable name in the following if statement but typically one would always
just copy and paste between the two statements so these names are always the
same.  This is the best that can be done in CMake unfortunately to catch
usage of misspelled undefined variables.</p>
</div>
<div class="section" id="combined-option">
<h3><a class="toc-backref" href="#id153">COMBINED_OPTION()</a></h3>
<p>Set up a <tt class="docutils literal">BOOL</tt> cache variable (i.e. an option) based on a set of
dependent options.</p>
<p>Usage:</p>
<pre class="literal-block">
COMBINED_OPTION( &lt;combinedOptionName&gt;
  DEP_OPTIONS_NAMES &lt;depOpName0&gt; &lt;depOptName1&gt; ...
  DOCSTR &quot;&lt;docstr0&gt;&quot; &quot;&lt;docstr1&quot; ...
  )
</pre>
<p>This sets up a <tt class="docutils literal">BOOL</tt> cache variable <tt class="docutils literal">&lt;combinedOptionName&gt;</tt> which is
defaulted to <tt class="docutils literal">ON</tt> if all of the listed dependent option variables
<tt class="docutils literal">&lt;depOpName0&gt;</tt>, <tt class="docutils literal">&lt;depOptName1&gt;</tt>, ... are all <tt class="docutils literal">ON</tt>.  However, if
<tt class="docutils literal">&lt;combinedOptionName&gt;</tt> is set to <tt class="docutils literal">ON</tt> by the user and not all of the
dependent option variables are also <tt class="docutils literal">ON</tt>, then this results in a fatal
error and all processing stops.</p>
<p>This is used by a CMake project to automatically turn on a feature that
requires a set of other features (when they are all enabled) but allows a
user to disable the feature if desired.</p>
</div>
<div class="section" id="concat-strings">
<h3><a class="toc-backref" href="#id154">CONCAT_STRINGS()</a></h3>
<p>Concatenate a set of string arguments.</p>
<p>Usage:</p>
<pre class="literal-block">
CONCAT_STRINGS(&lt;outputVar&gt; &quot;&lt;str0&gt;&quot; &quot;&lt;str1&gt;&quot; ...)
</pre>
<p>On output, <tt class="docutils literal">&lt;outputVar&gt;</tt> is set to <tt class="docutils literal"><span class="pre">&quot;&lt;str0&gt;&lt;str1&gt;...&quot;</span></tt>.  This makes it
easier to format a long string over multiple CMake source code lines.</p>
</div>
<div class="section" id="dual-scope-append-cmndline-args">
<h3><a class="toc-backref" href="#id155">DUAL_SCOPE_APPEND_CMNDLINE_ARGS()</a></h3>
<p>Utility function that appends command-line arguments to a variable of
command-line options and sets the result in current scope and parent scope.</p>
<p>Usage:</p>
<pre class="literal-block">
DUAL_SCOPE_APPEND_CMNDLINE_ARGS(&lt;var&gt; &quot;&lt;extraArgs&gt;&quot;)
</pre>
<p>Just calls <a class="reference internal" href="#append-cmndline-args">APPEND_CMNDLINE_ARGS()</a> and then <tt class="docutils literal"><span class="pre">SET(&lt;var&gt;</span> <span class="pre">${&lt;var&gt;}</span> PARENT_SCOPE)</tt>.</p>
</div>
<div class="section" id="dual-scope-prepend-cmndline-args">
<h3><a class="toc-backref" href="#id156">DUAL_SCOPE_PREPEND_CMNDLINE_ARGS()</a></h3>
<p>Utility function that prepends command-line arguments to a variable of
command-line arguments and sets the result in current scope and parent
scope.</p>
<p>Usage:</p>
<pre class="literal-block">
DUAL_SCOPE_PREPEND_CMNDLINE_ARGS(&lt;var&gt; &quot;&lt;extraArgs&gt;&quot;)
</pre>
<p>Just calls <a class="reference internal" href="#prepend-cmndline-args">PREPEND_CMNDLINE_ARGS()</a> and then <tt class="docutils literal"><span class="pre">SET(&lt;var&gt;</span> <span class="pre">${&lt;var&gt;}</span> PARENT_SCOPE)</tt>.</p>
</div>
<div class="section" id="dual-scope-set">
<h3><a class="toc-backref" href="#id157">DUAL_SCOPE_SET()</a></h3>
<p>Macro that sets a variable name both in the current scope and the
parent scope.</p>
<p>Usage:</p>
<pre class="literal-block">
DUAL_SCOPE_SET(&lt;varName&gt; [other args])
</pre>
<p>It turns out that when one calls <tt class="docutils literal"><span class="pre">ADD_SUBDIRECTORY(&lt;someDir&gt;)</span></tt> or enters a
<tt class="docutils literal">FUNCTION</tt> that CMake actually creates a copy of all of the regular
non-cache variables in the current scope in order to create a new set of
variables for the <tt class="docutils literal">CMakeLists.txt</tt> file in <tt class="docutils literal">&lt;someDir&gt;</tt>.  This means that
if you call <tt class="docutils literal">SET(SOMEVAR Blah PARENT_SCOPE)</tt> that it will not affect the
value of <tt class="docutils literal">SOMEVAR</tt> in the current scope!  This macro therefore is designed
to set the value of the variable in the current scope and the parent scope
in one shot to avoid confusion.</p>
<p>Global variables are different.  When one moves to a subordinate
<tt class="docutils literal">CMakeLists.txt</tt> file or enters a <tt class="docutils literal">FUNCTION</tt>, then a local copy of the
variable is <em>not</em> created.  If one sets the variable locally, it will shadow
the global variable.  However, if one sets the global cache value with
<tt class="docutils literal">SET(SOMEVAR someValue CACHE INTERNAL &quot;&quot;)</tt>, then the value will get
changed in the current subordinate scope and in all parent scopes all in one
shot!</p>
</div>
<div class="section" id="global-null-set">
<h3><a class="toc-backref" href="#id158">GLOBAL_NULL_SET()</a></h3>
<p>Set a variable as a null internal global (cache) variable (removes
boiler-plate code).</p>
<p>Usage:</p>
<pre class="literal-block">
GLOBAL_NULL_SET(&lt;varName&gt;)
</pre>
<p>This just calls:</p>
<pre class="literal-block">
SET(&lt;varName&gt; &quot;&quot; CACHE INTERNAL &quot;&quot;)
</pre>
<p>This avoid problems with misspelling <tt class="docutils literal">CACHE</tt>.</p>
</div>
<div class="section" id="global-set">
<h3><a class="toc-backref" href="#id159">GLOBAL_SET()</a></h3>
<p>Set a variable as an internal global (cache) variable (removes boiler-plate
code).</p>
<p>Usage:</p>
<pre class="literal-block">
GLOBAL_SET(&lt;varName&gt; [other args])
</pre>
<p>This just calls:</p>
<pre class="literal-block">
SET(&lt;varName&gt; [other args] CACHE INTERNAL &quot;&quot;)
</pre>
<p>This avoid misspelling <tt class="docutils literal">CACHE</tt>.</p>
</div>
<div class="section" id="join">
<h3><a class="toc-backref" href="#id160">JOIN()</a></h3>
<p>Join a set of strings into a single string using a join string.</p>
<p>Usage:</p>
<pre class="literal-block">
JOIN(&lt;outputStrVar&gt; &quot;&lt;sepStr&gt;&quot; &lt;quoteElements&gt;
  &quot;&lt;string0&gt;&quot; &quot;&lt;string1&gt;&quot; ...)
</pre>
<p>Arguments:</p>
<blockquote>
<p><tt class="docutils literal">&lt;outputStrVar&gt;</tt></p>
<blockquote>
The name of a variable that will hold the output string.</blockquote>
<p><tt class="docutils literal">&quot;&lt;sepStr&gt;&quot;</tt></p>
<blockquote>
A string to use to join the list of strings.</blockquote>
<p><tt class="docutils literal">&lt;quoteElements&gt;</tt></p>
<blockquote>
<dl class="docutils">
<dt>If <tt class="docutils literal">TRUE</tt>, then each <tt class="docutils literal">&lt;stringi&gt;</tt> is quoted using an escaped quote</dt>
<dd>char <tt class="docutils literal">\&quot;</tt>.  If <tt class="docutils literal">FALSE</tt> then no escaped quote is used.</dd>
</dl>
</blockquote>
<p><tt class="docutils literal">&quot;&lt;string0&gt;&quot; &quot;&lt;string1&gt;&quot; ...</tt></p>
<blockquote>
Zero or more string arguments to be joined.</blockquote>
</blockquote>
<p>On output, the variable <tt class="docutils literal">&lt;outputStrVar&gt;</tt> is set to:</p>
<pre class="literal-block">
&quot;&lt;string0&gt;&lt;sepStr&gt;&lt;string1&gt;&lt;sepStr&gt;...&quot;
</pre>
<p>If <tt class="docutils literal"><span class="pre">&lt;quoteElements&gt;=TRUE</span></tt>, then <tt class="docutils literal">&lt;outputStrVar&gt;</tt> is set to:</p>
<pre class="literal-block">
&quot;\&quot;&lt;string0&gt;\&quot;&lt;sepStr&gt;\&quot;&lt;string1&gt;\&quot;&lt;sepStr&gt;...&quot;
</pre>
<p>For example, the latter can be used to set up a set of command-line
arguments given a CMake array like:</p>
<pre class="literal-block">
JOIN(CMND_LINE_ARGS &quot; &quot; TRUE ${CMND_LINE_ARRAY})
</pre>
<p>WARNING: Be careful to quote string arguments that have spaces because CMake
interprets those as array boundaries.</p>
</div>
<div class="section" id="message-wrapper">
<h3><a class="toc-backref" href="#id161">MESSAGE_WRAPPER()</a></h3>
<p>Function that wraps the standard CMake/CTest <tt class="docutils literal">MESSAGE()</tt> function call in
order to allow unit testing to intercept the output.</p>
<p>Usage:</p>
<pre class="literal-block">
MESSAGE_WRAPPER(...)
</pre>
<p>This function takes exactly the same arguments as built-in <tt class="docutils literal">MESSAGE()</tt>
function.  However, when the variable <tt class="docutils literal">MESSAGE_WRAPPER_UNIT_TEST_MODE</tt> is
set to <tt class="docutils literal">TRUE</tt>, then this function will not call <tt class="docutils literal"><span class="pre">MESSAGE(...)</span></tt> but
instead will prepend set to the global variable <tt class="docutils literal">MESSAGE_WRAPPER_INPUT</tt>
the input argument that would have gon to <tt class="docutils literal">MESSAGE()</tt>.  To capture just
this call's input, first call:</p>
<pre class="literal-block">
GLOBAL_NULL_SET(MESSAGE_WRAPPER_INPUT)
</pre>
<p>before calling this function (or the functions/macros that call this
function).</p>
<p>This function allows one to unit test other user-defined CMake macros and
functions that call this function to catch error conditions without stopping
the CMake program.  Otherwise, this is used to capture print messages to
verify that they say the right thing.</p>
</div>
<div class="section" id="multiline-set">
<h3><a class="toc-backref" href="#id162">MULTILINE_SET()</a></h3>
<p>Function to set a single string by concatenating a list of separate strings</p>
<p>Usage:</p>
<pre class="literal-block">
MULTILINE_SET(&lt;outputStrVar&gt;
  &quot;&lt;string0&gt;&quot;
  &quot;&lt;string1&gt;&quot;
  ...
  )
</pre>
<p>On output, the local variables <tt class="docutils literal">&lt;outputStrVar&gt;</tt> is set to:</p>
<pre class="literal-block">
&quot;&lt;string0&gt;&lt;string1&gt;...&quot;
</pre>
<p>The purpose of this is function to make it easier to set longer strings over
multiple lines.</p>
<p>This function is exactly the same as <a class="reference internal" href="#concat-strings">CONCAT_STRINGS()</a> and should not even
exist :-(</p>
</div>
<div class="section" id="parse-arguments">
<h3><a class="toc-backref" href="#id163">PARSE_ARGUMENTS()</a></h3>
<p>Parse a set of macro/function input arguments into different lists.  This
allows the easy implementation of keyword-based user-defined macros and
functions.</p>
<p>Usage:</p>
<pre class="literal-block">
PARSE_ARGUMENTS(
  &lt;prefix&gt;  &lt;argNamesList&gt;  &lt;optionNamesList&gt;
  &lt;inputArgsList&gt;
  )
</pre>
<p>Arguments to this macro are:</p>
<blockquote>
<p><tt class="docutils literal">&lt;prefix&gt;</tt></p>
<blockquote>
Prefix <tt class="docutils literal">&lt;prefix&gt;_</tt> added the list and option variables created listed
in <tt class="docutils literal">&lt;argNamesList&gt;</tt> and <tt class="docutils literal">&lt;optionNamesList&gt;</tt>.</blockquote>
<p><tt class="docutils literal">&lt;argNamesList&gt;</tt></p>
<blockquote>
Quoted array of list arguments (e.g. <tt class="docutils literal"><span class="pre">&quot;&lt;argName0&gt;;&lt;argName1&gt;;...&quot;</span></tt>).
For each variable name <tt class="docutils literal">&lt;argNamei&gt;</tt>, a local variable will be created
in the current scope with the name <tt class="docutils literal">&lt;prefix&gt;_&lt;argNamei&gt;</tt> which gives
the list of variables parsed out of <tt class="docutils literal">&lt;inputArgsList&gt;</tt>.</blockquote>
<p><tt class="docutils literal">&lt;optionNamesList&gt;</tt></p>
<blockquote>
Quoted array of list options (e.g. <tt class="docutils literal"><span class="pre">&quot;&lt;optName0&gt;;&lt;optName1&gt;;...&quot;</span></tt>)
typically pass in as <tt class="docutils literal">${ARGN}</tt> in the outer function/macro.  For each
variable name <tt class="docutils literal">&lt;optNamei&gt;</tt>, a local variable will be created in the
current scope with the name <tt class="docutils literal">&lt;prefix&gt;_&lt;optNamei&gt;</tt> that is either set
to <tt class="docutils literal">TRUE</tt> or <tt class="docutils literal">FALSE</tt> depending if <tt class="docutils literal">&lt;optNamei&gt;</tt> appears in
<tt class="docutils literal">&lt;inputArgsList&gt;</tt> or not.</blockquote>
<p><tt class="docutils literal">&lt;inputArgsList&gt;</tt></p>
<blockquote>
List of arguments keyword-based arguments passed in through the outer
macro or function to be parsed out into the different argument and
option lists.</blockquote>
</blockquote>
<p>What this macro does is very simple yet very useful.  What it does is to
allow one to create one's own user-defined keyword-based macros and
functions like is used by some built-in CMake commands.</p>
<p>For example, consider the following user-defined macro that uses both
positional and keyword-based arguments using <tt class="docutils literal">PARSE_ARGUMENTS()</tt>:</p>
<pre class="literal-block">
MACRO(PARSE_SPECIAL_VARS  BASE_NAME)

  PARSE_ARGUMENTS(
    #prefix
    ${BASE_NAME}
    #lists
    &quot;ARG0;ARG1;ARG2&quot;
    #options
    &quot;OPT0;OPT1&quot;
    ${ARGN}
    )

ENDMACRO()
</pre>
<p>Calling this macro as:</p>
<pre class="literal-block">
PARSE_SPECIAL_VARS(MyVar ARG0 a b ARG2 c OPT1)
</pre>
<p>sets the following variables in the current scope:</p>
<pre class="literal-block">
MyVar_ARG0=&quot;a;b&quot;
MyVar_ARG1=&quot;&quot;
MyVar_ARG2=&quot;c&quot;
MyVar_OPT0=&quot;FALSE&quot;
MyVar_OPT1=&quot;TRUE&quot;
</pre>
<p>This allows one to define user-defined macros and functions that have a
mixture of positional arguments and keyword-based arguments like one can do
in other languages.  The keyword-based arguments can be passed in any order
and those that are missing are empty (or false for options) by default.</p>
<p>Any initial arguments that are not recognized as <tt class="docutils literal">&lt;argNamesList&gt;</tt> or
<tt class="docutils literal">&lt;optionNamesList&gt;</tt> keyword arguments will be put into the local variable
<tt class="docutils literal">&lt;prefix&gt;_DEFAULT_ARGS</tt>.  If no arguments in <tt class="docutils literal">&lt;inputArgsList&gt;</tt>
(typically <tt class="docutils literal">${ARGN}</tt>) match any in <tt class="docutils literal">&lt;argNamesList&gt;</tt>, then all non-option
arguments are put into <tt class="docutils literal">&lt;prefix&gt;_DEFAULT_ARGS</tt>.  For example, if one
passes in:</p>
<pre class="literal-block">
PARSE_SPECIAL_VARS(MyVar ARG5 a b c)
</pre>
<p>you will get:</p>
<pre class="literal-block">
MyVar_DEFAULT_ARGS=&quot;ARG5;a;b;c&quot;
MyVar_ARG0=&quot;&quot;
MyVar_ARG1=&quot;&quot;
MyVar_ARG2=&quot;&quot;
MyVar_OPT0=&quot;FALSE&quot;
MyVar_OPT1=&quot;FALSE&quot;
</pre>
<p>Multiple occurrences of keyword arguments in <tt class="docutils literal">&lt;inputArgsList&gt;</tt> is allowed
but only the last one listed will be recorded.  For example, if one calls:</p>
<pre class="literal-block">
PARSE_SPECIAL_VARS(MyVar ARG1 a b ARG1 c)
</pre>
<p>then this will set:</p>
<pre class="literal-block">
MyVar_ARG0=&quot;&quot;
MyVar_ARG1=&quot;c&quot;
MyVar_ARG2=&quot;&quot;
MyVar_OPT0=&quot;FALSE&quot;
MyVar_OPT1=&quot;FALSE&quot;
</pre>
<p>This is actually consistent with the way that most argument list parsers
behave with respect to multiple instances of the same argument so hopefully
this will not be a surprise to anyone.</p>
<p>If one puts an option keyword in the middle of a keyword argument list, the
option keyword will get pulled out of the list.  For example, if one calls:</p>
<pre class="literal-block">
PARSE_SPECIAL_VARS(MyVar ARG0 a OPT0 c)
</pre>
<p>then this will set:</p>
<pre class="literal-block">
MyVar_ARG0=&quot;a;c&quot;
MyVar_ARG1=&quot;&quot;
MyVar_ARG2=&quot;&quot;
MyVar_OPT0=&quot;TRUE&quot;
MyVar_OPT1=&quot;FALSE&quot;
</pre>
<p>This is confusing behavior so users would be smart not to mix option
arguments inside of list arguments.</p>
<p>If <tt class="docutils literal">PARSE_ARGUMENTS_DUMP_OUTPUT_ENABLED</tt> is set to <tt class="docutils literal">TRUE</tt>, then a bunch
of detailed debug info will be printed.  This should only be used in the
most desperate of debug situations because it will print a <em>lot</em> of output!</p>
<p><strong>PERFORMANCE:</strong> This function will scale as:</p>
<pre class="literal-block">
O( (len(&lt;argNamesList&gt;) * len(&lt;optionNamesList&gt;)) * len(&lt;inputArgsList&gt;) )
</pre>
<p>Therefore, this could scale very badly for large sets of argument and option
names and input argument list names.</p>
</div>
<div class="section" id="prepend-cmndline-args">
<h3><a class="toc-backref" href="#id164">PREPEND_CMNDLINE_ARGS()</a></h3>
<p>Utility function that prepends command-line arguments to a variable of
command-line arguments.</p>
<p>Usage:</p>
<pre class="literal-block">
PREPEND_CMNDLINE_ARGS(&lt;var&gt; &quot;&lt;extraArgs&gt;&quot;)
</pre>
<p>This function just prepends the command-line arguments in the string
<tt class="docutils literal">&quot;&lt;extraArgs&gt;&quot;</tt> but does not add an extra space if <tt class="docutils literal">&lt;var&gt;</tt> is empty on
input.</p>
</div>
<div class="section" id="prepend-global-set">
<h3><a class="toc-backref" href="#id165">PREPEND_GLOBAL_SET()</a></h3>
<p>Utility macro that prepends arguments to a global variable (reduces
boiler-plate code and mistakes).</p>
<p>Usage:</p>
<pre class="literal-block">
PREPEND_GLOBAL_SET(&lt;varName&gt; &lt;arg0&gt; &lt;arg1&gt; ...)
</pre>
<p>The variable <tt class="docutils literal">&lt;varName&gt;</tt> must exist before calling this function.  To set
it empty initially use <a class="reference internal" href="#global-null-set">GLOBAL_NULL_SET()</a>.</p>
</div>
<div class="section" id="print-nonempty-var">
<h3><a class="toc-backref" href="#id166">PRINT_NONEMPTY_VAR()</a></h3>
<p>Print a defined variable giving its name then value only if it is not empty.</p>
<p>Usage:</p>
<pre class="literal-block">
PRINT_NONEMPTY_VAR(&lt;varName&gt;)
</pre>
<p>Calls <tt class="docutils literal"><span class="pre">PRINT_VAR(&lt;varName&gt;)</span></tt> if <tt class="docutils literal"><span class="pre">${&lt;varName&gt;}</span></tt> is not empty.</p>
</div>
<div class="section" id="print-nonempty-var-with-spaces">
<h3><a class="toc-backref" href="#id167">PRINT_NONEMPTY_VAR_WITH_SPACES()</a></h3>
<p>Print a defined variable giving its name then value printed with spaces
instead of <tt class="docutils literal">';'</tt> but only if it is not empty.</p>
<p>Usage:</p>
<pre class="literal-block">
PRINT_NONEMPTY_VAR_WITH_SPACES(&lt;varName&gt;  &lt;printedVarInOut&gt;)
</pre>
<p>Prints the variable as:</p>
<pre class="literal-block">
&lt;varName&gt;: &lt;ele0&gt; &lt;ele1&gt; ...
</pre>
<p>If <tt class="docutils literal">$&lt;printedVarInOut&gt;</tt> is <tt class="docutils literal">TRUE</tt> on input, then the varible is not
touched. If however, the varible <tt class="docutils literal">$&lt;printedVarInOut&gt;</tt> is not <tt class="docutils literal">TRUE</tt> on
input, then it is set to <tt class="docutils literal">TRUE</tt> on output.</p>
</div>
<div class="section" id="print-var">
<h3><a class="toc-backref" href="#id168">PRINT_VAR()</a></h3>
<p>Unconditionally print a variable giving its name then value.</p>
<p>Usage:</p>
<pre class="literal-block">
PRINT_VAR(&lt;varName&gt;)
</pre>
<p>This prints:</p>
<pre class="literal-block">
MESSAGE(&quot;-- &quot; &quot;${VARIBLE_NAME}='${${VARIBLE_NAME}}'&quot;)
</pre>
<p>The variable <tt class="docutils literal">&lt;varName&gt;</tt> can be defined or undefined or empty.  This uses
an explicit &quot;-- &quot; line prefix so that it prints nice even on Windows CMake.</p>
</div>
<div class="section" id="remove-global-duplicates">
<h3><a class="toc-backref" href="#id169">REMOVE_GLOBAL_DUPLICATES()</a></h3>
<p>Remove duplicate elements from a global list variable (removes boiler-plate
code and errors).</p>
<p>Usage:</p>
<pre class="literal-block">
REMOVE_GLOBAL_DUPLICATES(&lt;globalVarName&gt;)
</pre>
<p>This function is necessary in order to preserve the &quot;global&quot; nature of the
variable.  If one just calls <tt class="docutils literal">LIST(REMOVE_DUPLICATES <span class="pre">...)</span></tt> it will
actually create a local variable of the same name and shadow the global
variable!  That is a fun bug to track down!  The variable
<tt class="docutils literal">&lt;globalVarName&gt;</tt> must be defined before this function is called.  If
<tt class="docutils literal">&lt;globalVarName&gt;</tt> is actually not a global cache variable before this
function is called it will be after it completes.</p>
</div>
<div class="section" id="set-and-inc-dirs">
<h3><a class="toc-backref" href="#id170">SET_AND_INC_DIRS()</a></h3>
<p>Set a variable to an include directory and call <tt class="docutils literal">INCLUDE_DIRECTORIES()</tt>
(removes boiler-plate code).</p>
<p>Usage:</p>
<blockquote>
SET_AND_INC_DIRS(&lt;dirVarName&gt; &lt;includeDir&gt;)</blockquote>
<p>On output, this sets <tt class="docutils literal">&lt;dirVarName&gt;</tt> to <tt class="docutils literal">&lt;includeDir&gt;</tt> in the local scope
and calls <tt class="docutils literal"><span class="pre">INCLUDE_DIRECTORIES(&lt;includeDir&gt;)</span></tt>.</p>
</div>
<div class="section" id="set-cache-on-off-empty">
<h3><a class="toc-backref" href="#id171">SET_CACHE_ON_OFF_EMPTY()</a></h3>
<p>Usage:</p>
<pre class="literal-block">
SET_CACHE_ON_OFF_EMPTY(&lt;varName&gt; &lt;initialVal&gt; &quot;&lt;docString&gt;&quot; [FORCE])
</pre>
<p>Sets a special string cache variable with possible values &quot;&quot;, &quot;ON&quot;, or
&quot;OFF&quot;.  This results in a nice drop-down box in the CMake cache manipulation
GUIs.</p>
</div>
<div class="section" id="set-default">
<h3><a class="toc-backref" href="#id172">SET_DEFAULT()</a></h3>
<p>Give a local variable a default value if a non-empty value is not already
set.</p>
<p>Usage:</p>
<pre class="literal-block">
SET_DEFAULT(&lt;varName&gt; &lt;arg0&gt; &lt;arg1&gt; ...)
</pre>
<p>If on input <tt class="docutils literal"><span class="pre">&quot;${&lt;varName&gt;}&quot;==&quot;&quot;</span></tt>, then <tt class="docutils literal">&lt;varName&gt;</tt> is set to the given
default <tt class="docutils literal">&lt;arg0&gt; &lt;arg1&gt; ...</tt>.  Otherwise, the existing non-empty value is
preserved.</p>
</div>
<div class="section" id="set-default-and-from-env">
<h3><a class="toc-backref" href="#id173">SET_DEFAULT_AND_FROM_ENV()</a></h3>
<p>Set a default value for a local variable and override from an environment
variable of the same name if it is set.</p>
<p>Usage:</p>
<pre class="literal-block">
SET_DEFAULT_AND_FROM_ENV(&lt;varName&gt; &lt;defaultVal&gt;)
</pre>
<p>First calls <tt class="docutils literal"><span class="pre">SET_DEFAULT(&lt;varName&gt;</span> &lt;defaultVal&gt;)</tt> and then looks for an
environment variable named <tt class="docutils literal">&lt;varName&gt;</tt>, and if non-empty then overrides
the value of the local variable <tt class="docutils literal">&lt;varName&gt;</tt>.</p>
<p>This macro is primarily used in CTest code to provide a way to pass in the
value of CMake variables.  Older versions of <tt class="docutils literal">ctest</tt> did not support the
option <tt class="docutils literal"><span class="pre">-D</span> <span class="pre">&lt;var&gt;:&lt;type&gt;=&lt;value&gt;</span></tt> to allow variables to be set through the
command-line like <tt class="docutils literal">cmake</tt> always allowed.</p>
</div>
<div class="section" id="split">
<h3><a class="toc-backref" href="#id174">SPLIT()</a></h3>
<p>Split a string variable into a string array/list variable.</p>
<p>Usage:</p>
<pre class="literal-block">
SPLIT(&quot;&lt;inputStr&gt;&quot; &quot;&lt;sepStr&gt;&quot; &lt;outputStrListVar&gt;)
</pre>
<p>The <tt class="docutils literal">&lt;sepStr&gt;</tt> string is used with <tt class="docutils literal">STRING(REGEX <span class="pre">...)</span></tt> to replace all
occurrences of <tt class="docutils literal">&lt;sepStr&gt;</tt> in <tt class="docutils literal">&lt;inputStr&gt;</tt> with <tt class="docutils literal">&quot;;&quot;</tt> and writing into
<tt class="docutils literal">&lt;outputStrListVar&gt;</tt>.</p>
<p>WARNING: <tt class="docutils literal">&lt;sepStr&gt;</tt> is interpreted as a regular expression (regex) so keep
that in mind when considering special regex chars like <tt class="docutils literal">'*'</tt>, <tt class="docutils literal">'.'</tt>,
etc!</p>
</div>
<div class="section" id="timer-get-raw-seconds">
<h3><a class="toc-backref" href="#id175">TIMER_GET_RAW_SECONDS()</a></h3>
<p>Return the raw time in seconds (nano-second accuracy) since epoch, i.e.,
since 1970-01-01 00:00:00 UTC.</p>
<p>Usage:</p>
<pre class="literal-block">
TIMER_GET_RAW_SECONDS(&lt;rawSecondsVar&gt;)
</pre>
<p>This function is used along with <a class="reference internal" href="#timer-get-rel-seconds">TIMER_GET_REL_SECONDS()</a>, and
<a class="reference internal" href="#timer-print-rel-time">TIMER_PRINT_REL_TIME()</a> to time big chunks of CMake code for timing and
profiling purposes.  See <a class="reference internal" href="#timer-print-rel-time">TIMER_PRINT_REL_TIME()</a> for more details and an
example.</p>
<p>NOTE: This function runs an external process with <tt class="docutils literal">EXECUTE_PROCESS()</tt> to
run the <tt class="docutils literal">date</tt> command.  Therefore, it only works on Unix/Linux and other
systems that have a standard <tt class="docutils literal">date</tt> command.  Since this uses
<tt class="docutils literal">EXECUTE_PROCESS()</tt>, this function should only be used to time very
course-grained operations (i.e. that take longer than a second).  If the
<cite>date</cite> command does not exist, then ${&lt;rawSecondsVar&gt;} will be empty on
output!</p>
</div>
<div class="section" id="timer-get-rel-seconds">
<h3><a class="toc-backref" href="#id176">TIMER_GET_REL_SECONDS()</a></h3>
<p>Return the relative time between start and stop seconds.</p>
<p>Usage:</p>
<pre class="literal-block">
TIMER_GET_REL_SECONDS(&lt;startSeconds&gt; &lt;endSeconds&gt; &lt;relSecondsOutVar&gt;)
</pre>
<p>This simple function computes the relative number of seconds between
<tt class="docutils literal">&lt;startSeconds&gt;</tt> and <tt class="docutils literal">&lt;endSeconds&gt;</tt> (returned from
<a class="reference internal" href="#timer-get-raw-seconds">TIMER_GET_RAW_SECONDS()</a>) and sets the result in the local variable
<tt class="docutils literal">&lt;relSecondsOutVar&gt;</tt>.</p>
</div>
<div class="section" id="timer-print-rel-time">
<h3><a class="toc-backref" href="#id177">TIMER_PRINT_REL_TIME()</a></h3>
<p>Print the relative time between start and stop timers in <tt class="docutils literal">&lt;min&gt;m&lt;sec&gt;s</tt>
format.</p>
<p>Usage:</p>
<pre class="literal-block">
TIMER_PRINT_REL_TIME(&lt;startSeconds&gt; &lt;endSeconds&gt; &quot;&lt;messageStr&gt;&quot;)
</pre>
<p>Differences the raw times <tt class="docutils literal">&lt;startSeconds&gt;</tt> and <tt class="docutils literal">&lt;endSeconds&gt;</tt>
(i.e. gotten from <a class="reference internal" href="#timer-get-raw-seconds">TIMER_GET_RAW_SECONDS()</a>) and prints the time in
<tt class="docutils literal">&lt;min&gt;m&lt;sec&gt;s</tt> format.</p>
<p>This is meant to be used with <a class="reference internal" href="#timer-get-raw-seconds">TIMER_GET_RAW_SECONDS()</a> to time expensive
blocks of CMake code like:</p>
<pre class="literal-block">
TIMER_GET_RAW_SECONDS(REAL_EXPENSIVE_START)

REAL_EXPENSIVE(...)

TIMER_GET_RAW_SECONDS(REAL_EXPENSIVE_END)

TIMER_PRINT_REL_TIME(${REAL_EXPENSIVE_START} ${REAL_EXPENSIVE_END}
   &quot;REAL_EXPENSIVE() time&quot;)
</pre>
<p>This will print something like:</p>
<pre class="literal-block">
REAL_EXPENSIVE() time: 0m5.235s
</pre>
</div>
<div class="section" id="unittest-compare-const">
<h3><a class="toc-backref" href="#id178">UNITTEST_COMPARE_CONST()</a></h3>
<p>Perform a single unit test equality check and update overall test statistics</p>
<p>Usage:</p>
<pre class="literal-block">
UNITTEST_COMPARE_CONST(&lt;varName&gt; &lt;expectedValue&gt;)
</pre>
<p>If <tt class="docutils literal"><span class="pre">${&lt;varName&gt;}</span> == &lt;expectedValue&gt;</tt>, then the check passes, otherwise it
fails.  This prints the variable name and values and shows the test result.</p>
<p>This updates the global variables <tt class="docutils literal">UNITTEST_OVERALL_NUMRUN</tt>,
<tt class="docutils literal">UNITTEST_OVERALL_NUMPASSED</tt>, and <tt class="docutils literal">UNITTEST_OVERALL_PASS</tt> which are used
by the unit test harness system to assess overall pass/fail.</p>
</div>
<div class="section" id="unittest-has-substr-const">
<h3><a class="toc-backref" href="#id179">UNITTEST_HAS_SUBSTR_CONST()</a></h3>
<p>Check that a given string var contains the given substring and update
overall test statistics</p>
<p>Usage:</p>
<pre class="literal-block">
UNITTEST_HAS_SUBSTR_CONST(&lt;varName&gt; &lt;substr&gt;)
</pre>
<p>If <tt class="docutils literal"><span class="pre">${&lt;varName&gt;}</span></tt> contains the substring <tt class="docutils literal">&lt;substr&gt;</tt>, then the check
passes, otherwise it fails.  This prints the variable name and values and
shows the test result.</p>
<p>This updates the global variables <tt class="docutils literal">UNITTEST_OVERALL_NUMRUN</tt>,
<tt class="docutils literal">UNITTEST_OVERALL_NUMPASSED</tt>, and <tt class="docutils literal">UNITTEST_OVERALL_PASS</tt> which are used
by the unit test harness system to assess overall pass/fail.</p>
</div>
<div class="section" id="unittest-string-regex">
<h3><a class="toc-backref" href="#id180">UNITTEST_STRING_REGEX()</a></h3>
<p>Perform a series regexes of given strings and update overall test statistics.</p>
<p>Usage:</p>
<pre class="literal-block">
UNITTEST_STRING_REGEX(
  &lt;inputString&gt;
  REGEX_STRINGS &quot;&lt;str0&gt;&quot; &quot;&lt;str1&gt;&quot; ...
  )
</pre>
<p>If the <tt class="docutils literal">&lt;inputString&gt;</tt> matches all of the of the regexs <tt class="docutils literal">&quot;&lt;str0&gt;&quot;</tt>,
<tt class="docutils literal">&quot;&lt;str1&gt;&quot;</tt>, ..., then the test passes.  Otherwise it fails.</p>
<p>This updates the global variables <tt class="docutils literal">UNITTEST_OVERALL_NUMRUN</tt>,
<tt class="docutils literal">UNITTEST_OVERALL_NUMPASSED</tt>, and <tt class="docutils literal">UNITTEST_OVERALL_PASS</tt> which are used
by the unit test harness system to assess overall pass/fail.</p>
</div>
<div class="section" id="unittest-file-regex">
<h3><a class="toc-backref" href="#id181">UNITTEST_FILE_REGEX()</a></h3>
<p>Perform a series regexes of given strings and update overall test statistics.</p>
<p>Usage:</p>
<pre class="literal-block">
UNITTEST_FILE_REGEX(
  &lt;inputFileName&gt;
  REGEX_STRINGS &quot;&lt;str1&gt;&quot; &quot;&lt;str2&gt;&quot; ...
  )
</pre>
<p>The contents of <tt class="docutils literal">&lt;inputFileName&gt;</tt> are read into a string and then passed
to <a class="reference internal" href="#unittest-string-regex">UNITTEST_STRING_REGEX()</a> to assess pass/fail.</p>
</div>
<div class="section" id="unittest-final-result">
<h3><a class="toc-backref" href="#id182">UNITTEST_FINAL_RESULT()</a></h3>
<p>Print final statistics from all tests and assert final pass/fail</p>
<p>Usage:</p>
<pre class="literal-block">
UNITTEST_FINAL_RESULT(&lt;expectedNumPassed&gt;)
</pre>
<p>If <tt class="docutils literal"><span class="pre">${UNITTEST_OVERALL_PASS}==TRUE</span></tt> and <tt class="docutils literal">${UNITTEST_OVERALL_NUMPASSED} ==
&lt;expectedNumPassed&gt;</tt>, then the overall test program is determined to have
passed and string:</p>
<pre class="literal-block">
&quot;Final UnitTests Result: PASSED&quot;
</pre>
<p>is printed.  Otherwise, the overall test program is determined to have
failed, the string:</p>
<pre class="literal-block">
&quot;Final UnitTests Result: FAILED&quot;
</pre>
<p>is printed, and <tt class="docutils literal">MESSAGE(SEND_ERROR &quot;FAIL&quot;)</tt> is called.</p>
<p>The reason that we require passing in the expected number of passed tests is
as an extra precaution to make sure that important unit tests are not left
out.  CMake is a very loosely typed language and it pays to be a little
paranoid.</p>
<!-- ToDo: Edited and spell-checked through here on 5/15/2014. -->
</div>
</div>
</div>
<div class="section" id="appendix">
<h1><a class="toc-backref" href="#id183">13&nbsp;&nbsp;&nbsp;Appendix</a></h1>
<div class="section" id="history-of-tribits">
<h2><a class="toc-backref" href="#id184">13.1&nbsp;&nbsp;&nbsp;History of TriBITS</a></h2>
<p>TriBITS started development in November 2007 as a set of helper macros to
provide a CMake build system for a small subset of packages in Trilinos.  The
initial goal was to just to support a native Windows build (using Visual C++)
to compile and install these few Trilinos packages on Windows for usage by
another project (the Sandia Titan project which included VTK).  At that time,
Trilinos was using a highly customized and augmented autotools build system.
Initially, this CMake system was just a set of macros to streamline creating
executables and tests.  Some of the conventions started in that early effort
(e.g. naming conventions of variables and macros where functions use upper
case like old FORTRAN and variables are mixed case) were continued in later
efforts and are reflected in the current implementation.  Then, stating in
early 2008, a more detailed evaluation was performed to see if Trilinos should
switch over to CMake as the default (and soon only) supported build and test
system (see &quot;Why CMake?&quot; in <a class="reference external" href="../overview/TribitsOverview.pdf">TriBITS Overview</a>).  This lead to the initial
implementation of a scalable package-based architecture (PackageArch) for the
Trilinos CMake project in late 2008.  This Trilinos CMake PackageArch system
evolved over the next few years with development in the system slowing
into 2010.  This Trilinos CMake build system was then adopted as the build
infrastructure for the CASL VERA effort in 2011 where CASL VERA packages were
treated as add-on Trilinos packages (see Section <a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a>).
Over the next year, there was significant development of the system to support
larger multi-repo projects in support of CASL VERA.  That lead to the decision
to formally generalize the Trilinos CMake PackageArch build system outside of
Trilinos and the name TriBITS was formally adopted in November 2011.  Work to
refactor the Trilinos CMake system into a general reusable stand-alone
CMake-based build system started in October 2011 and an initial implementation
was complete in December 2011 when it was used for the CASL VERA build system.
In early 2012, the ORNL CASL-related projects Denovo and SCALE (see [<a class="reference internal" href="#scale-2011">SCALE,
2011</a>]) adopted TriBITS as their native development build systems.  Shortly
after, TriBITS was adopted the native build system for the CASL-related
University of Michigan code MPACT.  In addition to being used in CASL, all of
these codes also had a significant life outside of CASL.  Because they used
the same TriBITS build system, it proved relatively easy to keep these various
codes integrated together in the CASL VERA code meta-build.  At the same time,
TriBITS well served the independent development teams and non-CASL projects
independent from CASL VERA.  Since the initial extraction of TriBITS from
Trilinos, the TriBITS system was further extended and refined, driven by CASL
VERA development and expansion.  Independently, an early version of TriBITS
from 2012 was adopted by the LiveV
projectfootnote{<a class="reference external" href="https://github.com/lifev/cmake">https://github.com/lifev/cmake</a>} which was forked and extended
independently.</p>
</div>
<div class="section" id="why-a-tribits-package-is-not-a-cmake-package">
<h2><a class="toc-backref" href="#id185">13.2&nbsp;&nbsp;&nbsp;Why a TriBITS Package is not a CMake Package</a></h2>
<p>Note that a <a class="reference internal" href="#tribits-package">TriBITS Package</a> is not the same thing as a &quot;Package&quot; in raw
CMake terminology.  In raw CMake, a &quot;Package&quot; is some externally provided bit
of software or other utility for which the current CMake project has an
optional or required dependency (see <a class="reference external" href="http://www.cmake.org/Wiki/CMake:How_To_Find_Libraries">CMake: How to Find Libraries</a>).  Therefore, a raw
CMake &quot;Package&quot; actually maps to a <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>.  A raw CMake &quot;Package&quot;
(e.g. Boost, CUDA, etc.)  can be found using a standard CMake find module
<tt class="docutils literal"><span class="pre">Find&lt;rawPackageName&gt;.cmake</span></tt> using the built-in CMake command
<tt class="docutils literal"><span class="pre">FIND_PACKAGE(&lt;rawPackageName&gt;)</span></tt>.  It is unfortunate that the TriBITS and
the raw CMake definitions of the term &quot;Package&quot; are not exactly the same.
However, the term &quot;Package&quot; was coined by the Trilinos project long ago before
CMake was adopted as the Trilinos build system and Trilinos' definition of
&quot;Package&quot; (going back to 1998) pre-dates the development of CMake (see
<a class="reference external" href="http://en.wikipedia.org/wiki/CMake#History">History of CMake</a>) and
therefore Trilinos dictated the terminology of TriBITS and the definition of
the term &quot;Package&quot; in the TriBITS system.  However, note that both meanings of
the term &quot;Package&quot; are consistent with the more general software engineering
definition of a &quot;Package&quot; according to <a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering Packaging
Principles</a>.</p>
</div>
<div class="section" id="design-considerations-for-tribits">
<h2><a class="toc-backref" href="#id186">13.3&nbsp;&nbsp;&nbsp;Design Considerations for TriBITS</a></h2>
<p>Some of the basic requirements and design goals for TriBITS are outlined in the <a class="reference external" href="../overview/TribitsOverview.pdf">TriBITS Overview</a> document.</p>
<!-- ToDo: Discuss design requirements for TriBITS in more detail. -->
<p>As stated in <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a>, <a class="reference internal" href="#no-circular-dependencies-of-any-kind-are-allowed">No circular
dependencies of any kind are allowed</a>.  That is, no TriBITS SE package (or
its tests) can declare a dependency on a <a class="reference internal" href="#downstream">downstream</a> SE package, period!  To
some, this might seem over constraining but adding support for circular
dependencies to the TriBITS system would add significant complexity and
space/time overhead and is a bad idea from a basic software engineering
perspective (see the <em>ADP (Acyclic Dependencies Principle)</em> in <a class="reference internal" href="#software-engineering-packaging-principles">Software
Engineering Packaging Principles</a>).  From a versioning, building, and
change-prorogation perspective, any packages involved in a circular dependency
would need to be treated as a single software engineering package anyway so
TriBITS forces development teams to glob all of this stuff together into a
single <a class="reference internal" href="#tribits-se-package">TriBITS SE Package</a> when cycles in software exist.  There are
numerous wonderful ways to break circular dependencies between packages that
are proven and well established in the SE community (for example, see [<a class="reference internal" href="#agile-software-development-2003">Agile
Software Development, 2003</a>]).</p>
<!-- ToDo: Discuss why it is a good idea to explicitly list packages instead of -->
<!-- just searching for them.  Hint: Think performance and circular -->
<!-- dependencies! -->
</div>
<div class="section" id="checkin-test-py-help">
<h2><a class="toc-backref" href="#id187">13.4&nbsp;&nbsp;&nbsp;checkin-test.py --help</a></h2>
<p>Below is a snapshot of the output from <tt class="docutils literal"><span class="pre">checkin-test.py</span> <span class="pre">--help</span></tt>.  This
<tt class="docutils literal"><span class="pre">--help</span></tt> output contains a lot of information about the recommended
development workflow (mostly related to pushing commits) and outlines a number
of different use cases for using the script.</p>
<pre class="literal-block">
Usage: checkin-test.py [OPTIONS]

This tool does testing of a TriBITS-based project using CTest and this script
can actually do the push itself using eg/git in a safe way.  In fact, it is
recommended that one uses this script to push since it will amend the last
commit message with a (minimal) summary of the builds and tests run with
results and/or send out a summary email about the builds/tests performed.


Quickstart:
-----------

In order to do a safe push, perform the following recommended workflow
(different variations on this workflow are described below):

1) Commit changes in the local repo:

  # 1.a) See what files are changed, newly added, etc. that need to be committed
  # or stashed.
  $ eg status

  # 1.b) Stage the files you want to commit (optional)
  $ eg stage &lt;files you want to commit&gt;

  # 1.c) Create your local commits
  $ eg commit -- SOMETHING
  $ eg commit -- SOMETHING_ELSE
  ...

  # 1.d) Stash whatever changes are left you don't want to test/push (optional)
  $ eg stash

  NOTE: You can group your commits any way that you would like (see the basic
  eg/git documentation).

  NOTE: If not installed on your system, the eg script can be found at
  tribits/common_tools/git/eg.  Just add it to your path.

  NOTE: When multiple repos are involved, use egdist instead.  It is provided
  at tribits/common_tools/git/egdist.  See egdist --help for details.

2) Review the changes that you have made to make sure it is safe to push:

  $ cd $PROJECT_HOME
  $ eg local-stat                  # Look at the full status of local repo
  $ eg diff --name-status origin   # [Optional] Look at the files that have changed

  NOTE: The command 'local-stat' is a git alias that can be installed with the
  script tribits/common_tools/git/git-config-alias.sh.  It is highly
  recommended over just a raw 'eg status' or 'eg log' to review commits before
  attempting to test/push commits.

  NOTE: If you see any files/directories that are listed as 'unknown' returned
  from 'eg local-stat', then you will need to do an 'eg add' to track them or
  add them to an ignore list *before* you run the checkin-test.py script.
  The eg script will not allow you to push if there are new 'unknown' files or
  uncommitted changes to tracked files.

3) Set up the checkin base build directory (first time only):

  $ cd $PROJECT_HOME
  $ echo CHECKIN &gt;&gt; .git/info/exclude
  $ mkdir CHECKIN
  $ cd CHECKIN

  NOTE: You may need to set up some configuration files if CMake can not find
  the right compilers, MPI, and TPLs by default (see detailed documentation
  below).

  NOTE: You might want to set up a simple shell driver script.

  NOTE: You can set up a CHECKIN directory of any name in any location
  you want.  If you create one outside of the main source dir, then
  you will not have to add the git exclude shown above.

4) Do the pull, configure, build, test, and push:

  $ cd $PROJECT_HOME
  $ cd CHECKIN
  $ ../checkin-test.py -j4 --do-all --push

  NOTE: The above will: a) pull updates from the global repo(s), b)
  automatically enable the correct packages, c) configure and build the right
  packages, d) run the tests, e) send you emails about what happened, f) do a
  final pull from the global repo, g) optionally amend the last local commit
  with the test results, and h) finally push local commits to the global
  repo(s) if everything passes.

  NOTE: You must have installed the official versions of eg/git with the
  install-git.py script in order to run this script.  If you don't, the script
  will die right away with an error message telling you what the problem is.

  NOTE: The current branch will be used to pull and push to.  A raw 'eg pull'
  is performed which will get all of the branches from 'origin'.  This means
  that your current branch must be a tracking branch so that it will get
  updated correctly.  The branch 'master' is the most common branch but
  release tracking branches are also common.

  NOTE: You must not have any uncommitted changes or the 'eg pull &amp;&amp; eg rebase
  --against origin' command will fail on the final pull/rebase before the push
  and therefore the whole script will fail.  To run the script, you will may
  need to first use 'eg stash' to stash away your unstaged/uncommitted changes
  *before* running this script.

  NOTE: You need to have SSH public/private keys set up to the remote repo
  machines for the git commands invoked in the script to work without you
  having to type a password.

  NOTE: You can do the final push in a second invocation of the script with a
  follow-up run with --push and removing --do-all (it will remember the
  results from the build/test cases just ran).  For more details, see detailed
  documentation below.

  NOTE: Once you start running the checkin-test.py script, you can go off and
  do something else and just check your email to see if all the builds and
  tests passed and if the push happened or not.

  NOTE: The commands 'cmake', 'ctest', and 'make' must be in your default path
  before running this script.

For more details on using this script, see the detailed documentation below.


Detailed Documentation:
-----------------------

The following approximate steps are performed by this script:


----------------------------------------------------------------------------


1) Check to see if the local repo(s) are clean:

  $ eg status

  NOTE: If any modified or any unknown files are shown, the process will be
  aborted.  The local repo(s) working directory must be clean and ready to
  push *everything* that is not stashed away.

2) Do a 'eg pull' to update the code (done if --pull or --do-all is set):

  NOTE: If not doing a pull, use --allow-no-pull or --local-do-all.

3) Select the list of packages to enable forward/downstream based on the
package directories where there are changed files (or from a list of packages
passed in by the user).

  NOTE: The automatic enable behavior can be overridden or modified using the
  options --enable-all-packages, --enable-packages, --disable-packages, and/or
  --no-enable-fwd-packages.

4) For each build/test case &lt;BUILD_NAME&gt; (e.g. MPI_DEBUG, SERIAL_RELEASE,
extra builds specified with --extra-builds):

  4.a) Configure a build directory &lt;BUILD_NAME&gt; in a standard way for all of
  the packages that have changed and all of the packages that depend on these
  packages forward/downstream. You can manually select which packages get
  enabled (see the enable options above).  (done if --configure, --do-all, or
  --local-do-all is set.)
  
  4.b) Build all configured code with 'make' (e.g. with -jN set through
  -j or --make-options).  (done if --build, --do-all, or --local-do-all is set.)
  
  4.c) Run all BASIC tests for enabled packages.  (done if --test, --do-all,
  or --local-do-all is set.)

  4.d) Analyze the results of the update, configure, build, and tests and send
  email about results.  (emails only sent out if --send-emails-to != &quot;&quot;)

5) Do final pull and rebase, append test results to last commit message, and
push (done if --push is set)

  5.a) Do a final 'eg pull' (done if --pull or --do-all is set)

  5.b) Do 'eg rebase --against origin/&lt;current_branch&gt;' (done if --pull or
  --do-all is set and --rebase is set)

    NOTE: The final 'eg rebase --against origin/&lt;current_branch&gt;' is
    required to avoid trivial merge commits that the global get repo
    will reject on the push.
  
  5.c) Amend commit message of the most recent commit with the summary of the
  testing performed.  (done if --append-test-results is set.)
  
  5.d) Push the local commits to the global repo (done if --push is set)


----------------------------------------------------------------------------


The recommended way to use this script is to create a new base CHECKIN test
directory apart from your standard build directories such as with:

  $ $PROJECT_HOME
  $ mkdir CHECKIN
  $ echo CHECKIN &gt;&gt; .git/info/exclude

The most basic way to do pre-push testing is with:

  $ cd CHECKIN
  $ ../checkin-test.py --do-all [other options]

If your MPI installation, other compilers, and standard TPLs (i.e. BLAS and
LAPACK) can be found automatically, then this is all you will need to do.
However, if the setup cannot be determined automatically, then you can add a
set of CMake variables that will get read in the files:

  COMMON.config
  MPI_DEBUG.config
  SERIAL_RELEASE.config

(or whatever your standard --default-builds are).

Actually, for built-in build/test cases, skeletons of these files will
automatically be written out with typical CMake cache variables (commented
out) that you would need to set out.  Any CMake cache variables listed in
these files will be read into and passed on the configure line to 'cmake'.

WARNING: Please do not add any extra CMake cache variables than what are
needed to get the Primary Tested (PT) --default-builds builds to work.  Adding
other enables/disables will make the builds non-standard and can break these
PT builds.  The goal of these configuration files is to allow you to specify
the minimum environment to find MPI, your compilers, and the required TPLs
(e.g. BLAS, LAPACK, etc.).  If you need to fudge what packages are enabled,
please use the script arguments --enable-packages, --disable-packages,
--no-enable-fwd-packages, and/or --enable-all-packages to control this, not
the *.config files!

WARNING: Please do not add any CMake cache variables in the *.config files
that will alter what packages or TPLs are enabled or what tests are run.
Actually, the script will not allow you to change TPL enables in these
standard *.config files because to do so deviates from a consistent build
configuration for Primary Tested (PT) Code.

NOTE: All tentatively-enabled TPLs (e.g. Pthreads and BinUtils) are hard
disabled in order to avoid different behaviors between machines where they
would be enabled and machines where they would be disabled.

NOTE: If you want to add extra build/test cases that do not conform to
the standard build/test configurations described above, then you need
to create extra builds with the --extra-builds and/or
--st-extra-builds options (see below).

NOTE: Before running this script, you should first do an 'eg status' and 'eg
diff --name-status origin..' and examine what files are changed to make sure
you want to push what you have in your local working directory.  Also, please
look out for unknown files that you may need to add to the git repository with
'eg add' or add to your ignores list.  There cannot be any uncommitted changes
in the local repo before running this script.

NOTE: You don't need to run this script if you have not changed any files that
affect the build or the tests.  For example, if all you have changed are
documentation files, then you don't need to run this script before pushing
manually.

NOTE: To see detailed debug-level information, set
TRIBITS_CHECKIN_TEST_DEBUG_DUMP=ON in the env before running this script.


Common Use Cases (examples):
----------------------------

(*) Basic full testing with integrating with global repo(s) without push:

  ../checkin-test.py --do-all

  NOTE: This will result in a set of emails getting sent to your email address
  for the different configurations and an overall push readiness status email.

  NOTE: If everything passed, you can follow this up with a --push (see
  below).

(*) Basic full testing with integrating with local repo and push:

  ../checkin-test.py --do-all --push

  NOTE: By default this will rebase your local commits and ammend the last
  commit with a short summary of test results.  This is appropriate for
  pushing commits that only exist in your local repo and are not shared with
  any remote repo.

(*) Push to global repo after a completed set of tests have finished:

  ../checkin-test.py [other options] --push

  NOTE: This will pick up the results for the last completed test runs with
  [other options] and append the results of those tests to the log of the most
  recent commit.

  NOTE: Take the action options for the prior run and replace --do-all with
  --push but keep all of the rest of the options the same.  For example, if
  you did:

    ../checkin-test.py --enable-packages=Blah --default-builds=MPI_DEBUG --do-all

  then follow that up with:

    ../checkin-test.py --enable-packages=Blah --default-builds=MPI_DEBUG --push

  NOTE: This is a common use case when some tests are failing which aborted
  the initial push but you determine it is okay to push anyway and do so with
  --force-push.

(*) Test only the packages modified and not the forward dependent packages:

  ../checkin-test.py --do-all --no-enable-fwd-packages

  NOTE: This is a safe thing to do when only tests in the modified packages
  are changed and not library code.  This can speed up the testing process and
  is to be preferred over not running this script at all.  It would be very
  hard to make this script automatically determine if only test code has
  changed because every package does not follow a set pattern for
  tests and test code.

(*) Run the most important default (e.g. MPI_DEBUG) build/test only:

  ../checkin-test.py --do-all --default-builds=MPI_DEBUG

(*) The minimum acceptable testing when code has been changed:

  ../checkin-test.py \
    --do-all --enable-all-packages=off --no-enable-fwd-packages \
    --default-builds=MPI_DEBUG

  NOTE: This will do only an MPI DEBUG build and will only build and run the
  tests for the packages that have directly been changed and not any forward
  packages.  Replace &quot;MPI_DEBUG&quot; with whatever your most important default
  build is.

(*) Test only a specific set of packages and no others:

  ../checkin-test.py \
    --enable-packages=&lt;P0&gt;,&lt;P1&gt;,&lt;P2&gt; --no-enable-fwd-packages \
    --do-all
  
  NOTE: This will override all logic in the script about which packages will
  be enabled based on file changes and only the given packages will be
  enabled.  When there are tens of thousands of changed files and hundreds of
  defined packages, this auto-detection algorithm can be very expensive!

  NOTE: You might also want to pass in --enable-all-packages=off in case the
  script wants to enable all the packages (see the output in the
  checkin-test.py log file for details) and you think it is not necessary to
  do so.

  NOTE: Using these options is greatly preferred to not running this script at
  all and should not be any more expensive than the testing you would already
  do manually before a push.

(*) Test changes locally without pulling updates:

  ../checkin-test.py --local-do-all

  NOTE: This will just configure, build, test, and send an email notification
  without updating or changing the status of the local git repo in any way and
  without any communication with the global repo.  Hence, you can have
  uncommitted changes and still run configure, build, test without having to
  commit or having to stash changes.

  NOTE: This is not a sufficient level of testing in order to push the changes
  to the global repo because you have not fully integrated your changes yet
  with other developers.  However, this would be a sufficient level of testing
  in order to do a commit on the local machine and then pull to a remote
  machine for further testing and a push (see below).

(*) Adding extra build/test cases:

  Often you will be working on Secondary Tested (ST) Code or Experimental (EX)
  Code and want to include the testing of this in your pre-push testing
  process along with the standard --default-builds build/test cases which can
  only include Primary Tested (PT) Code.  In this case you can run with:
  
    ../checkin-test.py --extra-builds=&lt;BUILD1&gt;,&lt;BUILD2&gt;,... [other options]
  
  For example, if you have a build that enables the TPL CUDA you would do:
  
    echo &quot;
    -DTPL_ENABLE_MPI:BOOL=ON
    -DTPL_ENABLE_CUDA:BOOL=ON
    &quot; &gt; MPI_DEBUG_CUDA.config
  
  and then run with:
  
    ../checkin-test.py --extra-builds=MPI_DEBUG_CUDA --do-all
  
  This will do the standard --default-builds (e.g. MPI_DEBUG and
  SERIAL_RELEASE) build/test cases along with your non-standard MPI_DEBUG_CUDA
  build/test case.

  NOTE: You can disable the default build/test cases with --default-builds=&quot;&quot;.
  However, please only do this when you are not going to push because you need
  at least one default build/test case (the most important default PT case,
  e.g. MPI_DEBUG) to do a safe push.

(*) Including extra repos and extra packages:

  You can also use the checkin-test.py script to continuously integrate
  multiple git repos containing add-on packages. To do so, just run:
    
    ../checkin-test.py --extra-repos=&lt;REPO1&gt;,&lt;REPO2&gt;,... [options]

  NOTE: You have to create local commits in all of the extra repos where there
  are changes or the script will abort.

  NOTE: Extra repos can be specified with more flexibility using the
  --extra-repos-file and --extra-repos-type arguments (also see
  --ignore-missing-extra-repos).

  NOTE: Each of the last local commits in each of the changed repos will get
  amended with the appended summary of what was enabled in the build/test (if
  --append-test-results is set).

(*) Avoid changing any of the local commit SHA1s:

  If you are pushing commits from a shared branch, it is critical that you do
  not change any of the SHA1s of the commits.  Changing the SHA1s for any of
  the commits will mess up various multi-repo, multi-branch workflows.  To
  avoid changing any of the SHA1s of the local commits, one must run with:

    ../checkin-test.py --no-rebase --no-append-test-results [options]

(*) Performing a remote test/push:

  If you develop on a slow machine like your laptop, doing an appropriate
  level of testing can take a long time.  In this case, you can pull the
  changes to another faster remote workstation and do a more complete set of
  tests and push from there.  If you are knowledgeable with git, this will be
  easy and natural to do, without any help from this script.  However, this
  script can still help and automate the steps and can do so in one command
  invocation on the part of the developer.

  On your slow local development machine 'mymachine', do the limited testing
  with:

    ../checkin-test.py --do-all --no-enable-fwd-packages
  
  On your fast remote test machine, do a full test and push with:
  
    ../checkin-test.py \
      --extra-pull-from=&lt;remote-name&gt;:master \
      --do-all --push

  where &lt;remote-name&gt; is a git repo pointing to
  mymachine:/some/dir/to/your/src:master (see 'git help remote').
  
  NOTE: You can of course adjust the packages and/or build/test cases that get
  enabled on the different machines.
  
  NOTE: Once you invoke the checkin-test.py script on the remote test machine
  and it has pulled the commits from mymachine, then you can start changing
  files again on your local development machine and just check your email to
  see what happens on the remote test machine.
  
  NOTE: If something goes wrong on the remote test machine, you can either
  work on fixing the problem there or you can fix the problem on your local
  development machine and then do the process over again.

  NOTE: If you alter the commits on the remote machine (such as squashing
  commits), you will have trouble merging back on our local machine.
  Therefore, if you have to to fix problems, make new commits and don't alter
  the ones you pulled from your local machine (but rebasing them should be
  okay as long as the local commits on mymachine are not pushed to other
  repos).

  NOTE: Git will resolve the duplicated commits when you pull the commits
  pushed from the remote machine.  Git knows that the commits are the same and
  will do the right thing when rebasing (or just merging).
  
(*) Check push readiness status:

  ../checkin-test.py

  NOTE: This will examine results for the last testing process and send out an
  email stating if the a push is ready to perform or not.

(*) See the default option values without doing anything:

  ../checkin-test.py --show-defaults

  NOTE: This is the easiest way to figure out what all of the default options
  are.

Hopefully the above documentation, the example use cases, the documentation of
the command-line arguments below, and some experimentation will be enough to
get you going using this script for all of your pre-push testing and pushes.
If that is not sufficient, send email to your development support team to ask
for help.


Handling of PT, ST, and EX Code in built-in and extra builds:
-------------------------------------------------------------

This script will only process PT (Primary Tested) packages in the
--default-builds (e.g. MPI_DEBUG and SERIAL_RELEASE) builds.  This is to avoid
problems of side-effects of turning on ST packages that would impact PT
packages (e.g. an ST package getting enabled that enables an ST TPL which
turns on support for that TPL in a PT package producing different code which
might work but the pure PT build without the extra TPL may actually be broken
and not know it).  Therefore, any non-PT packages that are enabled (either
implicitly through changed files or explicitly by listing in --enable-packages)
will be turned off in the --default-builds builds.  If none of the enabled
packages are PT, then they will all be disabled and the --default-builds
builds will be skipped.

In order to better support the development of ST and EX packages, this script
allows you to define some extra builds that will be invoked and used to
determine overall pass/fail before a potential push.  The option
--st-extra-builds is used to specify extra builds that will test ST packages
(and also PT packages if any are enabled).  If only PT packages are enabled
then the builds specified in --st-extra-builds will still be run.  The
reasoning is that PT packages may contain extra ST features and therefore if
the goal is to test these ST builds it is desirable to also run these builds
because they also my impact downstream ST packages.

Finally, the option --extra-builds will test all enabled packages, including
EX packages, regardless of their test group.  Therefore, when using
--extra-builds, be careful that you watch what packages are enabled.  If you
change an EX package, it will be enabled in --extra-builds builds.

A few use cases might help better demonstrate the behavior.  Consider
the following input arguments specifying extra builds

  --st-extra-builds=MPI_DEBUG_ST --extra-builds=INTEL_DEBUG

with the packages Teuchos, Phalanx, and Meros where Teuchos is PT, Phalanx is
ST, and Meros is EX.

Here is what packages would be enabled in each of the builds:

  --default-builds=MPI_DEBUG,SERIAL_RELEASE \
  --st-extra-builds=MPI_DEBUG_ST \
  --extra-builds=INTEL_DEBUG

and which packages would be excluded:

A) --enable-packages=Teuchos:
   MPI_DEBUG:       [Teuchos]
   SERIAL_RELEASE:  [Teuchos]
   MPI_DEBUG_ST:    [Teuchos]
   INTEL_DEBUG:     [Teuchos]     Always enabled!

B) --enable-packages=Phalanx:
   MPI_DEBUG:       []            Skipped, no PT packages!
   SERIAL_RELEASE:  []            Skipped, no PT packages!
   MPI_DEBUG_ST:    [Phalanx]
   INTEL_DEBUG:     [Phalanx]

C) --enable-packages=Meros:
   MPI_DEBUG:       []            Skipped, no PT packages!
   SERIAL_RELEASE:  []            Skipped, no PT packages!
   MPI_DEBUG_ST:    []            Skipped, no PT or ST packages!
   INTEL_DEBUG:     [Meros]

D) --enable-packages=Teuchos,Phalanx:
   MPI_DEBUG:       [Teuchos]
   SERIAL_RELEASE:  [Teuchos]
   MPI_DEBUG_ST:    [Teuchos,Phalanx]
   INTEL_DEBUG:     [Teuchos,Phalanx]

E) --enable-packages=Teuchos,Phalanx,Meros:
   MPI_DEBUG:       [Teuchos]
   SERIAL_RELEASE:  [Teuchos]
   MPI_DEBUG_ST:    [Teuchos,Phalanx]
   INTEL_DEBUG:     [Teuchos,Phalanx,Meros]

The --extra-builds=INTEL_DEBUG build is always performed with all of the
enabled packages.  This logic given above must be understood in order to
understand the output given in the script.


Conventions for Command-Line Arguments:
---------------------------------------

The command-line arguments are segregated into three broad categories: a)
action commands, b) aggregate action commands, and c) others.

a) The action commands are those such as --build, --test, etc. and are shown
with [ACTION] in their documentation.  These action commands have no off
complement.  If the action command appears, then the action will be performed.

b) Aggregate action commands such as --do-all and --local-do-all turn on sets
of other action commands and are shown with [AGGR ACTION] in their
documentation.  The sub-actions that these aggregate action commands turn on
cannot be disabled with other arguments.

c) Other arguments are those that are not marked with [ACTION] or [AGGR
ACTION] tend to either pass in data and turn control flags on or off.


Exit Code:
---------

This script returns 0 if the actions requested are successful.  This does not
necessarily imply that it is okay to do a push.  For example, if only --pull
is passed in and is successful, then 0 will be returned but that does *not*
mean that it is okay to do a push.  A 0 return value is a necessary but not
sufficient condition for readiness to push.



Options:
  -h, --help            show this help message and exit
  --project-configuration=PROJECTCONFIGURATION
                        Custom file to provide configuration defaults for the
                        project.  By default, the file project-checkin-test-
                        config.py is looked for in &lt;checkin-test-path&gt;/../..
                        (assuming default &lt;projectDir&gt;/cmake/tribits/
                        directory structure and second is looked for in
                        &lt;checkin-test-path&gt;/ (which is common practice to
                        symlink the checkin-test.py script into the project's
                        base directory).  If this file is set to a location
                        that is not in the project's base directory, then
                        --src-dir must be set to point to the project's base
                        directory.
  --show-defaults       Show the default option values and do nothing at all.
  --project-name=PROJECTNAME
                        Set the project's name. This is used to locate various
                        files.
  --eg-git-version-check
                        Enable automatic check for the right versions of eg
                        and git. [default]
  --no-eg-git-version-check
                        Do not check the versions of eg and git, just trust
                        they are okay.
  --src-dir=SRCDIR      The source base directory for code to be tested.  The
                        default is determined by the location of the found
                        project-checkin-test-config.py file.
  --default-builds=DEFAULTBUILDS
                        Comma separated list of builds that should always be
                        run by default.
  --extra-repos-file=EXTRAREPOSFILE
                        File path to an extra repositories list file.  If set
                        to 'project', then
                        &lt;project_dir&gt;/cmake/ExtraRepositoriesList.cmake is
                        read.  See the argument --extra-repos for details on
                        how this list is used (default empty '')
  --extra-repos-type=EXTRAREPOSTYPE
                        The test type of repos to read from
                        &lt;extra_repos_file&gt;. Choices = ('', 'Continuous',
                        'Nightly', 'Experimental').  [default = '']
  --extra-repos=EXTRAREPOS
                        List of comma separated extra repositories containing
                        extra  packages that can be enabled.  The order these
                        repos is listed in not important.  This option
                        overrides --extra-repos-file.
  --ignore-missing-extra-repos
                        If set, then extra repos read in from
                        &lt;extra_repos_file&gt; will be ignored and removed from
                        list.  This option is not applicable if
                        &lt;extra_repos_file&gt;=='' or &lt;extra_repos_type&gt;==''.
  --require-extra-repos-exist
                        If set, then all listed extra repos must exist or the
                        script will exit. [default]
  --with-cmake=WITHCMAKE
                        CMake executable to use with cmake -P scripts
                        internally (only set by unit testing code).
  --skip-deps-update    If set, skip the update of the dependency XML file.
                        If the package structure has not changed since the
                        last invocation, then it is safe to use this option.
  --enable-packages=ENABLEPACKAGES
                        List of comma separated packages to test changes for
                        (example, 'Teuchos,Epetra').  If this list of packages
                        is empty, then the list of packages to enable will be
                        determined automatically by examining the set of
                        modified files from the version control update log.
                        Note that this will skip the auto-detection of changed
                        packages based on changed files.
  --disable-packages=DISABLEPACKAGES
                        List of comma separated packages to explicitly disable
                        (example, 'Tpetra,NOX').  This list of disables will
                        be appended after all of the listed enables no mater
                        how they are determined (see --enable-packages
                        option).  NOTE: Only use this option to remove
                        packages that will not build for some reason.  You can
                        disable tests that run by using the CTest option -E
                        passed through the --ctest-options argument in this
                        script.
  --enable-all-packages=ENABLEALLPACKAGES
                        Determine if all packages are enabled 'on', or 'off',
                        or 'auto' (let other logic decide).  Setting to 'off'
                        is appropriate when the logic in this script
                        determines that a global build file has changed but
                        you know that you don't need to rebuild and test every
                        package for a reasonable test.  Setting --enable-
                        packages effectively disables this option.  Setting
                        this to 'off' does *not* stop the forward enabling of
                        downstream packages for packages that are modified or
                        set by --enable-packages. Setting this to 'on' will
                        skip the automatic detection of changed packages based
                        on changed files.  It can be helpful to stop the auto-
                        detection changed packages when there are thousands of
                        changed files and hundreds of defined packages.
                        Choices = ('auto', 'on', 'off').  [default = 'auto']
  --enable-fwd-packages
                        Enable forward packages. [default]
  --no-enable-fwd-packages
                        Do not enable forward packages.
  --continue-if-no-updates
                        If set, then the script will continue if no updates
                        are pulled from any repo. [default]
  --abort-gracefully-if-no-updates
                        If set, then the script will abort gracefully if no
                        updates are pulled from any repo.
  --continue-if-no-changes-to-push
                        If set, then the script will continue if no changes to
                        push from any repo. [default]
  --abort-gracefully-if-no-changes-to-push
                        If set, then the script will abort gracefully if no
                        changes to push from any repo.
  --continue-if-no-enables
                        If set, then the script will continue if no packages
                        are enabled. [default]
  --abort-gracefully-if-no-enables
                        If set, then the script will abort gracefully if no
                        packages are enabled.
  --extra-cmake-options=EXTRACMAKEOPTIONS
                        Extra options to pass to 'cmake' after all other
                        options. This should be used only as a last resort.
                        To disable packages, instead use --disable-packages.
                        To change test categories, use --test-categories.
  --test-categories=TESTCATEGORIES
                        . Change the test categories.  Can be 'BASIC',
                        'CONTINUOUS',  'NIGHTLY', or 'WEEKLY' (default
                        'BASIC').
  -j OVERALLNUMPROCS    The options to pass to make and ctest (e.g. -j4).
  --make-options=MAKEOPTIONS
                        The options to pass to make (e.g. -j4).
  --ctest-options=CTESTOPTIONS
                        Extra options to pass to 'ctest' (e.g. -j2).
  --ctest-timeout=CTESTTIMEOUT
                        timeout (in seconds) for each single 'ctest' test
                        (e.g. 180 for three minutes).
  --show-all-tests      Show all of the tests in the summary email and in the
                        commit message summary (see --append-test-results).
  --no-show-all-tests   Don't show all of the test results in the summary
                        email. [default]
  --without-default-builds
                        Skip the default builds (same as --default-builds='').
                        You would use option along with --extra-
                        builds=BUILD1,BUILD2,... to run your own local custom
                        builds.
  --st-extra-builds=STEXTRABUILDS
                        List of comma-separated ST extra build names.  For
                        each of the build names in --st-extra-
                        builds=&lt;BUILD1&gt;,&lt;BUILD2&gt;,..., there must be a file
                        &lt;BUILDN&gt;.config in the local directory along side the
                        COMMON.config file that defines the special build
                        options for the extra build.
  --ss-extra-builds=SSEXTRABUILDS
                        DEPRECATED!  Use --st-extra-builds instead!.
  --extra-builds=EXTRABUILDS
                        List of comma-separated extra build names.  For each
                        of the build names in --extra-
                        builds=&lt;BUILD1&gt;,&lt;BUILD2&gt;,..., there must be a file
                        &lt;BUILDN&gt;.config in the local directory along side the
                        COMMON.config file that defines the special build
                        options for the extra build.
  --send-email-to=SENDEMAILTO
                        List of comma-separated email addresses to send email
                        notification to after every build/test case finishes
                        and at the end for an overall summary and push status.
                        By default, this is the email address you set for git
                        returned by `git config --get user.email`.  In order
                        to turn off email notification, just set --send-email-
                        to='' and no email will be sent.
  --skip-case-send-email
                        If set then if a build/test case is skipped for some
                        reason (i.e. because no packages are enabled) then an
                        email will go out for that case. [default]
  --skip-case-no-email  If set then if a build/test case is skipped for some
                        reason (i.e. because no packages are enabled) then no
                        email will go out for that case. [default]
  --send-email-for-all  If set, then emails will get sent out for all
                        operations. [default]
  --send-email-only-on-failure
                        If set, then emails will only get sent out for
                        failures.
  --send-email-to-on-push=SENDEMAILTOONPUSH
                        List of comma-separated email addresses to send email
                        notification to on a successful push.  This is used to
                        log pushes to a central list.  In order to turn off
                        this email notification, just set --send-email-to-on-
                        push='' and no email will be sent to these email
                        lists.
  --force-push          Force the local push even if there are build/test
                        errors. WARNING: Only do this when you are 100%
                        certain that the errors are not caused by your code
                        changes.  This only applies when --push is specified
                        and this script.
  --no-force-push       Do not force a push if there are failures. [default]
  --do-push-readiness-check
                        Check the push readiness status at the end and send
                        email if not actually pushing. [default]
  --skip-push-readiness-check
                        Skip push status check.
  --rebase              Rebase the local commits on top of origin/master
                        before amending the last commit and pushing.  Rebasing
                        keeps a nice linear commit history like with CVS or
                        SVN and will work perfectly for the basic workflow of
                        adding commits to the 'master' branch and then syncing
                        up with origin/master before the final push. [default]
  --no-rebase           Do not rebase the local commits on top of
                        origin/master before amending the final commit and
                        pushing.  This allows for some more  complex workflows
                        involving local branches with multiple merges.
                        However, this will result in non-linear history and
                        will allow for trivial merge commits with
                        origin/master to get pushed.  This mode should only be
                        used in cases where the rebase mode will not work or
                        when it is desired to use a merge commit to integrate
                        changes on a branch that you wish be able to easily
                        back out.  For sophisticated users of git, this may in
                        fact be the preferred mode.
  --append-test-results
                        Before the final push, amend the most recent local
                        commit by appending a summary of the test results.
                        This provides a record of what builds and tests were
                        performed in order to test the local changes.  This is
                        only  performed if --push is also set.  NOTE: If the
                        same local commit is amended more than once, the prior
                        test summary sections will be overwritten with the
                        most recent test results from the current run.
                        [default]
  --no-append-test-results
                        Do not amend the last local commit with test results.
                        NOTE: If you have uncommitted local changes that you
                        do not want this script to commit then you must select
                        this option to avoid this last amending commit.  Also,
                        if you are pushing commits from a shared branch and
                        don't want to change any of the SHA1s for the commits,
                        then you must set this option!
  --extra-pull-from=EXTRAPULLFROM
                        Optional extra git pull '&lt;repository&gt;:&lt;branch&gt;' to
                        merge in changes from after pulling in changes from
                        'origin'.  This option uses a colon with no spaces in
                        between &lt;repository&gt;:&lt;branch&gt;' to avoid issues with
                        passing arguments with spaces.  For example --extra-
                        pull-from=machine:/base/dir/repo:master.  This extra
                        pull is only done if --pull is also specified.  NOTE:
                        when using --extra-repo=REPO1,REPO2,... the
                        &lt;repository&gt; must be a named repository that is
                        present in all of the git repos or it will be an
                        error.
  --allow-no-pull       Allowing for there to be no pull performed and still
                        doing the other actions.  This option is useful for
                        testing against local changes without having to get
                        the updates from the global repo.  However, if you
                        don't pull, you can't push your changes to the global
                        repo.  WARNING: This does *not* stop a pull attempt
                        from being performed by --pull or --do-all!
  --wipe-clean          [ACTION] Blow existing build directories and
                        build/test results.  The action can be performed on
                        its own or with other actions in which case the wipe
                        clean will be performed before any other actions.
                        NOTE: This will only wipe clean the builds that are
                        specified and will not touch those being ignored (e.g.
                        SERIAL_RELEASE will not be removed if --default-
                        builds=MPI_DEBUG is specified).
  --pull                [ACTION] Do the pull from the default (origin)
                        repository and optionally also merge in changes from
                        the repo pointed to by --extra-pull-from.
  --configure           [ACTION] Do the configure step.
  --build               [ACTION] Do the build step.
  --test                [ACTION] Do the running of the enabled tests.
  --local-do-all        [AGGR ACTION] Do configure, build, and test with no
                        pull (same as setting --allow-no-pull ---configure
                        --build --test).  This is the same as --do-all except
                        it does not do --pull and also allows for no pull.
  --do-all              [AGGR ACTION] Do update, configure, build, and test
                        (same as --pull --configure --build --test).  NOTE:
                        This will do a --pull regardless if --allow-no-pull is
                        set or not.  To avoid the pull, use --local-do-all.
  --push                [ACTION] Push the committed changes in the local repo
                        into to global repo 'origin' for the current branch.
                        Note: If you have uncommitted changes this command
                        will fail.  Note: You must have SSH public/private
                        keys set up with the origin machine (e.g.
                        software.sandia.gov) for the push to happen without
                        having to type your password.
  --execute-on-ready-to-push=EXECUTEONREADYTOPUSH
                        [ACTION] A command to execute on successful execution
                        and 'READY TO PUSH' status from this script.  This can
                        be used to do a remote SSH invocation to a remote
                        machine to do a remote pull/test/push after this
                        machine finishes.

</pre>
</div>
<div class="section" id="gitdist-help">
<h2><a class="toc-backref" href="#id188">13.5&nbsp;&nbsp;&nbsp;gitdist --help</a></h2>
<p>Below is a snapshot of the output from <tt class="docutils literal">gitdist <span class="pre">--help</span></tt>.  For more details on
the usage of <tt class="docutils literal">gitdist</tt>, see <a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a> and <a class="reference internal" href="#multi-repository-development-workflow">Multi-Repository
Development Workflow</a>.</p>
<pre class="literal-block">
Usage: gitdist [gitdist arguments] [git arguments]
       gitdist [gitdist arguments] dist-repo-status

Run git recursively over extra repos and some extra tools for multi-repository
git projects.

Instead of typing:

  $ git [git arguments]

type:

  $ gitdist [gitdist options] [git arguments]

This will distribute git commands across all git repos listed, including the
base git repo.  The options in [gitdist options] are prefixed with '--dist-'
and are are pulled out off before passing the remaining arguments in [git
arguments] to all the git repos.  See --help to see the [gitdist options].

For example, consider the following git repos with other git repos cloned
under it:

  BaseRepo/
    .git/
    ExtraRepo1/
      .git/
    ExtraRep2/
      .git/

The gitdist command is run in the base git repo 'BaseRepo' and the git
commands are run on it as well as the git repos 'ExtraRepo1' and 'ExtraRepo2'.

The set of repos processed is determined by the argument --dist-extra-repos or
the files .gitdist or .gitdist.default.  If --dist-extra-repos=&quot;&quot;, then the
list of extra repos will be read from the file '.gitdist' in the current
working directory.  If the file '.gitdist' does not exist, then the list of
extra repos will be read from the file '.gitdist.default in' the current
working directory.  The format of this files '.gitdist' and '.gitdist.default'
is to have one repo directory/name per line as in:

  ExtraRepo1
  ExtraRepo2
  ...

where each repo is the relative path to the repo under the base git repo
(e.g. under 'BaseRepo/').  The file .gitdist.default is meant to be committed
to the base git repo so that gitdist is ready to use right away.

If an extra repository does not exist, then it will be ignored.  Therefore, be
careful to manually verify that the script recognizes the repositories that
you list.  The best way to do that is to type 'gitdist status'.

This script has no dependencies other than standard python 2.4 packages so it
can be copied to anywhere and used.

TIPS:

 - To see the status of all repos in a compact way, use the speical
   'dist-repo-status' command (see below).

 - To process only changed repos w.r.t. their tracking branch, run
   'gitdist --dist-mod-only [git arguments]'.  For example, to see
   the status of only changed repos use 'gitdist --dist-mod-only status'.

 - Use 'gitdist --no-pager &lt;command&gt; ...' to get the full output from
   all extra repos in one contiguous stream which can then be piped
   to 'less' or to a file to be read with emacs or vi (may also want
   to use --dist-no-color as well).

 - 'gitdist --help' will run gitdist help, not git help.  If you want git
   help, run raw 'git --help'.

 - By default, gitdist will use 'git' in the environment.  If it can't find
   'git' in the environment, it will require that the user specify the git
   command to run with --dist-use-git=&lt;the command&gt;.

 - To exclude processing either the base git repo and/or other git repos
   listed in .gitdist, pass in --dist-not-base-repo and/or
   --dist-not-extra-repos=RepoX,RepoZ,...  This provides complete control over
   what git repos the given git command is run.

SUMMARY OF REPO STATUS:

This script supports the special command 'dist-repo-status' which prints a
nice table showing the current status of all the repos.  For example, for the
repos shown above:

  $ gitdist dist-repo-status

prints a table like:

  ----------------------------------------------------------------
  | ID | Repo Dir        | Branch | Tracking Branch | C | M  | ? |
  |----|-----------------|--------|-----------------|---|----|---|
  |  0 | BaseRepo (Base) | dummy  |                 |   |    |   |
  |  1 | ExtraRepo1      | master | origin/master   | 1 |  2 |   |
  |  2 | ExtraRepo2      | HEAD   |                 |   | 25 | 4 |
  ----------------------------------------------------------------

If the option --dist-legend is passed in, it will print the legend:

Legend:
* ID: Repository ID, zero based (order git commands are run)
* Repo Dir: Relative to base repo (base repo shown first with '(Base)')
* Branch: current branch (or detached HEAD)
* Tracking Branch: Tracking branch (or empty if no tracking branch)
* C: number local commits w.r.t. tracking branch (empty if zero)
* M: number of tracked modified (uncommitted) files (empty if zero)
* ?: number of untracked, non-ignored files (empty if zero)

REPO VERSION FILES:

This script also supports the options --dist-version-file=&lt;versionFile&gt; and
--dist-version-file2=&lt;versionFile2&gt; which are used to provide different SHA1
versions for each repo.  Each of these version files is expected to represent
a compatible set of versions of the repos.

The format of these repo version files is a follows:

-----------------------------------------------------
*** Base Git Repo: BaseRepo
e102e27 [Mon Sep 23 11:34:59 2013 -0400] &lt;author1&#64;someurl.com&gt;
First summary message
*** Git Repo: ExtraRepo1
b894b9c [Fri Aug 30 09:55:07 2013 -0400] &lt;author2&#64;someurl.com&gt;
Second summary message
*** Git Repo: ExtraRepo2
97cf1ac [Thu Dec 1 23:34:06 2011 -0500] &lt;author3&#64;someurl.com&gt;
Third summary message
...
-----------------------------------------------------

Each repository entry can have a summary message or not (i.e. use two or three
lines per repo in the file).  A compatible repo version file can be generated
with this script using, for example, using:

  $ gitdist --dist-no-color log -1 --pretty=format:&quot;%h [%ad] &lt;%ae&gt;%n%s&quot; \
    | grep -v &quot;^$&quot; &amp;&gt; RepoVersion.txt

using three lines per repo, or just:

  $ gitdist --dist-no-color log -1 --pretty=format:&quot;%h [%ad] &lt;%ae&gt;&quot; \
    | grep -v &quot;^$&quot; &amp;&gt; RepoVersion.txt

using two lines per repo in the output file.

This allows checking out consistent versions of the repos, diffing two
consistent versions of the repos, etc.

To checkout an older set of consistent versions of the set of repos, use:

  $ gitdist fetch origin
  $ gitdist --dist-version-file=RepoVersion.SomeDate.txt checkout _VERSION_

The '_VERSION_' string will be replaced with the SHA1 for each of the repos.

To tag and branch the set of repos using a consistent set of versions, use:

  $ gitdist --dist-version-file=RepoVersion.SomeDate.txt \
    tag -a some_tag _VERSION_

To diff two sets of versions of the repos, for example, use:

  $ gitdist --dist-version-file=RepoVersion.NewerDate.txt \
     --dist-version-file2=RepoVersion.OlderDate.txt \
     diff _VERSION_ ^_VERSION2_

Here, _VERSION_ is replaced by the SHA1s listed in RepoVersion.NewerDate.txt
and _VERSION2_ is replaced by the SHA1s listed in RepoVersion.OlderDate.txt.

One can construct any git commit taking one or two different repo version
arguments (SHA1s).

Note that the set of repos listed in the RepoVersion.txt file must be a
super-set of those processed by this script or an error will occur and the
script will stop.

Note that this Python script only depends on the Python 2.4+ standard modules
'sys', 'os', 'subprocess', and 're'. Also, it requires some compatible version
of 'git' at the very minimum as well of course.

COMPARISONS TO GIT SUBMODULE:

The purpose and functioning of gitdist has a lot in common with the build-in
git submodule command.  While git submodule is well suited for pulling in
externally developed git repos, git submodules are not well suited for
managing the co-development of multiple git repos.  A more detailed discussion
of different approaches to managing the development and integration of
multiple git repos, see the TriBITS Developers Guide.

USEFUL ALIASES:

Two very useful Linux/Unix aliases are:

  $ alias gitdist-status=&quot;gitdist dist-repo-status&quot;
  $ alias gitdist-mod=&quot;gitdist --dist-mod-only&quot;

This avoids lot of typing as these arguments are used a lot when working with
many git repos.  For example, to see the status of all your repos, do:

  $ gitdist-status | less

To see the changes in the repos use:

  $ gitdist-mod log --name-status HEAD ^origin/master

or

  $ gitdist-mod local-stat

(where 'local-stat' is a useful git alias defined in the script
'git-config-alias.sh').


Options:
  -h, --help            show this help message and exit
  --dist-use-git=USEGIT
                        The (path) to the git executable to use for each git
                        repo command (default='git')
  --dist-extra-repos=EXTRAREPOS
                        Comma-separated list of extra repos to forward git
                        commands to.  If the list is empty, it will look for a
                        file called .gitdist to get the list of extra repos
                        separated by newlines.
  --dist-not-extra-repos=NOTEXTRAREPOS
                        Comma separated list of extra repos to *not* forward
                        git commands to.  This removes any repos from being
                        processed that would otherwise be.
  --dist-not-base-repo  If set, don't pass the git command on to the base git
                        repo.
  --dist-version-file=VERSIONFILE
                        Path to a file contains a list of extra repo
                        directories and git versions (replaces _VERSION_).
  --dist-version-file2=VERSIONFILE2
                        Path to a second file contains a list of extra repo
                        directories and git versions (replaces _VERSION2_).
  --dist-no-color       If set, don't use color in the output for gitdist
                        (better for output to a file).
  --dist-debug          If set, then debugging info is printed.
  --dist-no-opt         If set, then no git commands will be run but instead
                        will just be printed.
  --dist-mod-only       If set, then the listed git command will be only be
                        run and output for the repo will only be produced if
                        the command 'git diff --name-only ^&lt;tracking-branch&gt;'
                        returns non-empty output where &lt;tracking-branch&gt; is
                        returned from 'rev-parse --abbrev-ref --symbolic-full-
                        name &#64;{u}'.  In order words, if a git repo is
                        unchanged w.r.t. its tracking branch, then the git
                        command is skipped for that repo.  If a repo does not
                        have a tracking branch, then the repo will be skipped
                        as well.  Therefore, be careful to first run with
                        dist-local-stat to see the status of each local repo
                        to know which repos don't have tracking branches.
  --dist-legend         If set, then a legend will be printed below the repo
                        summary table for the special dist-repo-status
                        command.  Only applicable with dist-repo-status.

</pre>
</div>
<div class="section" id="snapshot-dir-py-help">
<span id="snapshot-dir-py"></span><h2><a class="toc-backref" href="#id189">13.6&nbsp;&nbsp;&nbsp;snapshot-dir.py --help</a></h2>
<p>Below is a snapshot of the output from <tt class="docutils literal"><span class="pre">snapshot-dir.py</span> <span class="pre">--help</span></tt>.  For more
details on the usage of <tt class="docutils literal"><span class="pre">snapshot-dir.py</span></tt>, specifically for snapshotting the
<a class="reference internal" href="#projectdir-cmake-tribits">&lt;projectDir&gt;/cmake/tribits/</a> directory, see <a class="reference internal" href="#tribits-directory-snapshotting">TriBITS directory
snapshotting</a>.</p>
<pre class="literal-block">
Usage: snapshot-dir.py [OPTIONS]

This tool snapshots the contents of an origin directory ('orig-dir') to
destination directory ('dest-dir') and creates linkages between the two git
repos in the commit message in the 'dest-dir' git branch.  The command 'git'
must be in the path for this script to be used.

To demonstrate how this script is used, consider the desire to snapshot the
directory tree:

  &lt;some-orig-base-dir&gt;/orig-dir/

and duplicate it in the directory tree

  &lt;some-dest-base-dir&gt;/dest-dir/

Here, the directories can be any two directories from local git repos with any
names as long as they are given a final '/' at the end.  Otherwise, if you are
missing the final '/', then rsync will copy the contents from 'orig-dir' into
a subdir of 'dest-dir' which is usually not what you want.

A typical case is to have snapshot-dir.py soft linked into orig-dir/ to allow
a simple sync process.  This is the case, for example, with the 'tribits'
source tree.  The linked-in location of snapshot-dir.py gives the default
'orig-dir' directory automatically (but can be overridden with --orig-dir
option).

When snapshot-dir.py is soft-linked into the 'orig-dir' directory base, the
way to run this script would be:

  $ cd &lt;some-dest-base-dir&gt;/dest-dir/
  $ &lt;some-orig-base-dir&gt;/orig-dir/snapshot-dir.py

By default, this assumes that git repos are used for both the 'orig-dir' and
'dest-dir' locations.  The info about the origin of the snapshot from
'orig-dir' is recorded in the commit message of the 'dest-dir' git repo to
provide tractability for the versions (see below).

To sync between any two arbitrary directories invoking this script from any
directory location, one can do:

  $ &lt;some-base-dir&gt;/snapshot-dir.py \
    --orig-dir=&lt;some-orig-dir&gt;/ \
    --dest-dir=&lt;some-dest-dir&gt;/

Note the trailing '/' is critical for the correct functioning of rsync.

By default, this script does the following:

1) Asserts that the git repo for 'orig-dir' is clean (i.e. no uncommitted
   files, no unknown files, etc.).  This can be disabled by passing in
   --allow-dirty-orig-dir.

2) Asserts that the git repo for &lt;some-dest-dir&gt;/ is clean (see above).  This
   can be disabled by passing in --allow-dirty-dest-dir.

3) Run 'rsync -av --delete' to copy the contents from 'orig-dir' to
   'dest-dir', excluding the '.git/' directory if it exists in either git repo
   dir.  After this runs, &lt;some-dest-dir&gt;/ should be an exact duplicate of
   &lt;some-orig-dir&gt;/ (except for otherwise noted excluded files).  This rsync
   will delete any files in 'dest-dir' that are not in 'orig-dir'.  Note that
   if there are ignored untracked files, then the copied .gitignore files
   should avoid showing them as tracked or unknown files in the 'dest-dir' git
   repo as well.

4) Run 'git add .' in &lt;some-dest-dir&gt;/ to stage any new files.  Note that git
   will automatically stage deletes for any files removed by the 'rsync -av
   --delete' command!

5) Get the git remote URL from the orig-dir git repo, and the git log for the
   last commit for the directory from orig-dir.  This information is used to
   define perfect tracing of the version info when doing the snapshot.

6) Commit the updated dest-dir directory using a commit message with the
   orig-dir repo URL and log info.  This will only commit files in 'dest-dir'
   and not in other directories in the destination git repo!

NOTES:

* This script allows the syncing between base git repos or subdirs within git
  repos.  This is allowed because the rsync command is told to ignore the
  .git/ directory when syncing.

* Snapshotting with this script will create an exact duplicate of 'orig-dir'
  in 'dest-dir' and therefore if there are any local changes to the files or
  chagnes after the last snapshot, they will get wiped out.  To avoid this, do
  the snapshot on a branch in the 'dest-dir' git repo, then merge that branch
  into the master branch in 'dest-dir' repo that has the local changes.  As
  long as there are no merge conflicts, this will preserve local changes for
  the mirrored directories and files.  This works amazingly well in most
  cases.


Options:
  -h, --help            show this help message and exit
  --show-defaults       Show the default option values and do nothing at all.
  --orig-dir=ORIGDIR    Original directory that is the source for the
                        snapshotted directory.  Note that it is important to
                        add a final /' to the directory name.  The default is
                        the directory where this script lives (or is soft-
                        linked).  [default: '&lt;orig-dir&gt;']
  --dest-dir=DESTDIR    Destination directory that is the target for the
                        snapshoted directory.  Note that a final '/' just be
                        added or the origin will be added as subdir.  The
                        default dest-dir is current working directory.
                        [default: '&lt;dest-dir&gt;']
  --assert-clean-orig-dir
                        Check that orig-dir is committed and clean. [default]
  --allow-dirty-orig-dir
                        Skip clean check of orig-dir.
  --assert-clean-dest-dir
                        Check that dest-dir is committed and clean. [default]
  --allow-dirty-dest-dir
                        Skip clean check of dest-dir.
  --do-rsync            Actually do the rsync. [default]
  --skip-rsync          Skip the rsync (testing only?).
  --do-commit           Actually do the commit. [default]
  --skip-commit         Skip the commit.

</pre>
<!-- *** -->
<!-- *** Common references -->
<!-- ** -->
<!-- Common references to TribitsBuildQuickRef document -->
<!-- Common references to the TribitsOverview document -->
<!-- Common references to the TribitsLifecycleModel document -->
<!-- Other common references -->
<!-- Common references to raw CMake commands: -->
<!-- LocalWords:  TribitsOverview TribitsLifecycleModel Lifecycle CMakeLists -->
<!-- LocalWords:  TriBITS Subpackage subpackage Subpackages subpackages TPL TPLs Kitware -->
<!-- LocalWords:  CMake cmake CTest ctest CDash CPack WithSubpackages WithSubpackagesA -->
<!-- LocalWords:  WithSubpackagesB WithSubpackagesC executables FOREACH ENDFOREACH -->
</div>
</div>
</div>
</body>
</html>

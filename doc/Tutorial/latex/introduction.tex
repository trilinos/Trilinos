% @HEADER
% ***********************************************************************
% 
%            Trilinos: An Object-Oriented Solver Framework
%                 Copyright (2001) Sandia Corporation
% 
% Under terms of Contract DE-AC04-94AL85000, there is a non-exclusive
% license for use of this work by or on behalf of the U.S. Government.
% 
% This library is free software; you can redistribute it and/or modify
% it under the terms of the GNU Lesser General Public License as
% published by the Free Software Foundation; either version 2.1 of the
% License, or (at your option) any later version.
%  
% This library is distributed in the hope that it will be useful, but
% WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
% Lesser General Public License for more details.
%  
% You should have received a copy of the GNU Lesser General Public
% License along with this library; if not, write to the Free Software
% Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
% USA
% Questions? Contact Michael A. Heroux (maherou@sandia.gov) 
% 
% ***********************************************************************
% @HEADER

\section{Introduction}

%%%
%%%
%%%

\subsection{Getting Started}
\label{sec:getting}

The Trilinos Project uses a two-level software structure designed around
collections of {\sl packages}. A Trilinos package is an integral unit,
usually developed to solve a specific task, by a (relatively) small
group of experts.  Packages exist underneath the Trilinos top level,
which provides a common look-and-feel. Each package has its own
structure, documentation and set of examples, and it is possibly
available independently of Trilinos. However, each package is even more
valuable when combined with other Trilinos packages.

\smallskip

Trilinos is a large software project, and currently about twenty
packages are included.  The entire set of packages covers a wide range
of numerical methods for large scale computing, as well as a large set
of utilities to improve the development of software for scientific
computing. 

Clearly, a fully understanding all the functionalities of the Trilinos
packages requires time.  Each package offers sophisticated features,
difficult to ``unleashed'' at a first sight.  Besides that, a detailed
description of each Trilinos package is beyond the scope of this
document: the reader is referred to the documentation contained in each
package. For those reasons, we will limit ourselves to the basic (and
intermediate) features. Our goal is to present enough material so that
the reader can be sufficiently familiar with the described packages.  In
fact, for new users, it is neither easy, nor necessary, to manage all
the Trilinos functionalities.  At the beginning, it is more important to
understand how to manipulate the basic classes, such as vector, matrix
and linear system classes.  For a successive fine-tuning phase, users
still must look through individual package's documentation and examples.

\medskip

We will describe the following subset of the Trilinos packages.
\begin{itemize} 
\item {\bf Epetra}. The package defines the basic classes for
  distributed matrices and vectors, linear operators and linear
  problems. Epetra classes are the common language spoken by all the
  Trilinos packages (even if some packages can ``speak'' other
  languages). Each Trilinos package accepts as input Epetra objects.
  This allows powerful combinations among the various Trilinos
  functionalities.
\item {\bf Triutils}. This is a collection of utilities, that can be
  useful in some phases of software development. Here, we present a
  command line parser and a matrix generator, that are used throughout
  this document to define example matrices.
\item {\bf AztecOO}. This is a linear solve package based on
  preconditioned Krylov methods. It supports all the Aztec interfaces
  and functionality, but also provides significant new functionality.
\item {\bf IFPACK}. The package performs various incomplete
  factorizations, and is here used with AztecOO.
\item {\bf ML}. The algebraic multilevel and domain decomposition
  preconditioner package provides scalable preconditioning capabilities
  for a variety of problem classes. It is here used as a preconditioner
  for AztecOO solvers.
\item {\bf Amesos}. The package provides a common interface to certain
  sparse direct linear solvers (generally available outside the Trilinos
  framework), both sequential and parallel.
\item {\bf Anasazi}. The package provides a common interface to
  parallel eigenvalues and eigenvectors solvers, for both symmetric and
  non-symmetric linear problems.
\item {\bf NOX}. This is a collection of nonlinear solvers, designed to
  be easily integrated into an application and used with many different
  linear solvers.
\item {\bf Teuchos}. This is a collection of classes that can be
  essential for advanced code development.
\end{itemize}

Table~\ref{tab:tripackages} gives a partial overview of what can be
accomplished using Trilinos.
\begin{table}[htbp]
  \centering
  \begin{tabular}{| p{8cm} | p{2.5cm} | p{3cm} |}
    \hline
    {\bf Task} & {\bf Package} & {\bf Tutorial}\\
    \hline
    Definition of serial dense or sparse matrices: & Epetra 
    & Chapter \ref{chap:epetra_mat} \\
    Utilities for Epetra vectors and sparse matrices: & EpetraExt & -- 
    \\
    Templated distributed vectors and sparse matrices: & Tpetra$^\star$
    & -- \\
    Definition of distributed sparse matrices:& Epetra & -- \\
    Solve a linear system with preconditioned Krylov accelerators, like
    CG, GMRES, Bi-CGSTAB, TFQMR:& AztecOO, Belos$^\star$ &
    Chapter \ref{chap:aztecoo} \\
    Definition of incomplete factorizations:& AztecOO, \newline IFPACK &
    Chapter \ref{chap:ifpack} \\
    Definition of a multilevel preconditioner:& ML & Chapter
    \ref{chap:ml} \\
    Definition of black-box smoothed aggregation:& ML & Section
    \ref{ML_Preconditioner} \\
    Definition of a one-level Schwarz preconditioner (overlapping domain
    decomposition):& AztecOO, \newline IFPACK & Chapter \ref{chap:ifpack} \\
    Definition a two-level Schwarz preconditioner, with coarse grid based on
    aggregation:& AztecOO+ML & Section \ref{sec:ml_DD} \\
    Solution of  systems of nonlinear equations:& NOX & Chapter \ref{chap:nox} \\
    Interface with various direct solvers, as UMFPACK, MUMPS, SuperLU
    and others :& Amesos & Chapter \ref{chap:amesos} \\
    Computation of eigenvalue of large, sparse matrices:& Anasazi &
    Chapter \ref{chap:anasazi} 
    \\
    Solution of complex linear equations (using equivalent real formulation):&
    Komplex$^\star$ & -- \\
    Definition of segregated preconditioners and block preconditioners (for
    instance, for the incompressible Navier-Stokes equations):&
    Meros$^\star$ & -- \\
    Light-weight interface to BLAS and LAPACK: & Epetra 
    & Chapter \ref{chap:epetra_mat} \\
    Templated interface to BLAS and LAPACK, arbitrary-precision
    arithmetic, parameters; list, smart pointers:& Teuchos &
    Section \ref{sec:teuchos:LAPACK} \\
    Definition of abstract interfaces to vectors, linear operators, and
    solvers:& TSF$^\star$, TSFCore$^\star$, TSFExtended$^\star$   & --
    \\
    Generation of matrices & Triutils & Section~\ref{sec:triutils:gallery} \\
    \hline
  \end{tabular}
  \caption{Partial overview of intended uses of  Trilinos. $\star$:
    not covered in this tutorial.}
  \label{tab:tripackages}
\end{table}

\begin{remark}
  As already pointed out, Epetra objects are meant to be the ``common
  language'' spoken by all the Trilinos packages, and are a natural
  starting point for new users. Therefore we suggest to read Chapters
  \ref{chap:epetra_vec}-\ref{chap:epetra_others} before considering
  other Trilinos packages. Chapter~\ref{chap:triutils} is not essential
  to understand Trilinos, but the functionalities there presented are
  used in this document as a starting point for many examples.
  Chapter~\ref{chap:aztecoo} should be read before
  Chapters~\ref{chap:ifpack} and~\ref{chap:ml} (even if both IFPACK and
  ML can be compiled and run without AztecOO).
\end{remark}

The only prerequisites assumed in this tutorial are some familiarities
with numerical methods for PDEs, and with iterative linear and nonlinear
solvers. Although not strictly necessary, the reader is assumed to have
some familiarity with distributed memory computing and, to a lesser
extent, with MPI\footnote{Although almost no explicit MPI instructions
  are required in a Trilinos code, the reader should be aware of the
  basic concepts of message passing, like the definition of a
  communicator.}.

\smallskip

Note that this tutorial is not a substitute for individual packages'
documentation. Also, for an overview of all the Trilinos packages, the
Trilinos philosophy, and a description of the packages provided by
Trilinos, the reader is referred to \cite{Trilinos-Overview}.
Developers should also consider the Trilinos Developers' Guide, which
addresses many topics, including the development tools used by Trilinos'
developers, and how to include a new package\footnote{ Trilinos provides
  a variety of services to a developer wanting to integrate a package
  into Trilinos.  The services include Autoconf~\cite{Autoconf},
  Automake~\cite{Automake} and Libtool~\cite{Libtool}. The tools provide
  a robust, full-featured set of tools for building software across a
  broad set of platforms.  The tools are not officially standards, but
  are widely used.  All existing Trilinos packages use Autoconf and
  Automake.  Libtool support will be added in future releases.}.

%%%
%%%
%%%

\subsection{Installation}
\label{sec:installing}

To obtain Trilinos, please refers to the instructions reported at the
following web site:
\begin{verbatim}
http://software.sandia.gov/Trilinos
\end{verbatim}

Trilinos has been compiled on a variety of architectures, including
various flavors of Linux, Sun Solaris, SGI Irix, DEC, ASCI Red, and many
others. Trilinos has been designed to support parallel applications.
However, it can be compiled and run on serial computer.  Detailed
comments on the installation, and an exhaustive list of FAQs, can be
found at the web pages:
\begin{verbatim}
http://software.sandia.gov/Trilinos/installing_manual.html
http://software.sandia.gov/Trilinos/faq.html
\end{verbatim}


Suppose that we will compile on a LINUX platform with MPI. Here, we {\sl
  suggest} to set the environmental
variables \verb!TRILINOS_HOME!, indicating the full path of the Trilinos
directory, \verb!TRILINOS_LIB!, indicating the location of the compiled
Trilinos library, and \verb!TRILINOS_ARCH!, containing the architecture
and the communicator currently used.  For example, using the BASH shell,
command lines of the form
\begin{verbatim}
export TRILINOS_HOME=/home/msala/Trilinos
export TRILINOS_ARCH=LINUX.MPI
export TRILINOS_LIB=${TRILINOS_HOME}/${TRILINOS_ARCH}
\end{verbatim}
can be places in the users' \verb!.bashrc! file.

\smallskip

Each Trilinos' package can be enabled or disabled at configuration time.
A procedure one may follow in order to compile Trilinos with AztecOO,
ML, IFPACK, Anasazi, NOX, and Triutils is reported below. \$ indicates the
shell prompt. The \verb!tee! command is used to write the output to
standard output and to the specified file, and can be omitted.  More
details about the installation of Trilinos can be found in
\cite{Trilinos-Users-Guide}.
\begin{verbatim}
$ cd ${TRILINOS_HOME}
$ mkdir ${TRILINOS_ARCH}
$ cd ${TRILINOS_ARCH}
$ ../configure --prefix=${TRILINOS_HOME}/${TRILINOS_ARCH} \
  --enable-mpi --with-mpi-compilers \
  --enable-triutils --enable-aztecoo \
  --enable-ifpack --enable-anasazi \
  --enable-ml --enable-nox  \
  --enable-nox-epetra | tee configure_${TRILINOS_ARCH}.log
$ make | tee make_${TRILINOS_ARCH}.log
$ make install | tee make_install_${TRILINOS_ARCH}.log
\end{verbatim}
For serial configuration, set
\begin{verbatim}
export TRILINOS_ARCH=LINUX.SERIAL
\end{verbatim}
and delete the \verb!--enable-mpi --with-mpi-compilers! options.
\begin{remark}
  All Trilinos packages can be build to run with or without MPI. If MPI
  is enabled (using \verb!--enable-mpi!), the users must know the
  procedure for beginning MPI jobs on their computer system(s). It may be
  necessary to specify on the configure line the location of MPI include
  files and libraries.
\end{remark}

%%%
%%%
%%%

\subsection{Compiling and Linking a program using Trilinos}
\label{sec:intro_compiling}

In order to compile and link a code that makes use of Trilinos, the user
may decide to use a Makefile similar to the one reported below.  Suppose
that our code requires Epetra, AztecOO and IFPACK, and that the
procedure outlined in Section~\ref{sec:installing} has been followed.
The UNIX makefile can be as follows (line number are reported for
reader's convenience):
\begin{verbatim}
 1: TRILINOS_HOME = /home/msala/Trilinos/
 2: TRILINOS_ARCH - LINUX_MPI
 3: TRILINOS_LIB = $(TRILINOS_HOME)$(TRILINOS_ARCH)
 4: 
 5: include $(TRILINOS_HOME)/build/makefile.$(TRILINOS_ARCH)
 6: 
 7: MY_COMPILER_FLAGS = -DHAVE_CONFIG_H $(CXXFLAGS) -c -g\
 8:                    -I$(TRILINOS_LIB)/include/
 9:
10: MY_LINKER_FLAGS = $(LDFLAGS) $(TEST_C_OBJ) \
11:         -L$(TRILINOS_LIB)/lib/ \
12:         -lifpack -laztecoo -lepetra $(ARCH_LIBS)
14:
15: ex1: ex1.cpp
16:         $(CXX)     ex1.cpp $(MY_COMPILER_FLAGS)
17:         $(LINKER)  ex1.o   $(MY_LINKER_FLAGS)    -o ex1.exe
\end{verbatim}
Here we assume that the reader knows about UNIX makefiles.  Line 5
includes basic definitions of Trilinos. (On some architectures, one may
need to use \verb!gmake! instead of \verb!make!.)  In line 7, the
variable \verb!HAVE_CONFIG_H! is defined.  This definition is extremely
important, and must not be omitted.  Linker flags of lines 10-13 defines
the library to link (other libraries may be needed).  The variable
\verb!ARCH_LIBS! is defined in line 5.

In this example, the name of the executable is \verb!ex1.exe!.  The
command to run this example on 2 processors is often
\begin{verbatim}
$ mpirun -np 2 ./ex1.exe
\end{verbatim}
Please check the local MPI documentation for more details. 

%%%
%%%
%%%

\subsection{Copyright and Licensing of Trilinos}
\label{sec:copyright}

Trilinos is released under the Lesser GPL GNU Licence.

Trilinos is copyrighted by Sandia Corporation. Under the terms of
Contract DE-AC04-94AL85000, there is a non-exclusive license for use of
this work by or on behalf of the U.S. Government.  Export of this
program may require a license from the United States Government.

NOTICE: The United States Government is granted for itself and others
acting on its behalf a paid-up, nonexclusive, irrevocable worldwide
license in ths data to reproduce, prepare derivative works, and perform
publicly and display publicly.  Beginning five (5) years from July 25,
2001, the United States Government is granted for itself and others
acting on its behalf a paid-up, nonexclusive, irrevocable worldwide
license in this data to reproduce, prepare derivative works, distribute
copies to the public, perform publicly and display publicly, and to
permit others to do so.

NEITHER THE UNITED STATES GOVERNMENT, NOR THE UNITED STATES DEPARTMENT
OF ENERGY, NOR SANDIA CORPORATION, NOR ANY OF THEIR EMPLOYEES, MAKES ANY
WARRANTY, EXPRESS OR IMPLIED, OR ASSUMES ANY LEGAL LIABILITY OR
RESPONSIBILITY FOR THE ACCURACY, COMPLETENESS, OR USEFULNESS OF ANY
INFORMATION, APPARATUS, PRODUCT, OR PROCESS DISCLOSED, OR REPRESENTS
THAT ITS USE WOULD NOT INFRINGE PRIVATELY OWNED RIGHTS.

\medskip

Some parts of Trilinos are dependent on a third party code. Each third
party code comes with its own copyright and/or licensing requirements.
It is responsibility of the user to understand these requirements.

%%%
%%%
%%%

\subsection{Programming Language Used in this Tutorial}
\label{sec:language}

Trilinos is written in C++ (for most packages), and in C. Some
interfaces are provided to FORTRAN codes (mainly BLAS and LAPACK
routines). Even if limited support is included for C programs (and a
more limited for FORTRAN code), to unleash the full power of Trilinos we
recommend C++. All the example programs contained in this tutorial are
in C++; some packages (like ML) contain examples in C.

%%%
%%%
%%%

\subsection{Referencing Trilinos}
\label{sec:referencing}

The Trilinos project can be referenced by using the following BiBTeX
citation information:
\begin{verbatim}
@techreport{Trilinos-Overview,
title = "{An Overview of Trilinos}",
author = "Michael Heroux and Roscoe Bartlett and Vicki Howle
Robert Hoekstra and Jonathan Hu and Tamara Kolda and
Richard Lehoucq and Kevin Long and Roger Pawlowski and
Eric Phipps and Andrew Salinger and Heidi Thornquist and
Ray Tuminaro and James Willenbring and Alan Williams ",
institution = "Sandia National Laboratories",
number = "SAND2003-2927",
year = 2003}

@techreport{Trilinos-Dev-Guide,
title = "{Trilinos Developers Guide}",
author = "Michael A. Heroux and James M. Willenbring and Robert Heaphy",
institution = "Sandia National Laboratories",
number = "SAND2003-1898",
year = 2003}

@techreport{Trilinos-Dev-Guide-II,
title = "{Trilinos Developers Guide Part II: ASCI Software Quality
Engineering Practices Version 1.0}",
author = "Michael A. Heroux and James M. Willenbring and Robert Heaphy",
institution = "Sandia National Laboratories",
number = "SAND2003-1899",
year = 2003}

@techreport{Trilinos-Users-Guide,
title = "{Trilinos Users Guide}",
author = "Michael A. Heroux and James M. Willenbring",
institution = "Sandia National Laboratories",
number = "SAND2003-2952",
year = 2003}
\end{verbatim}
The BiBTeX information is available at the web page
\begin{verbatim}
http://software.sandia.gov/Trilinos/citing.html
\end{verbatim}

%%%
%%%
%%%

\subsection{A Note on the Directory Structure}
\label{sec:into_note}

Each Trilinos package in contained in the subdirectory
\begin{verbatim}
${TRILINOS_HOME}/packages
\end{verbatim}
Each package contains sources, examples, tests and documentation subdirectories:
\begin{verbatim}
${TRILINOS_HOME}/packages/<package-name>/src
${TRILINOS_HOME}/packages/<package-name>/examples
${TRILINOS_HOME}/packages/<package-name>/test
${TRILINOS_HOME}/packages/<package-name>/doc
\end{verbatim}
Developers' documentation is written using Doxygen\footnote{Copyright
  \copyright 1997-2003 by Dimitri van Heesch. More information can by
  found at the web address {\tt
    http://www.stack.nl/~dimitri/doxygen/}.}. The command to create For
instance, to create the documentation for Epetra are
\begin{verbatim}
$ cd ${TRILINOS_HOME}/packages/epetra/doc
$ doxygen
\end{verbatim}
Generally, both HTML and \LaTeX documentation are created by Doxygen.
The browser of choice can be used to walk through the HTML
documentation.  To compile the \LaTeX sources, the commands are:
\begin{verbatim}
$ cd ${TRILINOS_HOME}/packages/epetra/doc/latex
$ make
\end{verbatim}

%%%
%%%
%%%

\subsection{List of Trilinos Developers}
\label{sec:intro_incomplete}

The Trilinos' developers as of May 2004 are (in alphabetical order):

Roscoe A. Bartlett,
Jason A. Cross,
David M. Day,
Robert Heaphy,
Michael A. Heroux (project leader),
Russell Hooper,
Vicki E. Howle,
Robert J. Hoekstra,
Jonathan J. Hu,
Tamara G. Kolda,
Richard B. Lehoucq,
Paul Lin,
Kevin R. Long,
Roger P. Pawlowski,
Michael N. Phenow,
Eric T. Phipps,
Andrew J. Rothfuss,
Marzio Sala,
Andrew G. Salinger,
Paul M. Sexton,
Kendall S. Stanley,
Heidi K. Thornquist,
Ray S. Tuminaro,
James M. Willenbring, and
Alan Williams.

